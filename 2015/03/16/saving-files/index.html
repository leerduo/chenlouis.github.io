
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Saving Files | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="Android uses a file system that’s similar to disk-based file systems on other platforms. This lesson describes how to work with the Android file syste">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/16/saving-files/" title="Saving Files" itemprop="url">Saving Files</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-16T02:12:33.000Z" itemprop="datePublished">2015-03-16</time>
    更新日期:<time datetime="2015-04-20T07:21:35.638Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Choose_Internal_or_External_Storage"><span class="toc-number">1.</span> <span class="toc-text">Choose Internal or External Storage</span></a></li></ol>
		</div>
		
		<p>Android uses a file system that’s similar to disk-based file systems on other platforms. This lesson describes how to work with the Android file system to read and write files with the <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> APIs.</p>
<p>A <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> object is suited to reading or writing large amounts of data in start-to-finish order without skipping around. For example, it’s good for image files or anything exchanged over a network.</p>
<p>This lesson shows how to perform basic file-related tasks in your app. The lesson assumes that you are familiar with the basics of the Linux file system and the standard file input/output APIs in <code>[java.io](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/package-summary.html)</code>.</p>
<h2 id="Choose_Internal_or_External_Storage">Choose Internal or External Storage</h2><hr>
<p>All Android devices have two file storage areas: “internal” and “external” storage. These names come from the early days of Android, when most devices offered built-in non-volatile memory (internal storage), plus a removable storage medium such as a micro SD card (external storage). Some devices divide the permanent storage space into “internal” and “external” partitions, so even without a removable storage medium, there are always two storage spaces and the API behavior is the same whether the external storage is removable or not. The following lists summarize the facts about each storage space.</p>
<div><br><br><strong>Internal storage:</strong><br><br><em>   It’s always available.
</em>   Files saved here are accessible by only your app by default.<br><em>   When the user uninstalls your app, the system removes all your app’s files from internal storage.<br>Internal storage is best when you want to be sure that neither the user nor other apps can access your files.<br><br></em></div><br><div><br><br><strong>External storage:</strong>

   It’s not always available, because the user can mount the external storage as USB storage and in some cases remove it from the device.<br><em>   It’s world-readable, so files saved here may be read outside of your control.
</em>   When the user uninstalls your app, the system removes your app’s files from here only if you save them in the directory from <code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code>.<br>External storage is the best place for files that don’t require access restrictions and for files that you want to share with other apps or allow the user to access with a computer.<br><br></div><br><strong>Tip:</strong> Although apps are installed onto the internal storage by default, you can specify the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-element.html#install" target="_blank" rel="external"><code>android:installLocation</code></a> attribute in your manifest so your app may be installed on external storage. Users appreciate this option when the APK size is very large and they have an external storage space that’s larger than the internal storage. For more information, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/data/install-location.html" target="_blank" rel="external">App Install Location</a>.<br><br>## Obtain Permissions for External Storage<br><br><em> </em> <em><br><br>To write to the external storage, you must request the <code>[WRITE_EXTERNAL_STORAGE](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE)</code> permission in your<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-intro.html" target="_blank" rel="external">manifest file</a>:<br><br>[xml]&lt;manifest …&gt;<br>&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;<br>…<br>&lt;/manifest&gt;[/xml]<br><div><br><br><strong>Caution:</strong> Currently, all apps have the ability to read the external storage without a special permission. However, this will change in a future release. If your app needs to read the external storage (but not write to it), then you will need to declare the <code>[READ_EXTERNAL_STORAGE](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE)</code> permission. To ensure that your app continues to work as expected, you should declare this permission now, before the change takes effect.<br><br>[xml]&lt;manifest …&gt;<br>&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;<br>…<br>&lt;/manifest&gt;[/xml]<br><br>However, if your app uses the <code>[WRITE_EXTERNAL_STORAGE](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE)</code> permission, then it implicitly has permission to read the external storage as well.<br><br></div><br>You don’t need any permissions to save files on the internal storage. Your application always has permission to read and write files in its internal storage directory.<br><br>## Save a File on Internal Storage

</em> <em> </em><br><br>When saving a file to internal storage, you can acquire the appropriate directory as a <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> by calling one of two methods:<br><br><dl><dt><code>[getFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getFilesDir())</code></dt><dd>Returns a <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> representing an internal directory for your app.</dd><dt><code>[getCacheDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getCacheDir())</code></dt><dd>Returns a <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> representing an internal directory for your app’s temporary cache files. Be sure to delete each file once it is no longer needed and implement a reasonable size limit for the amount of memory you use at any given time, such as 1MB. If the system begins running low on storage, it may delete your cache files without warning.</dd></dl>To create a new file in one of these directories, you can use the <code>[File()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#File(java.io.File, java.lang.String))</code> constructor, passing the<code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> provided by one of the above methods that specifies your internal storage directory. For example:<br><br>[java]File file = new File(context.getFilesDir(), filename);[/java]<br><br>Alternatively, you can call <code>[openFileOutput()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#openFileOutput(java.lang.String, int))</code> to get a <code>[FileOutputStream](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/FileOutputStream.html)</code> that writes to a file in your internal directory. For example, here’s how to write some text to a file:<br><br>[java]String filename = &quot;myfile&quot;;<br>String string = &quot;Hello world!&quot;;<br>FileOutputStream outputStream;<br><br>try {<br>outputStream = openFileOutput(filename, Context.MODE_PRIVATE);<br>outputStream.write(string.getBytes());<br>outputStream.close();<br>} catch (Exception e) {<br>e.printStackTrace();<br>}[/java]<br><br>Or, if you need to cache some files, you should instead use <code>[createTempFile()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#createTempFile(java.lang.String, java.lang.String))</code>. For example, the following method extracts the file name from a <code>[URL](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/net/URL.html)</code> and creates a file with that name in your app’s internal cache directory:<br><br>[java]public File getTempFile(Context context, String url) {<br>File file;<br>try {<br>String fileName = Uri.parse(url).getLastPathSegment();<br>file = File.createTempFile(fileName, null, context.getCacheDir());<br>catch (IOException e) {<br>// Error while creating file<br>}<br>return file;<br>}[/java]<br><br><strong>Note:</strong> Your app’s internal storage directory is specified by your app’s package name in a special location of the Android file system. Technically, another app can read your internal files if you set the file mode to be readable. However, the other app would also need to know your app package name and file names. Other apps cannot browse your internal directories and do not have read or write access unless you explicitly set the files to be readable or writable. So as long as you use<code>[MODE_PRIVATE](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#MODE_PRIVATE)</code> for your files on the internal storage, they are never accessible to other apps.<br><br>## Save a File on External Storage<br><br><em> </em> <em><br><br>Because the external storage may be unavailable—such as when the user has mounted the storage to a PC or has removed the SD card that provides the external storage—you should always verify that the volume is available before accessing it. You can query the external storage state by calling<code>[getExternalStorageState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStorageState())</code>. If the returned state is equal to <code>[MEDIA_MOUNTED](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#MEDIA_MOUNTED)</code>, then you can read and write your files. For example, the following methods are useful to determine the storage availability:<br><br>[java]/</em> Checks if external storage is available for read and write <em>/<br>public boolean isExternalStorageWritable() {<br>String state = Environment.getExternalStorageState();<br>if (Environment.MEDIA_MOUNTED.equals(state)) {<br>return true;<br>}<br>return false;<br>}<br><br>/</em> Checks if external storage is available to at least read <em>/<br>public boolean isExternalStorageReadable() {<br>String state = Environment.getExternalStorageState();<br>if (Environment.MEDIA_MOUNTED.equals(state) ||<br>Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {<br>return true;<br>}<br>return false;<br>}[/java]<br><br>Although the external storage is modifiable by the user and other apps, there are two categories of files you might save here:<br><br><dl><dt>Public files</dt><dd>Files that should be freely available to other apps and to the user. When the user uninstalls your app, these files should remain available to the user.For example, photos captured by your app or other downloaded files.<br><br></dd><dt>Private files</dt><dd>Files that rightfully belong to your app and should be deleted when the user uninstalls your app. Although these files are technically accessible by the user and other apps because they are on the external storage, they are files that realistically don’t provide value to the user outside your app. When the user uninstalls your app, the system deletes all files in your app’s external private directory.For example, additional resources downloaded by your app or temporary media files.<br><br></dd></dl>If you want to save public files on the external storage, use the <code>[getExternalStoragePublicDirectory()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String))</code>method to get a <code>[File](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html)</code> representing the appropriate directory on the external storage. The method takes an argument specifying the type of file you want to save so that they can be logically organized with other public files, such as <code>[DIRECTORY_MUSIC](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_MUSIC)</code> or <code>[DIRECTORY_PICTURES](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_PICTURES)</code>. For example:<br><br>[java]public File getAlbumStorageDir(String albumName) {<br>// Get the directory for the user’s public pictures directory.<br>File file = new File(Environment.getExternalStoragePublicDirectory(<br>Environment.DIRECTORY_PICTURES), albumName);<br>if (!file.mkdirs()) {<br>Log.e(LOG_TAG, &quot;Directory not created&quot;);<br>}<br>return file;<br>}[/java]<br><br>If you want to save files that are private to your app, you can acquire the appropriate directory by calling <code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code> and passing it a name indicating the type of directory you’d like. Each directory created this way is added to a parent directory that encapsulates all your app’s external storage files, which the system deletes when the user uninstalls your app.<br><br>For example, here’s a method you can use to create a directory for an individual photo album:<br><br>[java]public File getAlbumStorageDir(Context context, String albumName) {<br>// Get the directory for the app’s private pictures directory.<br>File file = new File(context.getExternalFilesDir(<br>Environment.DIRECTORY_PICTURES), albumName);<br>if (!file.mkdirs()) {<br>Log.e(LOG_TAG, &quot;Directory not created&quot;);<br>}<br>return file;<br>}[/java]<br><br>If none of the pre-defined sub-directory names suit your files, you can instead call<code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code> and pass <code>null</code>. This returns the root directory for your app’s private directory on the external storage.<br><br>Remember that <code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code> creates a directory inside a directory that is deleted when the user uninstalls your app. If the files you’re saving should remain available after the user uninstalls your app—such as when your app is a camera and the user will want to keep the photos—you should instead use <code>[getExternalStoragePublicDirectory()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String))</code>.<br><br>Regardless of whether you use <code>[getExternalStoragePublicDirectory()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String))</code> for files that are shared or<code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code> for files that are private to your app, it’s important that you use directory names provided by API constants like <code>[DIRECTORY_PICTURES](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_PICTURES)</code>. These directory names ensure that the files are treated properly by the system. For instance, files saved in <code>[DIRECTORY_RINGTONES](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_RINGTONES)</code> are categorized by the system media scanner as ringtones instead of music.<br><br>## Query Free Space

</em> <em> </em><br><br>If you know ahead of time how much data you’re saving, you can find out whether sufficient space is available without causing an <code>[IOException](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/IOException.html)</code> by calling <code>[getFreeSpace()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getFreeSpace())</code> or <code>[getTotalSpace()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getTotalSpace())</code>. These methods provide the current available space and the total space in the storage volume, respectively. This information is also useful to avoid filling the storage volume above a certain threshold.<br><br>However, the system does not guarantee that you can write as many bytes as are indicated by<code>[getFreeSpace()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getFreeSpace())</code>. If the number returned is a few MB more than the size of the data you want to save, or if the file system is less than 90% full, then it’s probably safe to proceed. Otherwise, you probably shouldn’t write to storage.<br><br><strong>Note:</strong> You aren’t required to check the amount of available space before you save your file. You can instead try writing the file right away, then catch an <code>[IOException](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/IOException.html)</code> if one occurs. You may need to do this if you don’t know exactly how much space you need. For example, if you change the file’s encoding before you save it by converting a PNG image to JPEG, you won’t know the file’s size beforehand.<br><br>## Delete a File<br><br><em> </em> <em><br><br>You should always delete files that you no longer need. The most straightforward way to delete a file is to have the opened file reference call <code>[delete()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#delete())</code> on itself.<br><br>[java]myFile.delete();[/java]<br><br>If the file is saved on internal storage, you can also ask the <code>[Context](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html)</code> to locate and delete a file by calling <code>[deleteFile()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#deleteFile(java.lang.String))</code>:<br><br>[java]myContext.deleteFile(fileName);[/java]<br><div><br><br><strong>Note:</strong> When the user uninstalls your app, the Android system deletes the following:

</div></em>   All files you saved on internal storage<br>*   All files you saved on external storage using <code>[getExternalFilesDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String))</code>.<br>However, you should manually delete all cached files created with <code>[getCacheDir()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getCacheDir())</code> on a regular basis and also regularly delete other files you no longer need.<br><br>  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android开发/">Android开发</a>►<a class="article-category-link" href="/categories/Android开发/Training文档/">Training文档</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/16/saving-files/" data-title="Saving Files | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/16/saving-data-in-sql-databases/" title="Saving Data in SQL Databases">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Saving Data in SQL Databases</span>
</a>
</div>


<div class="next">
<a href="/2015/03/16/saving-key-value-sets/"  title="Saving Key-Value Sets">
 <strong>NEXT:</strong><br/> 
 <span>Saving Key-Value Sets
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Choose_Internal_or_External_Storage"><span class="toc-number">1.</span> <span class="toc-text">Choose Internal or External Storage</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
