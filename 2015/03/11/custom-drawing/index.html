
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Custom Drawing | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="Override onDraw()
The most important step in drawing a custom view is to override the [onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/11/custom-drawing/" title="Custom Drawing" itemprop="url">Custom Drawing</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-11T01:03:19.000Z" itemprop="datePublished">2015-03-11</time>
    更新日期:<time datetime="2015-04-20T07:21:35.637Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Override_onDraw()"><span class="toc-number">1.</span> <span class="toc-text">Override onDraw()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create_Drawing_Objects"><span class="toc-number">2.</span> <span class="toc-text">Create Drawing Objects</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Handle_Layout_Events"><span class="toc-number">3.</span> <span class="toc-text">Handle Layout Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Draw!"><span class="toc-number">4.</span> <span class="toc-text">Draw!</span></a></li></ol>
		</div>
		
		<h2 id="Override_onDraw()">Override onDraw()</h2><hr>
<p>The most important step in drawing a custom view is to override the <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> method. The parameter to <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> is a <code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code>object that the view can use to draw itself. The <code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code> class defines methods for drawing text, lines, bitmaps, and many other graphics primitives. You can use these methods in <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> to create your custom user interface (UI).</p>
<p>Before you can call any drawing methods, though, it’s necessary to create a <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> object. The next section discusses <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> in more detail.</p>
<h2 id="Create_Drawing_Objects">Create Drawing Objects</h2><hr>
<p>The <code>[android.graphics](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/package-summary.html)</code> framework divides drawing into two areas:</p>
<ul>
<li>What to draw, handled by <code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code></li>
<li>How to draw, handled by <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code>.<br>For instance, <code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code> provides a method to draw a line, while <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> provides methods to define that line’s color.<code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code> has a method to draw a rectangle, while <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> defines whether to fill that rectangle with a color or leave it empty. Simply put, <code>[Canvas](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html)</code> defines shapes that you can draw on the screen, while <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> defines the color, style, font, and so forth of each shape you draw.</li>
</ul>
<p>So, before you draw anything, you need to create one or more <code>[Paint](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html)</code> objects. The <code>PieChart</code> example does this in a method called <code>init</code>, which is called from the constructor:</p>
<p>[java]private void init() {<br>   mTextPaint = new Paint(Paint.ANTI_ALIAS_FLAG);<br>   mTextPaint.setColor(mTextColor);<br>   if (mTextHeight == 0) {<br>       mTextHeight = mTextPaint.getTextSize();<br>   } else {<br>       mTextPaint.setTextSize(mTextHeight);<br>   }</p>
<p>   mPiePaint = new Paint(Paint.ANTI_ALIAS_FLAG);<br>   mPiePaint.setStyle(Paint.Style.FILL);<br>   mPiePaint.setTextSize(mTextHeight);</p>
<p>   mShadowPaint = new Paint(0);<br>   mShadowPaint.setColor(0xff101010);<br>   mShadowPaint.setMaskFilter(new BlurMaskFilter(8, BlurMaskFilter.Blur.NORMAL));[/java]</p>
<p>Creating objects ahead of time is an important optimization. Views are redrawn very frequently, and many drawing objects require expensive initialization. Creating drawing objects within your <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> method significantly reduces performance and can make your UI appear sluggish.</p>
<h2 id="Handle_Layout_Events">Handle Layout Events</h2><hr>
<p>In order to properly draw your custom view, you need to know what size it is. Complex custom views often need to perform multiple layout calculations depending on the size and shape of their area on screen. You should never make assumptions about the size of your view on the screen. Even if only one app uses your view, that app needs to handle different screen sizes, multiple screen densities, and various aspect ratios in both portrait and landscape mode.</p>
<p>Although <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> has many methods for handling measurement, most of them do not need to be overridden. If your view doesn’t need special control over its size, you only need to override one method: <code>[onSizeChanged()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int))</code>.</p>
<p><code>[onSizeChanged()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int))</code> is called when your view is first assigned a size, and again if the size of your view changes for any reason. Calculate positions, dimensions, and any other values related to your view’s size in <code>[onSizeChanged()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int))</code>, instead of recalculating them every time you draw. In the <code>PieChart</code> example, <code>[onSizeChanged()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int))</code> is where the<code>PieChart</code> view calculates the bounding rectangle of the pie chart and the relative position of the text label and other visual elements.</p>
<p>When your view is assigned a size, the layout manager assumes that the size includes all of the view’s padding. You must handle the padding values when you calculate your view’s size. Here’s a snippet from<code>PieChart.onSizeChanged()</code> that shows how to do this:</p>
<p>[java]// Account for padding<br>       float xpad = (float)(getPaddingLeft() + getPaddingRight());<br>       float ypad = (float)(getPaddingTop() + getPaddingBottom());</p>
<pre><code><span class="comment">// Account for the label</span>
<span class="keyword">if</span> (mShowText) xpad += mTextWidth;

<span class="keyword">float</span> ww = (<span class="keyword">float</span>)w - xpad;
<span class="keyword">float</span> hh = (<span class="keyword">float</span>)h - ypad;

<span class="comment">// Figure out how big we can make the pie.</span>
<span class="keyword">float</span> diameter = Math.<span class="built_in">min</span>(ww, hh);[/java]
</code></pre><p>If you need finer control over your view’s layout parameters, implement <code>[onMeasure()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int))</code>. This method’s parameters are <code>[View.MeasureSpec](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html)</code> values that tell you how big your view’s parent wants your view to be, and whether that size is a hard maximum or just a suggestion. As an optimization, these values are stored as packed integers, and you use the static methods of <code>[View.MeasureSpec](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html)</code> to unpack the information stored in each integer.</p>
<p>Here’s an example implementation of <code>[onMeasure()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int))</code>. In this implementation, <code>PieChart</code> attempts to make its area big enough to make the pie as big as its label:</p>
<p>[java]@Override<br>protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {<br>   // Try for a width based on our minimum<br>   int minw = getPaddingLeft() + getPaddingRight() + getSuggestedMinimumWidth();<br>   int w = resolveSizeAndState(minw, widthMeasureSpec, 1);</p>
<p>   // Whatever the width ends up being, ask for a height that would let the pie<br>   // get as big as it can<br>   int minh = MeasureSpec.getSize(w) - (int)mTextWidth + getPaddingBottom() + getPaddingTop();<br>   int h = resolveSizeAndState(MeasureSpec.getSize(w) - (int)mTextWidth, heightMeasureSpec, 0);</p>
<p>   setMeasuredDimension(w, h);<br>}[/java]</p>
<p>There are three important things to note in this code:</p>
<ul>
<li>The calculations take into account the view’s padding. As mentioned earlier, this is the view’s responsibility.</li>
<li>The helper method <code>[resolveSizeAndState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#resolveSizeAndState(int, int, int))</code> is used to create the final width and height values. This helper returns an appropriate <code>[View.MeasureSpec](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html)</code> value by comparing the view’s desired size to the spec passed into<code>[onMeasure()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int))</code>.</li>
<li><code>[onMeasure()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int))</code> has no return value. Instead, the method communicates its results by calling<code>[setMeasuredDimension()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#setMeasuredDimension(int, int))</code>. Calling this method is mandatory. If you omit this call, the <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> class throws a runtime exception.</li>
</ul>
<h2 id="Draw!">Draw!</h2><hr>
<p>Once you have your object creation and measuring code defined, you can implement <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code>. Every view implements <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> differently, but there are some common operations that most views share:</p>
<ul>
<li>Draw text using <code>[drawText()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawText(char[], int, int, float, float, android.graphics.Paint))</code>. Specify the typeface by calling <code>[setTypeface()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setTypeface(android.graphics.Typeface))</code>, and the text color by calling<code>[setColor()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setColor(int))</code>.</li>
<li>Draw primitive shapes using <code>[drawRect()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawRect(android.graphics.Rect, android.graphics.Paint))</code>, <code>[drawOval()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawOval(android.graphics.RectF, android.graphics.Paint))</code>, and <code>[drawArc()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawArc(android.graphics.RectF, float, float, boolean, android.graphics.Paint))</code>. Change whether the shapes are filled, outlined, or both by calling <code>[setStyle()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setStyle(android.graphics.Paint.Style))</code>.</li>
<li>Draw more complex shapes using the <code>[Path](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Path.html)</code> class. Define a shape by adding lines and curves to a <code>[Path](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Path.html)</code> object, then draw the shape using <code>[drawPath()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawPath(android.graphics.Path, android.graphics.Paint))</code>. Just as with primitive shapes, paths can be outlined, filled, or both, depending on the <code>[setStyle()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setStyle(android.graphics.Paint.Style))</code>.</li>
<li>Define gradient fills by creating <code>[LinearGradient](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/LinearGradient.html)</code> objects. Call <code>[setShader()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setShader(android.graphics.Shader))</code> to use your <code>[LinearGradient](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/LinearGradient.html)</code> on filled shapes.</li>
<li>Draw bitmaps using <code>[drawBitmap()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawBitmap(android.graphics.Bitmap, android.graphics.Matrix, android.graphics.Paint))</code>.<br>For example, here’s the code that draws <code>PieChart</code>. It uses a mix of text, lines, and shapes.</li>
</ul>
<p>[java]protected void onDraw(Canvas canvas) {<br>   super.onDraw(canvas);</p>
<p>   // Draw the shadow<br>   canvas.drawOval(<br>           mShadowBounds,<br>           mShadowPaint<br>   );</p>
<p>   // Draw the label text<br>   canvas.drawText(mData.get(mCurrentItem).mLabel, mTextX, mTextY, mTextPaint);</p>
<p>   // Draw the pie slices<br>   for (int i = 0; i &lt; mData.size(); ++i) {<br>       Item it = mData.get(i);<br>       mPiePaint.setShader(it.mShader);<br>       canvas.drawArc(mBounds,<br>               360 - it.mEndAngle,<br>               it.mEndAngle - it.mStartAngle,<br>               true, mPiePaint);<br>   }</p>
<p>   // Draw the pointer<br>   canvas.drawLine(mTextX, mPointerY, mPointerX, mPointerY, mTextPaint);<br>   canvas.drawCircle(mPointerX, mPointerY, mPointerSize, mTextPaint);<br>}[/java]<br>总结一下：<br>第一：在构造器中完成init操作，初始化画笔等等操作；<br>第二：onSizeChanged()方法和onMeasure方法<br>第三：onDraw()方法，处理</p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/自定义控件/">自定义控件</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/11/custom-drawing/" data-title="Custom Drawing | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/11/making-the-view-interactive/" title="Making the View Interactive">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Making the View Interactive</span>
</a>
</div>


<div class="next">
<a href="/2015/03/11/creating-a-view-class/"  title="Creating a View Class">
 <strong>NEXT:</strong><br/> 
 <span>Creating a View Class
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Override_onDraw()"><span class="toc-number">1.</span> <span class="toc-text">Override onDraw()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create_Drawing_Objects"><span class="toc-number">2.</span> <span class="toc-text">Create Drawing Objects</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Handle_Layout_Events"><span class="toc-number">3.</span> <span class="toc-text">Handle Layout Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Draw!"><span class="toc-number">4.</span> <span class="toc-text">Draw!</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
