
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Creating a View Class | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="A well-designed custom view is much like any other well-designed class. It encapsulates a specific set of functionality with an easy to use interface,">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/11/creating-a-view-class/" title="Creating a View Class" itemprop="url">Creating a View Class</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-11T00:53:35.000Z" itemprop="datePublished">2015-03-11</time>
    更新日期:<time datetime="2015-04-20T07:21:35.637Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
		</div>
		
		<div><br><br>A well-designed custom view is much like any other well-designed class. It encapsulates a specific set of functionality with an easy to use interface, it uses CPU and memory efficiently, and so forth. In addition to being a well-designed class, though, a custom view should:<br><br><em>   Conform to Android standards
</em>   Provide custom styleable attributes that work with Android XML layouts<br><em>   Send accessibility events
</em>   Be compatible with multiple Android platforms.<br>上面说了自定义View需要符合的四个条件。<br><br>The Android framework provides a set of base classes and XML tags to help you create a view that meets all of these requirements. This lesson discusses how to use the Android framework to create the core functionality of a view class.<br><br>## <a name="t0"></a>Subclass a View<br><br><em> </em> <em><br><br>All of the view classes defined in the Android framework extend<code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code>. Your custom view can also extend <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> directly, or you can save time by extending one of the existing view subclasses, such as <code>[Button](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Button.html)</code>.<br><br>To allow the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/developing/tools/adt.html" target="_blank" rel="external">Android Developer Tools </a>to interact with your view, at a minimum you must provide a constructor that takes a <code>[Context](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html)</code> and an <code>[AttributeSet](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html)</code> object as parameters. This constructor allows the layout editor to create and edit an instance of your view.<br><br>[java]class PieChart extends View {<br>    public PieChart(Context context, AttributeSet attrs) {<br>        super(context, attrs);<br>    }<br>}[/java]<br><br>## <a name="t1"></a>Define Custom Attributes

</em> <em> </em><br><br>To add a built-in <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> to your user interface, you specify it in an XML element and control its appearance and behavior with element attributes. Well-written custom views can also be added and styled via XML. To enable this behavior in your custom view, you must:<br><br><em>   Define custom attributes for your view in a <code>&amp;lt;declare-styleable&amp;gt;</code>resource element
</em>   Specify values for the attributes in your XML layout<br><em>   Retrieve attribute values at runtime
</em>   Apply the retrieved attribute values to your view<br>This section discusses how to define custom attributes and specify their values. The next section deals with retrieving and applying the values at runtime.<br><br>To define custom attributes, add <code>&amp;lt;declare-styleable&amp;gt;</code>resources to your project. It’s customary to put these resources into a <code>res/values/attrs.xml</code> file. Here’s an example of an <code>attrs.xml</code> file:<br><br>[java]&lt;resources&gt;<br>   &lt;declare-styleable name=&quot;PieChart&quot;&gt;<br>       &lt;attr name=&quot;showText&quot; format=&quot;boolean&quot; /&gt;<br>       &lt;attr name=&quot;labelPosition&quot; format=&quot;enum&quot;&gt;<br>           &lt;enum name=&quot;left&quot; value=&quot;0&quot;/&gt;<br>           &lt;enum name=&quot;right&quot; value=&quot;1&quot;/&gt;<br>       &lt;/attr&gt;<br>   &lt;/declare-styleable&gt;<br>&lt;/resources&gt;[/java]<br><br>This code declares two custom attributes, <code>showText</code> and <code>labelPosition</code>, that belong to a styleable entity named<code>PieChart</code>. The name of the styleable entity is, by convention, the same name as the name of the class that defines the custom view. Although it’s not strictly necessary to follow this convention, many popular code editors depend on this naming convention to provide statement completion.<br><br>Once you define the custom attributes, you can use them in layout XML files just like built-in attributes. The only difference is that your custom attributes belong to a different namespace. Instead of belonging to the<code>http://schemas.android.com/apk/res/android</code> namespace, they belong to<code>http://schemas.android.com/apk/res/[your package name]</code>. For example, here’s how to use the attributes defined for <code>PieChart</code>:<br><br>&nbsp;<br><br>[java]&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br>&lt;LinearLayout xmlns:android=&quot;<a href="http://schemas.android.com/apk/res/android&amp;quot" target="_blank" rel="external">http://schemas.android.com/apk/res/android&amp;quot</a>;<br>   xmlns:custom=&quot;<a href="http://schemas.android.com/apk/res/com.example.customviews&quot;&amp;gt" target="_blank" rel="external">http://schemas.android.com/apk/res/com.example.customviews&quot;&amp;gt</a>;<br> &lt;com.example.customviews.charting.PieChart<br>     custom:showText=&quot;true&quot;<br>     custom:labelPosition=&quot;left&quot; /&gt;<br>&lt;/LinearLayout&gt;[/java]<br><br>In order to avoid having to repeat the long namespace URI, the sample uses an <code>xmlns</code> directive. This directive assigns the alias <code>custom</code> to the namespace <code>http://schemas.android.com/apk/res/com.example.customviews</code>. You can choose any alias you want for your namespace.<br><br>Notice the name of the XML tag that adds the custom view to the layout. It is the fully qualified name of the custom view class. If your view class is an inner class, you must further qualify it with the name of the view’s outer class. further. For instance, the <code>PieChart</code> class has an inner class called <code>PieView</code>. To use the custom attributes from this class, you would use the tag <code>com.example.customviews.charting.PieChart$PieView</code>.<br><br>## <a name="t2"></a>Apply Custom Attributes<br><br><em> </em> <em><br><br>When a view is created from an XML layout, all of the attributes in the XML tag are read from the resource bundle and passed into the view’s constructor as an <code>[AttributeSet](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html)</code>. Although it’s possible to read values from the<code>[AttributeSet](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html)</code> directly, doing so has some disadvantages:

</em>   Resource references within attribute values are not resolved<br><em>   Styles are not applied<br>Instead, pass the <code>[AttributeSet](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html)</code> to <code>[obtainStyledAttributes()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/Resources.Theme.html#obtainStyledAttributes(android.util.AttributeSet, int[], int, int))</code>. This method passes back a <code>[TypedArray](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html)</code> array of values that have already been dereferenced and styled.<br><br>The Android resource compiler does a lot of work for you to make calling <code>[obtainStyledAttributes()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/Resources.Theme.html#obtainStyledAttributes(android.util.AttributeSet, int[], int, int))</code> easier. For each <code>&amp;lt;declare-styleable&amp;gt;</code> resource in the res directory, the generated R.java defines both an array of attribute ids and a set of constants that define the index for each attribute in the array. You use the predefined constants to read the attributes from the <code>[TypedArray](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html)</code>. Here’s how the <code>PieChart</code> class reads its attributes:<br><br>[java]public PieChart(Context context, AttributeSet attrs) {<br>   super(context, attrs);<br>   TypedArray a = context.getTheme().obtainStyledAttributes(<br>        attrs,<br>        R.styleable.PieChart,<br>        0, 0);<br><br>   try {<br>       mShowText = a.getBoolean(R.styleable.PieChart_showText, false);<br>       mTextPos = a.getInteger(R.styleable.PieChart_labelPosition, 0);<br>   } finally {<br>       a.recycle();<br>   }<br>}[/java]<br><br>Note that <code>[TypedArray](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html)</code> objects are a shared resource and must be recycled after use.<br><br>## <a name="t3"></a>Add Properties and Events

</em> <em> </em><br><br>Attributes are a powerful way of controlling the behavior and appearance of views, but they can only be read when the view is initialized. To provide dynamic behavior, expose a property getter and setter pair for each custom attribute. The following snippet shows how <code>PieChart</code> exposes a property called <code>showText</code>:<br><br>[java]public boolean isShowText() {<br>   return mShowText;<br>}<br><br>public void setShowText(boolean showText) {<br>   mShowText = showText;<br>   invalidate();<br>   requestLayout();<br>}[/java]<br><br>Notice that <code>setShowText</code> calls <code>[invalidate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#invalidate())</code> and <code>[requestLayout()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#requestLayout())</code>. These calls are crucial to ensure that the view behaves reliably. You have to invalidate the view after any change to its properties that might change its appearance, so that the system knows that it needs to be redrawn. Likewise, you need to request a new layout if a property changes that might affect the size or shape of the view. Forgetting these method calls can cause hard-to-find bugs.<br><br>Custom views should also support event listeners to communicate important events. For instance, <code>PieChart</code>exposes a custom event called <code>OnCurrentItemChanged</code> to notify listeners that the user has rotated the pie chart to focus on a new pie slice.<br><br>It’s easy to forget to expose properties and events, especially when you’re the only user of the custom view. Taking some time to carefully define your view’s interface reduces future maintenance costs. A good rule to follow is to always expose any property that affects the visible appearance or behavior of your custom view.<br><br>## <a name="t4"></a>Design For Accessibility<br><br><em> </em> <em><br><br>Your custom view should support the widest range of users. This includes users with disabilities that prevent them from seeing or using a touchscreen. To support users with disabilities, you should:

</em>   Label your input fields using the <code>android:contentDescription</code> attribute<br><em>   Send accessibility events by calling <code>[sendAccessibilityEvent()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/accessibility/AccessibilityEventSource.html#sendAccessibilityEvent(int))</code> when appropriate.
</em>   Support alternate controllers, such as D-pad and trackball<br>For more information on creating accessible views, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/accessibility/apps.html#custom-views" target="_blank" rel="external">Making Applications Accessible</a> in the Android Developers Guide.<br><br>&nbsp;<br><br>总结一下：<br><br>第一步：在attrs.xml文件下面定义一些属性<br><br>第二步：定义一个类继承自View或者其他<br><br></div><br><div><br><div>第三步：在这个类的构造器中得到TypedArray这样一个数组，通过这个数组，取出属性。</div><br></div>  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/自定义控件/">自定义控件</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/11/creating-a-view-class/" data-title="Creating a View Class | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/11/custom-drawing/" title="Custom Drawing">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Custom Drawing</span>
</a>
</div>


<div class="next">
<a href="/2015/03/02/getbackstackentrycount-e5-92-8cpopbackstackstring-name-int-flags-e6-96-b9-e6-b3-95/"  title="getBackStackEntryCount()和popBackStack(String name, int flags)方法">
 <strong>NEXT:</strong><br/> 
 <span>getBackStackEntryCount()和popBackStack(String name, int flags)方法
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
