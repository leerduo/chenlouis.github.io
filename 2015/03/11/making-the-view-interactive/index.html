
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Making the View Interactive | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="Drawing a UI is only one part of creating a custom view. You also need to make your view respond to user input in a way that closely resembles the rea">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/11/making-the-view-interactive/" title="Making the View Interactive" itemprop="url">Making the View Interactive</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-11T01:13:27.000Z" itemprop="datePublished">2015-03-11</time>
    更新日期:<time datetime="2015-04-20T07:21:35.638Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Handle_Input_Gestures"><span class="toc-number">1.</span> <span class="toc-text">Handle Input Gestures</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create_Physically_Plausible_Motion"><span class="toc-number">2.</span> <span class="toc-text">Create Physically Plausible Motion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make_Your_Transitions_Smooth"><span class="toc-number">3.</span> <span class="toc-text">Make Your Transitions Smooth</span></a></li></ol>
		</div>
		
		<p>Drawing a UI is only one part of creating a custom view. You also need to make your view respond to user input in a way that closely resembles the real-world action you’re mimicking. Objects should always act in the same way that real objects do. For example, images should not immediately pop out of existence and reappear somewhere else, because objects in the real world don’t do that. Instead, images should move from one place to another.</p>
<p>Users also sense subtle behavior or feel in an interface, and react best to subtleties that mimic the real world. For example, when users fling a UI object, they should sense friction at the beginning that delays the motion, and then at the end sense momentum that carries the motion beyond the fling.</p>
<p>This lesson demonstrates how to use features of the Android framework to add these real-world behaviors to your custom view.</p>
<p>前面两篇写了绘制的过程，下面是处理与用户交互。</p>
<h2 id="Handle_Input_Gestures">Handle Input Gestures</h2><hr>
<p>Like many other UI frameworks, Android supports an input event model. User actions are turned into events that trigger callbacks, and you can override the callbacks to customize how your application responds to the user. The most common input event in the Android system is <em>touch</em>, which triggers<code>[onTouchEvent(android.view.MotionEvent)](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onTouchEvent(android.view.MotionEvent))</code>. Override this method to handle the event:</p>
<p>[java]@Override<br>   public boolean onTouchEvent(MotionEvent event) {<br>    return super.onTouchEvent(event);<br>   }[/java]</p>
<p>Touch events by themselves are not particularly useful. Modern touch UIs define interactions in terms of gestures such as tapping, pulling, pushing, flinging, and zooming. To convert raw touch events into gestures, Android provides <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code>.</p>
<p>Construct a <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code> by passing in an instance of a class that implements<code>[GestureDetector.OnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html)</code>. If you only want to process a few gestures, you can extend<code>[GestureDetector.SimpleOnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html)</code> instead of implementing the <code>[GestureDetector.OnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html)</code>interface. For instance, this code creates a class that extends <code>[GestureDetector.SimpleOnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html)</code> and overrides <code>[onDown(MotionEvent)](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html#onDown(android.view.MotionEvent))</code>.</p>
<p>[java]class mListener extends GestureDetector.SimpleOnGestureListener {<br>   @Override<br>   public boolean onDown(MotionEvent e) {<br>       return true;<br>   }<br>}<br>mDetector = new GestureDetector(PieChart.this.getContext(), new mListener());[/java]</p>
<p>Whether or not you use <code>[GestureDetector.SimpleOnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html)</code>, you must always implement an <code>[onDown()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent))</code>method that returns <code>true</code>. This step is necessary because all gestures begin with an <code>[onDown()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent))</code> message. If you return <code>false</code> from <code>[onDown()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent))</code>, as <code>[GestureDetector.SimpleOnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html)</code> does, the system assumes that you want to ignore the rest of the gesture, and the other methods of <code>[GestureDetector.OnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html)</code> never get called. The only time you should return <code>false</code> from <code>[onDown()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent))</code> is if you truly want to ignore an entire gesture. Once you’ve implemented <code>[GestureDetector.OnGestureListener](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html)</code> and created an instance of <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code>, you can use your <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code> to interpret the touch events you receive in <code>[onTouchEvent()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html#onTouchEvent(android.view.MotionEvent))</code>.</p>
<p>[java]@Override<br>public boolean onTouchEvent(MotionEvent event) {<br>   boolean result = mDetector.onTouchEvent(event);<br>   if (!result) {<br>       if (event.getAction() == MotionEvent.ACTION_UP) {<br>           stopScrolling();<br>           result = true;<br>       }<br>   }<br>   return result;<br>}[/java]</p>
<p>When you pass <code>[onTouchEvent()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html#onTouchEvent(android.view.MotionEvent))</code> a touch event that it doesn’t recognize as part of a gesture, it returns <code>false</code>. You can then run your own custom gesture-detection code.</p>
<h2 id="Create_Physically_Plausible_Motion">Create Physically Plausible Motion</h2><hr>
<p>Gestures are a powerful way to control touchscreen devices, but they can be counterintuitive and difficult to remember unless they produce physically plausible results. A good example of this is the <em>fling</em> gesture, where the user quickly moves a finger across the screen and then lifts it. This gesture makes sense if the UI responds by moving quickly in the direction of the fling, then slowing down, as if the user had pushed on a flywheel and set it spinning.</p>
<p>However, simulating the feel of a flywheel isn’t trivial. A lot of physics and math are required to get a flywheel model working correctly. Fortunately, Android provides helper classes to simulate this and other behaviors. The<code>[Scroller](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html)</code> class is the basis for handling flywheel-style <em>fling</em> gestures.</p>
<p>To start a fling, call <code>[fling()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int))</code> with the starting velocity and the minimum and maximum x and y values of the fling. For the velocity value, you can use the value computed for you by <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code>.</p>
<p>[java]@Override<br>public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {<br>   mScroller.fling(currentX, currentY, velocityX / SCALE, velocityY / SCALE, minX, minY, maxX, maxY);<br>   postInvalidate();<br>}[/java]</p>
<p><strong>Note:</strong> Although the velocity calculated by <code>[GestureDetector](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html)</code> is physically accurate, many developers feel that using this value makes the fling animation too fast. It’s common to divide the x and y velocity by a factor of 4 to 8.</p>
<p>The call to <code>[fling()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int))</code> sets up the physics model for the fling gesture. Afterwards, you need to update the <code>[Scroller](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html)</code>by calling <code>[Scroller.computeScrollOffset()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#computeScrollOffset())</code> at regular intervals. <code>[computeScrollOffset()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#computeScrollOffset())</code> updates the <code>[Scroller](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html)</code>object’s internal state by reading the current time and using the physics model to calculate the x and y position at that time. Call <code>[getCurrX()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#getCurrX())</code> and <code>[getCurrY()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#getCurrY())</code> to retrieve these values.</p>
<p>Most views pass the <code>[Scroller](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html)</code> object’s x and y position directly to <code>[scrollTo()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#scrollTo(int, int))</code>. The PieChart example is a little different: it uses the current scroll y position to set the rotational angle of the chart.</p>
<p>[java]if (!mScroller.isFinished()) {<br>    mScroller.computeScrollOffset();<br>    setPieRotation(mScroller.getCurrY());<br>}[/java]</p>
<p>The <code>[Scroller](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html)</code> class computes scroll positions for you, but it does not automatically apply those positions to your view. It’s your responsibility to make sure you get and apply new coordinates often enough to make the scrolling animation look smooth. There are two ways to do this:</p>
<ul>
<li>Call <code>[postInvalidate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#postInvalidate())</code> after calling <code>[fling()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int))</code>, in order to force a redraw. This technique requires that you compute scroll offsets in <code>[onDraw()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas))</code> and call <code>[postInvalidate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#postInvalidate())</code> every time the scroll offset changes.</li>
<li>Set up a <code>[ValueAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html)</code> to animate for the duration of the fling, and add a listener to process animation updates by calling <code>[addUpdateListener()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html#addUpdateListener(android.animation.ValueAnimator.AnimatorUpdateListener))</code>.<br>The PieChart example uses the second approach. This technique is slightly more complex to set up, but it works more closely with the animation system and doesn’t require potentially unnecessary view invalidation. The drawback is that <code>[ValueAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html)</code> is not available prior to API level 11, so this technique cannot be used on devices running Android versions lower than 3.0.</li>
</ul>
<p><strong>Note:</strong> <code>[ValueAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html)</code> isn’t available prior to API level 11, but you can still use it in applications that target lower API levels. You just need to make sure to check the current API level at runtime, and omit the calls to the view animation system if the current level is less than 11.</p>
<p>[java]mScroller = new Scroller(getContext(), null, true);<br>       mScrollAnimator = ValueAnimator.ofFloat(0,1);<br>       mScrollAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {<br>           @Override<br>           public void onAnimationUpdate(ValueAnimator valueAnimator) {<br>               if (!mScroller.isFinished()) {<br>                   mScroller.computeScrollOffset();<br>                   setPieRotation(mScroller.getCurrY());<br>               } else {<br>                   mScrollAnimator.cancel();<br>                   onScrollFinished();<br>               }<br>           }<br>       });[/java]</p>
<h2 id="Make_Your_Transitions_Smooth">Make Your Transitions Smooth</h2><hr>
<p>Users expect a modern UI to transition smoothly between states. UI elements fade in and out instead of appearing and disappearing. Motions begin and end smoothly instead of starting and stopping abruptly. The Android <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/graphics/prop-animation.html" target="_blank" rel="external">property animation framework</a>, introduced in Android 3.0, makes smooth transitions easy.</p>
<p>To use the animation system, whenever a property changes that will affect your view’s appearance, do not change the property directly. Instead, use <code>[ValueAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html)</code> to make the change. In the following example, modifying the currently selected pie slice in PieChart causes the entire chart to rotate so that the selection pointer is centered in the selected slice. <code>[ValueAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html)</code> changes the rotation over a period of several hundred milliseconds, rather than immediately setting the new rotation value.</p>
<p>[java]mAutoCenterAnimator = ObjectAnimator.ofInt(PieChart.this, &quot;PieRotation&quot;, 0);<br>mAutoCenterAnimator.setIntValues(targetAngle);<br>mAutoCenterAnimator.setDuration(AUTOCENTER_ANIM_DURATION);<br>mAutoCenterAnimator.start();[/java]</p>
<p>If the value you want to change is one of the base <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> properties, doing the animation is even easier, because Views have a built-in <code>[ViewPropertyAnimator](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewPropertyAnimator.html)</code> that is optimized for simultaneous animation of multiple properties. For example:</p>
<p>[java]animate().rotation(targetAngle).setDuration(ANIM_DURATION).start();[/java]</p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/自定义控件/">自定义控件</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/11/making-the-view-interactive/" data-title="Making the View Interactive | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/11/optimizing-the-view/" title="Optimizing the View">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Optimizing the View</span>
</a>
</div>


<div class="next">
<a href="/2015/03/11/custom-drawing/"  title="Custom Drawing">
 <strong>NEXT:</strong><br/> 
 <span>Custom Drawing
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Handle_Input_Gestures"><span class="toc-number">1.</span> <span class="toc-text">Handle Input Gestures</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create_Physically_Plausible_Motion"><span class="toc-number">2.</span> <span class="toc-text">Create Physically Plausible Motion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make_Your_Transitions_Smooth"><span class="toc-number">3.</span> <span class="toc-text">Make Your Transitions Smooth</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
