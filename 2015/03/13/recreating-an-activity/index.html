
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Recreating an Activity | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="There are a few scenarios in which your activity is destroyed due to normal app behavior, such as when the user presses the _Back_button or your activ">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/13/recreating-an-activity/" title="Recreating an Activity" itemprop="url">Recreating an Activity</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-13T07:29:08.000Z" itemprop="datePublished">2015-03-13</time>
    更新日期:<time datetime="2015-04-20T07:21:35.637Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Save_Your_Activity_State"><span class="toc-number">1.</span> <span class="toc-text">Save Your Activity State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Restore_Your_Activity_State"><span class="toc-number">2.</span> <span class="toc-text">Restore Your Activity State</span></a></li></ol>
		</div>
		
		<p>There are a few scenarios in which your activity is destroyed due to normal app behavior, such as when the user presses the _Back_button or your activity signals its own destruction by calling<code>[finish()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish())</code>. The system may also destroy your activity if it’s currently stopped and hasn’t been used in a long time or the foreground activity requires more resources so the system must shut down background processes to recover memory.</p>
<p>When your activity is destroyed because the user presses <em>Back</em> or the activity finishes itself, the system’s concept of that <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code>instance is gone forever because the behavior indicates the activity is no longer needed. However, if the system destroys the activity due to system constraints (rather than normal app behavior), then although the actual <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code> instance is gone, the system remembers that it existed such that if the user navigates back to it, the system creates a new instance of the activity using a set of saved data that describes the state of the activity when it was destroyed. The saved data that the system uses to restore the previous state is called the “instance state” and is a collection of key-value pairs stored in a <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> object.</p>
<p><span style="color: #0000ff;"><strong>Caution:</strong> Your activity will be destroyed and recreated each time the user rotates the screen. When the screen changes orientation, the system destroys and recreates the foreground activity because the screen configuration has changed and your activity might need to load alternative resources (such as the layout).</span></p>
<p>横竖屏切换带来生命周期的重建（为什么需要重建，比如需要加载新的layout）</p>
<p>By default, the system uses the <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> instance state to save information about each <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> object in your activity layout (such as the text value entered into an <code>[EditText](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html)</code> object). So, if your activity instance is destroyed and recreated, the state of the layout is restored to its previous state with no code required by you. However, your activity might have more state information that you’d like to restore, such as member variables that track the user’s progress in the activity.</p>
<p><span style="color: #0000ff;"><strong>Note:</strong> In order for the Android system to restore the state of the views in your activity, <strong>each view must have a unique ID</strong>, supplied by the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#attr_android:id" target="_blank" rel="external"><span style="color: #0000ff;"><code>android:id</code></span></a> attribute.</span></p>
<p>Bundle（A mapping from String values to various Parcelable types.）</p>
<p>To save additional data about the activity state, you must override the <code>[onSaveInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))</code> callback method. The system calls this method when the user is leaving your activity and passes it the <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> object that will be saved in the event that your activity is destroyed unexpectedly. If the system must recreate the activity instance later, it passes the same <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> object to both the <code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code> and <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code> methods.</p>
<p><img src="http://img.blog.csdn.net/20150313152602094?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-savestate.png" alt=""></p>
<p><strong>Figure 2.</strong> As the system begins to stop your activity, it calls <code>[onSaveInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))</code> (1) so you can specify additional state data you’d like to save in case the <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code> instance must be recreated. If the activity is destroyed and the same instance must be recreated, the system passes the state data defined at (1) to both the <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code> method (2) and the<code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code> method (3).</p>
<h2 id="Save_Your_Activity_State">Save Your Activity State</h2><hr>
<p>As your activity begins to stop, the system calls <code>[onSaveInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))</code> so your activity can save state information with a collection of key-value pairs. The default implementation of this method saves information about the state of the activity’s view hierarchy, such as the text in an <code>[EditText](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html)</code> widget or the scroll position of a<code>[ListView](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html)</code>.</p>
<p>To save additional state information for your activity, you must implement <code>[onSaveInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))</code> and add key-value pairs to the <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> object. For example:</p>
<p>[java]static final String STATE_SCORE = &quot;playerScore&quot;;<br>static final String STATE_LEVEL = &quot;playerLevel&quot;;<br>…</p>
<p>@Override<br>public void onSaveInstanceState(Bundle savedInstanceState) {<br>// Save the user’s current game state<br>savedInstanceState.putInt(STATE_SCORE, mCurrentScore);<br>savedInstanceState.putInt(STATE_LEVEL, mCurrentLevel);</p>
<p>// Always call the superclass so it can save the view hierarchy state<br>super.onSaveInstanceState(savedInstanceState);<br>}[/java]</p>
<p><strong>Caution:</strong> Always call the superclass implementation of <code>[onSaveInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))</code> so the default implementation can save the state of the view hierarchy.</p>
<h2 id="Restore_Your_Activity_State">Restore Your Activity State</h2><hr>
<p>When your activity is recreated after it was previously destroyed, you can recover your saved state from the<code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> that the system passes your activity. Both the <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code> and <code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code> callback methods receive the same <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> that contains the instance state information.</p>
<p>Because the <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code> method is called whether the system is creating a new instance of your activity or recreating a previous one, you must check whether the state <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> is null before you attempt to read it. If it is null, then the system is creating a new instance of the activity, instead of restoring a previous one that was destroyed.</p>
<p>For example, here’s how you can restore some state data in <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code>:</p>
<p>[java]@Override<br>protected void onCreate(Bundle savedInstanceState) {<br>super.onCreate(savedInstanceState); // Always call the superclass first</p>
<p>// Check whether we’re recreating a previously destroyed instance<br>if (savedInstanceState != null) {<br>// Restore value of members from saved state<br>mCurrentScore = savedInstanceState.getInt(STATE_SCORE);<br>mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL);<br>} else {<br>// Probably initialize members with default values for a new instance<br>}<br>…<br>}[/java]</p>
<p>Instead of restoring the state during <code>[onCreate()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle))</code> you may choose to implement <code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code>, which the system calls after the <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> method. The system calls <code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code> only if there is a saved state to restore, so you do not need to check whether the <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> is null:</p>
<p>[java]public void onRestoreInstanceState(Bundle savedInstanceState) {<br>// Always call the superclass so it can restore the view hierarchy<br>super.onRestoreInstanceState(savedInstanceState);</p>
<p>// Restore state members from saved instance<br>mCurrentScore = savedInstanceState.getInt(STATE_SCORE);<br>mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL);<br>}[/java]</p>
<p><strong>Caution:</strong> Always call the superclass implementation of <code>[onRestoreInstanceState()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle))</code> so the default implementation can restore the state of the view hierarchy.</p>
<p>&nbsp;</p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android开发/">Android开发</a>►<a class="article-category-link" href="/categories/Android开发/Training文档/">Training文档</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/13/recreating-an-activity/" data-title="Recreating an Activity | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/14/creating-a-fragment/" title="Creating a Fragment">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Creating a Fragment</span>
</a>
</div>


<div class="next">
<a href="/2015/03/13/stopping-and-restarting-an-activity/"  title="Stopping and Restarting an Activity">
 <strong>NEXT:</strong><br/> 
 <span>Stopping and Restarting an Activity
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Save_Your_Activity_State"><span class="toc-number">1.</span> <span class="toc-text">Save Your Activity State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Restore_Your_Activity_State"><span class="toc-number">2.</span> <span class="toc-text">Restore Your Activity State</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
