
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Stopping and Restarting an Activity | louis.chen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="louis.chen">
    
    <meta name="description" content="Properly stopping and restarting your activity is an important process in the activity lifecycle that ensures your users perceive that your app is alw">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="louis.chen" title="louis.chen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="louis.chen">louis.chen</a></h1>
				<h2 class="blog-motto">Mobile developers,experience extreme product.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/13/stopping-and-restarting-an-activity/" title="Stopping and Restarting an Activity" itemprop="url">Stopping and Restarting an Activity</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="louis.chen">louis.chen</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-13T07:18:53.000Z" itemprop="datePublished">2015-03-13</time>
    更新日期:<time datetime="2015-04-20T07:21:35.638Z" itemprop="dateModified">2015-04-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stop_Your_Activity"><span class="toc-number">1.</span> <span class="toc-text">Stop Your Activity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Start/Restart_Your_Activity"><span class="toc-number">2.</span> <span class="toc-text">Start/Restart Your Activity</span></a></li></ol>
		</div>
		
		<p>Properly stopping and restarting your activity is an important process in the activity lifecycle that ensures your users perceive that your app is always alive and doesn’t lose their progress. There are a few of key scenarios in which your activity is stopped and restarted:</p>
<ul>
<li><span style="color: #3366ff;">The user opens the Recent Apps window and switches from your app to another app. The activity in your app that’s currently in the foreground is stopped. If the user returns to your app from the Home screen launcher icon or the Recent Apps window, the activity restarts.</span></li>
<li><span style="color: #3366ff;">The user performs an action in your app that starts a new activity. The current activity is stopped when the second activity is created. If the user then presses the <em>Back</em> button, the first activity is restarted.</span></li>
<li><span style="color: #3366ff;">The user receives a phone call while using your app on his or her phone.</span><br>The <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code> class provides two lifecycle methods, <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> and<code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code>, which allow you to specifically handle how your activity handles being stopped and restarted. Unlike the paused state, which identifies a partial UI obstruction, the stopped state guarantees that the UI is no longer visible and the user’s focus is in a separate activity (or an entirely separate app).</li>
</ul>
<p><strong>Note:</strong> Because the system retains your <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code> instance in system memory when it is stopped, it’s possible that you don’t need to implement the <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> and <code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code> (or even <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> methods at all. For most activities that are relatively simple, the activity will stop and restart just fine and you might only need to use<code>[onPause()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause())</code> to pause ongoing actions and disconnect from system resources.</p>
<p><img src="http://img.blog.csdn.net/20150313150859528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-stopped.png" alt=""></p>
<p><strong>Figure 1.</strong> When the user leaves your activity, the system calls <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> to stop the activity (1). If the user returns while the activity is stopped, the system calls <code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code> (2), quickly followed by <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> (3) and <code>[onResume()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume())</code> (4). Notice that no matter what scenario causes the activity to stop, the system always calls <code>[onPause()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause())</code> before calling <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code>.</p>
<h2 id="Stop_Your_Activity">Stop Your Activity</h2><hr>
<p>When your activity receives a call to the <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> method, it’s no longer visible and should release almost all resources that aren’t needed while the user is not using it. Once your activity is stopped, the system might destroy the instance if it needs to recover system memory. In extreme cases, the system might simply kill your app process without calling the activity’s final <code>[onDestroy()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy())</code> callback, so it’s important you use <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> to release resources that might leak memory.</p>
<p>Although the <code>[onPause()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause())</code> method is called before <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code>, you should use <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> to perform larger, more CPU intensive shut-down operations, such as writing information to a database.</p>
<p>For example, here’s an implementation of <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> that saves the contents of a draft note to persistent storage:</p>
<p>[java]@Override<br>protected void onStop() {<br>super.onStop();  // Always call the superclass method first</p>
<p>// Save the note’s current draft, because the activity is stopping<br>// and we want to be sure the current note progress isn’t lost.<br>ContentValues values = new ContentValues();<br>values.put(NotePad.Notes.COLUMN_NAME_NOTE, getCurrentNoteText());<br>values.put(NotePad.Notes.COLUMN_NAME_TITLE, getCurrentNoteTitle());</p>
<p>getContentResolver().update(<br>mUri,    // The URI for the note to update.<br>values,  // The map of column names and new values to apply to them.<br>null,    // No SELECT criteria are used.<br>null     // No WHERE columns are used.<br>);<br>}[/java]</p>
<p>When your activity is stopped, the <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code> object is kept resident in memory and is recalled when the activity resumes. You don’t need to re-initialize components that were created during any of the callback methods leading up to the Resumed state. The system also keeps track of the current state for each <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> in the layout, so if the user entered text into an <code>[EditText](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html)</code> widget, that content is retained so you don’t need to save and restore it.</p>
<p><strong>Note:</strong> Even if the system destroys your activity while it’s stopped, it still retains the state of the <code>[View](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html)</code> objects (such as text in an <code>[EditText](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html)</code>) in a <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> (a blob of key-value pairs) and restores them if the user navigates back to the same instance of the activity (the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/activity-lifecycle/recreating.html" target="_blank" rel="external">next lesson</a> talks more about using a <code>[Bundle](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html)</code> to save other state data in case your activity is destroyed and recreated).</p>
<h2 id="Start/Restart_Your_Activity">Start/Restart Your Activity</h2><hr>
<p>When your activity comes back to the foreground from the stopped state, it receives a call to <code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code>. The system also calls the <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> method, which happens every time your activity becomes visible (whether being restarted or created for the first time). The <code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code> method, however, is called only when the activity resumes from the stopped state, so you can use it to perform special restoration work that might be necessary only if the activity was previously stopped, but not destroyed.</p>
<p>It’s uncommon that an app needs to use <code>[onRestart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart())</code> to restore the activity’s state, so there aren’t any guidelines for this method that apply to the general population of apps. However, because your <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> method should essentially clean up all your activity’s resources, you’ll need to re-instantiate them when the activity restarts. Yet, you also need to instantiate them when your activity is created for the first time (when there’s no existing instance of the activity). For this reason, you should usually use the <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> callback method as the counterpart to the<code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code> method, because the system calls <code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> both when it creates your activity and when it restarts the activity from the stopped state.</p>
<p>For example, because the user might have been away from your app for a long time before coming back it, the<code>[onStart()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart())</code> method is a good place to verify that required system features are enabled:</p>
<p>[java]@Override<br>protected void onStart() {<br>super.onStart();  // Always call the superclass method first</p>
<p>// The activity is either being restarted or started for the first time<br>// so this is where we should make sure that GPS is enabled<br>LocationManager locationManager =<br>(LocationManager) getSystemService(Context.LOCATION_SERVICE);<br>boolean gpsEnabled = locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER);</p>
<p>if (!gpsEnabled) {<br>// Create a dialog here that requests the user to enable GPS, and use an intent<br>// with the android.provider.Settings.ACTION_LOCATION_SOURCE_SETTINGS action<br>// to take the user to the Settings screen to enable GPS when they click &quot;OK&quot;<br>}<br>}</p>
<p>@Override<br>protected void onRestart() {<br>super.onRestart();  // Always call the superclass method first</p>
<p>// Activity being restarted from stopped state<br>}[/java]</p>
<p>When the system destroys your activity, it calls the <code>[onDestroy()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy())</code> method for your <code>[Activity](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html)</code>. Because you should generally have released most of your resources with <code>[onStop()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop())</code>, by the time you receive a call to <code>[onDestroy()](file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy())</code>, there’s not much that most apps need to do. This method is your last chance to clean out resources that could lead to a memory leak, so you should be sure that additional threads are destroyed and other long-running actions like method tracing are also stopped.</p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android开发/">Android开发</a>►<a class="article-category-link" href="/categories/Android开发/Training文档/">Training文档</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/03/13/stopping-and-restarting-an-activity/" data-title="Stopping and Restarting an Activity | louis.chen" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/13/recreating-an-activity/" title="Recreating an Activity">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Recreating an Activity</span>
</a>
</div>


<div class="next">
<a href="/2015/03/13/pausing-and-resuming-an-activity/"  title="Pausing and Resuming an Activity">
 <strong>NEXT:</strong><br/> 
 <span>Pausing and Resuming an Activity
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stop_Your_Activity"><span class="toc-number">1.</span> <span class="toc-text">Stop Your Activity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Start/Restart_Your_Activity"><span class="toc-number">2.</span> <span class="toc-text">Start/Restart Your Activity</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android开发/" title="Android开发">Android开发<sup>21</sup></a></li>
		
			<li><a href="/categories/Android开源框架/" title="Android开源框架">Android开源框架<sup>4</sup></a></li>
		
			<li><a href="/categories/Android开发/Dandelion/" title="Dandelion">Dandelion<sup>1</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/categories/Android开发/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/Training文档/" title="Training文档">Training文档<sup>9</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/categories/未分类/" title="未分类">未分类<sup>0</sup></a></li>
		
			<li><a href="/categories/自定义控件/" title="自定义控件">自定义控件<sup>4</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
		
			<li><a href="/tags/文章/" title="文章">文章<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> louis.chen,student of USTC,Focus on mobile develop. <br/>
			It is my amibition to develop beautiful app.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2338582935" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/leerduo" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="louis.chen">louis.chen</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
