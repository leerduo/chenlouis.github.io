<?xml version="1.0" encoding="UTF-8" ?>
<!-- This is a WordPress eXtended RSS file generated by WordPress as an export of your site. -->
<!-- It contains information about your site's posts, pages, comments, categories, and other content. -->
<!-- You may use this file to transfer that content from one site to another. -->
<!-- This file is not intended to serve as a complete backup of your site. -->

<!-- To import this information into a WordPress site follow these steps: -->
<!-- 1. Log in to that site as an administrator. -->
<!-- 2. Go to Tools: Import in the WordPress admin panel. -->
<!-- 3. Install the "WordPress" importer from the list. -->
<!-- 4. Activate & Run Importer. -->
<!-- 5. Upload this file using the form provided on that page. -->
<!-- 6. You will first be asked to map the authors in this export file to users -->
<!--    on the site. For each author, you may choose to map to an -->
<!--    existing user on the site or to create a new user. -->
<!-- 7. WordPress will then import each of the posts, pages, comments, categories, etc. -->
<!--    contained in this file into your site. -->

<!-- generator="WordPress/3.4.1" created="2015-04-20 06:28" -->
<rss version="2.0"
	xmlns:excerpt="http://wordpress.org/export/1.2/excerpt/"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:wp="http://wordpress.org/export/1.2/"
>

<channel>
	<title>一个开发者</title>
	<link>http://1.duoinfo.sinaapp.com</link>
	<description>热爱生活的程序猿 @USTC</description>
	<pubDate>Mon, 20 Apr 2015 06:28:21 +0000</pubDate>
	<language>zh-CN</language>
	<wp:wxr_version>1.2</wp:wxr_version>
	<wp:base_site_url>http://1.duoinfo.sinaapp.com</wp:base_site_url>
	<wp:base_blog_url>http://1.duoinfo.sinaapp.com</wp:base_blog_url>

	<wp:author><wp:author_id>1</wp:author_id><wp:author_login>duoinfo</wp:author_login><wp:author_email>eoeduo@163.com</wp:author_email><wp:author_display_name><![CDATA[duoinfo]]></wp:author_display_name><wp:author_first_name><![CDATA[]]></wp:author_first_name><wp:author_last_name><![CDATA[]]></wp:author_last_name></wp:author>

	<wp:category><wp:term_id>12</wp:term_id><wp:category_nicename>android%e5%bc%80%e5%8f%91</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Android开发]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>95</wp:term_id><wp:category_nicename>android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Android开源框架]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>24</wp:term_id><wp:category_nicename>android%e6%ba%90%e7%a0%81</wp:category_nicename><wp:category_parent>android%e5%bc%80%e5%8f%91</wp:category_parent><wp:cat_name><![CDATA[Android源码]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>82</wp:term_id><wp:category_nicename>android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Android源码分析]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>98</wp:term_id><wp:category_nicename>codingnet</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[CodingNet]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>85</wp:term_id><wp:category_nicename>dandelion</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Dandelion]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>70</wp:term_id><wp:category_nicename>java</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Java]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>92</wp:term_id><wp:category_nicename>leancloud</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[leancloud]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>100</wp:term_id><wp:category_nicename>material-design</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[material design]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>90</wp:term_id><wp:category_nicename>training%e6%96%87%e6%a1%a3</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[Training文档]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>13</wp:term_id><wp:category_nicename>%e4%b8%aa%e4%ba%ba%e7%ae%80%e4%bb%8b</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[个人简介]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>108</wp:term_id><wp:category_nicename>%e5%89%91%e6%8c%87offer</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[剑指offer]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>81</wp:term_id><wp:category_nicename>%e5%8a%b1%e5%bf%97</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[励志]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>20</wp:term_id><wp:category_nicename>%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af</wp:category_nicename><wp:category_parent>android%e5%bc%80%e5%8f%91</wp:category_parent><wp:cat_name><![CDATA[即时通讯]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>88</wp:term_id><wp:category_nicename>%e5%bf%86%e6%b8%b8</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[忆游]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>43</wp:term_id><wp:category_nicename>%e6%94%b6%e8%97%8f</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[收藏]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>93</wp:term_id><wp:category_nicename>%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[数据结构和算法]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>1</wp:term_id><wp:category_nicename>uncategorized</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[未分类]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>44</wp:term_id><wp:category_nicename>%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[自定义控件]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>107</wp:term_id><wp:category_nicename>%e9%97%ae%e9%a2%98%e9%9b%86%e5%90%88</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[问题集合]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>52</wp:term_id><wp:category_nicename>%e9%9d%a2%e8%af%95</wp:category_nicename><wp:category_parent>android%e5%bc%80%e5%8f%91</wp:category_parent><wp:cat_name><![CDATA[面试]]></wp:cat_name></wp:category>
	<wp:category><wp:term_id>84</wp:term_id><wp:category_nicename>%e9%a1%b9%e7%9b%ae</wp:category_nicename><wp:category_parent></wp:category_parent><wp:cat_name><![CDATA[项目]]></wp:cat_name></wp:category>
	<wp:tag><wp:term_id>91</wp:term_id><wp:tag_slug>activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f</wp:tag_slug><wp:tag_name><![CDATA[Activity生命周期]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>80</wp:term_id><wp:tag_slug>aidl</wp:tag_slug><wp:tag_name><![CDATA[AIDL]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>15</wp:term_id><wp:tag_slug>android</wp:tag_slug><wp:tag_name><![CDATA[Android]]></wp:tag_name><wp:tag_description><![CDATA[Android]]></wp:tag_description></wp:tag>
	<wp:tag><wp:term_id>24</wp:term_id><wp:tag_slug>android%e6%ba%90%e7%a0%81</wp:tag_slug><wp:tag_name><![CDATA[Android源码]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>22</wp:term_id><wp:tag_slug>android%e9%97%ae%e9%a2%98</wp:tag_slug><wp:tag_name><![CDATA[Android问题]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>89</wp:term_id><wp:tag_slug>android%e9%9d%a2%e8%af%95</wp:tag_slug><wp:tag_name><![CDATA[Android面试]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>97</wp:term_id><wp:tag_slug>androidannotations%e6%a1%86%e6%9e%b6</wp:tag_slug><wp:tag_name><![CDATA[Annotations]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>21</wp:term_id><wp:tag_slug>asynctask</wp:tag_slug><wp:tag_name><![CDATA[AsyncTask]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>53</wp:term_id><wp:tag_slug>asynctask%e5%b5%8c%e5%a5%97</wp:tag_slug><wp:tag_name><![CDATA[AsyncTask嵌套]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>39</wp:term_id><wp:tag_slug>autocompletetextview</wp:tag_slug><wp:tag_name><![CDATA[AutoCompleteTextView]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>69</wp:term_id><wp:tag_slug>beautyproj</wp:tag_slug><wp:tag_name><![CDATA[BeautyProj]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>56</wp:term_id><wp:tag_slug>bitmap</wp:tag_slug><wp:tag_name><![CDATA[bitmap]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>58</wp:term_id><wp:tag_slug>bitmapdrawable</wp:tag_slug><wp:tag_name><![CDATA[BitmapDrawable]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>36</wp:term_id><wp:tag_slug>borderless-button</wp:tag_slug><wp:tag_name><![CDATA[Borderless button]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>51</wp:term_id><wp:tag_slug>contextual-action-mode</wp:tag_slug><wp:tag_name><![CDATA[contextual action mode]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>42</wp:term_id><wp:tag_slug>date-picker</wp:tag_slug><wp:tag_name><![CDATA[Date picker]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>60</wp:term_id><wp:tag_slug>disklrucache</wp:tag_slug><wp:tag_name><![CDATA[DiskLruCache]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>65</wp:term_id><wp:tag_slug>displaying-bitmaps-in-your-ui</wp:tag_slug><wp:tag_name><![CDATA[Displaying Bitmaps in Your UI]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>38</wp:term_id><wp:tag_slug>edittext</wp:tag_slug><wp:tag_name><![CDATA[EditText]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>72</wp:term_id><wp:tag_slug>formatting</wp:tag_slug><wp:tag_name><![CDATA[formatting]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>86</wp:term_id><wp:tag_slug>fragment</wp:tag_slug><wp:tag_name><![CDATA[Fragment]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>87</wp:term_id><wp:tag_slug>gc</wp:tag_slug><wp:tag_name><![CDATA[GC]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>32</wp:term_id><wp:tag_slug>getmeasuredwidth</wp:tag_slug><wp:tag_name><![CDATA[getMeasuredWidth]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>31</wp:term_id><wp:tag_slug>getwidth</wp:tag_slug><wp:tag_name><![CDATA[getWidth]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>68</wp:term_id><wp:tag_slug>gridview</wp:tag_slug><wp:tag_name><![CDATA[GridView]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>62</wp:term_id><wp:tag_slug>handle-configuration-changes</wp:tag_slug><wp:tag_name><![CDATA[Handle Configuration Changes]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>77</wp:term_id><wp:tag_slug>handler</wp:tag_slug><wp:tag_name><![CDATA[Handler]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>35</wp:term_id><wp:tag_slug>im</wp:tag_slug><wp:tag_name><![CDATA[IM]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>64</wp:term_id><wp:tag_slug>inbitmap</wp:tag_slug><wp:tag_name><![CDATA[inBitmap]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>74</wp:term_id><wp:tag_slug>intentservice</wp:tag_slug><wp:tag_name><![CDATA[IntentService]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>71</wp:term_id><wp:tag_slug>java-2</wp:tag_slug><wp:tag_name><![CDATA[java]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>99</wp:term_id><wp:tag_slug>java%e5%ae%89%e5%85%a8%e9%80%9a%e4%bf%a1</wp:tag_slug><wp:tag_name><![CDATA[Java安全通信]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>25</wp:term_id><wp:tag_slug>jni-cc</wp:tag_slug><wp:tag_name><![CDATA[JNI C/C++]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>16</wp:term_id><wp:tag_slug>leetcode</wp:tag_slug><wp:tag_name><![CDATA[leetcode]]></wp:tag_name><wp:tag_description><![CDATA[leetcode]]></wp:tag_description></wp:tag>
	<wp:tag><wp:term_id>23</wp:term_id><wp:tag_slug>listview</wp:tag_slug><wp:tag_name><![CDATA[ListView]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>106</wp:term_id><wp:tag_slug>loadermanager</wp:tag_slug><wp:tag_name><![CDATA[LoaderManager]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>76</wp:term_id><wp:tag_slug>looper</wp:tag_slug><wp:tag_name><![CDATA[Looper]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>59</wp:term_id><wp:tag_slug>lrucache</wp:tag_slug><wp:tag_name><![CDATA[LruCache]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>63</wp:term_id><wp:tag_slug>managing-bitmap-memory</wp:tag_slug><wp:tag_name><![CDATA[Managing Bitmap Memory]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>30</wp:term_id><wp:tag_slug>margin</wp:tag_slug><wp:tag_name><![CDATA[Margin]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>100</wp:term_id><wp:tag_slug>material-design</wp:tag_slug><wp:tag_name><![CDATA[material design]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>78</wp:term_id><wp:tag_slug>messenger</wp:tag_slug><wp:tag_name><![CDATA[Messenger]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>14</wp:term_id><wp:tag_slug>more</wp:tag_slug><wp:tag_name><![CDATA[more]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>102</wp:term_id><wp:tag_slug>msg</wp:tag_slug><wp:tag_name><![CDATA[msg]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>73</wp:term_id><wp:tag_slug>multithreading</wp:tag_slug><wp:tag_name><![CDATA[multithreading]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>29</wp:term_id><wp:tag_slug>padding</wp:tag_slug><wp:tag_name><![CDATA[Padding]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>33</wp:term_id><wp:tag_slug>phonegap</wp:tag_slug><wp:tag_name><![CDATA[PhoneGap]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>40</wp:term_id><wp:tag_slug>picker</wp:tag_slug><wp:tag_name><![CDATA[Picker]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>67</wp:term_id><wp:tag_slug>scaletype</wp:tag_slug><wp:tag_name><![CDATA[ScaleType]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>105</wp:term_id><wp:tag_slug>swiperefreshlayout</wp:tag_slug><wp:tag_name><![CDATA[SwipeRefreshLayout]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>104</wp:term_id><wp:tag_slug>switch-%e6%88%96%e6%98%af-radoi-%e8%a2%ab%e5%8b%be%e9%80%89-checked-%e6%88%96%e6%98%af%e9%80%89%e5%ae%9a-selected-%e7%9a%84%e9%a2%9c%e8%89%b2%e3%80%82-%e5%9c%a8-style-%e7%9a%84%e5%b1%9e%e6%80%a7</wp:tag_slug><wp:tag_name><![CDATA[switch 或是 radoi) 被勾选 (checked) 或是选定 (selected) 的颜色。 在 style 的属性中设置。 colorControlNormal 各控制元件的预设颜色。 在 style 的属性中设置 windowBackground App 的背景色。 在 style 的属性中设置 navigationBarColor 导航栏的背景色，但只能用在 API Level 2]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>37</wp:term_id><wp:tag_slug>textview</wp:tag_slug><wp:tag_name><![CDATA[TextView]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>41</wp:term_id><wp:tag_slug>time-picker</wp:tag_slug><wp:tag_name><![CDATA[Time Picker]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>75</wp:term_id><wp:tag_slug>toast</wp:tag_slug><wp:tag_name><![CDATA[Toast]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>103</wp:term_id><wp:tag_slug>toast-length_short-show-return-true-%e5%b0%86onmenuitemclick%e7%9b%91%e5%90%ac%e8%80%85%e8%ae%be%e7%bd%ae%e7%bb%99toolbar-1-2-3-4-5-6-setsupportactionbartoolbar-menu-item-click</wp:tag_slug><wp:tag_name><![CDATA[Toast.LENGTH_SHORT).show(); } return true; } }; 将onMenuItemClick监听者设置给toolbar 1 2 3 4 5 6 setSupportActionBar(toolbar); ... // Menu item click 的監聽事件一樣要設定在 setSupportActionBar 才有作用 toolbar.setOnMenuIte]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>96</wp:term_id><wp:tag_slug>uil</wp:tag_slug><wp:tag_name><![CDATA[UIL]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>27</wp:term_id><wp:tag_slug>view</wp:tag_slug><wp:tag_name><![CDATA[View]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>28</wp:term_id><wp:tag_slug>viewgroup</wp:tag_slug><wp:tag_name><![CDATA[ViewGroup]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>66</wp:term_id><wp:tag_slug>viewtreeobserver</wp:tag_slug><wp:tag_name><![CDATA[ViewTreeObserver]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>34</wp:term_id><wp:tag_slug>webview</wp:tag_slug><wp:tag_name><![CDATA[WebView]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>49</wp:term_id><wp:tag_slug>%e4%b8%8b%e6%8b%89%e8%8f%9c%e5%8d%95</wp:tag_slug><wp:tag_name><![CDATA[下拉菜单]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>83</wp:term_id><wp:tag_slug>%e4%ba%8b%e4%bb%b6%e5%88%86%e5%8f%91</wp:tag_slug><wp:tag_name><![CDATA[事件分发]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>45</wp:term_id><wp:tag_slug>%e4%bc%98%e9%85%b7%e8%8f%9c%e5%8d%95</wp:tag_slug><wp:tag_name><![CDATA[优酷菜单]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>108</wp:term_id><wp:tag_slug>%e5%89%91%e6%8c%87offer</wp:tag_slug><wp:tag_name><![CDATA[剑指offer]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>20</wp:term_id><wp:tag_slug>%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af</wp:tag_slug><wp:tag_name><![CDATA[即时通讯]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>54</wp:term_id><wp:tag_slug>%e5%b1%8f%e5%b9%95%e6%97%8b%e8%bd%ac</wp:tag_slug><wp:tag_name><![CDATA[屏幕旋转]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>61</wp:term_id><wp:tag_slug>%e5%b1%8f%e5%b9%95%e6%97%8b%e8%bd%ac%e5%a4%84%e7%90%86</wp:tag_slug><wp:tag_name><![CDATA[屏幕旋转处理]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>48</wp:term_id><wp:tag_slug>%e5%b9%bf%e5%91%8a%e6%9d%a1</wp:tag_slug><wp:tag_name><![CDATA[广告条]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>88</wp:term_id><wp:tag_slug>%e5%bf%86%e6%b8%b8</wp:tag_slug><wp:tag_name><![CDATA[忆游]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>19</wp:term_id><wp:tag_slug>%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96</wp:tag_slug><wp:tag_name><![CDATA[性能优化]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>18</wp:term_id><wp:tag_slug>%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84</wp:tag_slug><wp:tag_name><![CDATA[数据结构]]></wp:tag_name><wp:tag_description><![CDATA[数据结构]]></wp:tag_description></wp:tag>
	<wp:tag><wp:term_id>46</wp:term_id><wp:tag_slug>%e6%97%8b%e8%bd%ac%e5%8a%a8%e7%94%bb</wp:tag_slug><wp:tag_name><![CDATA[旋转动画]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>101</wp:term_id><wp:tag_slug>%e6%9d%a5%e6%ba%90-httpblog-mosil-biz201410android-toolbar-%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e5%9b%a0%e4%b8%ba%e6%98%af%e5%8f%b0%e6%b9%be%e4%ba%ba%e5%86%99%e7%9a%84%ef%bc%8c%e8%af%ad</wp:tag_slug><wp:tag_name><![CDATA[来源 http://blog.mosil.biz/2014/10/android-toolbar/ 这篇文章因为是台湾人写的，语言风格很别致。本文在原文的基础上做了一些微调（主要是繁体字的问题）。 今年(2014) 的 google i/o 发表令多数人为之一亮的 material design，而 google 也从「google i/o 2014」 开始，大家也陆陆续续地看到其更新的 andr]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>26</wp:term_id><wp:tag_slug>%e6%a0%87%e9%a2%98%e6%a0%8f%e5%b0%ba%e5%af%b8</wp:tag_slug><wp:tag_name><![CDATA[标题栏尺寸]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>50</wp:term_id><wp:tag_slug>%e6%bb%91%e5%8a%a8%e5%bc%80%e5%85%b3</wp:tag_slug><wp:tag_name><![CDATA[滑动开关]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>55</wp:term_id><wp:tag_slug>%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f</wp:tag_slug><wp:tag_name><![CDATA[生命周期]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>47</wp:term_id><wp:tag_slug>%e7%9b%b8%e5%af%b9%e5%b8%83%e5%b1%80</wp:tag_slug><wp:tag_name><![CDATA[相对布局]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>17</wp:term_id><wp:tag_slug>%e7%ae%97%e6%b3%95</wp:tag_slug><wp:tag_name><![CDATA[算法]]></wp:tag_name><wp:tag_description><![CDATA[算法]]></wp:tag_description></wp:tag>
	<wp:tag><wp:term_id>44</wp:term_id><wp:tag_slug>%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6</wp:tag_slug><wp:tag_name><![CDATA[自定义控件]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>79</wp:term_id><wp:tag_slug>%e8%b7%a8%e8%bf%9b%e7%a8%8b%e9%80%9a%e4%bf%a1</wp:tag_slug><wp:tag_name><![CDATA[跨进程通信]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>94</wp:term_id><wp:tag_slug>%e9%93%be%e8%a1%a8</wp:tag_slug><wp:tag_name><![CDATA[链表]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>52</wp:term_id><wp:tag_slug>%e9%9d%a2%e8%af%95</wp:tag_slug><wp:tag_name><![CDATA[面试]]></wp:tag_name></wp:tag>
	<wp:tag><wp:term_id>57</wp:term_id><wp:tag_slug>%e9%ab%98%e6%95%88%e5%b1%95%e7%a4%babitmap</wp:tag_slug><wp:tag_name><![CDATA[高效展示Bitmap]]></wp:tag_name></wp:tag>
	<wp:term><wp:term_id>11</wp:term_id><wp:term_taxonomy>nav_menu</wp:term_taxonomy><wp:term_slug>%e5%a4%9a%e5%a4%9a</wp:term_slug><wp:term_name><![CDATA[多多]]></wp:term_name></wp:term>

	<generator>http://wordpress.org/?v=3.4.1</generator>

	<item>
		<title>首页</title>
		<link>http://1.duoinfo.sinaapp.com/?p=8</link>
		<pubDate>Tue, 20 Jan 2015 03:03:54 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=8</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>8</wp:post_id>
		<wp:post_date>2015-01-20 11:03:54</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:03:54</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%a6%96%e9%a1%b5</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>1</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[8]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>个人简介</title>
		<link>http://1.duoinfo.sinaapp.com/?p=9</link>
		<pubDate>Tue, 20 Jan 2015 03:09:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=9</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="color: #000080;">个人简介</span>

陈福多，中国科学技术大学硕士研二在读，Android爱好者，立志于从事移动互联网。爱生活，爱coding。

<span style="color: #000080;">目标方向</span>

移动开发

<span style="color: #000080;">小小梦想</span>

开发一款影响大众生活的APP。

<span style="color: #000080;">联系方式：</span>

邮箱：eoeduo@163.com

QQ:619189810

电话：15209839517]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>9</wp:post_id>
		<wp:post_date>2015-01-20 11:09:32</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:09:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>9</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="more"><![CDATA[more]]></category>
		<category domain="category" nicename="%e4%b8%aa%e4%ba%ba%e7%ae%80%e4%bb%8b"><![CDATA[个人简介]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707457]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[3]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>3</wp:comment_id>
			<wp:comment_author><![CDATA[卡旺卡的眷顾]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url></wp:comment_author_url>
			<wp:comment_author_IP>220.114.142.150</wp:comment_author_IP>
			<wp:comment_date>2015-01-25 11:52:16</wp:comment_date>
			<wp:comment_date_gmt>2015-01-25 03:52:16</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[未来之星]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_parent_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707456]]></wp:meta_value>
			</wp:commentmeta>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_post_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707458]]></wp:meta_value>
			</wp:commentmeta>
		</wp:comment>
	</item>
	<item>
		<title>手机管家项目</title>
		<link>http://1.duoinfo.sinaapp.com/?p=11</link>
		<pubDate>Tue, 20 Jan 2015 03:11:50 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=11</guid>
		<description></description>
		<content:encoded><![CDATA[升级V2版：

当用户点击圆是，清理内存：

<img src="http://img.blog.csdn.net/20150115110931687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

增加流量统计的功能:

<img src="http://img.blog.csdn.net/20150115110007531?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

应用的截图：

<img src="http://img.blog.csdn.net/20150114212118490?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150114211921739?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150114211912437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150114211934156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>11</wp:post_id>
		<wp:post_date>2015-01-20 11:11:50</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:11:50</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e6%89%8b%e6%9c%ba%e7%ae%a1%e5%ae%b6%e9%a1%b9%e7%9b%ae</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e9%a1%b9%e7%9b%ae"><![CDATA[项目]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707458]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[4]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>项目</title>
		<link>http://1.duoinfo.sinaapp.com/?p=14</link>
		<pubDate>Tue, 20 Jan 2015 03:13:06 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=14</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>14</wp:post_id>
		<wp:post_date>2015-01-20 11:13:06</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:13:06</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%a1%b9%e7%9b%ae</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>2</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[14]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/?cat=84]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>关于</title>
		<link>http://1.duoinfo.sinaapp.com/?p=17</link>
		<pubDate>Tue, 20 Jan 2015 03:15:41 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=17</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>17</wp:post_id>
		<wp:post_date>2015-01-20 11:15:41</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:15:41</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%85%b3%e4%ba%8e</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>7</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[17]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/?p=9]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>进来坐坐</title>
		<link>http://1.duoinfo.sinaapp.com/?p=19</link>
		<pubDate>Tue, 20 Jan 2015 03:18:07 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=19</guid>
		<description></description>
		<content:encoded><![CDATA[都来了，也给个回复呗，给我一点建议。

我的联系方式:eoeduo@163.com]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>19</wp:post_id>
		<wp:post_date>2015-01-20 11:18:07</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:18:07</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e8%bf%9b%e6%9d%a5%e5%9d%90%e5%9d%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="more"><![CDATA[more]]></category>
		<category domain="category" nicename="%e4%b8%aa%e4%ba%ba%e7%ae%80%e4%bb%8b"><![CDATA[个人简介]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707460]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>留言板</title>
		<link>http://1.duoinfo.sinaapp.com/?p=21</link>
		<pubDate>Tue, 20 Jan 2015 03:18:25 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=21</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>21</wp:post_id>
		<wp:post_date>2015-01-20 11:18:25</wp:post_date>
		<wp:post_date_gmt>2015-01-20 03:18:25</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e7%95%99%e8%a8%80%e6%9d%bf</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>6</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[21]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/?p=19]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android性能优化典范</title>
		<link>http://1.duoinfo.sinaapp.com/?p=27</link>
		<pubDate>Tue, 20 Jan 2015 09:56:41 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=27</guid>
		<description></description>
		<content:encoded><![CDATA[<img src="http://hukai.me/images/android_perf_patterns.png" alt="" />2015年伊始，Google发布了关于<a href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE">Android性能优化典范的专题</a>，一共16个短视频，每个3-5分钟，帮助开发者创建更快更优秀的Android App。课程专题不仅仅介绍了Android系统中有关性能问题的底层工作原理，同时也介绍了如何通过工具来找出性能问题以及提升性能的建议。主要从三个方面展开，Android的渲染机制，内存与GC，电量优化。下面是对这些问题和建议的总结梳理。
<h2>0)Render Performance</h2>
大多数用户感知到的卡顿等性能问题的最主要根源都是因为渲染性能。从设计师的角度，他们希望App能够有更多的动画，图片等时尚元素来实现流畅的用户体验。但是Android系统很有可能无法及时完成那些复杂的界面渲染操作。Android系统每隔16ms发出VSYNC信号，触发对UI进行渲染，如果每次渲染都成功，这样就能够达到流畅的画面所需要的60fps，为了能够实现60fps，这意味着程序的大多数操作都必须在16ms内完成。

<img src="http://hukai.me/images/draw_per_16ms.png" alt="" />

如果你的某个操作花费时间是24ms，系统在得到VSYNC信号的时候就无法进行正常渲染，这样就发生了丢帧现象。那么用户在32ms内看到的会是同一帧画面。

<img src="http://hukai.me/images/vsync_over_draw.png" alt="" />

用户容易在UI执行动画或者滑动ListView的时候感知到卡顿不流畅，是因为这里的操作相对复杂，容易发生丢帧的现象，从而感觉卡顿。有很多原因可以导致丢帧，也许是因为你的layout太过复杂，无法在16ms内完成渲染，有可能是因为你的UI上有层叠太多的绘制单元，还有可能是因为动画执行的次数过多。这些都会导致CPU或者GPU负载过重。

我们可以通过一些工具来定位问题，比如可以使用HierarchyViewer来查找Activity中的布局是否过于复杂，也可以使用手机设置里面的开发者选项，打开Show GPU Overdraw等选项进行观察。你还可以使用TraceView来观察CPU的执行情况，更加快捷的找到性能瓶颈。
<h2>1)Understanding Overdraw</h2>
Overdraw(过度绘制)描述的是屏幕上的某个像素在同一帧的时间内被绘制了多次。在多层次的UI结构里面，如果不可见的UI也在做绘制的操作，这就会导致某些像素区域被绘制了多次。这就浪费大量的CPU以及GPU资源。

<img src="http://hukai.me/images/overdraw_hidden_view.png" alt="" />

当设计上追求更华丽的视觉效果的时候，我们就容易陷入采用越来越多的层叠组件来实现这种视觉效果的怪圈。这很容易导致大量的性能问题，为了获得最佳的性能，我们必须尽量减少Overdraw的情况发生。

幸运的是，我们可以通过手机设置里面的开发者选项，打开Show GPU Overdraw的选项，可以观察UI上的Overdraw情况。

<img src="http://hukai.me/images/overdraw_options_view.png" alt="" />

蓝色，淡绿，淡红，深红代表了4种不同程度的Overdraw情况，我们的目标就是尽量减少红色Overdraw，看到更多的蓝色区域。

Overdraw有时候是因为你的UI布局存在大量重叠的部分，还有的时候是因为非必须的重叠背景。例如某个Activity有一个背景，然后里面的Layout又有自己的背景，同时子View又分别有自己的背景。仅仅是通过移除非必须的背景图片，这就能够减少大量的红色Overdraw区域，增加蓝色区域的占比。这一措施能够显著提升程序性能。
<h2>2)Understanding VSYNC</h2>
为了理解App是如何进行渲染的，我们必须了解手机硬件是如何工作，那么就必须理解什么是<em>VSYNC</em>。

在讲解VSYNC之前，我们需要了解两个相关的概念：
<ul>
	<li>Refresh Rate：代表了屏幕在一秒内刷新屏幕的次数，这取决于硬件的固定参数，例如60Hz。</li>
	<li>Frame Rate：代表了GPU在一秒内绘制操作的帧数，例如30fps，60fps。</li>
</ul>
GPU会获取图形数据进行渲染，然后硬件负责把渲染后的内容呈现到屏幕上，他们两者不停的进行协作。

<img src="http://hukai.me/images/vsync_gpu_hardware.png" alt="" />

不幸的是，刷新频率和帧率并不是总能够保持相同的节奏。如果发生帧率与刷新频率不一致的情况，就会容易出现<strong>Tearing</strong>的现象(画面上下两部分显示内容发生断裂，来自不同的两帧数据发生重叠)。

<img src="http://hukai.me/images/vsync_gpu_hardware_not_sync.png" alt="" />

<img src="http://hukai.me/images/vsync_buffer.png" alt="" />

理解图像渲染里面的双重与三重缓存机制，这个概念比较复杂，请移步查看这里：<a href="http://source.android.com/devices/graphics/index.html">http://source.android.com/devices/graphics/index.html</a>，还有这里<a href="http://article.yeeyan.org/view/37503/304664">http://article.yeeyan.org/view/37503/304664</a>。

通常来说，帧率超过刷新频率只是一种理想的状况，在超过60fps的情况下，GPU所产生的帧数据会因为等待VSYNC的刷新信息而被Hold住，这样能够保持每次刷新都有实际的新的数据可以显示。但是我们遇到更多的情况是帧率小于刷新频率。

<img src="http://hukai.me/images/vsync_gpu_hardware_not_sync2.png" alt="" />

在这种情况下，某些帧显示的画面内容就会与上一帧的画面相同。糟糕的事情是，帧率从超过60fps突然掉到60fps以下，这样就会发生<strong>LAG</strong>，<strong>JANK</strong>，<strong>HITCHING</strong>等卡顿掉帧的不顺滑的情况。这也是用户感受不好的原因所在。
<h2>3)Tool:Profile GPU Rendering</h2>
性能问题如此的麻烦，幸好我们可以有工具来进行调试。打开手机里面的开发者选项，选择Profile GPU Rendering，选中On screen as bars的选项。

<img src="http://hukai.me/images/tools_gpu_profile_rendering.png" alt="" />

选择了这样以后，我们可以在手机画面上看到丰富的GPU绘制图形信息，分别关于StatusBar，NavBar，激活的程序Activity区域的GPU Rending信息。

<img src="http://hukai.me/images/tools_gpu_profile_rendering_graphic_activity.png" alt="" />

随着界面的刷新，界面上会滚动显示垂直的柱状图来表示每帧画面所需要渲染的时间，柱状图越高表示花费的渲染时间越长。

<img src="http://hukai.me/images/tools_gpu_rendering_bar.png" alt="" />

中间有一根绿色的横线，代表16ms，我们需要确保每一帧花费的总时间都低于这条横线，这样才能够避免出现卡顿的问题。

<img src="http://hukai.me/images/tools_gpu_profile_three_color.png" alt="" />

每一条柱状线都包含三部分，蓝色代表测量绘制Display List的时间，红色代表OpenGL渲染Display List所需要的时间，黄色代表CPU等待GPU处理的时间。
<h2>4)Why 60fps?</h2>
我们通常都会提到60fps与16ms，可是知道为何会是以程序是否达到60fps来作为App性能的衡量标准吗？这是因为人眼与大脑之间的协作无法感知超过60fps的画面更新。

12fps大概类似手动快速翻动书籍的帧率，这明显是可以感知到不够顺滑的。24fps使得人眼感知的是连续线性的运动，这其实是归功于运动模糊的效果。24fps是电影胶圈通常使用的帧率，因为这个帧率已经足够支撑大部分电影画面需要表达的内容，同时能够最大的减少费用支出。但是低于30fps是无法顺畅表现绚丽的画面内容的，此时就需要用到60fps来达到想要的效果，当然超过60fps是没有必要的。

开发app的性能目标就是保持60fps，这意味着每一帧你只有16ms=1000/60的时间来处理所有的任务。
<h2>5)Android, UI and the GPU</h2>
了解Android是如何利用GPU进行画面渲染有助于我们更好的理解性能问题。那么一个最实际的问题是：activity的画面是如何绘制到屏幕上的？那些复杂的XML布局文件又是如何能够被识别并绘制出来的？

<img src="http://hukai.me/images/gpu_rasterization.png" alt="" />

<strong>Resterization栅格化</strong>是绘制那些Button，Shape，Path，String，Bitmap等组件最基础的操作。它把那些组件拆分到不同的像素上进行显示。这是一个很费时的操作，GPU的引入就是为了加快栅格化的操作。

CPU负责把UI组件计算成Polygons，Texture纹理，然后交给GPU进行栅格化渲染。

<img src="http://hukai.me/images/gpu_cpu_rasterization.png" alt="" />

然而每次从CPU转移到GPU是一件很麻烦的事情，所幸的是OpenGL ES可以把那些需要渲染的纹理Hold在GPU Memory里面，在下次需要渲染的时候直接进行操作。所以如果你更新了GPU所hold住的纹理内容，那么之前保存的状态就丢失了。

在Android里面那些由主题所提供的资源，例如Bitmaps，Drawables都是一起打包到统一的Texture纹理当中，然后再传递到GPU里面，这意味着每次你需要使用这些资源的时候，都是直接从纹理里面进行获取渲染的。当然随着UI组件的越来越丰富，有了更多演变的形态。例如显示图片的时候，需要先经过CPU的计算加载到内存中，然后传递给GPU进行渲染。文字的显示更加复杂，需要先经过CPU换算成纹理，然后再交给GPU进行渲染，回到CPU绘制单个字符的时候，再重新引用经过GPU渲染的内容。动画则是一个更加复杂的操作流程。

为了能够使得App流畅，我们需要在每一帧16ms以内处理完所有的CPU与GPU计算，绘制，渲染等等操作。
<h2>6)Invalidations, Layouts, and Performance</h2>
顺滑精妙的动画是app设计里面最重要的元素之一，这些动画能够显著提升用户体验。下面会讲解Android系统是如何处理UI组件的更新操作的。

通常来说，Android需要把XML布局文件转换成GPU能够识别并绘制的对象。这个操作是在<strong>DisplayList</strong>的帮助下完成的。DisplayList持有所有将要交给GPU绘制到屏幕上的数据信息。

在某个View第一次需要被渲染时，DisplayList会因此而被创建，当这个View要显示到屏幕上时，我们会执行GPU的绘制指令来进行渲染。如果你在后续有执行类似移动这个View的位置等操作而需要再次渲染这个View时，我们就仅仅需要额外操作一次渲染指令就够了。然而如果你修改了View中的某些可见组件，那么之前的DisplayList就无法继续使用了，我们需要回头重新创建一个DisplayList并且重新执行渲染指令并更新到屏幕上。

需要注意的是：任何时候View中的绘制内容发生变化时，都会重新执行创建DisplayList，渲染DisplayList，更新到屏幕上等一系列操作。这个流程的表现性能取决于你的View的复杂程度，View的状态变化以及渲染管道的执行性能。举个例子，假设某个Button的大小需要增大到目前的两倍，在增大Button大小之前，需要通过父View重新计算并摆放其他子View的位置。修改View的大小会触发整个HierarcyView的重新计算大小的操作。如果是修改View的位置则会触发HierarchView重新计算其他View的位置。如果布局很复杂，这就会很容易导致严重的性能问题。我们需要尽量减少Overdraw。

<img src="http://hukai.me/images/layout_three_steps.png" alt="" />

我们可以通过前面介绍的Monitor GPU Rendering来查看渲染的表现性能如何，另外也可以通过开发者选项里面的Show GPU view updates来查看视图更新的操作，最后我们还可以通过HierarchyViewer这个工具来查看布局，使得布局尽量扁平化，移除非必需的UI组件，这些操作能够减少Measure，Layout的计算时间。
<h2>7)Overdraw, Cliprect, QuickReject</h2>
引起性能问题的一个很重要的方面是因为过多复杂的绘制操作。我们可以通过工具来检测并修复标准UI组件的Overdraw问题，但是针对高度自定义的UI组件则显得有些力不从心。

有一个窍门是我们可以通过执行几个APIs方法来显著提升绘制操作的性能。前面有提到过，非可见的UI组件进行绘制更新会导致Overdraw。例如Nav Drawer从前置可见的Activity滑出之后，如果还继续绘制那些在Nav Drawer里面不可见的UI组件，这就导致了Overdraw。为了解决这个问题，Android系统会通过避免绘制那些完全不可见的组件来尽量减少Overdraw。那些Nav Drawer里面不可见的View就不会被执行浪费资源。

<img src="http://hukai.me/images/overdraw_invisible.png" alt="" />

但是不幸的是，对于那些过于复杂的自定义的View(重写了onDraw方法)，Android系统无法检测具体在onDraw里面会执行什么操作，系统无法监控并自动优化，也就无法避免Overdraw了。但是我们可以通过<a href="http://developer.android.com/reference/android/graphics/Canvas.html">canvas.clipRect()</a>来帮助系统识别那些可见的区域。这个方法可以指定一块矩形区域，只有在这个区域内才会被绘制，其他的区域会被忽视。这个API可以很好的帮助那些有多组重叠组件的自定义View来控制显示的区域。同时clipRect方法还可以帮助节约CPU与GPU资源，在clipRect区域之外的绘制指令都不会被执行，那些部分内容在矩形区域内的组件，仍然会得到绘制。

<img src="http://hukai.me/images/overdraw_reduce_cpu_gpu.png" alt="" />

除了clipRect方法之外，我们还可以使用<a href="http://developer.android.com/reference/android/graphics/Canvas.html">canvas.quickreject()</a>来判断是否没和某个矩形相交，从而跳过那些非矩形区域内的绘制操作。做了那些优化之后，我们可以通过上面介绍的Show GPU Overdraw来查看效果。
<h2>8)Memory Churn and performance</h2>
虽然Android有自动管理内存的机制，但是对内存的不恰当使用仍然容易引起严重的性能问题。在同一帧里面创建过多的对象是件需要特别引起注意的事情。

Android系统里面有一个<strong>Generational Heap Memory</strong>的模型，系统会根据内存中不同的内存数据类型分别执行不同的GC操作。例如，最近刚分配的对象会放在Young Generation区域，这个区域的对象通常都是会快速被创建并且很快被销毁回收的，同时这个区域的GC操作速度也是比Old Generation区域的GC操作速度更快的。

<img src="http://hukai.me/images/memory_mode_generation.png" alt="" />

除了速度差异之外，执行GC操作的时候，任何线程的任何操作都会需要暂停，等待GC操作完成之后，其他操作才能够继续运行。

<img src="http://hukai.me/images/gc_event_thread_stop.png" alt="" />

通常来说，单个的GC并不会占用太多时间，但是大量不停的GC操作则会显著占用帧间隔时间(16ms)。如果在帧间隔时间里面做了过多的GC操作，那么自然其他类似计算，渲染等操作的可用时间就变得少了。

导致GC频繁执行有两个原因：
<ul>
	<li><strong>Memory Churn内存抖动</strong>，内存抖动是因为大量的对象被创建又在短时间内马上被释放。</li>
	<li>瞬间产生大量的对象会严重占用Young Generation的内存区域，当达到阀值，剩余空间不够的时候，也会触发GC。即使每次分配的对象占用了很少的内存，但是他们叠加在一起会增加Heap的压力，从而触发更多其他类型的GC。这个操作有可能会影响到帧率，并使得用户感知到性能问题。</li>
</ul>
<img src="http://hukai.me/images/gc_overtime.png" alt="" />

解决上面的问题有简洁直观方法，如果你在<strong>Memory Monitor</strong>里面查看到短时间发生了多次内存的涨跌，这意味着很有可能发生了内存抖动。

<img src="http://hukai.me/images/memory_monitor_gc.png" alt="" />

同时我们还可以通过<strong>Allocation Tracker</strong>来查看在短时间内，同一个栈中不断进出的相同对象。这是内存抖动的典型信号之一。

当你大致定位问题之后，接下去的问题修复也就显得相对直接简单了。例如，你需要避免在for循环里面分配对象占用内存，需要尝试把对象的创建移到循环体之外，自定义View中的onDraw方法也需要引起注意，每次屏幕发生绘制以及动画执行过程中，onDraw方法都会被调用到，避免在onDraw方法里面执行复杂的操作，避免创建对象。对于那些无法避免需要创建对象的情况，我们可以考虑对象池模型，通过对象池来解决频繁创建与销毁的问题，但是这里需要注意结束使用之后，需要手动释放对象池中的对象。
<h2>9)Garbage Collection in Android</h2>
JVM的回收机制给开发人员带来很大的好处，不用时刻处理对象的分配与回收，可以更加专注于更加高级的代码实现。相比起Java，C与C++等语言具备更高的执行效率，他们需要开发人员自己关注对象的分配与回收，但是在一个庞大的系统当中，还是免不了经常发生部分对象忘记回收的情况，这就是内存泄漏。

原始JVM中的GC机制在Android中得到了很大程度上的优化。Android里面是一个三级Generation的内存模型，最近分配的对象会存放在Young Generation区域，当这个对象在这个区域停留的时间达到一定程度，它会被移动到Old Generation，最后到Permanent Generation区域。

<img src="http://hukai.me/images/android_memory_gc_mode.png" alt="" />

每一个级别的内存区域都有固定的大小，此后不断有新的对象被分配到此区域，当这些对象总的大小快达到这一级别内存区域的阀值时，会触发GC的操作，以便腾出空间来存放其他新的对象。

<img src="http://hukai.me/images/gc_threshold.png" alt="" />

前面提到过每次GC发生的时候，所有的线程都是暂停状态的。GC所占用的时间和它是哪一个Generation也有关系，Young Generation的每次GC操作时间是最短的，Old Generation其次，Permanent Generation最长。执行时间的长短也和当前Generation中的对象数量有关，遍历查找20000个对象比起遍历50个对象自然是要慢很多的。

虽然Google的工程师在尽量缩短每次GC所花费的时间，但是特别注意GC引起的性能问题还是很有必要。如果不小心在最小的for循环单元里面执行了创建对象的操作，这将很容易引起GC并导致性能问题。通过Memory Monitor我们可以查看到内存的占用情况，每一次瞬间的内存降低都是因为此时发生了GC操作，如果在短时间内发生大量的内存上涨与降低的事件，这说明很有可能这里有性能问题。我们还可以通过<strong>Heap and Allocation Tracker</strong>工具来查看此时内存中分配的到底有哪些对象。
<h2>10)Performance Cost of Memory Leaks</h2>
虽然Java有自动回收的机制，可是这不意味着Java中不存在内存泄漏的问题，而内存泄漏会很容易导致严重的性能问题。

内存泄漏指的是那些程序不再使用的对象无法被GC识别，这样就导致这个对象一直留在内存当中，占用了宝贵的内存空间。显然，这还使得每级Generation的内存区域可用空间变小，GC就会更容易被触发，从而引起性能问题。

寻找内存泄漏并修复这个漏洞是件很棘手的事情，你需要对执行的代码很熟悉，清楚的知道在特定环境下是如何运行的，然后仔细排查。例如，你想知道程序中的某个activity退出的时候，它之前所占用的内存是否有完整的释放干净了？首先你需要在activity处于前台的时候使用Heap Tool获取一份当前状态的内存快照，然后你需要创建一个几乎不这么占用内存的空白activity用来给前一个Activity进行跳转，其次在跳转到这个空白的activity的时候主动调用System.gc()方法来确保触发一个GC操作。最后，如果前面这个activity的内存都有全部正确释放，那么在空白activity被启动之后的内存快照中应该不会有前面那个activity中的任何对象了。

<img src="http://hukai.me/images/memory_leak_profile_method.png" alt="" />

如果你发现在空白activity的内存快照中有一些可疑的没有被释放的对象存在，那么接下去就应该使用<strong>Alocation Track Tool</strong>来仔细查找具体的可疑对象。我们可以从空白activity开始监听，启动到观察activity，然后再回到空白activity结束监听。这样操作以后，我们可以仔细观察那些对象，找出内存泄漏的真凶。

<img src="http://hukai.me/images/memory_leak_track_method.png" alt="" />
<h2>11)Memory Performance</h2>
通常来说，Android对GC做了大量的优化操作，虽然执行GC操作的时候会暂停其他任务，可是大多数情况下，GC操作还是相对很安静并且高效的。但是如果我们对内存的使用不恰当，导致GC频繁执行，这样就会引起不小的性能问题。

为了寻找内存的性能问题，Android Studio提供了工具来帮助开发者。
<ul>
	<li><strong>Memory Monitor：</strong>查看整个app所占用的内存，以及发生GC的时刻，短时间内发生大量的GC操作是一个危险的信号。</li>
	<li><strong>Allocation Tracker：</strong>使用此工具来追踪内存的分配，前面有提到过。</li>
	<li><strong>Heap Tool：</strong>查看当前内存快照，便于对比分析哪些对象有可能是泄漏了的，请参考前面的Case。</li>
</ul>
<h2>12)Tool - Memory Monitor</h2>
Android Studio中的Memory Monitor可以很好的帮组我们查看程序的内存使用情况。

<img src="http://hukai.me/images/memory_monitor_overview.png" alt="" />

<img src="http://hukai.me/images/memory_monitor_free_allocation.png" alt="" />

<img src="http://hukai.me/images/memory_monitor_gc_event.png" alt="" />
<h2>13)Battery Performance</h2>
电量其实是目前手持设备最宝贵的资源之一，大多数设备都需要不断的充电来维持继续使用。不幸的是，对于开发者来说，电量优化是他们最后才会考虑的的事情。但是可以确定的是，千万不能让你的应用成为消耗电量的大户。

Purdue University研究了最受欢迎的一些应用的电量消耗，平均只有30%左右的电量是被程序最核心的方法例如绘制图片，摆放布局等等所使用掉的，剩下的70%左右的电量是被上报数据，检查位置信息，定时检索后台广告信息所使用掉的。如何平衡这两者的电量消耗，就显得非常重要了。

有下面一些措施能够显著减少电量的消耗：
<ul>
	<li>我们应该尽量减少唤醒屏幕的次数与持续的时间，使用WakeLock来处理唤醒的问题，能够正确执行唤醒操作并根据设定及时关闭操作进入睡眠状态。</li>
	<li>某些非必须马上执行的操作，例如上传歌曲，图片处理等，可以等到设备处于充电状态或者电量充足的时候才进行。</li>
	<li>触发网络请求的操作，每次都会保持无线信号持续一段时间，我们可以把零散的网络请求打包进行一次操作，避免过多的无线信号引起的电量消耗。关于网络请求引起无线信号的电量消耗，还可以参考这里<a href="http://hukai.me/android-training-course-in-chinese/connectivity/efficient-downloads/efficient-network-access.html">http://hukai.me/android-training-course-in-chinese/connectivity/efficient-downloads/efficient-network-access.html</a></li>
</ul>
我们可以通过手机设置选项找到对应App的电量消耗统计数据。我们还可以通过<strong>Battery Historian Tool</strong>来查看详细的电量消耗。

<img src="http://hukai.me/images/battery_usages_settings.png" alt="" />

如果发现我们的App有电量消耗过多的问题，我们可以使用JobScheduler API来对一些任务进行定时处理，例如我们可以把那些任务重的操作等到手机处于充电状态，或者是连接到WiFi的时候来处理。 关于JobScheduler的更多知识可以参考<a href="http://hukai.me/android-training-course-in-chinese/background-jobs/scheduling/index.html">http://hukai.me/android-training-course-in-chinese/background-jobs/scheduling/index.html</a>
<h2>14)Understanding Battery Drain on Android</h2>
电量消耗的计算与统计是一件麻烦而且矛盾的事情，记录电量消耗本身也是一个费电量的事情。唯一可行的方案是使用第三方监测电量的设备，这样才能够获取到真实的电量消耗。

当设备处于待机状态时消耗的电量是极少的，以N5为例，打开飞行模式，可以待机接近1个月。可是点亮屏幕，硬件各个模块就需要开始工作，这会需要消耗很多电量。

使用WakeLock或者JobScheduler唤醒设备处理定时的任务之后，一定要及时让设备回到初始状态。每次唤醒无线信号进行数据传递，都会消耗很多电量，它比WiFi等操作更加的耗电，详情请关注<a href="http://hukai.me/android-training-course-in-chinese/connectivity/efficient-downloads/efficient-network-access.html">http://hukai.me/android-training-course-in-chinese/connectivity/efficient-downloads/efficient-network-access.html</a>

<img src="http://hukai.me/images/battery_drain_radio.png" alt="" />

修复电量的消耗是另外一个很大的课题，这里就不展开继续了。
<h2>15)Battery Drain and WakeLocks</h2>
高效的保留更多的电量与不断促使用户使用你的App来消耗电量，这是矛盾的选择题。不过我们可以使用一些更好的办法来平衡两者。

假设你的手机里面装了大量的社交类应用，即使手机处于待机状态，也会经常被这些应用唤醒用来检查同步新的数据信息。Android会不断关闭各种硬件来延长手机的待机时间，首先屏幕会逐渐变暗直至关闭，然后CPU进入睡眠，这一切操作都是为了节约宝贵的电量资源。但是即使在这种睡眠状态下，大多数应用还是会尝试进行工作，他们将不断的唤醒手机。一个最简单的唤醒手机的方法是使用PowerManager.WakeLock的API来保持CPU工作并防止屏幕变暗关闭。这使得手机可以被唤醒，执行工作，然后回到睡眠状态。知道如何获取WakeLock是简单的，可是及时释放WakeLock也是非常重要的，不恰当的使用WakeLock会导致严重错误。例如网络请求的数据返回时间不确定，导致本来只需要10s的事情一直等待了1个小时，这样会使得电量白白浪费了。这也是为何使用带超时参数的wakelock.acquice()方法是很关键的。但是仅仅设置超时并不足够解决问题，例如设置多长的超时比较合适？什么时候进行重试等等？

解决上面的问题，正确的方式可能是使用非精准定时器。通常情况下，我们会设定一个时间进行某个操作，但是动态修改这个时间也许会更好。例如，如果有另外一个程序需要比你设定的时间晚5分钟唤醒，最好能够等到那个时候，两个任务捆绑一起同时进行，这就是非精确定时器的核心工作原理。我们可以定制计划的任务，可是系统如果检测到一个更好的时间，它可以推迟你的任务，以节省电量消耗。

<img src="http://hukai.me/images/alarmmanager_inexact_wakelock.png" alt="" />

这正是JobScheduler API所做的事情。它会根据当前的情况与任务，组合出理想的唤醒时间，例如等到正在充电或者连接到WiFi的时候，或者集中任务一起执行。我们可以通过这个API实现很多免费的调度算法。

从Android 5.0开始发布了Battery History Tool，它可以查看程序被唤醒的频率，又谁唤醒的，持续了多长的时间，这些信息都可以获取到。

请关注程序的电量消耗，用户可以通过手机的设置选项观察到那些耗电量大户，并可能决定卸载他们。所以尽量减少程序的电量消耗是非常有必要的。

&nbsp;

<footer><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license"><img src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="知识共享许可协议" /></a>
本站作品 由 <a href="http://hukai.me/android-performance-patterns/hukai.me" rel="cc:attributionURL">Kesen Hoo</a> 创作，采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a>进行许可。</footer>&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>27</wp:post_id>
		<wp:post_date>2015-01-20 17:56:41</wp:post_date>
		<wp:post_date_gmt>2015-01-20 09:56:41</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%85%b8%e8%8c%83</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="android"><![CDATA[Android]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><![CDATA[性能优化]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707462]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>停止更新CSDN博客</title>
		<link>http://1.duoinfo.sinaapp.com/?p=31</link>
		<pubDate>Tue, 20 Jan 2015 10:14:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=31</guid>
		<description></description>
		<content:encoded><![CDATA[停止更新CSDN博客，技术博客改为本博客。

----爱生活，爱coding]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>31</wp:post_id>
		<wp:post_date>2015-01-20 18:14:00</wp:post_date>
		<wp:post_date_gmt>2015-01-20 10:14:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%81%9c%e6%ad%a2%e6%9b%b4%e6%96%b0csdn%e5%8d%9a%e5%ae%a2</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707463]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>陈福多的简历 (1)</title>
		<link>http://1.duoinfo.sinaapp.com/?attachment_id=120</link>
		<pubDate>Tue, 27 Jan 2015 11:29:40 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://duoinfo-wordpress.stor.sinaapp.com/uploads/2015/01/陈福多的简历-1.pdf</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>120</wp:post_id>
		<wp:post_date>2015-01-27 19:29:40</wp:post_date>
		<wp:post_date_gmt>2015-01-27 11:29:40</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%99%88%e7%a6%8f%e5%a4%9a%e7%9a%84%e7%ae%80%e5%8e%86-1</wp:post_name>
		<wp:status>inherit</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>attachment</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<wp:attachment_url>http://duoinfo-wordpress.stor.sinaapp.com/uploads/2015/01/陈福多的简历-1.pdf</wp:attachment_url>
		<wp:postmeta>
			<wp:meta_key>_wp_attached_file</wp:meta_key>
			<wp:meta_value><![CDATA[2015/01/陈福多的简历-1.pdf]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_wp_attachment_metadata</wp:meta_key>
			<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>陈福多的简历 (1)</title>
		<link>http://1.duoinfo.sinaapp.com/?attachment_id=121</link>
		<pubDate>Tue, 27 Jan 2015 11:29:41 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://duoinfo-wordpress.stor.sinaapp.com/uploads/2015/01/陈福多的简历-1.pdf</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>121</wp:post_id>
		<wp:post_date>2015-01-27 19:29:41</wp:post_date>
		<wp:post_date_gmt>2015-01-27 11:29:41</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%99%88%e7%a6%8f%e5%a4%9a%e7%9a%84%e7%ae%80%e5%8e%86-1-2</wp:post_name>
		<wp:status>inherit</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>attachment</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<wp:attachment_url>http://duoinfo-wordpress.stor.sinaapp.com/uploads/2015/01/陈福多的简历-1.pdf</wp:attachment_url>
		<wp:postmeta>
			<wp:meta_key>_wp_attached_file</wp:meta_key>
			<wp:meta_value><![CDATA[2015/01/陈福多的简历-1.pdf]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_wp_attachment_metadata</wp:meta_key>
			<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Caching Bitmaps</title>
		<link>http://1.duoinfo.sinaapp.com/?p=227</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=227</guid>
		<description></description>
		<content:encoded><![CDATA[Loading a single bitmap into your user interface (UI) is straightforward, however things get more complicated if you need to load a larger set of images at once. In many cases (such as with components like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code>), the total number of images on-screen combined with images that might soon scroll onto the screen are essentially unlimited.

Memory usage is kept down with components like this by recycling the child views as they move off-screen. The garbage collector also frees up your loaded bitmaps, assuming you don't keep any long lived references. This is all good and well, but in order to keep a fluid and fast-loading UI you want to avoid continually processing these images each time they come back on-screen. A memory and disk cache can often help here, allowing components to quickly reload processed images.

This lesson walks you through using a memory and disk bitmap cache to improve the responsiveness and fluidity of your UI when loading multiple bitmaps.

译：

加载单个Bitmap到UI是简单直接的，但是如果你需要一次加载大量的图片，事情则会变得复杂起来。在大多数情况下(例如在使用ListView,GridView或ViewPager时), 屏幕上的图片和因滑动将要显示的图片的数量通常是没有限制的。

通过循环利用子视图可以抑制内存的使用，GC(garbage collector)也会释放那些不再需要使用的bitmap。这些机制都非常好，但是为了保持一个流畅的用户体验，你想要在屏幕滑回来时避免每次重复处理那些图片。内存与磁盘缓存通常可以起到帮助的作用，允许组件快速的重新加载那些处理过的图片。

这一课会介绍在加载多张位图时使用内存Cache与磁盘Cache来提高反应速度与UI的流畅度。

&nbsp;

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>227</wp:post_id>
		<wp:post_date>2015-01-31 12:03:03</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android Service学习之AIDL, Parcelable和远程服务</title>
		<link>http://1.duoinfo.sinaapp.com/?p=264</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=264</guid>
		<description></description>
		<content:encoded><![CDATA[<strong><span style="color: #0000ff;">AIDL的作用</span>
</strong>
<div>    由于每个应用程序都运行在自己的进程空间，并且可以从应用程序UI运行另一个服务进程，而且经常会在不同的进程间传递对象。在Android平台，一个进程通常不能访问另一个进程的内存空间，所以要想对话，需要将对象分解成操作系统可以理解的基本单元，并且有序的通过进程边界。
通过代码来实现这个数据传输过程是冗长乏味的，Android提供了AIDL工具来处理这项工作。
</div>
<div>    AIDL (Android Interface Definition Language) 是一种IDL 语言，用于生成可以在Android设备上两个进程之间进行进程间通信(interprocess communication, IPC)的代码。如果在一个进程中（例如Activity）要调用另一个进程中（例如Service）对象的操作，就可以使用AIDL生成可序列化的参数。
AIDL IPC机制是面向接口的，像COM或Corba一样，但是更加轻量级。它是使用代理类在客户端和实现端传递数据。</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>264</wp:post_id>
		<wp:post_date>2015-02-08 20:45:06</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android内存泄漏调试</title>
		<link>http://1.duoinfo.sinaapp.com/?p=296</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=296</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="color: #333399;"> (一) 查询数据库没有关闭游标</span>
描述：
程序中经常会进行查询数据库的操作，但是经常会有使用完毕Cursor后没有关闭的情况。如果我们的查询结果集比较小，对内存的消耗不容易被发现，只有在常时间大量操作的情况下才会复现内存问题，这样就会给以后的测试和问题排查带来困难和风险。
示例代码：
[java]Cursor cursor = getContentResolver().query(uri ...);
if (cursor.moveToNext()) {
... ...
}[/java]


修正示例代码：
[java][/java]Cursor cursor = null;
try {
cursor = getContentResolver().query(uri ...);
if (cursor != null &amp;&amp; cursor.moveToNext()) {
... ...
}
} finally {
if (cursor != null) {
try {
cursor.close();
} catch (Exception e) {
//ignore this
}
}
}
(二) 构造Adapter时，没有使用缓存的 convertView
描述：
以构造ListView的BaseAdapter为例，在BaseAdapter中提高了方法：
public View getView(int position, View convertView, ViewGroup parent)
来 向ListView提供每一个item所需要的view对象。初始时ListView会从BaseAdapter中根据当前的屏幕布局实例化一定数量的 view对象，同时ListView会将这些view对象缓存起来。当向上滚动ListView时，原先位于最上面的list item的view对象会被回收，然后被用来构造新出现的最下面的list item。这个构造过程就是由getView()方法完成的，getView()的第二个形参 View convertView就是被缓存起来的list item的view对象(初始化时缓存中没有view对象则convertView是null)。
由此可以看出，如果我们不去使用convertView，而是每次都在getView()中重新实例化一个View对象的话，即浪费资源也浪费时间，也会使得内存占用越来越大。ListView回收list item的view对象的过程可以查看:
android.widget.AbsListView.java --&gt; void addScrapView(View scrap) 方法。
示例代码：
public View getView(int position, View convertView, ViewGroup parent) {
View view = new Xxx(...);
... ...
return view;
}
修正示例代码：
public View getView(int position, View convertView, ViewGroup parent) {
View view = null;
if (convertView != null) {
view = convertView;
populate(view, getItem(position));
...
} else {
view = new Xxx(...);
...
}
return view;
}
(三) Bitmap对象不在使用时调用recycle()释放内存
描述：
有时我们会手工的操作Bitmap对象，如果一个Bitmap对象比较占内存，当它不在被使用的时候，可以调用Bitmap.recycle()方法回收此对象的像素所占用的内存，但这不是必须的，视情况而定。可以看一下代码中的注释：
/**
* Free up the memory associated with this bitmap's pixels, and mark the
* bitmap as "dead", meaning it will throw an exception if getPixels() or
* setPixels() is called, and will draw nothing. This operation cannot be
* reversed, so it should only be called if you are sure there are no
* further uses for the bitmap. This is an advanced call, and normally need
* not be called, since the normal GC process will free up this memory when
* there are no more references to this bitmap.
*/
(四) 释放对象的引用
描述：
这种情况描述起来比较麻烦，举两个例子进行说明。
示例A：
假设有如下操作
public class DemoActivity extends Activity {
... ...
private Handler mHandler = ...
private Object obj;
public void operation() {
obj = initObj();
...
[Mark]
mHandler.post(new Runnable() {
public void run() {
useObj(obj);
}
});
}
}
我们有一个成员变量 obj，在operation()中我们希望能够将处理obj实例的操作post到某个线程的MessageQueue中。在以上的代码中，即便是 mHandler所在的线程使用完了obj所引用的对象，但这个对象仍然不会被垃圾回收掉，因为DemoActivity.obj还保有这个对象的引用。 所以如果在DemoActivity中不再使用这个对象了，可以在[Mark]的位置释放对象的引用，而代码可以修改为：
... ...
public void operation() {
obj = initObj();
...
final Object o = obj;
obj = null;
mHandler.post(new Runnable() {
public void run() {
useObj(o);
}
}
}
... ...
示例B:
假设我们希望在锁屏界面(LockScreen)中，监听系统中的电话服务以获取一些信息(如信号强度等)，则可以在LockScreen中定义一个 PhoneStateListener的对象，同时将它注册到TelephonyManager服务中。对于LockScreen对象，当需要显示锁屏界 面的时候就会创建一个LockScreen对象，而当锁屏界面消失的时候LockScreen对象就会被释放掉。
但是如果在释放LockScreen对象的时候忘记取消我们之前注册的PhoneStateListener对象，则会导致LockScreen无法被垃 圾回收。如果不断的使锁屏界面显示和消失，则最终会由于大量的LockScreen对象没有办法被回收而引起OutOfMemory,使得 system_process进程挂掉。
总之当一个生命周期较短的对象A，被一个生命周期较长的对象B保有其引用的情况下，在A的生命周期结束时，要在B中清除掉对A的引用。
(五) 其他
Android应用程序中最典型的需要注意释放资源的情况是在Activity的生命周期中，在onPause()、onStop()、 onDestroy()方法中需要适当的释放资源的情况。由于此情况很基础，在此不详细说明，具体可以查看官方文档对Activity生命周期的介绍，以 明确何时应该释放哪些资源。
三、内存监测工具 DDMS --&gt; Heap
无论怎么小心，想完全避免bad code是不可能的，此时就需要一些工具来帮助我们检查代码中是否存在会造成内存泄漏的地方。Android tools中的DDMS就带有一个很不错的内存监测工具Heap(这里我使用eclipse的ADT插件，并以真机为例，在模拟器中的情况类似)。用 Heap监测应用进程使用内存情况的步骤如下：
1. 启动eclipse后，切换到DDMS透视图，并确认Devices视图、Heap视图都是打开的；
2. 将手机通过USB链接至电脑，链接时需要确认手机是处于“USB调试”模式，而不是作为“Mass Storage”；
3. 链接成功后，在DDMS的Devices视图中将会显示手机设备的序列号，以及设备中正在运行的部分进程信息；
4. 点击选中想要监测的进程，比如system_process进程；
5. 点击选中Devices视图界面中最上方一排图标中的“Update Heap”图标；
6. 点击Heap视图中的“Cause GC”按钮；
7. 此时在Heap视图中就会看到当前选中的进程的内存使用量的详细情况。
说明：
a) 点击“Cause GC”按钮相当于向虚拟机请求了一次gc操作；
b) 当内存使用信息第一次显示以后，无须再不断的点击“Cause GC”，Heap视图界面会定时刷新，在对应用的不断的操作过程中就可以看到内存使用的变化；
c) 内存使用信息的各项参数根据名称即可知道其意思，在此不再赘述。
如何才能知道我们的程序是否有内存泄漏的可能性呢。这里需要注意一个值：Heap视图中部有一个Type叫做data object，即数据对象，也就是我们的程序中大量存在的类类型的对象。在data object一行中有一列是“Total Size”，其值就是当前进程中所有Java数据对象的内存总量，一般情况下，这个值的大小决定了是否会有内存泄漏。可以这样判断：
a) 不断的操作当前应用，同时注意观察data object的Total Size值；
b) 正常情况下Total Size值都会稳定在一个有限的范围内，也就是说由于程序中的的代码良好，没有造成对象不被垃圾回收的情况，所以说虽然我们不断的操作会不断的生成很多对 象，而在虚拟机不断的进行GC的过程中，这些对象都被回收了，内存占用量会会落到一个稳定的水平；
c) 反之如果代码中存在没有释放对象引用的情况，则data object的Total Size值在每次GC后不会有明显的回落，随着操作次数的增多Total Size的值会越来越大，
直到到达一个上限后导致进程被kill掉。
d) 此处已system_process进程为例，在我的测试环境中system_process进程所占用的内存的data object的Total Size正常情况下会稳定在2.2~2.8之间，而当其值超过3.55后进程就会被kill。

总之，使用DDMS的Heap视图工具可以很方便的确认我们的程序是否存在内存泄漏的可能性。

&nbsp;

&nbsp;

&nbsp;
<div>   Android的内存溢出是如何发生的?    Android的虚拟机是基于寄存器的Dalvik，它的最大堆大小一般是16M，有的机器为24M。因此我们所能利用的内存空间是有限的。如果我们的内存占用超过了一定的水平就会出现OutOfMemory的错误。

为什么会出现内存不够用的情况呢？我想原因主要有两个：
<ul>
	<li>由于我们程序的失误，长期保持某些资源（如Context）的引用，造成内存泄露，资源造成得不到释放。</li>
	<li>保存了多个耗用内存过大的对象（如Bitmap），造成内存超出限制。</li>
</ul>
三、万恶的static

static是Java中的一个关键字，当用它来修饰成员变量时，那么该变量就属于该类，而不是该类的实例。所以用static修饰的变量，它的生命周期是很长的，如果用它来引用一些资源耗费过多的实例（Context的情况最多），这时就要谨慎对待了。
<ol>
	<li>public class ClassName {</li>
	<li>     private static Context mContext;</li>
	<li>     //省略</li>
	<li>}</li>
</ol>
以上的代码是很危险的，如果将Activity赋值到么mContext的话。那么即使该Activity已经onDestroy，但是由于仍有对象保存它的引用，因此该Activity依然不会被释放。

我们举Android文档中的一个例子。
<ol>
	<li>private static Drawable sBackground;</li>
	<li></li>
	<li> @Override</li>
	<li> protected void onCreate(Bundle state) {</li>
	<li>   super.onCreate(state);</li>
	<li></li>
	<li>   TextView label = new TextView(this);</li>
	<li>   label.setText("Leaks are bad");</li>
	<li></li>
	<li>   if (sBackground == null) {</li>
	<li>     sBackground = getDrawable(R.drawable.large_bitmap);</li>
	<li>   }</li>
	<li>   label.setBackgroundDrawable(sBackground);</li>
	<li></li>
	<li>   setContentView(label);</li>
	<li> }</li>
</ol>
sBackground, 是 一个静态的变量，但是我们发现，我们并没有显式的保存Contex的引用，但是，当Drawable与View连接之后，Drawable就将View设 置为一个回调，由于View中是包含Context的引用的，所以，实际上我们依然保存了Context的引用。这个引用链如下：

Drawable-&gt;TextView-&gt;Context

所以，最终该Context也没有得到释放，发生了内存泄露。

如何才能有效的避免这种引用的发生呢？

第一，应该尽量避免static成员变量引用资源耗费过多的实例，比如Context。

第二、Context尽量使用Application Context，因为Application的Context的生命周期比较长，引用它不会出现内存泄露的问题。

第三、使用WeakReference代替强引用。比如可以使用WeakReference&lt;Context&gt; mContextRef;

该部分的详细内容也可以参考Android文档中Article部分。

四、都是线程惹的祸

线程也是造成内存泄露的一个重要的源头。线程产生内存泄露的主要原因在于线程生命周期的不可控。我们来考虑下面一段代码。
<ol>
	<li>public class MyActivity extends Activity {</li>
	<li>    @Override</li>
	<li>    public void onCreate(Bundle savedInstanceState) {</li>
	<li>        super.onCreate(savedInstanceState);</li>
	<li>        setContentView(R.layout.main);</li>
	<li>        new MyThread().start();</li>
	<li>    }</li>
	<li></li>
	<li>    private class MyThread extends Thread{</li>
	<li>        @Override</li>
	<li>        public void run() {</li>
	<li>            super.run();</li>
	<li>            //do somthing</li>
	<li>        }</li>
	<li>    }</li>
	<li>}</li>
</ol>
这段代码很平常也很 简单，是我们经常使用的形式。我们思考一个问题：假设MyThread的run函数是一个很费时的操作，当我们开启该线程后，将设备的横屏变为了竖屏，一 般情况下当屏幕转换时会重新创建Activity，按照我们的想法，老的Activity应该会被销毁才对，然而事实上并非如此。

由于我们的线程是Activity的内部类，所以MyThread中保存了Activity的一个引用，当MyThread的run函数没有结束时，MyThread是不会被销毁的，因此它所引用的老的Activity也不会被销毁，因此就出现了内存泄露的问题。

&nbsp;

<img src="http://hi.csdn.net/attachment/201108/12/0_1313138734AAu6.gif" alt="" />

有些人喜欢用Android提供的AsyncTask，但事实上AsyncTask的问题更加严重，Thread只有在run函数不结束时才出现这种内 存泄露问题，然而AsyncTask内部的实现机制是运用了ThreadPoolExcutor,该类产生的Thread对象的生命周期是不确定的，是应 用程序无法控制的，因此如果AsyncTask作为Activity的内部类，就更容易出现内存泄露的问题。

这种线程导致的内存泄露问题应该如何解决呢？

第一、将线程的内部类，改为静态内部类。

第二、在线程内部采用弱引用保存Context引用。

解决的模型如下：
<ol>
	<li>public abstract class WeakAsyncTask&lt;Params, Progress, Result, WeakTarget&gt; extends</li>
	<li>        AsyncTask&lt;Params, Progress, Result&gt; {</li>
	<li>    protected WeakReference&lt;WeakTarget&gt; mTarget;</li>
	<li></li>
	<li>    public WeakAsyncTask(WeakTarget target) {</li>
	<li>        mTarget = new WeakReference&lt;WeakTarget&gt;(target);</li>
	<li>    }</li>
	<li></li>
	<li>    /** {@inheritDoc} */</li>
	<li>    @Override</li>
	<li>    protected final void onPreExecute() {</li>
	<li>        final WeakTarget target = mTarget.get();</li>
	<li>        if (target != null) {</li>
	<li>            this.onPreExecute(target);</li>
	<li>        }</li>
	<li>    }</li>
	<li></li>
	<li>    /** {@inheritDoc} */</li>
	<li>    @Override</li>
	<li>    protected final Result doInBackground(Params... params) {</li>
	<li>        final WeakTarget target = mTarget.get();</li>
	<li>        if (target != null) {</li>
	<li>            return this.doInBackground(target, params);</li>
	<li>        } else {</li>
	<li>            return null;</li>
	<li>        }</li>
	<li>    }</li>
	<li></li>
	<li>    /** {@inheritDoc} */</li>
	<li>    @Override</li>
	<li>    protected final void onPostExecute(Result result) {</li>
	<li>        final WeakTarget target = mTarget.get();</li>
	<li>        if (target != null) {</li>
	<li>            this.onPostExecute(target, result);</li>
	<li>        }</li>
	<li>    }</li>
	<li></li>
	<li>    protected void onPreExecute(WeakTarget target) {</li>
	<li>        // No default action</li>
	<li>    }</li>
	<li></li>
	<li>    protected abstract Result doInBackground(WeakTarget target, Params... params);</li>
	<li></li>
	<li>    protected void onPostExecute(WeakTarget target, Result result) {</li>
	<li>        // No default action</li>
	<li>    }</li>
	<li>}</li>
</ol>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>296</wp:post_id>
		<wp:post_date>2015-03-03 16:16:23</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>java基础</title>
		<link>http://1.duoinfo.sinaapp.com/?p=383</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=383</guid>
		<description></description>
		<content:encoded><![CDATA[多态：java引用变量有两个类型：一个是编译时类型，一个是运行时类型，编译时类型由声明该变量时使用的类型决定，运行时类型由实际赋给该变量的对象决定。如果编译时类型和运行时类型不一样，就会出现多态。

向上转型：当把子类对象赋给父类引用变量的时，称为向上转型。

自动装箱：就是可以把一个基本类型变量直接赋给对应的包装类对象。

抽象类可以包含抽象方法，抽象类不能用于创建实例。

抽象是从多个具体类中抽象出来的父类，他具有更高层次的抽象。以抽象类作为子类的模板，从未避免了子类设计的随意性。

抽象类体现是一种模板模式的设计。

接口和抽象类的区别：

接口体现的是一种规范，抽象类体现的是一种模板设计。

接口只能包含抽象方法，但是抽象类可以包含普通的方法；

接口里不能定义静态的方法，抽象类里可以；

接口里只能定义静态常量field，不能定义普通field，抽象类里既可以定义普通field，也可以定义静态常量filed；

接口不包含构造器，抽象类里可以包含构造器，抽象类里的构造器并不是用于创建对象，而是让其子类调用这些构造器来完成属于抽象类的初始化操作；

接口里不能包含初始化块，但是抽象类可以包含初始化块；

一个类最多只能有一个直接父类，包括抽象类；但是一个类可以直接实现多个接口。

内部类：

内部类提供了更好的封装；

内部类成员可以直接访问外部类的私有数据；

匿名内部类适合用于创建那些仅需要一次使用的类。

匿名内部类：

匿名内部类不能是抽象类；

匿名内部类不能定义构造器。

闭包和回调：

闭包是一种能被调用的对象，他保存了创建他的作用域信息，可以把非静态内部类当成面向对象领域的闭包；

回调就是某个方法一旦获得了内部类对象的引用后，就可以在合适的时候反过来去调用外部类实例的方法。

Object和Objects类的区别，Object类是Java其他类的父类，Objects是空指针安全的。

String，StringBuffer,StringBuilder:

String类是不可变类，StringBuffer对象则代表一个字符序列可变的字符串，StringBuffer是线程安全的，而StringBuilder则没有实现线程安全功能，所以性能略高。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>383</wp:post_id>
		<wp:post_date>2015-03-17 16:05:43</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Sharing a File</title>
		<link>http://1.duoinfo.sinaapp.com/?p=404</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=404</guid>
		<description></description>
		<content:encoded><![CDATA[Once you have set up your app to share files using content URIs, you can respond to other apps' requests for those files. <span style="color: #333399;">One way to respond to these requests is to provide a file selection interface from the server app that other applications can invoke.</span> This approach allows a client application to let users select a file from the server app and then receive the selected file's content URI.(c/s模型，一个APP充当服务器端，提供响应客户端APP请求的文件选择接口，客户端APP发起请求)

This lesson shows you how to create a file selection <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> in your app that responds to requests for files.
<h2 id="ReceiveRequests">Receive File Requests</h2>

<hr />

To receive requests for files from client apps and respond with a content URI, your app should provide a file selection <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>. Client apps start this <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> containing the action<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_PICK">ACTION_PICK</a></code>. When the client app calls<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>, your app can return a result to the client app, in the form of a content URI for the file the user selected.

To learn how to implement a request for a file in a client app, see the lesson <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/secure-file-sharing/request-file.html">Requesting a Shared File</a>.
<h2 id="CreateFileSelection">Create a File Selection Activity</h2>

<hr />

To set up the file selection <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>, start by specifying the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> in your manifest, along with an intent filter that matches the action <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_PICK">ACTION_PICK</a></code> and the categories <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_DEFAULT">CATEGORY_DEFAULT</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_OPENABLE">CATEGORY_OPENABLE</a></code>. Also add MIME type filters for the files your app serves to other apps. The following snippet shows you how to specify the new <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> and intent filter:

[xml]&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
...
&lt;application&gt;
...
&lt;activity
android:name=&quot;.FileSelectActivity&quot;
android:label=&quot;@&quot;File Selector&quot; &gt;
&lt;intent-filter&gt;
&lt;action
android:name=&quot;android.intent.action.PICK&quot;/&gt;
&lt;category
android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
&lt;category
android:name=&quot;android.intent.category.OPENABLE&quot;/&gt;
&lt;data android:mimeType=&quot;text/plain&quot;/&gt;
&lt;data android:mimeType=&quot;image/*&quot;/&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;[/xml]
<h3>Define the file selection Activity in code</h3>
Next, define an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> subclass that displays the files available from your app's <code>files/images/</code> directory in internal storage and allows the user to pick the desired file. The following snippet demonstrates how to define this<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> and respond to the user's selection:
<pre>public class MainActivity extends Activity {
    // The path to the root of this app's internal storage
    private File mPrivateRootDir;
    // The path to the "images" subdirectory
    private File mImagesDir;
    // Array of files in the images subdirectory
    File[] mImageFiles;
    // Array of filenames corresponding to mImageFiles
    String[] mImageFilenames;
    // Initialize the Activity
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        // Set up an Intent to send back to apps that request a file
        mResultIntent =
                new Intent("com.example.myapp.ACTION_RETURN_FILE");
        // Get the files/ subdirectory of internal storage
        mPrivateRootDir = getFilesDir();
        // Get the files/images subdirectory;
        mImagesDir = new File(mPrivateRootDir, "images");
        // Get the files in the images subdirectory
        mImageFiles = mImagesDir.listFiles();
        // Set the Activity's result to null to begin with
        setResult(Activity.RESULT_CANCELED, null);
        /*
         * Display the file names in the ListView mFileListView.
         * Back the ListView with the array mImageFilenames, which
         * you can create by iterating through mImageFiles and
         * calling File.getAbsolutePath() for each File
         */
         ...
    }
    ...
}</pre>
<h2 id="RespondToRequest">Respond to a File Selection</h2>

<hr />

Once a user selects a shared file, your application must determine what file was selected and then generate a content URI for the file. Since the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> displays the list of available files in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>, when the user clicks a file name the system calls the method <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView&lt;?&gt;, android.view.View, int, long)">onItemClick()</a></code>, in which you can get the selected file.

In <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView&lt;?&gt;, android.view.View, int, long)">onItemClick()</a></code>, get a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> object for the file name of the selected file and pass it as an argument to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code>, along with the authority that you specified in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> element for the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>. The resulting content URI contains the authority, a path segment corresponding to the file's directory (as specified in the XML meta-data), and the name of the file including its extension. How <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> maps directories to path segments based on XML meta-data is described in the section <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/secure-file-sharing/setup-sharing.html#DefineMetaData">Specify Sharable Directories</a>.

The following snippet shows you how to detect the selected file and get a content URI for it:
<pre>    protected void onCreate(Bundle savedInstanceState) {
        ...
        // Define a listener that responds to clicks on a file in the ListView
        mFileListView.setOnItemClickListener(
                new AdapterView.OnItemClickListener() {
            @Override
            /*
             * When a filename in the ListView is clicked, get its
             * content URI and send it to the requesting app
             */
            public void onItemClick(AdapterView&lt;?&gt; adapterView,
                    View view,
                    int position,
                    long rowId) {
                /*
                 * Get a File for the selected file name.
                 * Assume that the file names are in the
                 * mImageFilename array.
                 */
                File requestFile = new File(mImageFilename[position]);
                /*
                 * Most file-related method calls need to be in
                 * try-catch blocks.
                 */
                // Use the FileProvider to get a content URI
                try {
                    fileUri = FileProvider.getUriForFile(
                            MainActivity.this,
                            "com.example.myapp.fileprovider",
                            requestFile);
                } catch (IllegalArgumentException e) {
                    Log.e("File Selector",
                          "The selected file can't be shared: " +
                          clickedFilename);
                }
                ...
            }
        });
        ...
    }</pre>
Remember that you can only generate content URIs for files that reside in a directory you've specified in the meta-data file that contains the <code>&lt;paths&gt;</code> element, as described in the section <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/secure-file-sharing/setup-sharing.html#DefineMetaData">Specify Sharable Directories</a>. If you call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code> for a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> in a path that you haven't specified, you receive an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/IllegalArgumentException.html">IllegalArgumentException</a></code>.
<h2 id="GrantPermissions">Grant Permissions for the File</h2>

<hr />

Now that you have a content URI for the file you want to share with another app, you need to allow the client app to access the file. To allow access, grant permissions to the client app by adding the content URI to an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> and then setting permission flags on the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>. The permissions you grant are temporary and expire automatically when the receiving app's task stack is finished.

The following code snippet shows you how to set read permission for the file:
<pre>    protected void onCreate(Bundle savedInstanceState) {
        ...
        // Define a listener that responds to clicks in the ListView
        mFileListView.setOnItemClickListener(
                new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView&lt;?&gt; adapterView,
                    View view,
                    int position,
                    long rowId) {
                ...
                if (fileUri != null) {
                    // Grant temporary read permission to the content URI
                    mResultIntent.addFlags(
                        Intent.FLAG_GRANT_READ_URI_PERMISSION);
                }
                ...
             }
             ...
        });
    ...
    }</pre>
<strong>Caution:</strong> Calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#setFlags(int)">setFlags()</a></code> is the only way to securely grant access to your files using temporary access permissions. Avoid calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#grantUriPermission(java.lang.String, android.net.Uri, int)">Context.grantUriPermission()</a></code> method for a file's content URI, since this method grants access that you can only revoke by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#revokeUriPermission(android.net.Uri, int)">Context.revokeUriPermission()</a></code>.
<h2 id="ShareFile">Share the File with the Requesting App</h2>

<hr />

To share the file with the app that requested it, pass the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> containing the content URI and permissions to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#setResult(int)">setResult()</a></code>. When the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> you have just defined is finished, the system sends the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> containing the content URI to the client app. The following code snippet shows you how to do this:
<pre>    protected void onCreate(Bundle savedInstanceState) {
        ...
        // Define a listener that responds to clicks on a file in the ListView
        mFileListView.setOnItemClickListener(
                new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView&lt;?&gt; adapterView,
                    View view,
                    int position,
                    long rowId) {
                ...
                if (fileUri != null) {
                    ...
                    // Put the Uri and MIME type in the result Intent
                    mResultIntent.setDataAndType(
                            fileUri,
                            getContentResolver().getType(fileUri));
                    // Set the result
                    MainActivity.this.setResult(Activity.RESULT_OK,
                            mResultIntent);
                    } else {
                        mResultIntent.setDataAndType(null, "");
                        MainActivity.this.setResult(RESULT_CANCELED,
                                mResultIntent);
                    }
                }
        });</pre>
Provide users with an way to return immediately to the client app once they have chosen a file. One way to do this is to provide a checkmark or <strong>Done</strong> button. Associate a method with the button using the button's<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#attr_android:onClick">android:onClick</a></code> attribute. In the method, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish()">finish()</a></code>. For example:
<pre>    public void onDoneClick(View v) {
        // Associate a method with the Done button
        finish();
    }</pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>404</wp:post_id>
		<wp:post_date>2015-03-20 08:55:18</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>叮咚时间</title>
		<link>http://1.duoinfo.sinaapp.com/?p=406</link>
		<pubDate>Sat, 21 Mar 2015 07:19:35 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=406</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>406</wp:post_id>
		<wp:post_date>2015-03-21 15:19:35</wp:post_date>
		<wp:post_date_gmt>2015-03-21 07:19:35</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%8f%ae%e5%92%9a%e6%97%b6%e9%97%b4</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>5</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[406]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://duoinfo.sinaapp.com/didotime/index.html]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>精华</title>
		<link>http://1.duoinfo.sinaapp.com/?p=408</link>
		<pubDate>Sat, 21 Mar 2015 07:21:48 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=408</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>408</wp:post_id>
		<wp:post_date>2015-03-21 15:21:48</wp:post_date>
		<wp:post_date_gmt>2015-03-21 07:21:48</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e7%b2%be%e5%8d%8e</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>3</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[408]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/?p=405]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>音乐</title>
		<link>http://1.duoinfo.sinaapp.com/?p=409</link>
		<pubDate>Sat, 21 Mar 2015 07:45:09 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=409</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>409</wp:post_id>
		<wp:post_date>2015-03-21 15:45:09</wp:post_date>
		<wp:post_date_gmt>2015-03-21 07:45:09</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%9f%b3%e4%b9%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>4</wp:menu_order>
		<wp:post_type>nav_menu_item</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="nav_menu" nicename="%e5%a4%9a%e5%a4%9a"><![CDATA[多多]]></category>
		<wp:postmeta>
			<wp:meta_key>_menu_item_classes</wp:meta_key>
			<wp:meta_value><![CDATA[a:1:{i:0;s:0:"";}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_target</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_object_id</wp:meta_key>
			<wp:meta_value><![CDATA[409]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_menu_item_parent</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_type</wp:meta_key>
			<wp:meta_value><![CDATA[custom]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_xfn</wp:meta_key>
			<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_menu_item_url</wp:meta_key>
			<wp:meta_value><![CDATA[http://1.duoinfo.sinaapp.com/music/index.html]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>PhotoView 源码解析</title>
		<link>http://1.duoinfo.sinaapp.com/?p=525</link>
		<pubDate>Wed, 30 Nov -0001 00:00:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=525</guid>
		<description></description>
		<content:encoded><![CDATA[<h3 id="1-">1. 功能介绍</h3>
<h5 id="-features-">特性(Features)：</h5>
<ul>
	<li>支持Pinch手势自由缩放。</li>
	<li>支持双击放大/还原。</li>
	<li>支持平滑滚动。</li>
	<li>在滑动父控件下能够运行良好。（例如：ViewPager）</li>
	<li>支持基于Matrix变化（放大/缩小/移动）的事件监听。</li>
</ul>
<h5 id="-">优势：</h5>
<ul>
	<li>PhotoView是ImageView的子类，自然的支持所有ImageView的源生行为。</li>
	<li>任意项目可以非常方便的从ImageView升级到PhotoView，不用做任何额外的修改。</li>
	<li>可以非常方便的与ImageLoader/Picasso之类的异步网络图片读取库集成使用。</li>
	<li>事件分发做了很好的处理，可以方便的与ViewPager等同样支持滑动手势的控件集成。</li>
</ul>
<h3 id="2-">2. 总体设计</h3>
PhotoView这个库实际上比较简单,关键点其实就是Touch事件处理和Matrix图形变换的应用.
<h5 id="2-1-touchevent-">2.1 TouchEvent及手势事件处理</h5>
对TouchEvent分发流程不了解的建议先阅读 <a href="http://www.trinea.cn/android/touch-event-delivery-mechanism/">Android Touch事件传递机制</a>

本库中对Touch事件的处理流程请参考第三部分的流程图，会有一个比较直观的认识。
<h5 id="2-2-matrix">2.2 Matrix</h5>
由于Matrix是Android系统源生API,很多开发者对此都比较熟悉,为了不影响阅读效果，故不在此详细叙述,如果对其不是很了解,可以查看本文档末尾的Matrix补充说明

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>525</wp:post_id>
		<wp:post_date>2015-04-02 14:59:41</wp:post_date>
		<wp:post_date_gmt>0000-00-00 00:00:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name></wp:post_name>
		<wp:status>draft</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>ACTION_GET_CONTENT和ACTION_PICK的区别</title>
		<link>http://1.duoinfo.sinaapp.com/?p=66</link>
		<pubDate>Fri, 23 Jan 2015 08:59:55 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=66</guid>
		<description></description>
		<content:encoded><![CDATA[即时通讯做到选择图片的功能：我是这样处理的：

[codesyntax lang="java"]
<pre> public void selectPicFromLocal() {
        Intent intent;
        if (Build.VERSION.SDK_INT &lt; 19) {
            intent = new Intent(Intent.ACTION_GET_CONTENT);
            intent.setType("image/*");

        } else {
            intent = new Intent(
                    Intent.ACTION_PICK,
                    android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);
        }
        startActivityForResult(intent, REQUEST_CODE_LOCAL);
    }</pre>
[/codesyntax]

那么，为什么这样处理呢？

其实在4.3或以下可以直接用ACTION_GET_CONTENT的,在4.4或以上,官方建议用ACTION_OPEN_DOCUMENT,但其实都不算太大区别,区别是他们返回的Uri,那个才叫大区别.这就是困扰了我一整天的问题所在了.4.3或以下,选了图片之后,根据Uri来做处理,很多帖子都有了,我就不详细说了.主要是4.4,如果使用上面pick的原生方法来选图,返回的uri还是正常的,但如果用ACTION_GET_CONTENT的方法,返回的uri跟4.3是完全不一样的,4.3返回的是带文件路径的,而4.4返回的却是content://com.android.providers.media.documents/document/image:3951这样的,没有路径,只有图片编号的uri.这就导致接下来无法根据图片路径来裁剪的步骤了.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>66</wp:post_id>
		<wp:post_date>2015-01-23 16:59:55</wp:post_date>
		<wp:post_date_gmt>2015-01-23 08:59:55</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>action_get_content%e5%92%8caction_pick%e7%9a%84%e5%8c%ba%e5%88%ab</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707467]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>2</wp:comment_id>
			<wp:comment_author><![CDATA[Eversleeping]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://t.qq.com/eversleeping6094</wp:comment_author_url>
			<wp:comment_author_IP>61.190.88.149</wp:comment_author_IP>
			<wp:comment_date>2015-01-23 17:02:45</wp:comment_date>
			<wp:comment_date_gmt>2015-01-23 09:02:45</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[ceshi]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>1</wp:comment_user_id>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_parent_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707456]]></wp:meta_value>
			</wp:commentmeta>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_post_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707457]]></wp:meta_value>
			</wp:commentmeta>
		</wp:comment>
	</item>
	<item>
		<title>photoview实现多点触控</title>
		<link>http://1.duoinfo.sinaapp.com/?p=70</link>
		<pubDate>Mon, 26 Jan 2015 08:02:41 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=70</guid>
		<description></description>
		<content:encoded><![CDATA[PhotoView的github地址是：<a href="https://github.com/chrisbanes/PhotoView" target="_blank">https://github.com/chrisbanes/PhotoView</a>，在我的项目中，当用户发送图片后，点击图片后，进入查看大图片的页面，那么我希望在这个查看大图片的页面能够响应多点触控的事件。所以用到了这个控件。

PhotoView的几个特征：

&nbsp;
<ul>
	<li>Out of the box zooming, using multi-touch and double-tap.</li>
	<li>Scrolling, with smooth scrolling fling.</li>
	<li>Works perfectly when using used in a scrolling parent (such as ViewPager).</li>
	<li>Allows the application to be notified when the displayed Matrix has changed. Useful for when you need to update your UI based on the current zoom/scroll position.</li>
	<li>Allows the application to be notified when the user taps on the Photo.</li>
</ul>
给的使用方法：

[codesyntax lang="java"]
<pre>ImageView mImageView;
PhotoViewAttacher mAttacher;

@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // Any implementation of ImageView can be used!
    mImageView = (ImageView) findViewById(R.id.iv_photo);

    // Set the Drawable displayed
    Drawable bitmap = getResources().getDrawable(R.drawable.wallpaper);
    mImageView.setImageDrawable(bitmap);

    // Attach a PhotoViewAttacher, which takes care of all of the zooming functionality.
    mAttacher = new PhotoViewAttacher(mImageView);
}

// If you later call mImageView.setImageDrawable/setImageBitmap/setImageResource/etc then you just need to call
attacher.update();</pre>
[/codesyntax]
另外，作者给了一个demo（demo地址在github上）。demo中有结合ViewPager使用的案例。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>70</wp:post_id>
		<wp:post_date>2015-01-26 16:02:41</wp:post_date>
		<wp:post_date_gmt>2015-01-26 08:02:41</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>photoview%e5%ae%9e%e7%8e%b0%e5%a4%9a%e7%82%b9%e8%a7%a6%e6%8e%a7</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707468]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>深入解析AsyncTask</title>
		<link>http://1.duoinfo.sinaapp.com/?p=73</link>
		<pubDate>Mon, 26 Jan 2015 08:13:37 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=73</guid>
		<description></description>
		<content:encoded><![CDATA[<h2>AsyncTask的介绍及基本使用方法</h2>
关于AsyncTask的介绍和基本使用方法可以参考<a href="http://developer.android.com/reference/android/os/AsyncTask.html" target="_blank">官方文档</a>和<a href="http://blog.csdn.net/hitlion2008/article/details/7560878" target="_blank">Android实战技巧：多线程AsyncTask</a>这里就不重复。
<h2><a name="t1"></a>AsyncTask引发的一个问题</h2>
上周遇到了一个极其诡异的问题，一个小功能从网络上下载一个图片，然后放到ImageView中，是用AsyncTask来实现的，本身逻辑也很简单，仅是在doInBackground中用HTTP请求把图片的输入流取出，然后用BitmapFactory去解析，然后再把得到的Bitmap放到ImageView中。这个应用是用4.0的SDK开发的，也是运行在4.0上面的。但是有时候下载这张图片去要用很久很久，甚至要等上几分钟。通过调试发现一个令人难以接受的事实：竟然是doInBackground()未及时执行，也就是它并没有在#execute()调用之后马上执行，而是等待了很久才得以执行。

神马情况，难道AsyncTask不是线程，难道不是异步，难道AsyncTask另有内幕？
<h2><a name="t2"></a>AsyncTask的内幕</h2>
AsyncTask主要有二个部分：一个是与主线各的交互，另一个就是线程的管理调度。虽然可能多个AsyncTask的子类的实例，但是AsyncTask的内部Handler和ThreadPoolExecutor都是进程范围内共享的，其都是static的，也即属于类的，类的属性的作用范围是CLASSPATH，因为一个进程一个VM，所以是AsyncTask控制着进程范围内所有的子类实例。
<h3><a name="t3"></a>与主线程交互</h3>
与主线程交互是通过Handler来进行的，因为本文主要探讨AsyncTask在任务调度方面的，所以对于这部分不做细致介绍，感兴趣的朋友可以去看<a href="https://github.com/android/platform_frameworks_base/blob/master/core/java/android/os/AsyncTask.java" target="_blank">AsyncTask的源码</a>

&nbsp;
<h3><a name="t4"></a>线程任务的调度</h3>
内部会创建一个进程作用域的线程池来管理要运行的任务，也就就是说当你调用了AsyncTask#execute()后，AsyncTask会把任务交给线程池，由线程池来管理创建Thread和运行Therad。对于内部的线程池不同版本的Android的实现方式是不一样的：
<h4><a name="t5"></a>Android2.3以前的版本，也即SDK/API 10和以前的版本</h4>
内部的线程池限制是5个，也就是说同时只能有5个线程运行，超过的线程只能等待，等待前面的线程某个执行完了才被调度和运行。换句话说，如果一个进程中的AsyncTask实例个数超过5个，那么假如前5个都运行很长时间的话，那么第6个只能等待机会了。这是AsyncTask的一个限制，而且对于2.3以前的版本无法解决。如果你的应用需要大量的后台线程去执行任务，那么你只能放弃使用AsyncTask，自己创建线程池来管理Thread，或者干脆不用线程池直接使用Thread也无妨。不得不说，虽然AsyncTask较Thread使用起来比较方便，但是它最多只能同时运行5个线程，这也大大局限了它的实力，你必须要小心的设计你的应用，错开使用AsyncTask的时间，尽力做到分时，或者保证数量不会大于5个，否则就可能遇到上面提到的问题。要不然就只能使用JavaSE中的API了。

<img src="http://img.my.csdn.net/uploads/201209/15/1347724789_6353.gif" alt="" align="middle" />
<h4><a name="t6"></a>Android 3.0以后，也即SDK/API 11和以后的版本</h4>
可能是Google意识到了AsyncTask的局限性了，从Android 3.0开始对AsyncTask的API做出了一些调整：
<ol>
	<li>#execute()提交的任务，按先后顺序每次只运行一个也就是说它是按提交的次序，每次只启动一个线程执行一个任务，完成之后再执行第二个任务，也就是相当于只有一个后台线程在执行所提交的任务(Executors.newSingleThreadPool())。

<img src="http://img.my.csdn.net/uploads/201209/16/1347724823_3885.gif" alt="" align="middle" /></li>
	<li>新增了接口#executeOnExecutor()这个接口允许开发者提供自定义的线程池来运行和调度Thread，如果你想让所有的任务都能并发同时运行，那就创建一个没有限制的线程池(Executors.newCachedThreadPool())，并提供给AsyncTask。这样这个AsyncTask实例就有了自己的线程池而不必使用AsyncTask默认的。</li>
	<li>新增了二个预定义的线程池<em>SERIAL_EXECUTOR</em>和<em>THREAD_POOL_EXECUTOR</em>其实<em>THREAD_POOL_EXECUTOR</em>并不是新增的，之前的就有，只不过之前(Android 2.3)它是AsyncTask私有的，未公开而已。<em>THREAD_POOL_EXECUTOR</em>是一个corePoolSize为5的线程池，也就是说最多只有5个线程同时运行，超过5个的就要等待。所以如果使用executeOnExecutor(AsyncTask.<em>THREAD_POOL_EXECUTOR</em>)就跟2.3版本的AsyncTask.execute()效果是一样的。

<img src="http://img.my.csdn.net/uploads/201209/16/1347726246_7870.gif" alt="" />

而<em>SERIAL_EXECUTOR</em>是新增的，它的作用是保证任务执行的顺序，也就是它可以保证提交的任务确实是按照先后顺序执行的。它的内部有一个队列用来保存所提交的任务，保证当前只运行一个，这样就可以保证任务是完全按照顺序执行的，默认的execute()使用的就是这个，也就是executeOnExecutor(AsyncTask.<em>SERIAL_EXECUTOR</em>)与execute()是一样的。</li>
</ol>
&nbsp;
<h2><a name="t7"></a>前面问题的解法</h2>
了解了AsyncTask的内幕就知道了前面问题的原因：因为是4.0平台，所以所有的AsyncTask并不都会运行在单独的线程中，而是被SERIAL_EXECUTOR顺序的使用线程执行。因为应用中可能还有其他地方使用AsyncTask，所以到网络取图片的AsyncTask也许会等待到其他任务都完成时才得以执行而不是调用executor()之后马上执行。

那么解决方法其实很简单，要么直接使用Thread，要么创建一个单独的线程池(Executors.newCachedThreadPool())。或者最简单的解法就是使用executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR)，这样起码不用等到前面的都结束了再执行。
<h2><a name="t8"></a>AsyncTask的使用注意事项</h2>
<a href="http://blog.csdn.net/hitlion2008/article/details/7560878" target="_blank">前面的文章</a>曾建议使用AsyncTask而不是使用Thread，但是AsyncTask似乎又有它的限制，这就要根据具体的需求情况而选择合适的工具，<strong>No Silver Bullet。</strong>下面是一些建议：
<ul>
	<li>改善你的设计，<strong>少用异步处理</strong>线程的开销是非常大的，同时异步处理也容易出错，难调试，难维护，所以改善你的设计，尽可能的少用异步。对于一般性的数据库查询，少量的I/O操作是没有必要启动线程的。</li>
	<li>与主线程有<strong>交互</strong>时用AsyncTask，否则就用ThreadAsyncTask被设计出来的目的就是为了满足Android的特殊需求：非主线程不能操作(UI)组件，所以AsyncTask扩展Thread增强了与主线程的交互的能力。如果你的应用没有与主线程交互，那么就直接使用Thread就好了。</li>
	<li>当有需要大量线程执行任务时，一定要<strong>创建线程池</strong>线程的开销是非常大的，特别是创建一个新线程，否则就不必设计线程池之类的工具了。当需要大量线程执行任务时，一定要创建线程池，无论是使用AsyncTask还是Thread，因为使用AsyncTask它内部的线程池有数量限制，可能无法满足需求；使用Thread更是要线程池来管理，避免虚拟机创建大量的线程。比如从网络上批量下载图片，你不想一个一个的下，或者5个5个的下载，那么就创建一个CorePoolSize为10或者20的线程池，每次10个或者20个这样的下载，即满足了速度，又不至于耗费无用的性能开销去无限制的创建线程。</li>
	<li>对于想要立即开始执行的异步任务，要么直接使用Thread，要么单独创建线程池提供给AsyncTask默认的AsyncTask不一定会立即执行你的任务，除非你提供给他一个单独的线程池。如果不与主线程交互，直接创建一个Thread就可以了，虽然创建线程开销比较大，但如果这不是批量操作就没有问题。</li>
	<li>Android的开发没有想像中那样简单，要多花心思和时间在代码上和测试上面，以确信程序是优质的</li>
</ul>
附上相关资源：

使用自定义的CorePoolSize为7的Executor(Executors.newFixedThreadPool(7))：

<img src="http://img.my.csdn.net/uploads/201209/16/1347725020_5458.gif" alt="" align="middle" />

使用未设限制的Executor(Executors.newCachedThreadPool())：

<img src="http://img.my.csdn.net/uploads/201209/16/1347725044_9827.gif" alt="" align="middle" />

这些例子所用的代码：

[codesyntax lang="java"]
<pre>public class AsyncTaskDemoActivity extends Activity {
    private static int ID = 0;
    private static final int TASK_COUNT = 9;
    private static ExecutorService SINGLE_TASK_EXECUTOR;
    private static ExecutorService LIMITED_TASK_EXECUTOR;
    private static ExecutorService FULL_TASK_EXECUTOR;

    static {
        SINGLE_TASK_EXECUTOR = (ExecutorService) Executors.newSingleThreadExecutor();
        LIMITED_TASK_EXECUTOR = (ExecutorService) Executors.newFixedThreadPool(7);
        FULL_TASK_EXECUTOR = (ExecutorService) Executors.newCachedThreadPool();
    };

    @Override
    public void onCreate(Bundle icicle) {
        super.onCreate(icicle);
        setContentView(R.layout.asynctask_demo_activity);
        String title = "AsyncTask of API " + VERSION.SDK_INT;
        setTitle(title);
        final ListView taskList = (ListView) findViewById(R.id.task_list);
        taskList.setAdapter(new AsyncTaskAdapter(getApplication(), TASK_COUNT));
    }

    private class AsyncTaskAdapter extends BaseAdapter {
        private Context mContext;
        private LayoutInflater mFactory;
        private int mTaskCount;
        List&lt;SimpleAsyncTask&gt; mTaskList;

        public AsyncTaskAdapter(Context context, int taskCount) {
            mContext = context;
            mFactory = LayoutInflater.from(mContext);
            mTaskCount = taskCount;
            mTaskList = new ArrayList&lt;SimpleAsyncTask&gt;(taskCount);
        }

        @Override
        public int getCount() {
            return mTaskCount;
        }

        @Override
        public Object getItem(int position) {
            return mTaskList.get(position);
        }

        @Override
        public long getItemId(int position) {
            return position;
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            if (convertView == null) {
                convertView = mFactory.inflate(R.layout.asynctask_demo_item, null);
                SimpleAsyncTask task = new SimpleAsyncTask((TaskItem) convertView);
                /*
                 * It only supports five tasks at most. More tasks will be scheduled only after
                 * first five finish. In all, the pool size of AsyncTask is 5, at any time it only
                 * has 5 threads running.
                 */
//                task.execute();
                // use AsyncTask#SERIAL_EXECUTOR is the same to #execute();
//                task.executeOnExecutor(AsyncTask.SERIAL_EXECUTOR);
                // use AsyncTask#THREAD_POOL_EXECUTOR is the same to older version #execute() (less than API 11)
                // but different from newer version of #execute()
//                task.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);
                // one by one, same to newer version of #execute()
//                task.executeOnExecutor(SINGLE_TASK_EXECUTOR);
                // execute tasks at some limit which can be customized
//                task.executeOnExecutor(LIMITED_TASK_EXECUTOR);
                // no limit to thread pool size, all tasks run simultaneously
                task.executeOnExecutor(FULL_TASK_EXECUTOR);

                mTaskList.add(task);
            }
            return convertView;
        }
    }

    private class SimpleAsyncTask extends AsyncTask&lt;Void, Integer, Void&gt; {
        private TaskItem mTaskItem;
        private String mName;

        public SimpleAsyncTask(TaskItem item) {
            mTaskItem = item;
            mName = "Task #" + String.valueOf(++ID);
        }

        @Override
        protected Void doInBackground(Void... params) {
            int prog = 1;
            while (prog &lt; 101) {
                SystemClock.sleep(100);
                publishProgress(prog);
                prog++;
            }
            return null;
        }

        @Override
        protected void onPostExecute(Void result) {
        }

        @Override
        protected void onPreExecute() {
            mTaskItem.setTitle(mName);
        }

        @Override
        protected void onProgressUpdate(Integer... values) {
            mTaskItem.setProgress(values[0]);
        }
    }
}

class TaskItem extends LinearLayout {
    private TextView mTitle;
    private ProgressBar mProgress;

    public TaskItem(Context context, AttributeSet attrs) {
        super(context, attrs);
    }

    public TaskItem(Context context) {
        super(context);
    }

    public void setTitle(String title) {
        if (mTitle == null) {
            mTitle = (TextView) findViewById(R.id.task_name);
        }
        mTitle.setText(title);
    }

    public void setProgress(int prog) {
        if (mProgress == null) {
            mProgress = (ProgressBar) findViewById(R.id.task_progress);
        }
        mProgress.setProgress(prog);
    }
}</pre>
[/codesyntax]

&nbsp;

&nbsp;

[codesyntax lang="xml"]
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingLeft="10dip"
    android:paddingRight="10dip"
    android:orientation="vertical" &gt;
    &lt;ListView android:id="@+id/task_list"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:divider="#cccccc"
        android:dividerHeight="0.6dip"
        android:footerDividersEnabled="true"
        android:headerDividersEnabled="true" /&gt;
&lt;/LinearLayout&gt;</pre>
[/codesyntax]

&nbsp;

[codesyntax lang="xml"]
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;com.hilton.effectiveandroid.os.TaskItem xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="50dip"
    android:gravity="center_vertical"
    android:layout_gravity="center_vertical"
    android:orientation="horizontal" &gt;
    &lt;TextView android:id="@+id/task_name"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textColor="#ffff00"
        android:textSize="26sp" /&gt;
    &lt;ProgressBar android:id="@+id/task_progress"
        android:layout_width="fill_parent"
        android:layout_height="15dip"
        android:max="100"
        style="@android:style/Widget.ProgressBar.Horizontal" /&gt;
&lt;/com.hilton.effectiveandroid.os.TaskItem &gt;</pre>
[/codesyntax]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>73</wp:post_id>
		<wp:post_date>2015-01-26 16:13:37</wp:post_date>
		<wp:post_date_gmt>2015-01-26 08:13:37</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e6%b7%b1%e5%85%a5%e8%a7%a3%e6%9e%90asynctask</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707469]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>IM遇到的问题</title>
		<link>http://1.duoinfo.sinaapp.com/?p=75</link>
		<pubDate>Mon, 26 Jan 2015 08:18:11 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=75</guid>
		<description></description>
		<content:encoded><![CDATA[1.ListView的getView重复的执行；（高度）<a title="http://www.cnblogs.com/gisdream/p/3514975.html" href="http://www.cnblogs.com/gisdream/p/3514975.html">http://www.cnblogs.com/gisdream/p/3514975.html</a>

2.AsyncTask下载图片的问题；（深入了解AsyncTask(并行，串行)）

3.AsyncTask嵌套，AsyncTask更新界面与屏幕旋转

&nbsp;

//=========2015.03.03更新=====

4.子线程更新UI（<em>Only the original thread that created a view hierarchy can touch its views</em>）]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>75</wp:post_id>
		<wp:post_date>2015-01-26 16:18:11</wp:post_date>
		<wp:post_date_gmt>2015-01-26 08:18:11</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>im%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="android%e9%97%ae%e9%a2%98"><![CDATA[Android问题]]></category>
		<category domain="post_tag" nicename="asynctask"><![CDATA[AsyncTask]]></category>
		<category domain="post_tag" nicename="listview"><![CDATA[ListView]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707470]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android源码分析---AsyncTask</title>
		<link>http://1.duoinfo.sinaapp.com/?p=77</link>
		<pubDate>Mon, 26 Jan 2015 10:18:15 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=77</guid>
		<description></description>
		<content:encoded><![CDATA[AsyncTask内部封装了Thread和Handler，可以让我们在后台进行计算并且把计算的结果及时更新到UI上，而这些正是Thread+Handler所做的事情，没错，AsyncTask的作用就是简化Thread+Handler，让我们能够通过更少的代码来完成一样的功能，这里，我要说明的是：AsyncTask只是简化Thread+Handler而不是替代，实际上它也替代不了。同时，AsyncTask从最开始到现在已经经过了几次代码修改，任务的执行逻辑慢慢地发生了改变，并不是大家所想象的那样：AsyncTask是完全并行执行的就像多个线程一样，其实不是的，所以用AsyncTask的时候还是要注意.这里先给出AsyncTask的一个例子：

[codesyntax lang="java"]
<pre>private class DownloadFilesTask extends AsyncTask&lt;URL, Integer, Long&gt; {
     protected Long doInBackground(URL... urls) {
         int count = urls.length;
         long totalSize = 0;
         for (int i = 0; i &lt; count; i++) {
             totalSize += Downloader.downloadFile(urls[i]);
             publishProgress((int) ((i / (float) count) * 100));
             // Escape early if cancel() is called
             if (isCancelled()) break;
         }
         return totalSize;
     }

     protected void onProgressUpdate(Integer... progress) {
         setProgressPercent(progress[0]);
     }

     protected void onPostExecute(Long result) {
         showDialog("Downloaded " + result + " bytes");
     }
 }</pre>
[/codesyntax]
<h2>使用AsyncTask的规则</h2>
&nbsp;
<ul>
	<li>AsyncTask的类必须在UI线程加载（从4.1开始系统会帮我们自动完成）</li>
	<li>AsyncTask对象必须在UI线程创建</li>
	<li>execute方法必须在UI线程调用</li>
	<li>不要在你的程序中去直接调用onPreExecute(), onPostExecute, doInBackground, onProgressUpdate方法</li>
	<li>一个AsyncTask对象只能执行一次，即只能调用一次execute方法，否则会报运行时异常</li>
	<li>AsyncTask不是被设计为处理耗时操作的，耗时上限为几秒钟，如果要做长耗时操作，强烈建议你使用Executor，ThreadPoolExecutor以及FutureTask</li>
	<li>在1.6之前，AsyncTask是串行执行任务的，1.6的时候AsyncTask开始采用线程池里处理并行任务，但是从3.0开始，为了避免AsyncTask所带来的并发错误，AsyncTask又采用一个线程来串行执行任务</li>
</ul>
&nbsp;
<h2><a name="t2"></a>AsyncTask到底是串行还是并行？</h2>
给大家做一下实验，请看如下实验代码：代码很简单，就是点击按钮的时候同时执行5个AsyncTask，每个AsyncTask休眠3s，同时把每个AsyncTask执行结束的时间打印出来，这样我们就能观察出到底是串行执行还是并行执行。

[codesyntax lang="java"]
<pre>package com.dystu.asynctaskdemo;

import java.text.SimpleDateFormat;
import java.util.Date;

import android.app.Activity;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.Toast;

public class MainActivity extends Activity implements OnClickListener {

	public static final String TAG = "AsyncTask";
	private Button mButton;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		mButton = (Button) findViewById(R.id.btn);
		mButton.setOnClickListener(this);
	}

    @Override
    public void onClick(View v) {
        if (v == mButton) {
        	Toast.makeText(getApplicationContext(), "我执行了", 0).show();
           new MyAsyncTask("AsyncTask#1").execute("");
            new MyAsyncTask("AsyncTask#2").execute("");
            new MyAsyncTask("AsyncTask#3").execute("");
            new MyAsyncTask("AsyncTask#4").execute("");
            new MyAsyncTask("AsyncTask#5").execute("");

        }

    }

    private static class MyAsyncTask extends AsyncTask&lt;String, Integer, String&gt; {

        private String mName = "AsyncTask";

        public MyAsyncTask(String name) {
            super();
            mName = name;
        }

        @Override
        protected String doInBackground(String... params) {
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return mName;
        }

        @Override
        protected void onPostExecute(String result) {
            super.onPostExecute(result);
            SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            Log.e(TAG, result + "execute finish at " + df.format(new Date()));
        }
    }
}</pre>
[/codesyntax]

&nbsp;

我找了2个手机，系统分别是4.1.1和2.3.3，按照我前面的描述，AsyncTask在4.1.1应该是串行的，在2.3.3应该是并行的，到底是不是这样呢？请看Log

&nbsp;

Android 4.1.1上执行：从下面Log可以看出，5个AsyncTask共耗时15s且时间间隔为3s，很显然是串行执行的

<img src="http://img.blog.csdn.net/20131227020312906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2luZ3doYXRpd2FubmE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />

Android 2.3.3上执行：从下面Log可以看出，5个AsyncTask的结束时间是一样的，很显然是并行执行

<img src="http://img.blog.csdn.net/20131227020343265?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2luZ3doYXRpd2FubmE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />
结论：从上面的两个Log可以看出，我前面的描述是完全正确的。下面请看源码，让我们去了解下其中的原理。
<h2><a name="t3"></a>源码分析</h2>
[codesyntax lang="java"]
<pre>/*
 * Copyright (C) 2008 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package android.os;

import java.util.ArrayDeque;
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.Callable;
import java.util.concurrent.CancellationException;
import java.util.concurrent.Executor;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;
import java.util.concurrent.LinkedBlockingQueue;
import java.util.concurrent.ThreadFactory;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.TimeoutException;
import java.util.concurrent.atomic.AtomicBoolean;
import java.util.concurrent.atomic.AtomicInteger;

public abstract class AsyncTask&lt;Params, Progress, Result&gt; {
    private static final String LOG_TAG = "AsyncTask";

	//获取当前的cpu核心数
    private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();
	//线程池核心容量
    private static final int CORE_POOL_SIZE = CPU_COUNT + 1;
	//线程池最大容量
    private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;
	//过剩的空闲线程的存活时间
    private static final int KEEP_ALIVE = 1;
	//ThreadFactory 线程工厂，通过工厂方法newThread来获取新线程
    private static final ThreadFactory sThreadFactory = new ThreadFactory() {
		//原子整数，可以在超高并发下正常工作
        private final AtomicInteger mCount = new AtomicInteger(1);

        public Thread newThread(Runnable r) {
            return new Thread(r, "AsyncTask #" + mCount.getAndIncrement());
        }
    };
	//静态阻塞式队列，用来存放待执行的任务，初始容量：128个
    private static final BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =
            new LinkedBlockingQueue&lt;Runnable&gt;(128);

    /**
     * 静态并发线程池，可以用来并行执行任务，尽管从3.0开始，AsyncTask默认是串行执行任务
	 * 但是我们仍然能构造出并行的AsyncTask
     */
    public static final Executor THREAD_POOL_EXECUTOR
            = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE,
                    TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory);

    /**
     * 静态串行任务执行器，其内部实现了串行控制，
	 * 循环的取出一个个任务交给上述的并发线程池去执行
     */
    public static final Executor SERIAL_EXECUTOR = new SerialExecutor();
	//消息类型：发送结果
    private static final int MESSAGE_POST_RESULT = 0x1;
	//消息类型：更新进度
    private static final int MESSAGE_POST_PROGRESS = 0x2;
	/**静态Handler，用来发送上述两种通知，采用UI线程的Looper来处理消息
	 * 这就是为什么AsyncTask必须在UI线程调用，因为子线程
	 * 默认没有Looper无法创建下面的Handler，程序会直接Crash
	 */
    private static final InternalHandler sHandler = new InternalHandler();
	//默认任务执行器，被赋值为串行任务执行器，就是它，AsyncTask变成串行的了
    private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR;
	//如下两个变量我们先不要深究，不影响我们对整体逻辑的理解
    private final WorkerRunnable&lt;Params, Result&gt; mWorker;
    private final FutureTask&lt;Result&gt; mFuture;
	//任务的状态 默认为挂起，即等待执行，其类型标识为易变的（volatile）
    private volatile Status mStatus = Status.PENDING;
    //原子布尔型，支持高并发访问，标识任务是否被取消
    private final AtomicBoolean mCancelled = new AtomicBoolean();
	//原子布尔型，支持高并发访问，标识任务是否被执行过
    private final AtomicBoolean mTaskInvoked = new AtomicBoolean();

	/*串行执行器的实现，我们要好好看看，它是怎么把并行转为串行的
	 *目前我们需要知道，asyncTask.execute(Params ...)实际上会调用
	 *SerialExecutor的execute方法，这一点后面再说明。也就是说：当你的asyncTask执行的时候，
	 *首先你的task会被加入到任务队列，然后排队，一个个执行
	 */
    private static class SerialExecutor implements Executor {
		//线性双向队列，用来存储所有的AsyncTask任务
        final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();
		//当前正在执行的AsyncTask任务
        Runnable mActive;

        public synchronized void execute(final Runnable r) {
			//将新的AsyncTask任务加入到双向队列中
            mTasks.offer(new Runnable() {
                public void run() {
                    try {
						//执行AsyncTask任务
                        r.run();
                    } finally {
						//当前AsyncTask任务执行完毕后，进行下一轮执行，如果还有未执行任务的话
						//这一点很明显体现了AsyncTask是串行执行任务的，总是一个任务执行完毕才会执行下一个任务
                        scheduleNext();
                    }
                }
            });
			//如果当前没有任务在执行，直接进入执行逻辑
            if (mActive == null) {
                scheduleNext();
            }
        }

        protected synchronized void scheduleNext() {
			//从任务队列中取出队列头部的任务，如果有就交给并发线程池去执行
            if ((mActive = mTasks.poll()) != null) {
                THREAD_POOL_EXECUTOR.execute(mActive);
            }
        }
    }

    /**
     * 任务的三种状态
     */
    public enum Status {
        /**
         * 任务等待执行
         */
        PENDING,
        /**
         * 任务正在执行
         */
        RUNNING,
        /**
         * 任务已经执行结束
         */
        FINISHED,
    }

    /** 隐藏API：在UI线程中调用，用来初始化Handler */
    public static void init() {
        sHandler.getLooper();
    }

    /** 隐藏API：为AsyncTask设置默认执行器 */
    public static void setDefaultExecutor(Executor exec) {
        sDefaultExecutor = exec;
    }

    /**
     * Creates a new asynchronous task. This constructor must be invoked on the UI thread.
     */
    public AsyncTask() {
        mWorker = new WorkerRunnable&lt;Params, Result&gt;() {
            public Result call() throws Exception {
                mTaskInvoked.set(true);

                Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
                //noinspection unchecked
                return postResult(doInBackground(mParams));
            }
        };

        mFuture = new FutureTask&lt;Result&gt;(mWorker) {
            @Override
            protected void done() {
                try {
                    postResultIfNotInvoked(get());
                } catch (InterruptedException e) {
                    android.util.Log.w(LOG_TAG, e);
                } catch (ExecutionException e) {
                    throw new RuntimeException("An error occured while executing doInBackground()",
                            e.getCause());
                } catch (CancellationException e) {
                    postResultIfNotInvoked(null);
                }
            }
        };
    }

    private void postResultIfNotInvoked(Result result) {
        final boolean wasTaskInvoked = mTaskInvoked.get();
        if (!wasTaskInvoked) {
            postResult(result);
        }
    }
	//doInBackground执行完毕，发送消息
    private Result postResult(Result result) {
        @SuppressWarnings("unchecked")
        Message message = sHandler.obtainMessage(MESSAGE_POST_RESULT,
                new AsyncTaskResult&lt;Result&gt;(this, result));
        message.sendToTarget();
        return result;
    }

    /**
     * 返回任务的状态
     */
    public final Status getStatus() {
        return mStatus;
    }

    /**
	 * 这个方法是我们必须要重写的，用来做后台计算
	 * 所在线程：后台线程
     */
    protected abstract Result doInBackground(Params... params);

    /**
	 * 在doInBackground之前调用，用来做初始化工作
	 * 所在线程：UI线程
     */
    protected void onPreExecute() {
    }

    /**
	 * 在doInBackground之后调用，用来接受后台计算结果更新UI
	 * 所在线程：UI线程
     */
    protected void onPostExecute(Result result) {
    }

    /**
     * Runs on the UI thread after {@link #publishProgress} is invoked.
     /**
	 * 在publishProgress之后调用，用来更新计算进度
	 * 所在线程：UI线程
     */
    protected void onProgressUpdate(Progress... values) {
    }

     /**
	 * cancel被调用并且doInBackground执行结束，会调用onCancelled，表示任务被取消
	 * 这个时候onPostExecute不会再被调用，二者是互斥的，分别表示任务取消和任务执行完成
	 * 所在线程：UI线程
     */
    @SuppressWarnings({"UnusedParameters"})
    protected void onCancelled(Result result) {
        onCancelled();
    }    

    protected void onCancelled() {
    }

    public final boolean isCancelled() {
        return mCancelled.get();
    }

    public final boolean cancel(boolean mayInterruptIfRunning) {
        mCancelled.set(true);
        return mFuture.cancel(mayInterruptIfRunning);
    }

    public final Result get() throws InterruptedException, ExecutionException {
        return mFuture.get();
    }

    public final Result get(long timeout, TimeUnit unit) throws InterruptedException,
            ExecutionException, TimeoutException {
        return mFuture.get(timeout, unit);
    }

    /**
     * 这个方法如何执行和系统版本有关，在AsyncTask的使用规则里已经说明，如果你真的想使用并行AsyncTask，
	 * 也是可以的，只要稍作修改
	 * 必须在UI线程调用此方法
     */
    public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) {
		//串行执行
        return executeOnExecutor(sDefaultExecutor, params);
		//如果我们想并行执行，这样改就行了，当然这个方法我们没法改
		//return executeOnExecutor(THREAD_POOL_EXECUTOR, params);
    }

    /**
     * 通过这个方法我们可以自定义AsyncTask的执行方式，串行or并行，甚至可以采用自己的Executor
	 * 为了实现并行，我们可以在外部这么用AsyncTask：
	 * asyncTask.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, Params... params);
	 * 必须在UI线程调用此方法
     */
    public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,
            Params... params) {
        if (mStatus != Status.PENDING) {
            switch (mStatus) {
                case RUNNING:
                    throw new IllegalStateException("Cannot execute task:"
                            + " the task is already running.");
                case FINISHED:
                    throw new IllegalStateException("Cannot execute task:"
                            + " the task has already been executed "
                            + "(a task can be executed only once)");
            }
        }

        mStatus = Status.RUNNING;
		//这里#onPreExecute会最先执行
        onPreExecute();

        mWorker.mParams = params;
		//然后后台计算#doInBackground才真正开始
        exec.execute(mFuture);
		//接着会有#onProgressUpdate被调用，最后是#onPostExecute

        return this;
    }

    /**
     * 这是AsyncTask提供的一个静态方法，方便我们直接执行一个runnable
     */
    public static void execute(Runnable runnable) {
        sDefaultExecutor.execute(runnable);
    }

    /**
	 * 打印后台计算进度，onProgressUpdate会被调用
     */
    protected final void publishProgress(Progress... values) {
        if (!isCancelled()) {
            sHandler.obtainMessage(MESSAGE_POST_PROGRESS,
                    new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget();
        }
    }

	//任务结束的时候会进行判断，如果任务没有被取消，则onPostExecute会被调用
    private void finish(Result result) {
        if (isCancelled()) {
            onCancelled(result);
        } else {
            onPostExecute(result);
        }
        mStatus = Status.FINISHED;
    }

	//AsyncTask内部Handler，用来发送后台计算进度更新消息和计算完成消息
    private static class InternalHandler extends Handler {
        @SuppressWarnings({"unchecked", "RawUseOfParameterizedType"})
        @Override
        public void handleMessage(Message msg) {
            AsyncTaskResult result = (AsyncTaskResult) msg.obj;
            switch (msg.what) {
                case MESSAGE_POST_RESULT:
                    // There is only one result
                    result.mTask.finish(result.mData[0]);
                    break;
                case MESSAGE_POST_PROGRESS:
                    result.mTask.onProgressUpdate(result.mData);
                    break;
            }
        }
    }

    private static abstract class WorkerRunnable&lt;Params, Result&gt; implements Callable&lt;Result&gt; {
        Params[] mParams;
    }

    @SuppressWarnings({"RawUseOfParameterizedType"})
    private static class AsyncTaskResult&lt;Data&gt; {
        final AsyncTask mTask;
        final Data[] mData;

        AsyncTaskResult(AsyncTask task, Data... data) {
            mTask = task;
            mData = data;
        }
    }
}</pre>
[/codesyntax]

&nbsp;
<h2>让你的AsyncTask在3.0以上的系统中并行起来</h2>
通过上面的源码分析，我已经给出了在3.0以上系统中让AsyncTask并行执行的方法，现在，让我们来试一试，代码还是之前采用的测试代码，我们要稍作修改，调用AsyncTask的executeOnExecutor方法而不是execute，请看：

&nbsp;

[codesyntax lang="java"]
<pre>package com.dystu.asynctaskdemo;

import java.text.SimpleDateFormat;
import java.util.Date;

import android.app.Activity;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.Toast;

public class MainActivity extends Activity implements OnClickListener {

	public static final String TAG = "AsyncTask";
	private Button mButton;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		mButton = (Button) findViewById(R.id.btn);
		mButton.setOnClickListener(this);
	}

    @Override
    public void onClick(View v) {
        if (v == mButton) {
        	Toast.makeText(getApplicationContext(), "我执行了", 0).show();
        /*    new MyAsyncTask("AsyncTask#1").execute("");
            new MyAsyncTask("AsyncTask#2").execute("");
            new MyAsyncTask("AsyncTask#3").execute("");
            new MyAsyncTask("AsyncTask#4").execute("");
            new MyAsyncTask("AsyncTask#5").execute("");*/

        	//=======================3.0以上让其并行执行===================
        	 new MyAsyncTask("AsyncTask#1").executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,"");  
             new MyAsyncTask("AsyncTask#2").executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,"");  
             new MyAsyncTask("AsyncTask#3").executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,"");  
             new MyAsyncTask("AsyncTask#4").executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,"");  
             new MyAsyncTask("AsyncTask#5").executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,"");  

        }

    }

    private static class MyAsyncTask extends AsyncTask&lt;String, Integer, String&gt; {

        private String mName = "AsyncTask";

        public MyAsyncTask(String name) {
            super();
            mName = name;
        }

        @Override
        protected String doInBackground(String... params) {
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return mName;
        }

        @Override
        protected void onPostExecute(String result) {
            super.onPostExecute(result);
            SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            Log.e(TAG, result + "execute finish at " + df.format(new Date()));
        }
    }
}</pre>
[/codesyntax]

下面是系统为4.1.1手机打印出的Log：很显然，我们的目的达到了，成功的让AsyncTask在4.1.1的手机上并行起来了

<img src="http://img.blog.csdn.net/20131227021159765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2luZ3doYXRpd2FubmE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>77</wp:post_id>
		<wp:post_date>2015-01-26 18:18:15</wp:post_date>
		<wp:post_date_gmt>2015-01-26 10:18:15</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-asynctask</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="android"><![CDATA[Android]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="android%e6%ba%90%e7%a0%81"><![CDATA[Android源码]]></category>
		<category domain="post_tag" nicename="android%e6%ba%90%e7%a0%81"><![CDATA[Android源码]]></category>
		<category domain="post_tag" nicename="asynctask"><![CDATA[AsyncTask]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707471]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android JNI开发</title>
		<link>http://1.duoinfo.sinaapp.com/?p=82</link>
		<pubDate>Mon, 26 Jan 2015 11:03:02 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=82</guid>
		<description></description>
		<content:encoded><![CDATA[<h1>什么是JNI：</h1>
JNI： java本地开发接口， JNI 是一个协议 ，这个协议用来沟通java代码和外部的本地代码(c/c++). 通过这个协议,java代码就可以调用外部的c/c++代码 ，外部的c/c++代码也可以调用java代码。
<h1><a name="t1"></a>为什么用JNI：</h1>
JNI扩展了java 虚拟机的能力, 驱动开发 (wifi-hotspot) ，2.3 无线热点共享；

Native code效率高,数学运算,实时渲染的游戏上,音视频处理 (极品飞车,opengl,ffmpeg)；

复用代码 (文件压缩,人脸识别…)；

特殊的业务场景；
<h1><a name="t2"></a>怎么用JNI：</h1>
1.C/C++语言；

2.掌握java jni流程；

3.NDK (native develop kits )；
<h1><a name="t3"></a>搭建ndk开发环境：</h1>
1.为eclipse增加c和c++的开发插件

点击：Help中的install new software，选择 Helios- http：//download.eclipse.org/release/helios

等待展开，选择Programing language，选择c/c++ 开发工具，一路next下去。 同意licenses，安装成功会提示是不是确认重启eclipse，重启就完成安装。

2，安装cygwin

Ndk需要运行在linux环境下，cygwin是windows下模拟linux的一个工具。

Cygwin是一个程序，支持很多插件。双击安装。把需要下载的东西下载好，选择install from local directory。

安装完毕后 ,桌面会出现一个快捷图标，现在打开 cygwin，首先程序会初始化，敲入命令：

Make –v

显示出来 GNU Make 的版本 ,说明我们的cygwin模拟的linux编译环境 模拟成功了.下面去安装android ndk，下载之后直接解压到某个目录下 ，如图：

<img src="http://img.blog.csdn.net/20150126192237906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

配置NDK的 cygwin环境变量

<img src="http://img.blog.csdn.net/20150126192744695?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

为了方便直接在命令行里面使用ndk-build需要给cygwin的环境变量里面添加ndk的目录,目录/etc/profile/.
<h1><a name="t4"></a>NDK HelloWorld:</h1>
<div>1.创建一个android工程
2.JAVA代码中写声明native 方法</div>
<div>[codesyntax lang="java"]
<pre>    /* A native method that is implemented by the
     * 'hello-jni' native library, which is packaged
     * with this application.
     */
    public native String  stringFromJNI();</pre>
[/codesyntax]

</div>
<div>3. 创建jni目录,编写c代码,方法名字要对应</div>
<div>
<div>
<div>
<div>[codesyntax lang="java"]
<pre>#include &lt;string.h&gt;
#include &lt;jni.h&gt;

/* This is a trivial JNI example where we use a native method
 * to return a new VM String. See the corresponding Java source
 * file located at:
 *
 *   apps/samples/hello-jni/project/src/com/example/hellojni/HelloJni.java
 */
jstring
Java_com_example_hellojni_HelloJni_stringFromJNI( JNIEnv* env,
                                                  jobject thiz )
{
    return (*env)-&gt;NewStringUTF(env, "Hello from JNI !");
}</pre>
[/codesyntax]

</div>
</div>
</div>
4.编写Android.mk文件

</div>
<div>
<div>

[codesyntax lang="java"]
<pre>LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)

LOCAL_MODULE := hello-jni
LOCAL_SRC_FILES := hello-jni.c

include $(BUILD_SHARED_LIBRARY)</pre>
[/codesyntax]

</div>
5.Ndk编译生成动态库

</div>
<div><img src="http://img.blog.csdn.net/20150126194015727?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div>6.Java代码load 动态库.调用native代码</div>
[codesyntax lang="java"]
<pre> static {
        System.loadLibrary("hello-jni");
    }</pre>
[/codesyntax]

注意：

<img src="http://img.blog.csdn.net/20150126194043515?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;
<h1><a name="t5"></a> Android.mk详细介绍</h1>
<div>Android.mk 的含义
LOCAL_PATH:=$(call my-dir)
LOCAL_PATH是定义源文件在哪个目录用的.
my-dir 是个定义的宏方法, $(call my-dir)就是调用这个叫 my-dir的宏方法,这个方法返回值就是
Android.mk文件所在的目录
include $(CLEAR_VARS)
CLEAR_BARS 变量是build system里面的一个变量
这个变量指向了所有的类似 LOCAL_XXX的变量,
执行完这一句话, 这个编译系统就把 所有的类似
LOCAL_MODULE,_SRC_FILELOCALS,LOCAL_STATIC_LIBRARIES,...这样的变量都清除掉
但是不会清除掉 LOCAL_PATH
LOCAL_MODULE  就是你要生成的库的名字,名字要是唯一的这个.不能有空格.
编译后系统会自动在前面加上lib的头, 比如说我们的Hello 就编译成了libHello.so
还有个特点就是如果你起名叫libHello 编译后ndk就不会给你的module名字前加上lib了
但是你最后调用的时候 还是调用Hello这个库
LOCAL_SRC_FILES = :Hello.c
这个是指定你要编译哪些文件
不需要指定头文件 ,引用哪些依赖, 因为编译器会自动找到这些依赖 自动编译
include $(BUILD_SHARED_LIBRARY)  BUILD_STATIC_LIBRARY
.so
编译后生成的库的类型,如果是静态库.a 配置include $(BUILD_STATIC_LIBRARY)
别的参数
LOCAL_CPP_EXTENSION := cc //指定c++文件的扩展名
LOCAL_MODULE    := ndkfoo
LOCAL_SRC_FILES := ndkfoo.cc
LOCAL_LDLIBS += -llog -lvmsagent -lmpnet -lmpxml -lH264Android
//指定需要加载一些别的什么库.</div>
<h1><a name="t6"></a> 重新审视这个程序</h1>
<div>1.创建一个android工程
2.JAVA代码中写声明native 方法 public native String helloFromJNI();
3.用javah工具生成头文件</div>
<div><img src="http://img.blog.csdn.net/20150126194550894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div><img src="http://img.blog.csdn.net/20150126194726834?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div>4. 创建jni目录,引入头文件,根据头文件实现c代码
5.编写Android.mk文件
6.Ndk编译生成动态库
7.Java代码load 动态库.调用native代码</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>82</wp:post_id>
		<wp:post_date>2015-01-26 19:03:02</wp:post_date>
		<wp:post_date_gmt>2015-01-26 11:03:02</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-jni%e5%bc%80%e5%8f%91</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="jni-cc"><![CDATA[JNI C/C++]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707472]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android程序框架PhoneGap</title>
		<link>http://1.duoinfo.sinaapp.com/?p=90</link>
		<pubDate>Mon, 26 Jan 2015 14:37:38 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=90</guid>
		<description></description>
		<content:encoded><![CDATA[PhoneGap是由<a id="10_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%CE%C2%B8%E7%BB%AA&amp;k0=%CE%C2%B8%E7%BB%AA&amp;k1=app&amp;k2=android&amp;k3=palm&amp;k4=%CE%C4%BC%FE%BC%D0&amp;k5=javascript&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=7&amp;seller_id=1&amp;di=128" target="_blank">温哥华</a>的一家小公司研发的多平台的移动开发框架,支持流行的大多数移动设备(iPhone，Android ，BlackBerry，Symbian，Palm，Window Phone).目前phonegap获得Apple,IBM,NOKIA,<a id="11_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=palm&amp;k0=palm&amp;k1=%CE%C4%BC%FE%BC%D0&amp;k2=javascript&amp;k3=phone&amp;k4=blackberry&amp;k5=%CE%C2%B8%E7%BB%AA&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=2&amp;seller_id=1&amp;di=128" target="_blank">palm</a>等众多公司的支持.

<strong>phonegap的优点:</strong>

1.兼容性,完全做到了written once,run everywhere.

2.标准化.phonegap使用W3C标准,可用html5+css3+JqueryMobile快速开发各平台的<a id="9_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=app&amp;k0=app&amp;k1=android&amp;k2=palm&amp;k3=%CE%C4%BC%FE%BC%D0&amp;k4=javascript&amp;k5=phone&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=8&amp;seller_id=1&amp;di=128" target="_blank">app</a>

3.开发成本低

4.完全自由免费.phonegap采用MIT,BSD许可证.

<strong>honegap的缺点:</strong>

1.性能有待加强,运行速度慢,UI反应延时

2.没有中文文档例子较少。

下面采用phonegap+jquerymobile开发一个phonegap的Helloworld.

第一步:下载phonegap,jquerymobile,jquery1.5.1解压待用.(文章末尾附有官网链接)

第二步:新建一个android项目HelloWorld,在assets目录下新建文件夹www,这个文件夹将用来放置html,JS,CSS等文件.在根目录下新建libs文件夹,用来放置phonegap的开发包.

第三步: 将刚刚解压出来的phonegap/android下的phonegap.0.9.5.js;jquerymobile目录下的 images,jquery.mobile-1.0a4.1.min.css,jquery.mobile-1.0a4.1.min.js;Jquery 目录下的jqueryjquery-1.5.1.min.js复制到www<a id="8_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%CE%C4%BC%FE%BC%D0&amp;k0=%CE%C4%BC%FE%BC%D0&amp;k1=javascript&amp;k2=phone&amp;k3=blackberry&amp;k4=%CE%C2%B8%E7%BB%AA&amp;k5=app&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">文件夹</a>.

第四步:复制<a id="7_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=phone&amp;k0=phone&amp;k1=blackberry&amp;k2=%CE%C2%B8%E7%BB%AA&amp;k3=app&amp;k4=android&amp;k5=palm&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=5&amp;seller_id=1&amp;di=128" target="_blank">phone</a>gap/android下的phonegap.0.9.5.jar到libs文件夹,并在项目的属性中将其加入到项目

第五步:修改默认的Activity文件main.java

[codesyntax lang="java"]
<pre>package com.pixy.phonegap;

import com.phonegap.DroidGap;

import android.app.Activity;
import android.os.Bundle;

public class main extends DroidGap {
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        super.loadUrl("file:///android_asset/www/index.html");
    }
}</pre>
[/codesyntax]
<div></div>
第六步:在www<a id="5_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%CE%C4%BC%FE%BC%D0&amp;k0=%CE%C4%BC%FE%BC%D0&amp;k1=javascript&amp;k2=phone&amp;k3=blackberry&amp;k4=%CE%C2%B8%E7%BB%AA&amp;k5=app&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">文件夹</a>中新建index.html文件.

输入内容
<div>
<div id="highlighter_896483">[codesyntax lang="xml"]
<pre>&lt;link rel="stylesheet" href="jquery.mobile-1.0a4.1.min.css" type="text/css"
			charset="utf-8"&gt;
		&lt;script type="text/javascript" charset="utf-8" src="phonegap.js"&gt;&lt;/script&gt;
		&lt;script type="text/javascript" charset="utf-8" src="jquery.js"&gt;&lt;/script&gt;		
		&lt;script type="text/javascript" charset="utf-8" src="jquery.mobile-1.0a4.1.min.js"&gt;&lt;/script&gt;
		&lt;script type="text/javascript" charset="utf-8"&gt;
			$(document).ready(function(){
				//为按钮ClickMe添加点击事件
				$('#ClickMe').tap(function(){alert('HelloWorld!');});
			}); 
		&lt;/script&gt;</pre>
[/codesyntax]

</div>
</div>
在&lt;body&gt;&lt;/body&gt;中添加
<div>
<div id="highlighter_383035">[codesyntax lang="xml"]
<pre>&lt;body&gt;
		&lt;div data-theme="b" data-role="page" id="main"&gt;
			&lt;div data-role="header" &gt;
				&lt;h1&gt;
					HelloWorld
				&lt;/h1&gt;
			&lt;/div&gt;
			&lt;!-- /header --&gt;

			&lt;div data-role="content" &gt;
				&lt;p&gt;
					这是我第一个PhoneGap+JqueryMobile结合的android程序
				&lt;/p&gt;
				&lt;p&gt;					
					&lt;a href="#" id="ClickMe" data-role="button" data-inline="true" class="Bsimhei"&gt;点我&lt;/a&gt;
				&lt;/p&gt;
			&lt;/div&gt;
			&lt;!-- /content --&gt;

			&lt;div data-role="footer" &gt;
				&lt;h4&gt;
					这个是页脚
				&lt;/h4&gt;
			&lt;/div&gt;
			&lt;!-- /header --&gt;
		&lt;/div&gt;
	&lt;/body&gt;</pre>
[/codesyntax]

</div>
</div>
第七步:Run As Android Application

运行效果图如下
<img src="http://www.jcodecraeer.com/uploads/allimg/130506/201Z160V-0.jpg" alt="" />
<img src="http://www.jcodecraeer.com/uploads/allimg/130506/201Z13027-1.jpg" alt="" />

&nbsp;

OK,至此一个<a id="1_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=phone&amp;k0=phone&amp;k1=blackberry&amp;k2=%CE%C2%B8%E7%BB%AA&amp;k3=app&amp;k4=android&amp;k5=palm&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=5&amp;seller_id=1&amp;di=128" target="_blank">phone</a>gap+jquerymobile的<a id="2_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F0506%2F1215%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=android&amp;k0=android&amp;k1=palm&amp;k2=%CE%C4%BC%FE%BC%D0&amp;k3=javascript&amp;k4=phone&amp;k5=blackberry&amp;sid=ff67e0afb60a6873&amp;ch=0&amp;tu=u1921070&amp;jk=00bec9a438bf58c7&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=1&amp;seller_id=1&amp;di=128" target="_blank">android</a>程序已经完成.在模拟器中运行性能很差,真机运行的延时是可以接受的.

相关链接

PhoneGap <a href="http://www.phonegap.com/">http://www.phonegap.com/</a>

jquerymobile  <a href="http://jquerymobile.com/">http://jquerymobile.com/</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>90</wp:post_id>
		<wp:post_date>2015-01-26 22:37:38</wp:post_date>
		<wp:post_date_gmt>2015-01-26 14:37:38</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e7%a8%8b%e5%ba%8f%e6%a1%86%e6%9e%b6phonegap</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="phonegap"><![CDATA[PhoneGap]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707473]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title> Android获取状态栏，标题栏，视图的尺寸</title>
		<link>http://1.duoinfo.sinaapp.com/?p=93</link>
		<pubDate>Tue, 27 Jan 2015 01:15:07 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=93</guid>
		<description></description>
		<content:encoded><![CDATA[效果如下：

<img src="http://img.blog.csdn.net/20150127090413945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

在onWindowFocusChanged方法中执行测量的代码。

[codesyntax lang="java"]
<pre>package com.dystu.viewdimen;

import android.app.Activity;
import android.graphics.Rect;
import android.os.Bundle;
import android.view.View;
import android.view.Window;
import android.widget.TextView;

public class MainActivity extends Activity {

	private TextView tv;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		tv = (TextView) findViewById(R.id.tv);

	}

	@Override
	public void onWindowFocusChanged(boolean hasFocus) {
		super.onWindowFocusChanged(hasFocus);
		Rect frame = new Rect();
		getWindow().getDecorView().getWindowVisibleDisplayFrame(frame);
		// 状态栏高度
		int statusBarHeight = frame.top;
		// 获得根视图
		View v = getWindow().findViewById(Window.ID_ANDROID_CONTENT);
		int contentTop = v.getTop();

		// statusBarHeight是上面所求的状态栏的高度
		int titleBarHeight = contentTop - statusBarHeight;

		tv.setText("标题栏的高度" + Integer.toString(titleBarHeight) + "\n" + "状态栏高度"
				+ statusBarHeight + "\n" + "视图的宽度" + v.getWidth() + "\n"
				+ "视图的高度（不包含状态栏和标题栏）" + v.getHeight());
	}

}</pre>
[/codesyntax]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>93</wp:post_id>
		<wp:post_date>2015-01-27 09:15:07</wp:post_date>
		<wp:post_date_gmt>2015-01-27 01:15:07</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e8%8e%b7%e5%8f%96%e7%8a%b6%e6%80%81%e6%a0%8f%ef%bc%8c%e6%a0%87%e9%a2%98%e6%a0%8f%ef%bc%8c%e8%a7%86%e5%9b%be%e7%9a%84%e5%b0%ba%e5%af%b8</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="%e6%a0%87%e9%a2%98%e6%a0%8f%e5%b0%ba%e5%af%b8"><![CDATA[标题栏尺寸]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707474]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title> Android,View设置margin</title>
		<link>http://1.duoinfo.sinaapp.com/?p=95</link>
		<pubDate>Tue, 27 Jan 2015 01:21:59 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=95</guid>
		<description></description>
		<content:encoded><![CDATA[读开发文档的时候，遇到这样的一句话：

Even though a view can define a padding, it does not provide any support for margins. However, view groups provide such a support. Refer to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewGroup.html">ViewGroup</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewGroup.MarginLayoutParams.html">ViewGroup.MarginLayoutParams</a></code> for further information.

意思是View不支持margin属性。

android的view中有setPadding，但是没有直接的setMargin方法。如果要在代码中设置该怎么做呢？

可以通过设置view里面的 LayoutParams 设置，而这个LayoutParams是根据该view在不同的GroupView而不同的。

[codesyntax lang="java"]
<pre>ImageView image = (ImageView) findViewById(R.id.main_image);
RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(image.getLayoutParams());
lp.setMargins(50, 100, 0, 0);
image.setLayoutParams(lp);</pre>
[/codesyntax]

这里的RelativeLayout是说明该view在一个RelativeLayout里面。
可以把设置margin的方式封装成方法，只要是GroupView里面的LayoutParams 即可。

[codesyntax lang="java"]
<pre>public static void setMargins (View v, int l, int t, int r, int b) {
    if (v.getLayoutParams() instanceof ViewGroup.MarginLayoutParams) {
        ViewGroup.MarginLayoutParams p = (ViewGroup.MarginLayoutParams) v.getLayoutParams();
        p.setMargins(l, t, r, b);
        v.requestLayout();
    }
}</pre>
[/codesyntax]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>95</wp:post_id>
		<wp:post_date>2015-01-27 09:21:59</wp:post_date>
		<wp:post_date_gmt>2015-01-27 01:21:59</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>androidview%e8%ae%be%e7%bd%aemargin</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="margin"><![CDATA[Margin]]></category>
		<category domain="post_tag" nicename="padding"><![CDATA[Padding]]></category>
		<category domain="post_tag" nicename="view"><![CDATA[View]]></category>
		<category domain="post_tag" nicename="viewgroup"><![CDATA[ViewGroup]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707475]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>理解getWidth和getMeasuredWidth</title>
		<link>http://1.duoinfo.sinaapp.com/?p=99</link>
		<pubDate>Tue, 27 Jan 2015 01:30:30 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=99</guid>
		<description></description>
		<content:encoded><![CDATA[<a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6e519585010152s5&amp;url=http://s12.sinaimg.cn/orignal/6e519585gbdc2eebf9fab" target="_blank"><img title="Android &lt;wbr&gt;一张图理解getWidth和getMeasuredWidth" src="http://s12.sinaimg.cn/middle/6e519585gbdc2eebf9fab&amp;690" alt="Android &lt;wbr&gt;一张图理解getWidth和getMeasuredWidth" name="image_operate_36241334544846951" width="690" height="551" /></a>
<div>view.getMeasuredHeight()可能隐藏在上头.可能在下头.如果view没有超出屏幕的时候view.getMeasuredHeight() <wbr>有可能小于 <wbr>view.getHeight()</wbr></wbr></div>
<div></div>
<div> <wbr>getWidth(): view在设定好布局后整个view的宽度。
<wbr> getMeasuredWidth():对view上的内容进行测量后得到的View内容占据的宽度。前提是你必须在父布局的onLayout()方法或者此View的onDraw()方法里调用measure(0,0);(measure中的参数的值你自己可以定义)，否则你得到的结果和getWidth()得到的结果是一样的。</wbr></wbr></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>99</wp:post_id>
		<wp:post_date>2015-01-27 09:30:30</wp:post_date>
		<wp:post_date_gmt>2015-01-27 01:30:30</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e7%90%86%e8%a7%a3getwidth%e5%92%8cgetmeasuredwidth</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="getmeasuredwidth"><![CDATA[getMeasuredWidth]]></category>
		<category domain="post_tag" nicename="getwidth"><![CDATA[getWidth]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707476]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>android WebView全面总结</title>
		<link>http://1.duoinfo.sinaapp.com/?p=103</link>
		<pubDate>Tue, 27 Jan 2015 02:14:06 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=103</guid>
		<description></description>
		<content:encoded><![CDATA[WebView是安卓中用来显示html文本内容的的控件，对html5也有很好的支持，<a id="17_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=ios&amp;k0=ios&amp;k1=open&amp;k2=%E4%AF%C0%C0%C6%F7&amp;k3=%B0%B4%C5%A5&amp;k4=android&amp;k5=web&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=7&amp;seller_id=1&amp;di=128" target="_blank">ios</a>的控件UIWebView差不多。网上对WebView的解释很多，但都是零星的介绍，导致到现在为止webview给我的印象都是，貌似很强大，其实很鸡肋，于是决定总结一下webview的开发经验。

<strong>使用WebView并不需要开通网络权限</strong>

网上有文章说webview需要开通internet权限，否则会出Web page not available错误，这是不对的，出现Web page not available并不是因为使用了webview，而是webview访问了网络，如果webview只是加载本地html（比如assets目录中的文件），或者只是加载带有html文本的字符串，即使没有internet权限，也不会报错。

<strong>如何调用webview</strong>

<a id="16_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=xml&amp;k0=xml&amp;k1=%D7%E9%BC%FE&amp;k2=api&amp;k3=ios&amp;k4=open&amp;k5=%E4%AF%C0%C0%C6%F7&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=4&amp;seller_id=1&amp;di=128" target="_blank">xml</a>中
<div>
<div id="highlighter_595800">[codesyntax lang="java"]
<pre>&lt;WebView
    android:id="@+id/blog_detail"
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:background="#FFFFFF"/&gt;</pre>
[/codesyntax]</div>
</div>
activity中
<div>
<div id="highlighter_94571">[codesyntax lang="java"]
<pre>mWebView = (WebView)findViewById(R.id.blog_detail_webview);
mWebView.getSettings().setJavaScriptEnabled(false);
mWebView.getSettings().setSupportZoom(false);
mWebView.getSettings().setBuiltInZoomControls(false);
mWebView.getSettings().setLayoutAlgorithm(LayoutAlgorithm.SINGLE_COLUMN);
mWebView.getSettings().setDefaultFontSize(18);</pre>
[/codesyntax]</div>
</div>
<strong>基本设置</strong>

上面的<a id="14_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=java&amp;k0=java&amp;k1=xml&amp;k2=%D7%E9%BC%FE&amp;k3=api&amp;k4=ios&amp;k5=open&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">java</a>代码部分相信大家都懂，可以看到WebView 和其他控件不同的地方在于其属性设置是调用mWebView.getSettings()来完成的，不知道谷歌这样设计的用意，其中：

<strong>mWebView.getSettings().setJavaScriptEnabled(false);</strong>

表示不支持js，如果想让<a id="6_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=java&amp;k0=java&amp;k1=xml&amp;k2=%D7%E9%BC%FE&amp;k3=api&amp;k4=ios&amp;k5=open&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=3&amp;seller_id=1&amp;di=128" target="_blank">java</a>和js交互或者本身希望js完成一定的功能请把false改为true。
<div>

<strong>mWebView.getSettings().setSupportZoom(false);</strong>

设置是否支持缩放，我这里为false，默认为true。
<div>

<strong>mWebView.getSettings().setBuiltInZoomControls(false);</strong>

设置是否显示缩放工具，默认为false。

<strong>mWebView.getSettings().setLayoutAlgorithm(LayoutAlgorithm.SINGLE_COLUMN);</strong>

一般很少会用到这个，用WebView组件显示普通网页时一般会出现横向滚动条，这样会导致页面查看起来非常不方便。LayoutAlgorithm是一个枚举，用来控制html的布局，总共有三种类型：
NORMAL：正常显示，没有渲染变化。
SINGLE_COLUMN：把所有内容放到WebView组件等宽的一列中。
NARROW_COLUMNS：可能的话，使所有列的宽度不超过屏幕宽度。

<strong>mWebView.getSettings().setDefaultFontSize(18);</strong>

设置默认的字体大小，默认为16，有效值区间在1-72之间。

<strong>加载内容</strong>

</div>
（1）加载assets目录下的本地网页

一般我们都是把html文件放在assets目录下， WebView调用assets目录下的本地网页和图片等资源非常方便，使用形如
<div>
<div id="highlighter_37551">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>mWebView.loadUrl("file:///android_asset/www/index.html"</code><code>);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
的调用方法即可。

（2）加载远程网页
<div>
<div id="highlighter_933049">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>mWebView.loadUrl(</code><code>"<a href="http://www.google.com/">http://www.google.com</a>"</code><code>);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
（3）使用 LoadData 或者 loadDataWithBaseURL方法加载内容

有时候我们的webview可能只是html片段，而不是一个完整的网页，事实上绝大多数时候都是如此，完整的网页无需做成应用，而直接在<a id="4_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%E4%AF%C0%C0%C6%F7&amp;k0=%E4%AF%C0%C0%C6%F7&amp;k1=%B0%B4%C5%A5&amp;k2=android&amp;k3=web&amp;k4=java&amp;k5=xml&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=9&amp;seller_id=1&amp;di=128" target="_blank">浏览器</a>访问。

这种情况我们使用 LoadData 或者 loadDataWithBaseURL方法，后者用的最多：

void loadDataWithBaseURL (String baseUrl, String data, String mimeType, String encoding, String historyUrl)

loadDataWithBaseURL()比loadData()多两个参数，可以指定HTML代码片段中相关资源的相对根路径，也可以指定历史Url，其余三个参数相同。

这里主要注意参数baseUrl，baseUrl指定了你的data参数中数据是以什么地址为基准的，因为data中的数据可能会有超链接或者是image元素，而很多网站的地址都是用的相对路径，如果没有baseUrl，<a id="3_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=web&amp;k0=web&amp;k1=java&amp;k2=xml&amp;k3=%D7%E9%BC%FE&amp;k4=api&amp;k5=ios&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=2&amp;seller_id=1&amp;di=128" target="_blank">web</a>view将访问不到这些资源。

举个例子：
<div>
<div id="highlighter_531388">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div></td>
<td>
<div>
<div><code>String body =</code><code>"示例：这里有个img标签，地址是相对路径&lt;img src='/uploads/allimg/130923/1FP02V7-0.png' /&gt;"</code><code>;</code></div>
<div><code>mWebView.loadDataWithBaseURL(</code><code>"<a href="http://www.jcodecraeer.com/">http://www.jcodecraeer.com</a>"</code><code>, body, </code><code>"text/html"</code><code>, </code><code>"utf-8"</code><code>,</code><code>null</code><code>);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
如果baseUrl没有指定为http://www.jcodecraeer.com，那么这张图片将显示不出来。

上面的例子其实演示了loadDataWithBaseURL的用法，我们直接加载一个字符串里面的html内容，而有些时候这些内容是从assets目录下的本地网页文件中读取，下面我们将<code>html/test1.html中的内容通过LoadData来加载：</code>

[codesyntax lang="java"]
<pre>String data = "";
try {
    // 读取assets目录下的文件需要用到AssetManager对象的Open方法打开文件
    InputStream is = getAssets().open("html/test2.html");
    // loadData()方法需要的是一个字符串数据所以我们需要把文件转成字符串
    ByteArrayBuffer baf = new ByteArrayBuffer(500);
    int count = 0;
    while ((count = is.read()) != -1) {
        baf.append(count);
    }
    data = EncodingUtils.getString(baf.toByteArray(), "utf-8");
} catch (IOException e) {
    e.printStackTrace();
}
// 下面两种方法都可以加载成功
mWebView.loadData(data, "text/html", "utf-8");
// wv.loadDataWithBaseURL("", data, "text/html", "utf-8", "");</pre>
[/codesyntax]

<code></code>这种通过读取文件再用<code>loadData</code>加载其实和<code>mWebView.loadUrl(</code><code>"file:///<a id="0_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=android&amp;k0=android&amp;k1=web&amp;k2=java&amp;k3=xml&amp;k4=%D7%E9%BC%FE&amp;k5=api&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=1&amp;seller_id=1&amp;di=128" target="_blank">android</a>_asset/html/test1.html"</code><code>)是一致的，只不过<code>loadData</code>方式因为没有指定地址的基准url，<code>html/test1.html</code>文件中一些资源文件或者链接地址会失效。</code>
<div>
<div><code></code><code></code>loadDataWithBaseURL和loadData两个方法加载的HTML代码片段的不同点在于，loadData()中的html data中不能包含'#', '%', '\', '?'四中特殊字符，在平时测试时，你的数据时，你的数据里含有这些字符，但不会出问题，当出问题时，你可以替换下。</div>
</div>
%，会报找不到页面错误，页面全是乱码。乱码样式见符件。

#，会让你的goBack失效，但canGoBAck是可以使用的。于是就会产生返回<a id="1_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%B0%B4%C5%A5&amp;k0=%B0%B4%C5%A5&amp;k1=android&amp;k2=web&amp;k3=java&amp;k4=xml&amp;k5=%D7%E9%BC%FE&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=10&amp;seller_id=1&amp;di=128" target="_blank">按钮</a>生效，但不能返回的情况。

</div>
<strong>WebView内容的处理</strong>

&nbsp;

<strong>android 中webView控件 padding不起作用</strong>
在一个布局文件中有一个WebView，想使用padding属性让左右向内留出一些空白，但是padding属性不起左右，内容照样贴边显示，反而移动了右边滚动条的位置。<a id="12_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=android&amp;k0=android&amp;k1=web&amp;k2=java&amp;k3=xml&amp;k4=%D7%E9%BC%FE&amp;k5=api&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=1&amp;seller_id=1&amp;di=128" target="_blank">android</a>的bug，用一个外围的layout包含webview，可以有所改进，但不能完全解决。其实正确的做法是在webView的加载的css中增加padding,没必要为了padding而更改<a id="13_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=xml&amp;k0=xml&amp;k1=%D7%E9%BC%FE&amp;k2=api&amp;k3=ios&amp;k4=open&amp;k5=%E4%AF%C0%C0%C6%F7&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=4&amp;seller_id=1&amp;di=128" target="_blank">xml</a>布局文件。
<strong>重写shouldOverrideUrlLoading时指定url</strong>

指定只有url里包含eoe.cn的时候才在<a id="10_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=web&amp;k0=web&amp;k1=java&amp;k2=xml&amp;k3=%D7%E9%BC%FE&amp;k4=api&amp;k5=ios&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=2&amp;seller_id=1&amp;di=128" target="_blank">web</a>view里打开，否则还是启动<a id="11_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=%E4%AF%C0%C0%C6%F7&amp;k0=%E4%AF%C0%C0%C6%F7&amp;k1=%B0%B4%C5%A5&amp;k2=android&amp;k3=web&amp;k4=java&amp;k5=xml&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=9&amp;seller_id=1&amp;di=128" target="_blank">浏览器</a>打开.
<div>
<div id="highlighter_881593">[codesyntax lang="java"]
<pre>@Override
public boolean shouldOverrideUrlLoading(WebView view, String url) {
    LogUtil.i(this, "url="   url);
    if ( url.contains("eoe.cn") == true){
        view.loadUrl(url);
        return true;
    }else{
        Intent in = new Intent (Intent.ACTION_VIEW , Uri.parse(url));
        startActivity(in);
        return true;
    }
}</pre>
[/codesyntax]</div>
</div>
android:scrollbarStyle控制滚动条位置

WebView有一个设置滚动条位置的属性：<a id="9_nwl" href="http://cpro.baidu.com/cpro/ui/uijs.php?rs=1&amp;u=http%3A%2F%2Fwww%2Ejcodecraeer%2Ecom%2Fa%2Fanzhuokaifa%2Fandroidkaifa%2F2013%2F1010%2F1569%2Ehtml&amp;p=baidu&amp;c=news&amp;n=10&amp;t=tpclicked3_hc&amp;q=01072140_cpr&amp;k=android&amp;k0=android&amp;k1=web&amp;k2=java&amp;k3=xml&amp;k4=%D7%E9%BC%FE&amp;k5=api&amp;sid=5ef3cc66dc7153b2&amp;ch=0&amp;tu=u1921070&amp;jk=fafbcfc0af468ed5&amp;cf=29&amp;rb=0&amp;fv=14&amp;stid=9&amp;urlid=0&amp;luki=1&amp;seller_id=1&amp;di=128" target="_blank">android</a>:scrollbarStyle 可以是insideOverlay可以是outsideOverlay，两个的区别是SCROLLBARS_INSIDE_OVERLAY的样式是滚动条在整个page里，类似css中的padding，看代码下的这个图吧，很清晰.

&nbsp;
<pre>mWebView.setScrollBarStyle(View.SCROLLBARS_OUTSIDE_OVERLAY);</pre>
mWebView.setScrollBarStyle(View.SCROLLBARS_INSIDE_OVERLAY);

<img title="Screen Shot 2013-02-23 at 9.30.00 PM.png" src="http://www.jcodecraeer.com/uploads/20131011/261381424147.png" alt="Screen Shot 2013-02-23 at 9.30.00 PM.png" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>103</wp:post_id>
		<wp:post_date>2015-01-27 10:14:06</wp:post_date>
		<wp:post_date_gmt>2015-01-27 02:14:06</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-webview%e5%85%a8%e9%9d%a2%e6%80%bb%e7%bb%93</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="webview"><![CDATA[WebView]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707477]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>IM即时通讯项目</title>
		<link>http://1.duoinfo.sinaapp.com/?p=111</link>
		<pubDate>Tue, 27 Jan 2015 10:22:19 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=111</guid>
		<description></description>
		<content:encoded><![CDATA[项目目前做到发送语音（完成）2015.01.27

<img src="http://img.blog.csdn.net/20150127181758774?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150127181818321?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150127181837135?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150127181854123?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150127181911564?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="http://img.blog.csdn.net/20150127181925105?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>111</wp:post_id>
		<wp:post_date>2015-01-27 18:22:19</wp:post_date>
		<wp:post_date_gmt>2015-01-27 10:22:19</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>im%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af%e9%a1%b9%e7%9b%ae</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="im"><![CDATA[IM]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<category domain="post_tag" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<category domain="category" nicename="%e9%a1%b9%e7%9b%ae"><![CDATA[项目]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707478]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Borderless button</title>
		<link>http://1.duoinfo.sinaapp.com/?p=125</link>
		<pubDate>Wed, 28 Jan 2015 02:29:24 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=125</guid>
		<description></description>
		<content:encoded><![CDATA[读Google的文档的时候发现的这个，想起来，我之前在即时通讯项目是这样干的，直接在button的xml属性中指定下面的属性：

android:background=null;

&nbsp;

One design that can be useful is a "borderless" button. Borderless buttons resemble basic buttons except that they have no borders or background but still change appearance during different states, such as when clicked.

To create a borderless button, apply the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/R.attr.html#borderlessButtonStyle" target="_blank">borderlessButtonStyle</a></code> style to the button. For example:

当使用无缝隙的button的时候，当他的state改变的时候，其appearance 回随着其一起改变。

[codesyntax lang="java"]
<pre>&lt;Button
    android:id="@+id/button_send"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="@string/button_send"
    android:onClick="sendMessage"
    style="?android:attr/borderlessButtonStyle" /&gt;</pre>
[/codesyntax]
<img src="http://img.blog.csdn.net/20150128101408405?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

获取焦点时：

<img src="http://img.blog.csdn.net/20150128101431993?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>125</wp:post_id>
		<wp:post_date>2015-01-28 10:29:24</wp:post_date>
		<wp:post_date_gmt>2015-01-28 02:29:24</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>borderless-button</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="borderless-button"><![CDATA[Borderless button]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707480]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>TextView的一些重要属性</title>
		<link>http://1.duoinfo.sinaapp.com/?p=128</link>
		<pubDate>Wed, 28 Jan 2015 02:34:36 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=128</guid>
		<description></description>
		<content:encoded><![CDATA[Here are some of the common input type values that define keyboard behaviors:

<dl><dt><code>"textCapSentences"</code></dt><dd>Normal text keyboard that capitalizes the first letter for each new sentence.（大写第一个字母）</dd><dt><code>"textCapWords"</code></dt><dd>Normal text keyboard that capitalizes every word. Good for titles or person names.（大写每一个字母）</dd><dt><code>"textAutoCorrect"</code></dt><dd>Normal text keyboard that corrects commonly misspelled words.</dd><dt><code>"textPassword"</code></dt><dd>Normal text keyboard, but the characters entered turn into dots.</dd><dt><code>"textMultiLine"</code></dt></dl>Normal text keyboard that allow users to input long strings of text that include line breaks (carriage returns).（处理很长的text）]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>128</wp:post_id>
		<wp:post_date>2015-01-28 10:34:36</wp:post_date>
		<wp:post_date_gmt>2015-01-28 02:34:36</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>textview%e7%9a%84%e4%b8%80%e4%ba%9b%e9%87%8d%e8%a6%81%e5%b1%9e%e6%80%a7</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="textview"><![CDATA[TextView]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707481]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>EditText的一些属性</title>
		<link>http://1.duoinfo.sinaapp.com/?p=131</link>
		<pubDate>Wed, 28 Jan 2015 02:55:33 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=131</guid>
		<description></description>
		<content:encoded><![CDATA[我在IM即时通讯项目中，想在输入文字的时候，输入法上面显示发送，然后去响应我的发送消息的事件，但是不知道怎么做，于是我去查下了EdiText的文档（Google  guide），获得了下面的消息：

&nbsp;
<h2 id="Actions">Specifying Keyboard Actions（指定action）</h2>

<hr />

<div><img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/ui/edittext-actionsend.png" alt="" />In addition to changing the keyboard's input type, Android allows you to specify an action to be made when users have completed their input. The action specifies the button that appears in place of the carriage return key and the action to be made, such as "Search" or "Send."

</div>
You can specify the action by setting the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> attribute. For example, here's how you can specify the Send action:

[codesyntax lang="java"]
<pre>&lt;EditText
    android:id="@+id/search"
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:hint="@string/search_hint"
    android:inputType="text"
    android:imeOptions="actionSend" /&gt;</pre>
[/codesyntax]

上面话的意思是只要在EditText下制定这样的一个属性：<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> 让他的值为actionSend即可。

同样如果添加搜索，只需要指定该属性的值为:actionSearch即可。

If you do not explicitly specify an input action then the system attempts to determine if there are any subsequent <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#attr_android:focusable" target="_blank"><code>android:focusable</code></a> fields. If any focusable fields are found following this one, the system applies the (@code actionNext} action to the current <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html" target="_blank">EditText</a></code> so the user can select Next to move to the next field. If there's no subsequent focusable field, the system applies the<code>"actionDone"</code> action. You can override this by setting the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> attribute to any other value such as <code>"actionSend"</code> or <code>"actionSearch"</code> or suppress the default behavior by using the<code>"actionNone"</code> action.
<h3 id="ActionEvent">Responding to action button events（相应事件）</h3>
If you have specified a keyboard action for the input method using <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> attribute (such as <code>"actionSend"</code>), you can listen for the specific action event using an<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.OnEditorActionListener.html" target="_blank">TextView.OnEditorActionListener</a></code>. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.OnEditorActionListener.html" target="_blank">TextView.OnEditorActionListener</a></code> interface provides a callback method called <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.OnEditorActionListener.html#onEditorAction(android.widget.TextView, int, android.view.KeyEvent)" target="_blank">onEditorAction()</a></code> that indicates the action type invoked with an action ID such as<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/inputmethod/EditorInfo.html#IME_ACTION_SEND" target="_blank">IME_ACTION_SEND</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/inputmethod/EditorInfo.html#IME_ACTION_SEARCH" target="_blank">IME_ACTION_SEARCH</a></code>.

&nbsp;

使用<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.OnEditorActionListener.html" target="_blank">TextView.OnEditorActionListener</a>来处理监听事件。

&nbsp;

For example, here's how you can listen for when the user clicks the Send button on the keyboard:
<pre>[codesyntax lang="java"]</pre>
<pre>EditText editText = (EditText) findViewById(R.id.search);
editText.setOnEditorActionListener(new OnEditorActionListener() {
    @Override
    public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
        boolean handled = false;
        if (actionId == EditorInfo.IME_ACTION_SEND) {
            sendMessage();
            handled = true;
        }
        return handled;
    }
});</pre>
<pre>[/codesyntax]</pre>
<h3 id="ActionLabel">Setting a custom action button label（给一个label）</h3>
If the keyboard is too large to reasonably share space with the underlying application (such as when a handset device is in landscape orientation) then fullscreen ("extract mode") is triggered. In this mode, a labeled action button is displayed next to the input. You can customize the text of this button by setting the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeActionLabel" target="_blank"><code>android:imeActionLabel</code></a> attribute:
<pre>[codesyntax lang="java"]</pre>
<pre>&lt;EditText
    android:id="@+id/launch_codes"
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:hint="@string/enter_launch_codes"
    android:inputType="number"
    android:imeActionLabel="@string/launch" /&gt;</pre>
<pre>[/codesyntax]</pre>
<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/ui/edittext-actionlabel.png" alt="" />

上面的综合的一个图：

&nbsp;

<img src="http://img.blog.csdn.net/20150128104143334?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<h2 id="Flags">Adding Other Keyboard Flags</h2>

<hr />

In addition to the actions you can specify with the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> attribute, you can add additional flags to specify other keyboard behaviors. All available flags are listed along with the actions in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> documentation.

For example, figure 5 shows how the system enables a fullscreen text field when a handset device is in landscape orientation (or the screen space is otherwise constrained for space). You can disable the fullscreen input mode with <code>flagNoExtractUi</code> in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html#attr_android:imeOptions" target="_blank"><code>android:imeOptions</code></a> attribute, as shown in figure 6.

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/ui/edittext-noextract.png" alt="" />

Figure The  text field ("extract mode") is disabled with<code>android:imeOptions="flagNoExtractUi"</code>.

&nbsp;

<img src="http://img.blog.csdn.net/20150128104409319?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<h2 id="AutoComplete">Providing Auto-complete Suggestions（自动提示）</h2>

<hr />

If you want to provide suggestions to users as they type, you can use a subclass of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html" target="_blank">EditText</a></code> called<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AutoCompleteTextView.html" target="_blank">AutoCompleteTextView</a></code>. To implement auto-complete, you must specify an (@link android.widget.Adapter) that provides the text suggestions. There are several kinds of adapters available, depending on where the data is coming from, such as from a database or an array.

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/ui/edittext-autocomplete.png" alt="" /><img src="http://img.blog.csdn.net/20150128104904269?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

The following procedure describes how to set up an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AutoCompleteTextView.html" target="_blank">AutoCompleteTextView</a></code> that provides suggestions from an array, using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ArrayAdapter.html" target="_blank">ArrayAdapter</a></code>:
<ol>
	<li>Add the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AutoCompleteTextView.html" target="_blank">AutoCompleteTextView</a></code> to your layout. Here's a layout with only the text field:
<pre>[codesyntax lang="xml"]</pre>
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AutoCompleteTextView xmlns:android="http://schemas.android.com/apk/res/android" 
    android:id="@+id/autocomplete_country"
    android:layout_width="fill_parent"
    android:layout_height="wrap_content" /&gt;</pre>
<pre>[/codesyntax]</pre>
</li>
	<li>Define the array that contains all text suggestions. For example, here's an array of country names that's defined in an XML resource file (<code>res/values/strings.xml</code>):
<pre>[codesyntax lang="xml"]</pre>
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;resources&gt;
    &lt;string-array name="countries_array"&gt;
        &lt;item&gt;Afghanistan&lt;/item&gt;
        &lt;item&gt;Albania&lt;/item&gt;
        &lt;item&gt;Algeria&lt;/item&gt;
        &lt;item&gt;American Samoa&lt;/item&gt;
        &lt;item&gt;Andorra&lt;/item&gt;
        &lt;item&gt;Angola&lt;/item&gt;
        &lt;item&gt;Anguilla&lt;/item&gt;
        &lt;item&gt;Antarctica&lt;/item&gt;
        ...
    &lt;/string-array&gt;
&lt;/resources&gt;</pre>
<pre>[/codesyntax]</pre>
</li>
	<li>In your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html" target="_blank">Activity</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html" target="_blank">Fragment</a></code>, use the following code to specify the adapter that supplies the suggestions:
<pre>[codesyntax lang="java"]</pre>
<pre>// Get a reference to the AutoCompleteTextView in the layout
AutoCompleteTextView textView = (AutoCompleteTextView) findViewById(R.id.autocomplete_country);
// Get the string array
String[] countries = getResources().getStringArray(R.array.countries_array);
// Create the adapter and set it to the AutoCompleteTextView 
ArrayAdapter&lt;String&gt; adapter = 
        new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, countries);
textView.setAdapter(adapter);</pre>
<pre>[/codesyntax]</pre>
Here, a new <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ArrayAdapter.html" target="_blank">ArrayAdapter</a></code> is initialized to bind each item in the <code>COUNTRIES</code> string array to a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/TextView.html" target="_blank">TextView</a></code> that exists in the <code>simple_list_item_1</code> layout (this is a layout provided by Android that provides a standard appearance for text in a list).

Then assign the adapter to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AutoCompleteTextView.html" target="_blank">AutoCompleteTextView</a></code> by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AutoCompleteTextView.html#setAdapter(T)" target="_blank">setAdapter()</a></code>.</li>
</ol>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>131</wp:post_id>
		<wp:post_date>2015-01-28 10:55:33</wp:post_date>
		<wp:post_date_gmt>2015-01-28 02:55:33</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>edittext%e7%9a%84%e4%b8%80%e4%ba%9b%e5%b1%9e%e6%80%a7</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="autocompletetextview"><![CDATA[AutoCompleteTextView]]></category>
		<category domain="post_tag" nicename="edittext"><![CDATA[EditText]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707482]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Picker(Time picker&amp;&amp; Date picker)</title>
		<link>http://1.duoinfo.sinaapp.com/?p=134</link>
		<pubDate>Wed, 28 Jan 2015 03:35:35 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=134</guid>
		<description></description>
		<content:encoded><![CDATA[<h1><span style="font-size: small;">Android provides controls for the user to pick a time or pick a date as ready-to-use dialogs. Each picker provides controls for selecting each part of the time (hour, minute, AM/PM) or date (month, day, year). Using these pickers helps ensure that your users can pick a time or date that is valid, formatted correctly, and adjusted to the user's locale.</span></h1>
<div id="jd-content">

<span style="font-size: small;">We recommend that you use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> to host each time or date picker. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> manages the dialog lifecycle for you and allows you to display the pickers in different layout configurations, such as in a basic dialog on handsets or as an embedded part of the layout on large screens.</span>

<span style="font-size: small;">推荐使用<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> 。</span>

<span style="font-size: small;">Although <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DialogFragment.html">DialogFragment</a></code> was first added to the platform in Android 3.0 (API level 11), if your app supports versions of Android older than 3.0—even as low as Android 1.6—you can use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> class that's available in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/index.html">support library</a> for backward compatibility.</span>

<span style="font-size: small;">Note: The code samples below show how to create dialogs for a time picker and date picker using the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/index.html">support library</a> APIs for <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code>. If your app's <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/uses-sdk-element.html#min"><code>minSdkVersion</code></a> is 11 or higher, you can instead use the platform version of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DialogFragment.html">DialogFragment</a></code>.</span>
<h2 id="TimePicker"><span style="font-size: small;">Creating a Time Picker</span></h2>

<hr />

<span style="font-size: small;">To display a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.html">TimePickerDialog</a></code> using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code>, you need to define a fragment class that extends<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> and return a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.html">TimePickerDialog</a></code> from the fragment's <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#onCreateDialog(android.os.Bundle)">onCreateDialog()</a></code> method.</span>

<span style="font-size: small;">Note: If your app supports versions of Android older than 3.0, be sure you've set up your Android project with the support library as described in <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/setup.html">Setting Up a Project to Use a Library</a>.</span>
<h3 id="TimePickerFragment"><span style="font-size: small;">Extending DialogFragment for a time picker</span></h3>
<span style="font-size: small;">To define a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> for a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.html">TimePickerDialog</a></code>, you must:</span>
<ul>
	<li><span style="font-size: small;">Define the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#onCreateDialog(android.os.Bundle)">onCreateDialog()</a></code> method to return an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.html">TimePickerDialog</a></code></span></li>
	<li><span style="font-size: small;">Implement the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.OnTimeSetListener.html">TimePickerDialog.OnTimeSetListener</a></code> interface to receive a callback when the user sets the time.</span></li>
</ul>
<span style="font-size: small;">Here's an example:</span>
<pre>[codesyntax lang="java"]</pre>
<pre>package com.dystu.pickerdemo;

import java.util.Calendar;

import android.app.Dialog;
import android.app.DialogFragment;
import android.app.Fragment;
import android.app.TimePickerDialog;
import android.app.TimePickerDialog.OnTimeSetListener;
import android.os.Bundle;
import android.text.format.DateFormat;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TimePicker;

public class TimePickerFragment extends DialogFragment implements
		OnTimeSetListener {

	static TimePickerFragment newInstance() {
		TimePickerFragment fragment = new TimePickerFragment();

		return fragment;
	}

	@Override
	public Dialog onCreateDialog(Bundle savedInstanceState) {

		// Use the current time as the default values for the picker
		final Calendar c = Calendar.getInstance();
		int hour = c.get(Calendar.HOUR_OF_DAY);
		int minute = c.get(Calendar.MINUTE);

		// Create a new instance of TimePickerDialog and return it
		return new TimePickerDialog(getActivity(), this, hour, minute,
				DateFormat.is24HourFormat(getActivity()));
	}

	@Override
	public View onCreateView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		return super.onCreateView(inflater, container, savedInstanceState);
	}

	@Override
	public void onTimeSet(TimePicker view, int hourOfDay, int minute) {

	}

}</pre>
<pre>[/codesyntax]</pre>
<pre></pre>
<pre>[codesyntax lang="java"]</pre>
<pre>package com.dystu.pickerdemo;

import android.app.Activity;
import android.os.Bundle;

public class MainActivity extends Activity {

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
	/*	TimePickerFragment fragment = TimePickerFragment.newInstance();
		fragment.show(getFragmentManager(), "timerpicker");*/

		DatePickerFragment fragment = DatePickerFragment.newInstance();
		fragment.show(getFragmentManager(), "datepicker");

	}
}</pre>
<pre>[/codesyntax]</pre>
<span style="font-size: small;">需要注意的是：如果低于3.0，需要使用<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html#getSupportFragmentManager()">getSupportFragmentManager()</a>来代替getFragmentManager()并且要继承FragmentActivity而不是Activity。</span>

<span style="font-size: small;">效果：</span>

<span style="font-size: small;"><img src="http://img.blog.csdn.net/20150128112628906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
</span>

<span style="font-size: small;">Caution: If your app supports versions of Android lower than 3.0, be sure that you call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html#getSupportFragmentManager()">getSupportFragmentManager()</a></code> to acquire an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code>. Also make sure that your activity that displays the time picker extends <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html">FragmentActivity</a></code> instead of the standard <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>class.</span>
<h2 id="DatePicker"><span style="font-size: small;">Creating a Date Picker</span></h2>

<hr />

<span style="font-size: small;">Creating a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.html">DatePickerDialog</a></code> is just like creating a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/TimePickerDialog.html">TimePickerDialog</a></code>. The only difference is the dialog you create for the fragment.</span>

<span style="font-size: small;">To display a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.html">DatePickerDialog</a></code> using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code>, you need to define a fragment class that extends<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> and return a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.html">DatePickerDialog</a></code> from the fragment's <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#onCreateDialog(android.os.Bundle)">onCreateDialog()</a></code> method.</span>

<span style="font-size: small;">Note: If your app supports versions of Android older than 3.0, be sure you've set up your Android project with the support library as described in <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/setup.html">Setting Up a Project to Use a Library</a>.</span>
<h3 id="DatePickerFragment"><span style="font-size: small;">Extending DialogFragment for a date picker</span></h3>
<span style="font-size: small;">To define a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> for a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.html">DatePickerDialog</a></code>, you must:</span>
<ul>
	<li><span style="font-size: small;">Define the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#onCreateDialog(android.os.Bundle)">onCreateDialog()</a></code> method to return an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.html">DatePickerDialog</a></code></span></li>
	<li><span style="font-size: small;">Implement the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/DatePickerDialog.OnDateSetListener.html">DatePickerDialog.OnDateSetListener</a></code> interface to receive a callback when the user sets the date.</span></li>
</ul>
[codesyntax lang="java"]
<pre>package com.dystu.pickerdemo;

import java.util.Calendar;

import android.app.DatePickerDialog;
import android.app.Dialog;
import android.app.DialogFragment;
import android.app.Fragment;
import android.app.TimePickerDialog;
import android.app.TimePickerDialog.OnTimeSetListener;
import android.os.Bundle;
import android.text.format.DateFormat;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.DatePicker;
import android.widget.TimePicker;

public class DatePickerFragment extends DialogFragment  implements DatePickerDialog.OnDateSetListener {

	static DatePickerFragment newInstance() {
		DatePickerFragment fragment = new DatePickerFragment();

		return fragment;
	}

	 @Override
	    public Dialog onCreateDialog(Bundle savedInstanceState) {
	        // Use the current date as the default date in the picker
	        final Calendar c = Calendar.getInstance();
	        int year = c.get(Calendar.YEAR);
	        int month = c.get(Calendar.MONTH);
	        int day = c.get(Calendar.DAY_OF_MONTH);

	        // Create a new instance of DatePickerDialog and return it
	        return new DatePickerDialog(getActivity(), this, year, month, day);
	    }

	    public void onDateSet(DatePicker view, int year, int month, int day) {
	    }
}</pre>
[/codesyntax]

<span style="font-size: small;">This method calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#show(android.support.v4.app.FragmentManager, java.lang.String)">show()</a></code> on a new instance of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html">DialogFragment</a></code> defined above. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/DialogFragment.html#show(android.support.v4.app.FragmentManager, java.lang.String)">show()</a></code> method requires an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code> and a unique tag name for the fragment.</span>

<span style="font-size: small;">效果图：</span>

<span style="font-size: small;"><img src="http://img.blog.csdn.net/20150128113039135?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
</span>

<span style="font-size: small;">Caution: If your app supports versions of Android lower than 3.0, be sure that you call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html#getSupportFragmentManager()">getSupportFragmentManager()</a></code> to acquire an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code>. Also make sure that your activity that displays the time picker extends <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html">FragmentActivity</a></code> instead of the standard <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>class.</span>

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>134</wp:post_id>
		<wp:post_date>2015-01-28 11:35:35</wp:post_date>
		<wp:post_date_gmt>2015-01-28 03:35:35</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>134</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="date-picker"><![CDATA[Date picker]]></category>
		<category domain="post_tag" nicename="picker"><![CDATA[Picker]]></category>
		<category domain="post_tag" nicename="time-picker"><![CDATA[Time Picker]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707483]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>合肥雪景</title>
		<link>http://1.duoinfo.sinaapp.com/?p=138</link>
		<pubDate>Wed, 28 Jan 2015 10:40:03 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=138</guid>
		<description></description>
		<content:encoded><![CDATA[&nbsp;

&nbsp;

合肥昨晚下雪啦！（图片来自科大校友微信公众账号和合肥晚报）

&nbsp;

<img src="http://img.blog.csdn.net/20150128182905444?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128182920765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128183036502?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128183047984?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128183206795?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

<img src="http://img.blog.csdn.net/20150128183410484?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

<img src="http://img.blog.csdn.net/20150128183633586?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128183741468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

&nbsp;

&nbsp;

<img src="http://img.blog.csdn.net/20150128183832349?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>138</wp:post_id>
		<wp:post_date>2015-01-28 18:40:03</wp:post_date>
		<wp:post_date_gmt>2015-01-28 10:40:03</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%90%88%e8%82%a5%e9%9b%aa%e6%99%af</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%94%b6%e8%97%8f"><![CDATA[收藏]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707484]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>4</wp:comment_id>
			<wp:comment_author><![CDATA[吊炸天]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url></wp:comment_author_url>
			<wp:comment_author_IP>61.190.88.149</wp:comment_author_IP>
			<wp:comment_date>2015-01-28 21:08:28</wp:comment_date>
			<wp:comment_date_gmt>2015-01-28 13:08:28</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[  ]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_parent_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707456]]></wp:meta_value>
			</wp:commentmeta>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_post_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707459]]></wp:meta_value>
			</wp:commentmeta>
		</wp:comment>
	</item>
	<item>
		<title>Android自定义控件---优酷菜单</title>
		<link>http://1.duoinfo.sinaapp.com/?p=143</link>
		<pubDate>Wed, 28 Jan 2015 12:01:16 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=143</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="font-size: small;">实现的效果图：</span>

<span style="font-size: small;"><img src="http://img.blog.csdn.net/20150128195245015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
</span>

<span style="font-size: small;">逻辑并不是很难，主要有三点：</span>

<span style="font-size: small;">1.他的布局</span>

<span style="font-size: small;">2.动画的原理</span>

<span style="font-size: small;">3.onkeydown监听menu按键的事件</span>

<span style="font-size: small;">
</span>

<span style="font-size: small;">第一个：</span>

[codesyntax lang="xml"]
<pre>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context="${relativePackage}.${activityClass}" &gt;

    &lt;RelativeLayout
        android:id="@+id/level1"
        android:layout_width="100dp"
        android:layout_height="50dp"
        android:layout_alignParentBottom="true"
        android:layout_centerHorizontal="true"
        android:background="@drawable/level1" &gt;

        &lt;ImageView
            android:id="@+id/icon_home"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_centerInParent="true"
            android:background="@drawable/icon_home" /&gt;
    &lt;/RelativeLayout&gt;

    &lt;RelativeLayout
        android:id="@+id/level2"
        android:layout_width="180dp"
        android:layout_height="90dp"
        android:layout_alignParentBottom="true"
        android:layout_centerHorizontal="true"
        android:background="@drawable/level2" &gt;
         &lt;ImageView
            android:id="@+id/icon_search"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentBottom="true"
            android:layout_margin="10dp"
            android:background="@drawable/icon_search" /&gt;
          &lt;ImageView
            android:id="@+id/icon_menu"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_centerHorizontal="true"
            android:layout_marginTop="5dp"
            android:background="@drawable/icon_menu" /&gt;
           &lt;ImageView
            android:id="@+id/icon_myyouku"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentBottom="true"
            android:layout_alignParentRight="true"
            android:layout_margin="10dp"
            android:background="@drawable/icon_myyouku" /&gt;

    &lt;/RelativeLayout&gt;

    &lt;RelativeLayout
        android:id="@+id/level3"
        android:layout_width="280dp"
        android:layout_height="140dp"
        android:layout_alignParentBottom="true"
        android:layout_centerHorizontal="true"
        android:background="@drawable/level3" &gt;

         &lt;ImageView
            android:id="@+id/channel1"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentBottom="true"
             android:layout_marginLeft="10dp"
            android:layout_marginBottom="10dp"
            android:background="@drawable/channel1" /&gt;
          &lt;ImageView
            android:id="@+id/channel2"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_above="@id/channel1"
            android:layout_alignLeft="@id/channel1"
            android:layout_marginLeft="20dp"
            android:layout_marginBottom="6dp"
            android:background="@drawable/channel2" /&gt;
         &lt;!--   android:layout_alignLeft="@id/channel1" 和channel1控件左边对齐--&gt;
         &lt;ImageView
            android:id="@+id/channel3"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_above="@id/channel2"
            android:layout_alignLeft="@id/channel2"
            android:layout_marginLeft="30dp"
            android:layout_marginBottom="6dp"
            android:background="@drawable/channel3" /&gt;
           &lt;ImageView
            android:id="@+id/channel4"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_centerHorizontal="true"
            android:layout_marginTop="5dp"
            android:background="@drawable/channel4" /&gt;

           &lt;ImageView
            android:id="@+id/channel5"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_above="@+id/channel6"
            android:layout_alignRight="@+id/channel6"
            android:layout_marginRight="30dp"
            android:layout_marginBottom="6dp"
            android:background="@drawable/channel5" /&gt;

             &lt;ImageView
            android:id="@+id/channel6"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_above="@+id/channel7"
            android:layout_alignRight="@+id/channel7"
            android:layout_marginRight="20dp"
            android:layout_marginBottom="6dp"
            android:background="@drawable/channel6" /&gt;

           &lt;ImageView
            android:id="@+id/channel7"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentBottom="true"
            android:layout_alignParentRight="true"
             android:layout_marginRight="10dp"
            android:layout_marginBottom="10dp"
            android:background="@drawable/channel7" /&gt;

    &lt;/RelativeLayout&gt;

&lt;/RelativeLayout&gt;</pre>
[/codesyntax]
<pre></pre>
<span style="font-size: small;">
第二个：</span>

&nbsp;

<span style="font-size: small;"><img src="http://img.blog.csdn.net/20150128195610174?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
</span>

<span style="font-size: small;">
</span>

<span style="font-size: small;">
</span>
<pre></pre>
<h2><span style="font-size: small;">[codesyntax lang="java"]</span></h2>
<pre>package com.dystu.youkudemo;

import android.view.animation.RotateAnimation;
import android.widget.RelativeLayout;

public class MyUtils {

	/**
	 * 
	 * 旋转离开的动画
	 * 
	 * @param view
	 */
	public static void startAnimationOut(RelativeLayout view) {

		/**
		 * 
		 * 默认圆心为View的左上角
		 * 
		 * 水平向右:0度 顺时针旋转度数增加
		 * 
		 * 
		 */
		RotateAnimation animation = new RotateAnimation(0, 180,
				view.getWidth() / 2, view.getHeight());

		animation.setDuration(500);

		//动画执行完以后，保持最后的状态
		animation.setFillAfter(true);

		view.startAnimation(animation);

	}

	/**
	 * 
	 * 旋转进入的动画
	 * 
	 * @param view
	 */
	public static void startAnimationIn(RelativeLayout view) {
		RotateAnimation animation = new RotateAnimation(180, 360,
				view.getWidth() / 2, view.getHeight());

		animation.setDuration(500);

		animation.setFillAfter(true);

		view.startAnimation(animation);
	}

	/**
	 * 
	 * 让指定view延时执行旋转离开的方法
	 * 
	 * @param level3
	 * @param i  延时的时间
	 */
	public static void startAnimationOut(RelativeLayout view, long offset) {
		/**
		 * 
		 * 默认圆心为View的左上角
		 * 
		 * 水平向右:0度 顺时针旋转度数增加
		 * 
		 * 
		 */
		RotateAnimation animation = new RotateAnimation(0, 180,
				view.getWidth() / 2, view.getHeight());

		animation.setDuration(500);

		//动画执行完以后，保持最后的状态
		animation.setFillAfter(true);
		//设置延时执行的动画
		animation.setStartOffset(offset);

		view.startAnimation(animation);
	}

}</pre>
<h2><span style="font-size: small;">[/codesyntax]
3.</span></h2>
<div>
<pre>[codesyntax lang="java"]</pre>
<pre>package com.dystu.youkudemo;

import android.app.Activity;
import android.os.Bundle;
import android.view.KeyEvent;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.ArrayAdapter;
import android.widget.AutoCompleteTextView;
import android.widget.ImageView;
import android.widget.RelativeLayout;

public class MainActivity extends Activity implements OnClickListener {

	private ImageView icon_menu, icon_home;

	private RelativeLayout level1;
	private RelativeLayout level2;
	private RelativeLayout level3;

	// 用于判断第三级菜单是否显示 默认是显示的(true)
	private boolean isLevel3Show = true;
	private boolean isLevel2Show = true;
	private boolean isLevel1Show = true;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);

		icon_home = (ImageView) findViewById(R.id.icon_home);
		icon_menu = (ImageView) findViewById(R.id.icon_menu);

		level1 = (RelativeLayout) findViewById(R.id.level1);
		level2 = (RelativeLayout) findViewById(R.id.level2);
		level3 = (RelativeLayout) findViewById(R.id.level3);

		icon_home.setOnClickListener(this);
		icon_menu.setOnClickListener(this);

	}

	@Override
	public void onClick(View v) {
		switch (v.getId()) {
		case R.id.icon_menu:

			// 如果第三级菜单是显示状态，则隐藏，反之，则显示；

			if (isLevel3Show) {
				// 隐藏第三级菜单

				MyUtils.startAnimationOut(level3);

			} else {

				// 显示

				MyUtils.startAnimationIn(level3);

			}
			isLevel3Show = !isLevel3Show;

			break;
		case R.id.icon_home:

			// 如果二级菜单是显示状态，那么就隐藏2,3级菜单；
			// 如果二级菜单是隐藏状态，那么就显示2级菜单。
			if (isLevel2Show) {
				MyUtils.startAnimationOut(level2);
				isLevel2Show = false;
				if (isLevel3Show) {
					// 如果第三级菜单也显示，那也将其隐藏

					MyUtils.startAnimationOut(level3);
					isLevel3Show = false;
				}

			} else {
				MyUtils.startAnimationIn(level2);

				isLevel2Show = true;

			}

			break;

		default:
			break;
		}
	}

	/**
	 * 
	 * 监听menu按键的事件
	 * 
	 */
	@Override
	public boolean onKeyDown(int keyCode, KeyEvent event) {

		if (keyCode == KeyEvent.KEYCODE_MENU) {
			changeLevel1State();
		}

		return super.onKeyDown(keyCode, event);
	}

	/**
	 * 
	 * 
	 * 改变第一级菜单的状态
	 * 
	 */
	private void changeLevel1State() {

		// 如果第一级菜单是显示状态 那么隐藏1,2,3级菜单
		// 如果第一级菜单是隐藏状态，那么显示1,2级菜单
		if (isLevel1Show) {

			MyUtils.startAnimationOut(level1);
			isLevel1Show = false;
			if (isLevel2Show) {
				MyUtils.startAnimationOut(level2);
				isLevel2Show = false;

				if (isLevel3Show) {

					MyUtils.startAnimationOut(level3);

					isLevel3Show = false;

				}

			}

		} else {

			MyUtils.startAnimationIn(level1);
			isLevel1Show = true;
			MyUtils.startAnimationIn(level2);
			isLevel2Show = true;

		}
	}

}</pre>
<pre>[/codesyntax]</pre>
</div>
<span style="font-size: small;">
</span>

<span style="font-size: small;">
</span>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>143</wp:post_id>
		<wp:post_date>2015-01-28 20:01:16</wp:post_date>
		<wp:post_date_gmt>2015-01-28 12:01:16</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6-%e4%bc%98%e9%85%b7%e8%8f%9c%e5%8d%95</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="%e4%bc%98%e9%85%b7%e8%8f%9c%e5%8d%95"><![CDATA[优酷菜单]]></category>
		<category domain="post_tag" nicename="%e6%97%8b%e8%bd%ac%e5%8a%a8%e7%94%bb"><![CDATA[旋转动画]]></category>
		<category domain="post_tag" nicename="%e7%9b%b8%e5%af%b9%e5%b8%83%e5%b1%80"><![CDATA[相对布局]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707485]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android自定义控件---广告条滚动</title>
		<link>http://1.duoinfo.sinaapp.com/?p=145</link>
		<pubDate>Wed, 28 Jan 2015 13:21:05 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=145</guid>
		<description></description>
		<content:encoded><![CDATA[实现后的效果：

<img src="http://img.blog.csdn.net/20150128211041015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

1.布局：

[codesyntax lang="xml"]
<pre>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context="${relativePackage}.${activityClass}" &gt;

    &lt;android.support.v4.view.ViewPager
        android:id="@+id/viewpager"
        android:layout_width="match_parent"
        android:layout_height="200dp"

        /&gt;

     &lt;LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_alignBottom="@id/viewpager"
        android:background="#33000000"
        android:orientation="vertical" &gt;

        &lt;TextView
            android:id="@+id/image_desc"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:gravity="center"
            android:text="@string/app_name"
            android:textColor="@android:color/white"
            android:textSize="18sp" /&gt;

        &lt;LinearLayout
            android:orientation="horizontal"
            android:id="@+id/point_group"
            android:layout_width="wrap_content"
            android:layout_gravity="center_horizontal"
            android:layout_height="wrap_content" &gt;
        &lt;/LinearLayout&gt;
    &lt;/LinearLayout&gt;

&lt;/RelativeLayout&gt;</pre>
[/codesyntax]
<pre></pre>
2.ViewPager的适配器：

&nbsp;

[codesyntax lang="java"]
<pre>private class MyPagerAdapter extends PagerAdapter {

		/**
		 * 获得页面的总数
		 */
		@Override
		public int getCount() {
			return Integer.MAX_VALUE;
		}

		/**
		 * 获得相应位置上的view container view的容器，其实就是viewpager自身 position 相应的位置
		 */
		@Override
		public Object instantiateItem(ViewGroup container, int position) {

			// 给 container 添加一个view
			container.addView(imageList.get(position % imageList.size()));
			// 返回一个和该view相对的object
			return imageList.get(position % imageList.size());
		}

		/**
		 * 判断 view和object的对应关系
		 */
		@Override
		public boolean isViewFromObject(View view, Object object) {
			if (view == object) {
				return true;
			} else {
				return false;
			}
		}

		/**
		 * 销毁对应位置上的object
		 */
		@Override
		public void destroyItem(ViewGroup container, int position, Object object) {

			container.removeView((View) object);
			object = null;
		}

	}</pre>
[/codesyntax]

&nbsp;

3.ViewPager的监听器：

&nbsp;
<pre>[codesyntax lang="java"]</pre>
<pre>viewPager.setOnPageChangeListener(new OnPageChangeListener() {
			/**
			 * 
			 * 页面切换后调用
			 * 
			 * @param position
			 */
			@Override
			public void onPageSelected(int position) {
				position = position%imageList.size();

				//设置文字描述内容
				imageDesc.setText(imageDescriptions[position]);

				//改变指示点的状态
				//把当前点enbale 为true 
				pointGroup.getChildAt(position).setEnabled(true);
				//把上一个点设为false
				pointGroup.getChildAt(lastPosition).setEnabled(false);
				lastPosition = position;
			}
			/**
			 * 页面正在滑动的时候，回调
			 */
			@Override
			public void onPageScrolled(int position, float positionOffset,
					int positionOffsetPixels) {

			}
			/**
			 * 当页面状态发生变化的时候，回调
			 */
			@Override
			public void onPageScrollStateChanged(int state) {

			}
		});</pre>
<pre>[/codesyntax]</pre>
4.Handler自动：

&nbsp;

[codesyntax lang="java"]
<pre>	private Handler handler = new Handler(){
		public void handleMessage(android.os.Message msg) {

			//让viewPager 滑动到下一页
			viewPager.setCurrentItem(viewPager.getCurrentItem()+1);
			if(isRunning){
				handler.sendEmptyMessageDelayed(0, 2000);
			}
		};
	};</pre>
[/codesyntax]
整个逻辑：

&nbsp;

&nbsp;
<pre>[codesyntax lang="java"]</pre>
<pre>package com.dystu.adverdemo;

import java.util.ArrayList;

import android.app.Activity;
import android.os.Bundle;
import android.os.Handler;
import android.support.v4.view.PagerAdapter;
import android.support.v4.view.ViewPager;
import android.support.v4.view.ViewPager.OnPageChangeListener;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

public class MainActivity extends Activity {

	private ViewPager viewPager;

	private LinearLayout pointGroup;

	private TextView imageDesc;

	// 图片资源ID
	private final int[] imageIds = { R.drawable.a, R.drawable.b, R.drawable.c,
			R.drawable.d, R.drawable.e };

	// 图片标题集合
	private final String[] imageDescriptions = { "巩俐不低俗，我就不能低俗",
			"扑树又回来啦！再唱经典老歌引万人大合唱", "揭秘北京电影如何升级", "乐视网TV版大派送", "热血屌丝的反杀" };

	private ArrayList&lt;ImageView&gt; imageList;

	/**
	 * 上一个页面的位置
	 */
	protected int lastPosition;

	MyPagerAdapter pageAdapter;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		viewPager = (ViewPager) findViewById(R.id.viewpager);
		pointGroup = (LinearLayout) findViewById(R.id.point_group);
		imageDesc = (TextView) findViewById(R.id.image_desc);

		imageList = new ArrayList&lt;ImageView&gt;();

		imageDesc.setText(imageDescriptions[0]);

		for (int i = 0; i &lt; imageIds.length; i++) {

			ImageView image = new ImageView(this);
			image.setBackgroundResource(imageIds[i]);

			imageList.add(image);

			//添加指示点
			ImageView point =new ImageView(this);
			LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(
					LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT);

			params.rightMargin = 20;
			point.setLayoutParams(params);

			point.setBackgroundResource(R.drawable.point_bg);
			if(i==0){
				point.setEnabled(true);
			}else{
				point.setEnabled(false);
			}
			pointGroup.addView(point);
		}
		pageAdapter = new MyPagerAdapter();

		viewPager.setAdapter(pageAdapter);

		viewPager.setOnPageChangeListener(new OnPageChangeListener() {
			/**
			 * 
			 * 页面切换后调用
			 * 
			 * @param position
			 */
			@Override
			public void onPageSelected(int position) {
				position = position%imageList.size();

				//设置文字描述内容
				imageDesc.setText(imageDescriptions[position]);

				//改变指示点的状态
				//把当前点enbale 为true 
				pointGroup.getChildAt(position).setEnabled(true);
				//把上一个点设为false
				pointGroup.getChildAt(lastPosition).setEnabled(false);
				lastPosition = position;
			}
			/**
			 * 页面正在滑动的时候，回调
			 */
			@Override
			public void onPageScrolled(int position, float positionOffset,
					int positionOffsetPixels) {

			}
			/**
			 * 当页面状态发生变化的时候，回调
			 */
			@Override
			public void onPageScrollStateChanged(int state) {

			}
		});
		 /*
		  * 自动循环：
		  * 1、定时器：Timer
		  * 2、开子线程 while  true 循环
		  * 3、ColckManager 
		  * 4、 用handler 发送延时信息，实现循环
		  */
		 isRunning = true;
		 handler.sendEmptyMessageDelayed(0, 2000);

	}
	/**
	 * 判断是否自动滚动
	 */
	private boolean isRunning = false;

	private Handler handler = new Handler(){
		public void handleMessage(android.os.Message msg) {

			//让viewPager 滑动到下一页
			viewPager.setCurrentItem(viewPager.getCurrentItem()+1);
			if(isRunning){
				handler.sendEmptyMessageDelayed(0, 2000);
			}
		};
	};

	protected void onDestroy() {

		isRunning = false;
	};
	private class MyPagerAdapter extends PagerAdapter {

		/**
		 * 获得页面的总数
		 */
		@Override
		public int getCount() {
			return Integer.MAX_VALUE;
		}

		/**
		 * 获得相应位置上的view container view的容器，其实就是viewpager自身 position 相应的位置
		 */
		@Override
		public Object instantiateItem(ViewGroup container, int position) {

			// 给 container 添加一个view
			container.addView(imageList.get(position % imageList.size()));
			// 返回一个和该view相对的object
			return imageList.get(position % imageList.size());
		}

		/**
		 * 判断 view和object的对应关系
		 */
		@Override
		public boolean isViewFromObject(View view, Object object) {
			if (view == object) {
				return true;
			} else {
				return false;
			}
		}

		/**
		 * 销毁对应位置上的object
		 */
		@Override
		public void destroyItem(ViewGroup container, int position, Object object) {

			container.removeView((View) object);
			object = null;
		}

	}

}</pre>
<pre>[/codesyntax]</pre>
&nbsp;

原点创建一个shape文件即可，状态不同，用selector.
<div></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>145</wp:post_id>
		<wp:post_date>2015-01-28 21:21:05</wp:post_date>
		<wp:post_date_gmt>2015-01-28 13:21:05</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6-%e5%b9%bf%e5%91%8a%e6%9d%a1%e6%bb%9a%e5%8a%a8</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="%e5%b9%bf%e5%91%8a%e6%9d%a1"><![CDATA[广告条]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707486]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android自定义控件—下拉菜单</title>
		<link>http://1.duoinfo.sinaapp.com/?p=147</link>
		<pubDate>Wed, 28 Jan 2015 13:38:23 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=147</guid>
		<description></description>
		<content:encoded><![CDATA[效果图：

<img src="http://img.blog.csdn.net/20150128213529650?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

实现思路是：EditText+PopupWindow+ListView（PopupWindow接触的少，注意下他的用法）

[codesyntax lang="java"]
<pre>package com.dystu.edittextdemo;

import java.util.ArrayList;
import java.util.List;

import android.app.Activity;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.PopupWindow;
import android.widget.TextView;

public class MainActivity extends Activity {

	private EditText input;

	private ImageView downArrow;

	private List&lt;String&gt; msgList;

	private PopupWindow popWin;

	private ListView listView;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);

		input = (EditText) findViewById(R.id.input);
		downArrow = (ImageView) findViewById(R.id.down_arrow);

		msgList = new ArrayList&lt;String&gt;();

		for (int i = 0; i &lt; 20; i++) {
			msgList.add("1000000000"+i);
		}

		initListView();

		downArrow.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {

				System.out.println("=======");
				//定义 popupWindow
				popWin = new PopupWindow(MainActivity.this);
				popWin.setWidth(input.getWidth()); //设置宽度
				popWin.setHeight(200);	//设置popWin 高度

				popWin.setContentView(listView); //为popWindow填充内容
				popWin.setOutsideTouchable(true); // 点击popWin 以处的区域，自动关闭 popWin

				popWin.showAsDropDown(input, 0, 0);//设置 弹出窗口，显示的位置

			}
		});

	}

	private void initListView() {
		listView = new ListView(this);
		listView.setBackgroundResource(R.drawable.listview_background); //设置listView 背景
		listView.setDivider(null);	//设置条目之间的分隔线为null
		listView.setVerticalScrollBarEnabled(false); // 关闭
		listView.setAdapter(new MyListAdapter());
	}

	private class MyListAdapter extends BaseAdapter{

		@Override
		public int getCount() {
			return msgList.size();
		}

		@Override
		public Object getItem(int position) {
			return position;
		}

		@Override
		public long getItemId(int position) {
			return position;
		}

		@Override
		public View getView(final int position, View convertView, ViewGroup parent) {
			ViewHolder holder;
			if(convertView == null){
				convertView = View.inflate(getApplicationContext(), R.layout.list_item, null);
				holder = new ViewHolder();

				holder.delete = (ImageView) convertView.findViewById(R.id.delete);
				holder.tv_msg =(TextView) convertView.findViewById(R.id.tv_list_item);
				convertView.setTag(holder);
			}else{
				holder = (ViewHolder) convertView.getTag();
			}

			holder.tv_msg.setText(msgList.get(position));

			holder.delete.setOnClickListener(new OnClickListener() {

				@Override
				public void onClick(View v) {
				//删除对应的条目
					msgList.remove(position);

					//刷新listView
					MyListAdapter.this.notifyDataSetChanged();
				}
			});
			convertView.setOnClickListener(new OnClickListener() {

				@Override
				public void onClick(View v) {
					//设置输入框 
					input.setText(msgList.get(position));

					popWin.dismiss();
				}
			});

			return convertView;
		}
		}

	private class ViewHolder{
		TextView tv_msg;
		ImageView delete;
	}

}</pre>
[/codesyntax]
<pre></pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>147</wp:post_id>
		<wp:post_date>2015-01-28 21:38:23</wp:post_date>
		<wp:post_date_gmt>2015-01-28 13:38:23</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6-%e4%b8%8b%e6%8b%89%e8%8f%9c%e5%8d%95</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="%e4%b8%8b%e6%8b%89%e8%8f%9c%e5%8d%95"><![CDATA[下拉菜单]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707487]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android自定义控件—滑动开关</title>
		<link>http://1.duoinfo.sinaapp.com/?p=149</link>
		<pubDate>Wed, 28 Jan 2015 14:26:19 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=149</guid>
		<description></description>
		<content:encoded><![CDATA[在IM即时通讯的项目中，我用过了滑动开关，那时候，还不会现在这种通过继承View自定义的方式，那时候，我用了两个ImageView通过setVisibility方法去控制的。感觉也挺方便的。（Android4.0有Switch控件，一样的效果）

<img src="http://img.blog.csdn.net/20150128221131377?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

定义一个类继承自View，并实现他的有两个构造函数的方法。执行初始化：

[codesyntax lang="java"]
<pre>public class MyToggleButton extends View implements OnClickListener{

	/**
	 * 做为背景的图片
	 */
	private Bitmap backgroundBitmap;
	/**
	 * 可以滑动的图片
	 */
	private Bitmap slideBtn;
	private Paint paint;
	/**
	 * 滑动按钮的左边届
	 */
	private float slideBtn_left;

	/**
	 * 在代码里面创建对象的时候，使用此构造方法
	 */
	public MyToggleButton(Context context) {
		super(context);
		// TODO Auto-generated constructor stub
	}

	/**
	 * 在布局文件中声名的view，创建时由系统自动调用。
	 * @param context	上下文对象
	 * @param attrs		属性集
	 */
	public MyToggleButton(Context context, AttributeSet attrs) {
		super(context, attrs);

		initView();
	}</pre>
[/codesyntax]
<pre><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px;">初始化图片资源和画笔：</span></pre>
[codesyntax lang="java"]
<pre>	/**
	 * 初始化
	 */
	private void initView() {

		//初始化图片
		backgroundBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.switch_background);
		slideBtn = BitmapFactory.decodeResource(getResources(), R.drawable.slide_button);

		//初始化 画笔
		paint = new Paint();
		paint.setAntiAlias(true); // 打开抗矩齿

		//添加onclick事件监听
		setOnClickListener(this);
	}</pre>
[/codesyntax]
<span style="color: #002832;"><strong> view 对象显示的屏幕上，有几个重要步骤：</strong></span>
<span style="color: #002832;"><strong>  * 1、构造方法 创建 对象。</strong></span>
<span style="color: #002832;"><strong>  * 2、测量view的大小。 onMeasure(int,int);</strong></span>
<span style="color: #002832;"><strong>  * 3、确定view的位置 ，view自身有一些建议权，决定权在 父view手中。  onLayout();</strong></span>
<span style="color: #002832;"><strong>  * 4、绘制 view 的内容 。 onDraw(Canvas)</strong></span>

&nbsp;

测量view的大小：

[codesyntax lang="java"]
<pre>	@Override
	/**
	 * 测量尺寸时的回调方法 
	 */
	protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
//		super.onMeasure(widthMeasureSpec, heightMeasureSpec);

		/**
		 * 设置当前view的大小
		 * width  :view的宽度
		 * height :view的高度   （单位：像素）
		 */
		setMeasuredDimension(backgroundBitmap.getWidth(),backgroundBitmap.getHeight());
	}

	//确定位置的时候调用此方法
	//自定义view的时候，作用不大
//	@Override
//	protected void onLayout(boolean changed, int left, int top, int right,
//			int bottom) {
//		super.onLayout(changed, left, top, right, bottom);
//	}</pre>
[/codesyntax]

绘制：

[codesyntax lang="java"]
<pre>/**
	 * 当前开关的状态
	 *  true 为开
	 */
	private boolean currState = false;

	/**
	 * 绘制当前view的内容
	 */
	protected void onDraw(Canvas canvas) {
//		super.onDraw(canvas);

		// 绘制 背景
		/*
		 * backgroundBitmap	要绘制的图片
		 * left	图片的左边届
		 * top	图片的上边届
		 * paint 绘制图片要使用的画笔
		 */
		canvas.drawBitmap(backgroundBitmap, 0, 0, paint);

		//绘制 可滑动的按钮
		canvas.drawBitmap(slideBtn, slideBtn_left, 0, paint);
	}</pre>
[/codesyntax]
<pre><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px;">点击的时候状态发生改变：</span></pre>
[codesyntax lang="java"]
<pre>	
	/**
	 * 判断是否发生拖动，
	 * 如果拖动了，就不再响应 onclick 事件
	 * 
	 */
	private boolean isDrag = false;
	@Override
	/**
	 * onclick 事件在View.onTouchEvent 中被解析。
	 * 系统对onclick 事件的解析，过于简陋，只要有down 事件  up 事件，系统即认为 发生了click 事件
	 * 
	 */
	public void onClick(View v) {
		/*
		 * 如果没有拖动，才执行改变状态的动作
		 */
		if(!isDrag){
			currState = !currState;
			flushState();
		}
	}</pre>
[/codesyntax]

上面必须在不拖动的时候；

刷新：

[codesyntax lang="java"]
<pre>/**
	 * 刷新当前状态
	 */
	private void flushState() {
		if(currState){
			slideBtn_left = backgroundBitmap.getWidth()-slideBtn.getWidth();
		}else{
			slideBtn_left = 0;
		}

		flushView(); 
	}

	/**
	 * 刷新当前视力
	 */
	private void flushView() {
		/*
		 * 对 slideBtn_left  的值进行判断 ，确保其在合理的位置 即       0&lt;=slideBtn_left &lt;=  maxLeft
		 * 
		 */

		int maxLeft = backgroundBitmap.getWidth()-slideBtn.getWidth();	//	slideBtn 左边届最大值

		//确保 slideBtn_left &gt;= 0
		slideBtn_left = (slideBtn_left&gt;0)?slideBtn_left:0;

		//确保 slideBtn_left &lt;=maxLeft
		slideBtn_left = (slideBtn_left&lt;maxLeft)?slideBtn_left:maxLeft;

		/*
		 * 刷新当前视图  导致 执行onDraw执行
		 */
		invalidate();
	}</pre>
[/codesyntax]
<pre><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px;">onTouchDown事件：</span></pre>
<pre>[codesyntax lang="java"]</pre>
<pre>/**
	 * down 事件时的x值
	 */
	private int firstX;
	/**
	 * touch 事件的上一个x值
	 */
	private int lastX;

	@Override
	public boolean onTouchEvent(MotionEvent event) {
		super.onTouchEvent(event);

		switch (event.getAction()) {
		case MotionEvent.ACTION_DOWN:
			firstX = lastX =(int) event.getX();
			isDrag = false;

			break;
		case MotionEvent.ACTION_MOVE:

			//判断是否发生拖动
			if(Math.abs(event.getX()-firstX)&gt;5){
				isDrag = true;
			}

			//计算 手指在屏幕上移动的距离
			int dis = (int) (event.getX() - lastX);

			//将本次的位置 设置给lastX
			lastX = (int) event.getX();

			//根据手指移动的距离，改变slideBtn_left 的值
			slideBtn_left = slideBtn_left+dis;
			break;
		case MotionEvent.ACTION_UP:

			//在发生拖动的情况下，根据最后的位置，判断当前开关的状态
			if (isDrag) {

				int maxLeft = backgroundBitmap.getWidth() - slideBtn.getWidth(); // slideBtn
																					// 左边届最大值
				/*
				 * 根据 slideBtn_left 判断，当前应是什么状态
				 */
				if (slideBtn_left &gt; maxLeft / 2) { // 此时应为 打开的状态
					currState = true;
				} else {
					currState = false;
				}

				flushState();
			}
			break;
		}

		flushView();

		return true; 
	}</pre>
<pre>[/codesyntax]</pre>
方法消费了该事件。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>149</wp:post_id>
		<wp:post_date>2015-01-28 22:26:19</wp:post_date>
		<wp:post_date_gmt>2015-01-28 14:26:19</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6-%e6%bb%91%e5%8a%a8%e5%bc%80%e5%85%b3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="%e6%bb%91%e5%8a%a8%e5%bc%80%e5%85%b3"><![CDATA[滑动开关]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707488]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>contextual action mode</title>
		<link>http://1.duoinfo.sinaapp.com/?p=152</link>
		<pubDate>Thu, 29 Jan 2015 02:27:18 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=152</guid>
		<description></description>
		<content:encoded><![CDATA[在Google的开发文档的guide的menu里面，提到上下文菜单的两种形式。

There are two ways to provide contextual actions:
<ul>
	<li>In a <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/menus.html#FloatingContextMenu" target="_blank">floating context menu</a>. A menu appears as a floating list of menu items (similar to a dialog) when the user performs a long-click (press and hold) on a view that declares support for a context menu. Users can perform a contextual action on one item at a time.</li>
	<li>In the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/menus.html#CAB" target="_blank">contextual action mode</a>. This mode is a system implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ActionMode.html" target="_blank">ActionMode</a></code> that displays a contextual action bar at the top of the screen with action items that affect the selected item(s). When this mode is active, users can perform an action on multiple items at once (if your app allows it).</li>
</ul>
一种是：浮动的上下文菜单，这也是我们经常用到的。

一种是：contextual action mode

效果图如下：

<img src="http://img.blog.csdn.net/20150129101927320?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

&nbsp;

contextual action mode即是右边的那幅图。

我实现的效果如下图：

<img src="http://img.blog.csdn.net/20150129102049703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<ol>
	<li>Implement the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ActionMode.Callback.html" target="_blank">ActionMode.Callback</a></code> interface. In its callback methods, you can specify the actions for the contextual action bar, respond to click events on action items, and handle other lifecycle events for the action mode.</li>
	<li>Call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActionMode(android.view.ActionMode.Callback)" target="_blank">startActionMode()</a></code> when you want to show the bar (such as when the user long-clicks the view).</li>
</ol>
也就是说第一步需要实现<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ActionMode.Callback.html" target="_blank">ActionMode.Callback</a> 这样的接口。第二步调用<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActionMode(android.view.ActionMode.Callback)" target="_blank">startActionMode()</a></code> 方法。

&nbsp;

第一步：

[codesyntax lang="java"]
<pre> 

private ActionMode mActionMode;

	private ActionMode.Callback mActionModeCallback = new ActionMode.Callback() {
		// Called each time the action mode is shown. Always called after
		// onCreateActionMode, but
		// may be called multiple times if the mode is invalidated.
		@Override
		public boolean onPrepareActionMode(ActionMode mode, Menu menu) {
			return false; // Return false if nothing is done
		}

		// Called when the action mode is created; startActionMode() was called
		@Override
		public boolean onCreateActionMode(ActionMode mode, Menu menu) {
			// Inflate a menu resource providing context menu items
			MenuInflater inflater = mode.getMenuInflater();
			inflater.inflate(R.menu.game_menu, menu);
			return true;
		}

		@Override
		public void onDestroyActionMode(ActionMode mode) {
			 mActionMode = null;
		}

		@Override
		public boolean onActionItemClicked(ActionMode mode, MenuItem item) {
			int id = item.getItemId();

			return false;
		}
	};</pre>
[/codesyntax]

第二步：

[codesyntax lang="java"]
<pre>
mActionMode = startActionMode(mActionModeCallback);
		mActionMode.setTitle("title");</pre>
[/codesyntax]
指定样式：

[codesyntax lang="xml"]
<pre>  &lt;style name="MyActionBarTheme" parent="@style/Theme.AppCompat.Light"&gt;
        &lt;item name="android:actionBarStyle"&gt;@style/MyActionBar&lt;/item&gt;
        &lt;item name="android:actionModeBackground"&gt;@android:color/holo_orange_light&lt;/item&gt;

        &lt;!-- ActionMode右边的按钮是一个特殊的CloseButton，分割线与CloseButton的Style有关 --&gt;
        &lt;!-- 删除ActionMode的Divider--&gt;
        &lt;item name="android:actionModeCloseButtonStyle"&gt;@null&lt;/item&gt;
    &lt;/style&gt;

    &lt;style name="MyActionBar" parent="@style/Widget.AppCompat.ActionBar"&gt;
        &lt;item name="android:background"&gt;@android:color/holo_green_light&lt;/item&gt;
    &lt;/style&gt;</pre>
[/codesyntax]

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>152</wp:post_id>
		<wp:post_date>2015-01-29 10:27:18</wp:post_date>
		<wp:post_date_gmt>2015-01-29 02:27:18</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>contextual-action-mode</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="contextual-action-mode"><![CDATA[contextual action mode]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707489]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android零碎知识点</title>
		<link>http://1.duoinfo.sinaapp.com/?p=154</link>
		<pubDate>Thu, 29 Jan 2015 06:39:15 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=154</guid>
		<description></description>
		<content:encoded><![CDATA[1、Activity横竖屏时的生命周期，怎么设置属性。

当屏幕横竖屏切换的时候，Activity会被销毁，重新创建Activity。设置属性：<span style="color: #000080;">android:configChanges="orientation|keyboardHidden|screenSize"  </span>

2、说一说你对反射机制的理解

java反射是Java被视为动态（或准动态）语言的一个关键性质。这个机制允许程序在运行时透过Reflection APIs取得任何一个已知名称的class的内部信息，包括其modifiers（诸如public, static等等）、superclass（例如Object）、实现之interfaces（例如Cloneable），也包括fields和methods的所有信息，并可于运行时改变fields内容或唤起methods。

通俗地说,反射机制就是可以把一个类,类的成员(函数,属性),当成一个对象来操作；

使用反射机制的一些地方：

a.工厂模式：Factory类中用反射的话，添加了一个新的类之后，就不需要再修改工厂类Factory了

b.数据库JDBC中通过Class.forName(Driver).来获得数据库连接驱动

c.分析类文件：毕竟能得到类中的方法等等

d.访问一些不能访问的变量或属性：破解别人代码

3、ContentProvider是以什么形式存储数据的？存储在那里了

Content Provider是所有应用程序之间数据存储和检索的一个桥梁，它的作用就是使得各个应用程序之间实现数据共享。Android为常见的一些数据提供了ContentProvider(包括音频、视频、图片和通讯录)

每个Content Providers都会对外提供一个公共的URI(包装成Uri对象)，如果应用程序有数据需要共享时，就需要使用Content Providers为这些数据定义一个URI，然后其他的应用程序就可以通过Content Providers传入这个URI来对数据进行操作。URI由3个部分组成:"content://"、数据的路径、标识ID(可选)。

ContentProvider的用法有两种，一种是使用现有的内容提供器来读取和操作相应程序中的数据，另一种是创建自己的内容提供者给我们的程序提供外部的访问接口。

4、如何关闭广播？
<pre id="answer-content-1932794269">广播有两种注册方式，一是在Activity启动过程中通过代码动态注册，二是在AndroidManifest.xml文件中利用&lt;receiver&gt;标签进行静态注册。对于第一种方法，在Activity进入停止或者销毁状态的时候使用unregisterReceiver方法将注册的BroadcastReceiver注销掉。如果通过第二种方法注册的BroadcastReceiver，如果通过&lt;receiver&gt;标签来注册的BroadcastReceiver，那么该对象的实例在onReceive被调用之后就会在任意时间内被销毁。也就是说，我们并需要担心静态注册的BroadcastReceiver的销毁问题。静态注册无需担忧广播接收器是否被关闭，只要设备是开启状态，广播接收器也是打开着的。也就是说哪怕app本身未启动，该app订阅的广播在触发时也会对它起作用。</pre>
<img src="http://img.blog.csdn.net/20150129113535433?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<pre id="answer-content-1932794269"></pre>
<div><img src="file:///D:\Program Files\619189810\Image\C2C\FOMTD%5X(FC[I_(}DH5U]QP.png" alt="" /></div>
5.说一下Activity的生命周期和Service的生命周期

Activity 的略去。

<img src="http://img.blog.csdn.net/20150129113816144?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

6、android常用的一些设计模式，请举例说明？

//==========================================================================

1、适配器模式：ListView或GridView的Adapter

简介：不同的数据提供者使用一个适配器来向一个相同的客户提供服务。

2、建造者模式：AlertDialog.Builder

简介：可以分步地构造每一部分。

3、命令模式：Handler.post后Handler.handleMessage

简介：把请求封装成一个对象发送出去，方便定制、排队、取消。

4、享元模式：Message.obtainMessage通过重用Message对象来避免大量的Message对象被频繁的创建和销毁。

简介：运用共享技术有效地支持大量细粒度的对象。

5、迭代器模式：如通过Hashtable.elements方法可以得到一个Enumeration，然后通过这个Enumeration访问Hashtable中的数据，而不用关心Hashtable中的数据存放方式。

简介：提供一个方法顺序访问数据集合中的所有数据而又不暴露对象的内部表示。

6、备忘录模式：Activity的onSaveInstanceState和onRestoreInstanceState就是通过Bundle这种序列化的数据结构来存储Activity的状态，至于其中存储的数据结构，这两个方法不用关心

简介：不需要了解对象的内部结构的情况下备份对象的状态，方便以后恢复。

7、观察者模式：我们可以通过BaseAdapter.registerDataSetObserver和BaseAdapter.unregisterDataSetObserver两方法来向BaseAdater注册、注销一个DataSetObserver。这个过程中，DataSetObserver就是一个观察者，它一旦发现BaseAdapter内部数据有变量，就会通过回调方法DataSetObserver.onChanged和DataSetObserver.onInvalidated来通知DataSetObserver的实现类。事件通知也是观察者模式

简介：一个对象发生改变时，所有信赖于它的对象自动做相应改变。

8、原型模式：比如我们需要一张Bitmap的几种不同格式：ARGB_8888、RGB_565、ARGB_4444、ALAPHA_8等。那我们就可以先创建一个ARGB_8888的Bitmap作为原型，在它的基础上，通过调用Bitmap.copy(Config)来创建出其它几种格式的Bitmap。另外一个例子就是Java中所有对象都有的一个名字叫clone的方法，已经原型模式的代名词了

简介：在系统中要创建大量的对象，这些对象之间具有几乎完全相同的功能，只是在细节上有一点儿差别。

9、代理模式：类似于ios开发的delegate委托模式，所有的AIDL都一个代理模式的例子。假设一个Activity A去绑定一个Service S，那么A调用S中的每一个方法其实都是通过系统的Binder机制的中转，然后调用S中的对应方法来做到的。Binder机制就起到了代理的作用。

简介：为其他对象提供一种代理以控制对这个对象的访问。

10、状态模式：View.onVisibilityChanged方法，就是提供了一个状态模式的实现，允许在View的visibility发生改变时，引发执行onVisibilityChanged方法中的动作。

简介：状态发生改变时，行为改变。

11、策略模式：

举例：Java.util.List就是定义了一个增（add）、删（remove）、改（set）、查（indexOf）策略，至于实现这个策略的ArrayList、LinkedList等类，只是在具体实现时采用了不同的算法。但因为它们策略一样，不考虑速度的情况下，使用时完全可以互相替换使用。

简介：定义了一系列封装了算法、行为的对象，他们可以相互替换。

12、调解者模式

简介：一个对象的某个操作需要调用N个对象的M个方法来完成时，把这些调用过程封装起来，就成了一个调解者

举例：如Resource.getDrawable方法的实现逻辑是这样的：创建一个缓存来存放所有已经加载过的，如果getDrawable中传入的id所对应的Drawable以前没有被加载过，那么它就会根据id所对应的资源类型，分别调用XML解析器生成，或者通过读取包中的图片资源文件来创建Drawable。

而Resource.getDrawable把涉及到多个对象、多个逻辑的操作封装成一个方法，就实现了一个调解者的角色。

13、抽象工厂模式

DAO与Service的使用

以上的内容来自：<a title="http://blog.csdn.net/dengshengjin2234/article/details/8502097" href="http://blog.csdn.net/dengshengjin2234/article/details/8502097">http://blog.csdn.net/dengshengjin2234/article/details/8502097</a>

//==================================================================================

7、说一下你是怎么理解List、Set、Map的？它们各有什么用法

略。

8、String和StringBuilder的区别

略。

9、说一说异常机制

略。

10、什么是ANR，什么情况下会出现此现象？该如何处理

参考：<a title="http://hukai.me/android-training-course-in-chinese/performance/perf-anr/index.html" href="http://hukai.me/android-training-course-in-chinese/performance/perf-anr/index.html">http://hukai.me/android-training-course-in-chinese/performance/perf-anr/index.html</a>

11、如何避免内存溢出问题

略。

12、ListView的优化问题

a.复用已经生成的convertView；
b.添加viewHolder类；
c.缓存数据（图片缓存）；
d.分页加载。

参考:<a title="http://www.cnblogs.com/itstudent/p/3729117.html" href="http://www.cnblogs.com/itstudent/p/3729117.html" target="_blank">http://www.cnblogs.com/itstudent/p/3729117.html</a>

13、谈谈android架构

参考：<a title="http://www.cnblogs.com/lijunamneg/archive/2013/01/18/2866953.html" href="http://www.cnblogs.com/lijunamneg/archive/2013/01/18/2866953.html" target="_blank">http://www.cnblogs.com/lijunamneg/archive/2013/01/18/2866953.html</a>

14、请说一下android的四大组件

略。
<div>15、android的五个布局分别有哪些？每个的用法</div>
<div>略。</div>
<div>16、android数字签名是怎么回事</div>
<div>参考：<a title="http://www.cnblogs.com/feisky/archive/2010/01/17/1650076.html" href="http://www.cnblogs.com/feisky/archive/2010/01/17/1650076.html" target="_blank">http://www.cnblogs.com/feisky/archive/2010/01/17/1650076.html</a></div>
17、在android中如何访问WebService

参考：黑马webService

18、谈谈对canvas这个类的了解

略

19、在项目中遇到什么难题怎么解决的

略

20、android系统的优缺点

略

21.结合项目谈谈Android的最佳实践

略

22.onTouch与onClick的区别
<pre id="recommend-content-1453056449">onClick传入的参数就一个onClick(View v)而 onTouch为onTouch(View v, MotionEvent event)显然后者可以对控件有更丰富的操作，比如判断触摸的状态（比如按下，或者放开），和得到点击的位置等等.</pre>
<pre id="recommend-content-1453056449">23.返回键和home键的区别</pre>
当按下Home键，默认情况下stop前台的actiity，即activity设置成onstop，而不是ondestory。如果再次启动该activity不是调用onCreate，而是调用onSavedInstanceState方法，保持上次Activity的状态则是从onRestart开始-&gt;onStart-&gt;onResume;

而当按下back键则不同，back键默认finish前台的activity，即activity的状态为onDestory为止，再次启动该activity则从onCreate开始，不会调用onSavedInstanceState方法。

24.谈谈NDK和jni

略

25.如何避免内存泄露

D盘浏览器下载的文档

26.适配

27.UI优化的实践

略。

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>154</wp:post_id>
		<wp:post_date>2015-01-29 14:39:15</wp:post_date>
		<wp:post_date_gmt>2015-01-29 06:39:15</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e9%9b%b6%e7%a2%8e%e7%9f%a5%e8%af%86%e7%82%b9</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e9%9d%a2%e8%af%95"><![CDATA[面试]]></category>
		<category domain="post_tag" nicename="%e9%9d%a2%e8%af%95"><![CDATA[面试]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707490]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Async Task的嵌套使用和Async Task使用中屏幕旋转带来的问题解决</title>
		<link>http://1.duoinfo.sinaapp.com/?p=156</link>
		<pubDate>Thu, 29 Jan 2015 08:17:36 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=156</guid>
		<description></description>
		<content:encoded><![CDATA[即时通讯项目发送视频：我的业务逻辑是从ImageCache中取出缓存，当缓存存在，则直接把path传给播放视频的界面，如果是接受方，那么消息状态标记为已读。当本地缓存不存在的时候，因为获取视频缩略图比较耗时，不能放在主线程中去处理。这里使用的是创建一个类继承自AsyncTask去处理。（实质上在前面发送图片的时候，我也采取的是这种方式，可是在获取缩略图的时候，可能用户断网了，那么这时候消息肯定是失败的状态，当后台的Service监听到用户网络连接上的时候，再去获取，那么这个动作我当时是开启了一个子线程，当时没敢嵌套AsyncTask，今天下午查了下StackOverFlow，发现可以这样做）。同样这里一样的道理，当消息失败或者是接收方但是接收方的Bitmap为空，此时判断用户的网络状态，网络连接上的时候，重新在onPostExecute中开一个匿名内部类去提取消息。

所带来的问题：

在异步获取的过程中，为了避免界面好像是卡死在那里，我加了一个进度条，提示用户当前的进度，当时没有注意到，当用户此时旋转屏幕的时候，可笑的事情发生了，进度条归零了（感谢stackoverflow那个哥们，之前知道屏幕旋转会带来Activity生命周期的变化，但是没想到使用AsyncTask也会带来这个变化）。

解决方法：代码逻辑太复杂，抽离不出来。

参考：

<a title="http://blog.csdn.net/zhangyadick18/article/details/7346454" href="http://blog.csdn.net/zhangyadick18/article/details/7346454" target="_blank">http://blog.csdn.net/zhangyadick18/article/details/7346454</a>

<a title="http://www.cnblogs.com/kissazi2/p/4116456.html" href="http://www.cnblogs.com/kissazi2/p/4116456.html" target="_blank">http://www.cnblogs.com/kissazi2/p/4116456.html</a>

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>156</wp:post_id>
		<wp:post_date>2015-01-29 16:17:36</wp:post_date>
		<wp:post_date_gmt>2015-01-29 08:17:36</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>async-task%e7%9a%84%e5%b5%8c%e5%a5%97%e4%bd%bf%e7%94%a8%e5%92%8casync-task%e4%bd%bf%e7%94%a8%e4%b8%ad%e5%b1%8f%e5%b9%95%e6%97%8b%e8%bd%ac%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98%e8%a7%a3%e5%86%b3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="asynctask"><![CDATA[AsyncTask]]></category>
		<category domain="post_tag" nicename="asynctask%e5%b5%8c%e5%a5%97"><![CDATA[AsyncTask嵌套]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<category domain="post_tag" nicename="%e5%b1%8f%e5%b9%95%e6%97%8b%e8%bd%ac"><![CDATA[屏幕旋转]]></category>
		<category domain="post_tag" nicename="%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f"><![CDATA[生命周期]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707491]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android性能优化总结</title>
		<link>http://1.duoinfo.sinaapp.com/?p=181</link>
		<pubDate>Fri, 30 Jan 2015 03:17:03 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=181</guid>
		<description></description>
		<content:encoded><![CDATA[前言
性能优化本身是一个很大的主题，涵盖程序的方方面面，任何不慎的操作，都有可能对性能造成比较大的影响，要知道程序的性能是可以累加的，多处的性能低下，会影响整体的性能，其后果可能也是多方面的，本文总结了目前工作中，所需要知道的大部分性能优化点，一部分个人总结，一部分来自于互联网。但整体上，都是提纲性的，并没有列出具体的实例，因为写这方面主题的达人实在太多了，所以，我得站在巨人的肩膀上，具体细节，请参考对应的链接。
性能低下的现象
游戏：界面很卡，FPS低
搜索性能差
服务器响应速度慢
OS：界面无响应
性能低下的后果：降低用户体验
用户流失
项目失败
引发灾难
…
容易引发性能问题的点
硬件
IO操作
数据库
网络
函数调用
数据结构
程序逻辑
….
从全局考虑
硬件性能
架构设计
核心数据结构
……
从微观考虑
小规模修改程序，提高性能：程序的性能是可以累加的
简单代码设计
类和函数设计：合适的数据类型和算法
用快速排序代替冒泡排序
用二分查找代替线性查找
业务逻辑的实现
……
一些观点
高效代码≠更好代码≠高质量代码（易修改，易扩充，易维护）
80/20法则：4%的代码占用了50%以上的运行时间
随时随地进行优化 ==>将陷入无休止的优化泥潭
开发阶段前期：功能都未实现，何谈优化，但在设计的时候，需要考虑到对应风险。
开发阶段中后期：功能部分完善，通过现象进行模块优化
开发阶段后期：功能完善，充分考虑整体性，通过现象进行系统优化
后期优化无法满足性能要求----架构先天不足，只能大批量重构
过分提高性能会损害程序的可读性和可维护性
优先实现功能，然后再进行优化
程序功能的正确性比性能更重要
真正高性能的程序设计：
more small, more fast
more simple, more fast
……
方法论
在进行性能优化前，确保该功能是否已基本完整。
 

Key Points
是否考虑通过修改需求来提高性能？
是否考虑通过修改整体设计提高性能？
是否考虑通过来修改类的设计提高性能？
在开始修改前，程序是完全正确的么？
是否在修改前是否进行性能评估？
是否记录了每次修改后的性能的变化？
如果没有带来预期的性能提高，是否完全放弃所做的代码调整？
是否对每个性能瓶颈进行不止一次的尝试？
是否反复进行代码调整，直到最优？
……
性能瓶颈的发现
找出瓶颈，集中火力对付占用绝大部分资源的少量代码。
途径：
Code Review
通过最基本优化策略优化代码
代码性能测量
1) 通过性能Log记录函数调用时间，找出瓶颈点
    LogUtil.d(TAGConstant.TAG_PERFORMANCE,"Load media info into group begin......");
    longstart = System.currentTimeMillis();
                 ……
    LogUtil.d(TAGConstant.TAG_PERFORMANCE,“Load media info into group end, Total Time: ” + (System.currentTimeMillis() -start) + “ ms”);
2) 使用性能分析工具：
    Traceview（参考：Android性能调优工具TraceView介绍）
    Monkey
    monkeyrunner
     注：后两个我个人没有使用过，不做介绍，优先推荐使用TraceView工具 
如何优化
优化本身是一个很大的主题，我这是主要是针对于Android平台来说的。个人认为，优化可以分成好几部分：
一是JAVA语法层次通用的优化，如尽量使用局部变量（栈变量），IO缓冲等。
二是通用的Android性能优化，如同步改异步，各种缓存的使用等
三是应用程序内部的性能优化，如内部逻辑、数据插入及查找、数据结构的安排与组织等
 
以下部分针对于上述3种类型，分别进行简要说明：
基本优化策略：JAVA语法层次的优化
（以下部分来自于：http://blog.csdn.net/aomandeshangxiao/article/details/8115612#t1，具体做法请参考该连接）
类和对象使用技巧
尽量少用new生成新对象
使用clone方法生成新对象
尽量使用局部变量栈变量
减少方法调用
使用final类和final/static/private方法
让访问实例内变量的 getter/setter 方法变成final  
避免不需要的 instanceof 操作  
避免不需要的造型操作  
尽量重用对象  
不要重复初始化变量  
不要过分创建对象
Java IO技巧
使用缓冲提高IO性能
lnputStream比Reader高效，OutputStream比Writer高效
在适当的时候用byte替代char
有缓冲的块操作IO要比缓冲的流字符IO快
序列化时使用原子类型
在finally块中关闭stream 
SQL语句
尽早释放资源
异常Exceptions使用技巧
避免使用异常来控制程序流程
尽可能重用异常
将trycatch 块移出循环  
线程使用技巧
在使用大量线程Threading的场合使用线程池管理
防止过多的同步
同步方法而不要同步整个代码段
在追求速度的场合用ArrayList和HashMap代替Vector和Hashtable
使用notify而不是notifyAll
不要在循环中调用 synchronized同步方法   
单线程应尽量使用 HashMap，ArrayList
其它常用技巧
使用移位操作替代乘除法操作可以极大地提高性能
对Vector中最后位置的添加删除操作要远远快于埘第一个元素的添加删除操作
当复制数组时使用System.arraycop方法
使用复合赋值运算符
用int而不用其它基本类型
在进行数据库连接和网络连接时使用连接池
用压缩加快网络传输速度一种常用方法是把相关文件打包到一个jar文件中
在数据库应用程序中使用批处理功能
消除循环体中不必要的代码
为vectors 和 hashtables定义初始大小  
如果只是查找单个字符的话用charat代替startswith
在字符串相加的时候使用 charat()代替startswith() 如果该字符串只有一个字符的话  
对于 boolean 值避免不必要的等式判断  
对于常量字符串用string 代替 stringbuffer   
用stringtokenizer 代替 indexof 和substring  
使用条件操作符替代if cond else  结构 
不要在循环体中实例化变量  
确定 stringbuffer的容量  
不要总是使用取反操作符  
与一个接口 进行instanceof 操作  
采用在需要的时候才开始创建的策略  
通过 StringBuffer 的构造函数来设定他的初始化容量可以明显提升性能  
合理使用 javautilVector
不要将数组声明为public static final
HaspMap 的遍历
array数组和 ArrayList 的使用  
StringBufferStringBuilder 的区别
尽量使用基本数据类型代替对象   
用简单的数值计算代替复杂的函数计算比如查表方式解决三角函数问题  
使用具体类比使用接口效率高但结构弹性降低了但现代 IDE都可以解决这个问题 
考虑使用静态方法
应尽可能避免使用内在的GET/SET 方法 
避免枚举浮点数的使用   
二维数组比一维数组占用更多的内存空间大概是 10倍计算 
SQLite
奇偶判断
 
实际上，Android本身的Training文档也提供给我们很多可参考的内容，以下仅枚举一些KeyPoint，当然，有的内容是与上面的策略是重复的。
原文参考：Performance Tips
译文参考：Android应用开发者指南：性能优化(1)
其它参考：Android开发性能优化简介
总体上来说，想要写出高效代码，我们要遵循两条基本的原则：
不作没有必要的工作。
尽量避免内存分配。
Key Point：
避免创建不必要的对象
用静态代替虚拟
避免内部的Getters/Setters
对常量使用Static Final修饰符
使用改进的For循环语法（for-each）
在有内部类的情况考虑使用包权限来替代私有访问
避免使用浮点数
了解并使用类库
合理利用Native方法
 
通用Android性能优化
布局优化
（原文参考：ImprovingLayout Performance）
尽量减少Android程序布局中View的层次，View层次越多，效率就越低
使用<include/>复用布局
使用ViewStub懒加载布局 (TODO:Android布局技巧：使用ViewStub提高UI性能)
使用ViewHolder、Thread使ListView滚动更加流畅
 
其它优化点
合理使用异步操作
懒加载：当前不需要的数据，不要加载，即按需加载。懒加载的范围是广泛的，可以是数据，可以是View，或者其它
使用缓存
图片缓存：包括MemoryCache和DiskCache，推荐使用官方DEMO中的Cache
参考：DisplayingBitmaps Efficiently
单例数据缓存：建立一个管理数据的类，管理所有数据，当主界面消失后，由于Application本身没有实际退出，因此，数据本身也没有释放掉，下次启动时，省去了加载数据的时间，当然，这并不是一个好的行为。
使用ListView、GridView的View缓存
使用Message自身的缓存，避免重复创建Message实例
线程池
数据池（可参考Message Pool的实现方式）
……
数据库优化
SQL优化
建立索引
使用事务
…...
算法优化
用快速排序代替冒泡排序
用二分查找代替线性查找
……
数据结构使用
不要全部使用ArrayList，合理使用LinkedList等易于插入和删除的集合
合理使用HashMap、HashSet来提高查找性能
使用SparseArray、SparseIntArray、SparseBooleanArray来替代某些特定的HashMap
……
其它策略
可以考虑延迟处理，避免在同一时间干过多的事情
应用程序内部的性能优化
该部分的优化应该是依据程序的不同而不同，没有万般皆准的法则，目前从我做过的程序来看，实际上，上述的性能优化点基本上已经能够解决很多性能问题了。
在我所做的程序中，主要的优化手段是：
程序逻辑简化：分析代码，去掉冗余逻辑
数据结构的优化：对集合类的灵活使用，特别是HashMap的使用，极大的提高查找性能。
批量处理原则：对于需要循环调用地方，采用批量处理
总结
性能优化本身是对代码的重构和反思过程，通过优化性能，能找出我们很多设计、逻辑上的不足。
优化的过程往往很痛苦，但在做过这个过程后，个人在编程水平、设计水平上都会有很大的提高。
很多优化的思想应该做为编码规范的一部分，需要我们反复实践，在写代码时，第一反应所得出的代码就是最优的。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>181</wp:post_id>
		<wp:post_date>2015-01-30 11:17:03</wp:post_date>
		<wp:post_date_gmt>2015-01-30 03:17:03</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e6%80%bb%e7%bb%93</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><![CDATA[性能优化]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707493]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>高效展示bitmap</title>
		<link>http://1.duoinfo.sinaapp.com/?p=183</link>
		<pubDate>Fri, 30 Jan 2015 03:29:11 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=183</guid>
		<description></description>
		<content:encoded><![CDATA[管理Bitmap内存

先来看看Android不同版本对Bitmap管理的进化
在Android2.2或更低的版本中，当出现垃圾回收时，你的应用会暂停执行。这会导致延迟，降低程序性能。Android2.3增加了并行的垃 圾回收机制，这意味着当图片对象不再被引用时所占用的内存空间马上会被回收利用
在Android2.3或更低版本中，图片的像素级数据是存储在本地内存（JVM 用于其内部操作的内存）中的，它和Bitmap对象本身是分开来的，Bitmap对象本身是存储在Java虚拟机堆中。在本地内存中的像素数据的释放是不可预知的，这样就有可能会导致应用短暂的超过内存限制，从而程序崩溃。Android3.0之后，Bitmap像素数据和它本身都存储在Java虚拟机的堆内存中
下面我们来看看在不同的Android版本中如何来对Bitmap内存进行管理
Android2.3或更低版本中对Bitmap内存的管理
在Android2.3或更低版本中，推荐对Bitmap使用recycle() 方法。如果你在你的一个用中显示大量的图片数据，那么你的应用非常有可能出现OutOfMemoryError 错误。调用 recycle() 方法能让应用以尽可能快的回收Bitmap所占用的内存资源。
警告：你应该调用 recycle() 方法的时机是:当你不会再使用这张Bitmap。如果你后续再试图去访问，你将会得到"Canvas: trying to use a recycled bitmap" 错误
下面的程序片段是调用recycle() 示例，使用到了引用计数（mDisplayRefCount and mCacheRefCount）来追踪一张Bitmap是正在被显示还是存储在缓存中，回收Bitmap需要符合以下两个条件
1、 mDisplayRefCount and mCacheRefCount 的引用计数都为0
2、Bitmap对象不为null，并且没有被回收
private int mCacheRefCount = 0; private int mDisplayRefCount = 0; ... // Notify the drawable that the displayed state has changed. // Keep a count to determine when the drawable is no longer displayed. public void setIsDisplayed(boolean isDisplayed) { synchronized (this) { if (isDisplayed) { mDisplayRefCount++; mHasBeenDisplayed = true; } else { mDisplayRefCount--; } } // Check to see if recycle() can be called. checkState(); } // Notify the drawable that the cache state has changed. // Keep a count to determine when the drawable is no longer being cached. public void setIsCached(boolean isCached) { synchronized (this) { if (isCached) { mCacheRefCount++; } else { mCacheRefCount--; } } // Check to see if recycle() can be called. checkState(); } private synchronized void checkState() { // If the drawable cache and display ref counts = 0, and this drawable // has been displayed, then recycle. if (mCacheRefCount Android3.0或更高版本中对Bitmap内存的管理
在Android3.0中为我们介绍了BitmapFactory.Options.inBitmap 属性。 如果设置了这个属性，那么使用了Options 对象作为参数的decode方法会试图重用现有的Bitmap来作为方法的返回值。 这意味着Bitmap的内存资源被重用了，从而使得程序性能得到提高，并且消除了这份内存的分配和回收工作。下面是使用inBitmap 属性的一些说明和注意点
要进行重用的Bitmap的大小必须要跟源图片大小一致（确保两者内存使用大小一样），而且图片必须是PNG或JPEG格式（可以是资源，也可以是二进制流数据）
如果源图片设置了inPreferredConfig 配置项，那么要进行重用的Bitmap也设置此项
你应该一值使用decode方法返回的Bitmap，因为我们不能保证重用的Bitmap是否可靠（比如，上面提到的大小有可能不匹配）
保存一张Bitmap供以后使用
在Android3.0或更高版本上，当一张Bitmap被LruCache 踢出时，Bitmap的软引用会被保存在一个HashSet中 ，可能稍后会被inBitmap 使用。

HashSet&lt;SoftReferenceamp;$gt; mReusableBitmaps; private LruCachemMemoryCache; // If you're running on Honeycomb or newer, create // a HashSet of references to reusable bitmaps. if (Utils.hasHoneycomb()) { mReusableBitmaps = new HashSet&lt;SoftReferenceamp;$gt;(); } mMemoryCache = new LruCache(mCacheParams.memCacheSize) { // Notify the removed entry that is no longer being cached. @Override protected void entryRemoved(boolean evicted, String key, BitmapDrawable oldValue, BitmapDrawable newValue) { if (RecyclingBitmapDrawable.class.isInstance(oldValue)) { // The removed entry is a recycling drawable, so notify it // that it has been removed from the memory cache. ((RecyclingBitmapDrawable) oldValue).setIsCached(false); } else // The removed entry is a standard BitmapDrawable. if (Utils.hasHoneycomb()) { // We're running on Honeycomb or later, so add the bitmap // to a SoftReference set for possible use with inBitmap later. mReusableBitmaps.add (new SoftReference(oldValue.getBitmap())); } } } .... }
使用已经存在的Bitmap
在运行的app中，decoder 方法会去检查是否已经有一张已经存在的Bitmap可以使用

public static Bitmap decodeSampledBitmapFromFile(String filename, int reqWidth, int reqHeight, ImageCache cache) { final BitmapFactory.Options options = new BitmapFactory.Options(); ... BitmapFactory.decodeFile(filename, options); ... // If we're running on Honeycomb or newer, try to use inBitmap. if (Utils.hasHoneycomb()) { addInBitmapOptions(options, cache); } ... return BitmapFactory.decodeFile(filename, options); }
上面使用到的addInBitmapOptions() 方法在下面定义了。它会去查找inBitmap是否设置了一张已经存在的Bitmap ，你可以发现inBitmap 只设置相匹配的图片（你永远都不要去假设相匹配的图片一定找得到）

private static void addInBitmapOptions(BitmapFactory.Options options, ImageCache cache) { // inBitmap only works with mutable bitmaps, so force the decoder to // return mutable bitmaps. options.inMutable = true; if (cache != null) { // Try to find a bitmap to use for inBitmap. Bitmap inBitmap = cache.getBitmapFromReusableSet(options); if (inBitmap != null) { // If a suitable bitmap has been found, set it as the value of // inBitmap. options.inBitmap = inBitmap; } } } // This method iterates through the reusable bitmaps, looking for one // to use for inBitmap: protected Bitmap getBitmapFromReusableSet(BitmapFactory.Options options) { Bitmap bitmap = null; if (mReusableBitmaps != null &amp;&amp; !mReusableBitmaps.isEmpty()) { final Iterator&lt;SoftReferenceamp;$gt; iterator = mReusableBitmaps.iterator(); Bitmap item; while (iterator.hasNext()) { item = iterator.next().get(); if (null != item &amp;&amp; item.isMutable()) { // Check to see it the item can be used for inBitmap. if (canUseForInBitmap(item, options)) { bitmap = item; // Remove from reusable set so it can't be used again. iterator.remove(); break; } } else { // Remove from the set if the reference has been cleared. iterator.remove(); } } } return bitmap; }
下面一个方法用来判断一张候选图片是否满足inBitmap用来使用的大小标准

private static boolean canUseForInBitmap( Bitmap candidate, BitmapFactory.Options targetOptions) { int width = targetOptions.outWidth / targetOptions.inSampleSize; int height = targetOptions.outHeight / targetOptions.inSampleSize; // Returns true if "candidate" can be used for inBitmap re-use with // "targetOptions". return candidate.getWidth() == width &amp;&amp; candidate.getHeight() == height; }]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>183</wp:post_id>
		<wp:post_date>2015-01-30 11:29:11</wp:post_date>
		<wp:post_date_gmt>2015-01-30 03:29:11</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%ab%98%e6%95%88%e5%b1%95%e7%a4%babitmap</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="bitmap"><![CDATA[bitmap]]></category>
		<category domain="post_tag" nicename="%e9%ab%98%e6%95%88%e5%b1%95%e7%a4%babitmap"><![CDATA[高效展示Bitmap]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707494]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Displaying Bitmaps Efficiently</title>
		<link>http://1.duoinfo.sinaapp.com/?p=216</link>
		<pubDate>Sat, 31 Jan 2015 01:06:49 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=216</guid>
		<description></description>
		<content:encoded><![CDATA[Learn how to use common techniques to process and load<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html">Bitmap</a></code> objects in a way that keeps your user interface (UI) components responsive and avoids exceeding your application memory limit. If you're not careful, bitmaps can quickly consume your available memory budget leading to an application crash due to the dreaded exception:
<span style="color: #0000ff;"><code>java.lang.OutofMemoryError: bitmap size exceeds VM budget</code>.    </span>

There are a number of reasons why loading bitmaps in your Android application is tricky:
<ul>
	<li>Mobile devices typically have constrained system resources. Android devices can have as little as 16MB of memory available to a single application. The<a href="http://source.android.com/compatibility/downloads.html">Android Compatibility Definition Document</a> (CDD),<em>Section 3.7. Virtual Machine Compatibility</em> gives the required minimum application memory for various screen sizes and densities. Applications should be optimized to perform under this minimum memory limit. However, keep in mind many devices are configured with higher limits.</li>
	<li>Bitmaps take up a lot of memory, especially for rich images like photographs. For example, the camera on the <a href="http://www.android.com/devices/detail/galaxy-nexus">Galaxy Nexus</a> takes photos up to 2592x1936 pixels (5 megapixels). If the bitmap configuration used is<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.Config.html">ARGB_8888</a></code> (the default from the Android 2.3 onward) then loading this image into memory takes about 19MB of memory (2592*1936*4 bytes), immediately exhausting the per-app limit on some devices.</li>
	<li>Android app UI’s frequently require several bitmaps to be loaded at once. Components such as<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> commonly include multiple bitmaps on-screen at once with many more potentially off-screen ready to show at the flick of a finger.</li>
</ul>
译：上面的一段话主要就是说bitmap会很快消耗内存，导致OOM。并且列举个几个原因。
<ul>
	<li>移动设备的系统资源有限。Android设备对于单个程序至少需要16MB的内存。<a href="http://source.android.com/compatibility/downloads.html" target="_blank">Android Compatibility Definition Document (CDD)</a>, Section 3.7. Virtual Machine Compatibility 给出了对于不同大小与密度的屏幕的最低内存需求。 程序应该在这个最低内存限制下最优化程序的效率。当然，大多数设备的都有更高的限制需求。</li>
	<li>Bitmap会消耗很多内存，特别是对于类似照片等内容更加丰富的图片。 例如，<a href="http://www.android.com/devices/detail/galaxy-nexus" target="_blank">Galaxy Nexus</a>的照相机能够拍摄2592x1936 pixels (5 MB)的图片。 如果bitmap的配置是使用<a href="http://developer.android.com/reference/android/graphics/Bitmap.Config.html" target="_blank">ARGB_8888</a> (从Android 2.3开始的默认配置) ，那么加载这张照片到内存会大概需要19MB(<code>2592*1936*4</code> bytes) 的内存, 这样的话会迅速消耗掉设备的整个内存。</li>
	<li>Android app的UI通常会在一次操作中立即加载许多张bitmaps。 例如在<a href="http://developer.android.com/reference/android/widget/ListView.html" target="_blank">ListView</a>, <a href="http://developer.android.com/reference/android/widget/GridView.html" target="_blank">GridView</a> 与<a href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html" target="_blank">ViewPager</a> 等组件中通常会需要一次加载许多张bitmaps，而且需要预先加载一些没有在屏幕上显示的内容，为用户滑动时显示做准备。</li>
</ul>
<h2>Lessons</h2>

<hr />

<dl><dt><strong><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/load-bitmap.html">Loading Large Bitmaps Efficiently</a></strong></dt><dd>This lesson walks you through decoding large bitmaps without exceeding the per application memory limit.</dd><dt><strong><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html">Processing Bitmaps Off the UI Thread</a></strong></dt><dd>Bitmap processing (resizing, downloading from a remote source, etc.) should never take place on the main UI thread. This lesson walks you through processing bitmaps in a background thread using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> and explains how to handle concurrency issues.</dd><dt><strong><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html">Caching Bitmaps</a></strong></dt><dd>This lesson walks you through using a memory and disk bitmap cache to improve the responsiveness and fluidity of your UI when loading multiple bitmaps.</dd><dt><strong><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/manage-memory.html">Managing Bitmap Memory</a></strong></dt><dd>This lesson explains how to manage bitmap memory to maximize your app's performance.</dd><dt><strong><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/display-bitmap.html">Displaying Bitmaps in Your UI</a></strong></dt><dd>This lesson brings everything together, showing you how to load multiple bitmaps into components like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> using a background thread and bitmap cache.</dd><dd>
<h1>译：</h1>
</dd></dl>
<ul>
	<li><span style="color: #0000ff;"><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/load-bitmap.html"><span style="color: #0000ff;"><strong>高效的加载大图(Loading Large Bitmaps Efficiently)</strong></span></a></span>这节课会带领你学习如何解析很大的Bitmaps并且避免超出程序的内存限制。</li>
</ul>
<ul>
	<li><span style="color: #0000ff;"><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/process-bitmap.html"><span style="color: #0000ff;"><strong>非UI线程处理Bitmap(Processing Bitmaps Off the UI Thread)</strong></span></a></span>

处理Bitmap(裁剪,下载等操作)不能执行在主线程。这节课会带领你学习如何使用AsyncTask在后台线程对Bitmap进行处理，并解释如何处理并发带来的问题。</li>
</ul>
<ul>
	<li><span style="color: #0000ff;"><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/cache-bitmap.html"><span style="color: #0000ff;"><strong>缓存Bitmaps(Caching Bitmaps)</strong></span></a></span>

这节课会带领你学习如何使用内存与磁盘缓存来提升加载多张Bitmaps时的响应速度与流畅度。</li>
</ul>
<ul>
	<li><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/manage-memory.html"><strong>管理Bitmap占用的内存(Managing Bitmap Memory)</strong></a>

这节课会介绍为了最大化程序的性能如何管理Bitmap的内存占用。</li>
</ul>
<ul>
	<li><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/display-bitmap.html"><strong>在UI上显示Bitmap(Displaying Bitmaps in Your UI)</strong></a>

这节课会把前面介绍的内容综合起来，演示如何在类似<a href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html" target="_blank">ViewPager</a>与<a href="http://developer.android.com/reference/android/widget/GridView.html" target="_blank">GridView</a>的控件中使用后台线程与缓存进行加载多张Bitmaps。</li>
</ul>
<dl><dd></dd></dl><dl><dd></dd><dd></dd><dd></dd></dl>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>216</wp:post_id>
		<wp:post_date>2015-01-31 09:06:49</wp:post_date>
		<wp:post_date_gmt>2015-01-31 01:06:49</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>displaying-bitmaps-efficiently</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="bitmap"><![CDATA[bitmap]]></category>
		<category domain="post_tag" nicename="%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><![CDATA[性能优化]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707498]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Loading Large Bitmaps Efficiently</title>
		<link>http://1.duoinfo.sinaapp.com/?p=219</link>
		<pubDate>Sat, 31 Jan 2015 01:14:19 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=219</guid>
		<description></description>
		<content:encoded><![CDATA[Images come in all shapes and sizes. In many cases they are larger than required for a typical application user interface (UI). For example, the system Gallery application displays photos taken using your Android devices's camera which are typically much higher resolution than the screen density of your device.

Given that you are working with limited memory, ideally you only want to load a lower resolution version in memory. The lower resolution version should match the size of the UI component that displays it. An image with a higher resolution does not provide any visible benefit, but still takes up precious memory and incurs additional performance overhead due to additional on the fly scaling.

This lesson walks you through decoding large bitmaps without exceeding the per application memory limit by loading a smaller subsampled version in memory.

译：

图片有不同的形状与大小。在大多数情况下它们的实际大小都比需要呈现出来的要大很多。例如，系统的Gallery程序会显示那些你使用设备camera拍摄的图片，但是那些图片的分辨率通常都比你的设备屏幕分辨率要高很多。

考虑到程序是在有限的内存下工作，理想情况是你只需要在内存中加载一个低分辨率的版本即可。这个低分辨率的版本应该是与你的UI大小所匹配的，这样才便于显示。一个高分辨率的图片不会提供任何可见的好处，却会占用宝贵的(precious)的内存资源，并且会在快速滑动图片时导致(incurs)附加的效率问题。
<h2 id="read-bitmap">Read Bitmap Dimensions and Type</h2>

<hr />

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.html">BitmapFactory</a></code> class provides several decoding methods (<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.html#decodeByteArray(byte[], int, int, android.graphics.BitmapFactory.Options)">decodeByteArray()</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.html#decodeFile(java.lang.String, android.graphics.BitmapFactory.Options)">decodeFile()</a></code>,<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.html#decodeResource(android.content.res.Resources, int, android.graphics.BitmapFactory.Options)">decodeResource()</a></code>, etc.) for creating a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html">Bitmap</a></code> from various sources. Choose the most appropriate decode method based on your image data source. These methods attempt to allocate memory for the constructed bitmap and therefore can easily result in an <code>OutOfMemory</code> exception. Each type of decode method has additional signatures that let you specify decoding options via the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html">BitmapFactory.Options</a></code>class. Setting the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inJustDecodeBounds">inJustDecodeBounds</a></code> property to <code>true</code> while decoding avoids memory allocation, returning <code>null</code> for the bitmap object but setting <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#outWidth">outWidth</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#outHeight">outHeight</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#outMimeType">outMimeType</a></code>. This technique allows you to read the dimensions and type of the image data prior to construction (and memory allocation) of the bitmap.

[java]
BitmapFactory.Options options = new BitmapFactory.Options();
options.inJustDecodeBounds = true;
BitmapFactory.decodeResource(getResources(), R.id.myimage, options);
int imageHeight = options.outHeight;
int imageWidth = options.outWidth;
String imageType = options.outMimeType;
[/java]

To avoid <code>java.lang.OutOfMemory</code> exceptions, check the dimensions of a bitmap before decoding it, unless you absolutely trust the source to provide you with predictably sized image data that comfortably fits within the available memory.

译：

BitmapFactory 类提供了一些decode的方法 (<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeByteArray(byte[], int, int, android.graphics.BitmapFactory.Options)">decodeByteArray()</a>, <a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeFile(java.lang.String, android.graphics.BitmapFactory.Options)">decodeFile()</a>, <a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeResource(android.content.res.Resources, int, android.graphics.BitmapFactory.Options)">decodeResource()</a>, etc.) 用来从不同的资源中创建一个Bitmap. 根据你的图片数据源来选择合适的decode方法. 那些方法<span style="color: #000080;"><strong>在构造位图的时候会尝试分配内存</strong></span>，因此会容易导致<code>OutOfMemory</code>的异常。每一种decode方法都提供了通过<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html" target="_blank">BitmapFactory.Options</a> 来设置一些附加的标记来指定decode的选项。设置 <a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inJustDecodeBounds" target="_blank">inJustDecodeBounds</a> 属性<span style="color: #000080;"><strong>为<code>true</code>可以在decoding的时候避免内存的分配</strong></span>，它会返回一个<code>null</code>的bitmap，<strong><span style="color: #000080;">但是 outWidth, outHeight 与 outMimeType 还是可以获取</span></strong>。这个技术可以允许你在构造bitmap之前优先读图片的尺寸与类型。
<h2 id="load-bitmap">Load a Scaled Down Version into Memory</h2>

<hr />

Now that the image dimensions are known, they can be used to decide if the full image should be loaded into memory or if a subsampled version should be loaded instead. Here are some factors to consider:
<ul>
	<li>Estimated memory usage of loading the full image in memory.</li>
	<li>Amount of memory you are willing to commit to loading this image given any other memory requirements of your application.</li>
	<li>Dimensions of the target <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> or UI component that the image is to be loaded into.</li>
	<li>Screen size and density of the current device.</li>
</ul>
For example, it’s not worth loading a 1024x768 pixel image into memory if it will eventually be displayed in a 128x96 pixel thumbnail in an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>.

To tell the decoder to subsample the image, loading a smaller version into memory, set <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inSampleSize">inSampleSize</a></code>to <code>true</code> in your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html">BitmapFactory.Options</a></code> object. For example, an image with resolution 2048x1536 that is decoded with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inSampleSize">inSampleSize</a></code> of 4 produces a bitmap of approximately 512x384. Loading this into memory uses 0.75MB rather than 12MB for the full image (assuming a bitmap configuration of<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.Config.html">ARGB_8888</a></code>). Here’s a method to calculate a sample size value that is a power of two based on a target width and height:

译：

通过上面的步骤我们已经知道了图片的尺寸，那些数据可以用来决定是应该加载整个图片到内存中还是加载一个缩小的版本。有下面一些因素需要考虑：
<ul>
	<li><span style="color: #000080;">评估加载完整图片所需要耗费的内存。</span></li>
	<li><span style="color: #000080;">程序在加载这张图片时会涉及到其他内存需求。</span></li>
	<li><span style="color: #000080;">呈现这张图片的组件的尺寸大小。</span></li>
	<li><span style="color: #000080;">屏幕大小与当前设备的屏幕密度。</span></li>
</ul>
例如，如果把一个原图是<code>1024*768</code> pixel的图片显示到ImageView为<code>128*96</code> pixel的缩略图就没有必要把整张图片都加载到内存中。

为了告诉decoder去加载一个低版本的图片到内存，<span style="color: #000080;">需要在你的<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html" target="_blank"><span style="color: #000080;">BitmapFactory.Options</span></a> 中设置 inSampleSize 为 <code>true</code></span> 。For example, 一个分辨率为2048x1536 的图片，如果设置 inSampleSize 为4，那么会产出一个大概为512x384的bitmap。加载这张小的图片仅仅使用大概<span style="color: #000080;">0.75MB</span>，如果是加载全图那么大概要花费<span style="color: #000080;">12MB</span>(前提都是bitmap的配置是 ARGB_8888). 下面有一段根据目标图片大小来计算Sample图片大小的Sample Code:

[java]
&lt;pre&gt;public static int calculateInSampleSize(
            BitmapFactory.Options options, int reqWidth, int reqHeight) {
    // Raw height and width of image
    final int height = options.outHeight;
    final int width = options.outWidth;
    int inSampleSize = 1;

    if (height &gt; reqHeight || width &gt; reqWidth) {

        final int halfHeight = height / 2;
        final int halfWidth = width / 2;

        // Calculate the largest inSampleSize value that is a power of 2 and keeps both
        // height and width larger than the requested height and width.
        while ((halfHeight / inSampleSize) &gt; reqHeight
                &amp;&amp; (halfWidth / inSampleSize) &gt; reqWidth) {
            inSampleSize *= 2;
        }
    }

    return inSampleSize;
}&lt;/pre&gt;
[/java]

<strong>Note:</strong> A power of two value is calculated because the decoder uses a final value by rounding down to the nearest power of two, as per the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inSampleSize">inSampleSize</a></code> documentation.(文档是这样说的：If set to a value &gt; 1, requests the decoder to subsample the original image, returning a smaller image to save memory. The sample size is the number of pixels in either dimension that correspond to a single pixel in the decoded bitmap. For example, inSampleSize == 4 returns an image that is 1/4 the width/height of the original, and 1/16 the number of pixels. Any value &lt;= 1 is treated the same as 1. Note: the decoder uses a final value based on powers of 2, any other value will be rounded down to the nearest power of 2.)假如inSampleSize为4，宽高尺寸会缩小到原来的四分之一，分辨率会缩小到原来的十六分之一。如果inSampleSize小于等于1，则其为1.

To use this method, first decode with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inJustDecodeBounds">inJustDecodeBounds</a></code> set to <code>true</code>, pass the options through and then decode again using the new <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inSampleSize">inSampleSize</a></code> value and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inJustDecodeBounds">inJustDecodeBounds</a></code> set to <code>false</code>:

译：

为了使用这个方法，首先需要设置 <a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inJustDecodeBounds" target="_blank">inJustDecodeBounds</a> 为 <code>true</code>, 把options的值传递过来，然后使用<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inSampleSize" target="_blank">inSampleSize</a> 的值并设置 inJustDecodeBounds 为 <code>false</code> 来重新Decode一遍。

[java]
&lt;pre&gt;public static Bitmap decodeSampledBitmapFromResource(Resources res, int resId,
        int reqWidth, int reqHeight) {

    // First decode with inJustDecodeBounds=true to check dimensions
    final BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeResource(res, resId, options);

    // Calculate inSampleSize
    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);

    // Decode bitmap with inSampleSize set
    options.inJustDecodeBounds = false;
    return BitmapFactory.decodeResource(res, resId, options);
}&lt;/pre&gt;
[/java]

This method makes it easy to load a bitmap of arbitrarily large size into an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> that displays a 100x100 pixel thumbnail, as shown in the following example code:

译：使用上面这个方法可以简单的加载一个任意大小的图片并显示为100*100 pixel的缩略图形式。像下面演示的一样:

[java]
&lt;pre&gt;mImageView.setImageBitmap(
    decodeSampledBitmapFromResource(getResources(), R.id.myimage, 100, 100));&lt;/pre&gt;
[/java]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>219</wp:post_id>
		<wp:post_date>2015-01-31 09:14:19</wp:post_date>
		<wp:post_date_gmt>2015-01-31 01:14:19</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>loading-large-bitmaps-efficiently</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="bitmap"><![CDATA[bitmap]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707499]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Processing Bitmaps Off the UI Thread</title>
		<link>http://1.duoinfo.sinaapp.com/?p=223</link>
		<pubDate>Sat, 31 Jan 2015 03:59:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=223</guid>
		<description></description>
		<content:encoded><![CDATA[The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.html#decodeByteArray(byte[], int, int, android.graphics.BitmapFactory.Options)">BitmapFactory.decode*</a></code> methods, discussed in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/load-bitmap.html">Load Large Bitmaps Efficiently</a> lesson, should not be executed on the main UI thread if the source data is read from disk or a network location (or really any source other than memory). The time this data takes to load is unpredictable and depends on a variety of factors (speed of reading from disk or network, size of image, power of CPU, etc.). If one of these tasks blocks the UI thread, the system flags your application as non-responsive and the user has the option of closing it (see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/practices/responsiveness.html">Designing for Responsiveness</a> for more information).

This lesson walks you through processing bitmaps in a background thread using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> and shows you how to handle concurrency issues.

译：

在上一课中有介绍一系列的<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeByteArray(byte[], int, int, android.graphics.BitmapFactory.Options" target="_blank">BitmapFactory.decode*</a>) 方法，当数据源是网络或者是磁盘时(或者是任何实际源不在内存的)，这些方法都不应该在main UI 线程中执行。那些情况下加载数据是不可以预知的，它依赖于许多因素(从网络或者硬盘读取数据的速度, 图片的大小, CPU的速度, etc.)。如果其中任何一个任务卡住了UI thread, 系统会出现ANR的错误。

这一节课会介绍如何使用 AsyncTask 在后台线程中处理bitmap并且演示了如何处理并发(concurrency)的问题。
<h2 id="async-task">Use an AsyncTask</h2>

<hr />

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> class provides an easy way to execute some work in a background thread and publish the results back on the UI thread. To use it, create a subclass and override the provided methods. Here’s an example of loading a large image into an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> and <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/load-bitmap.html#decodeSampledBitmapFromResource"><code>decodeSampledBitmapFromResource()</code></a>:

译：

<a href="http://developer.android.com/reference/android/os/AsyncTask.html" target="_blank">AsyncTask</a> 类提供了一个简单的方法来在后台线程执行一些操作，并且可以把后台的结果呈现到UI线程。下面是一个加载大图的示例：

[java]
&lt;pre&gt;class BitmapWorkerTask extends AsyncTask&lt;Integer, Void, Bitmap&gt; {
    private final WeakReference&lt;ImageView&gt; imageViewReference;
    private int data = 0;

    public BitmapWorkerTask(ImageView imageView) {
        // Use a WeakReference to ensure the ImageView can be garbage collected
        imageViewReference = new WeakReference&lt;ImageView&gt;(imageView);
    }

    // Decode image in background.
    @Override
    protected Bitmap doInBackground(Integer... params) {
        data = params[0];
        return decodeSampledBitmapFromResource(getResources(), data, 100, 100));
    }

    // Once complete, see if ImageView is still around and set bitmap.
    @Override
    protected void onPostExecute(Bitmap bitmap) {
        if (imageViewReference != null &amp;&amp; bitmap != null) {
            final ImageView imageView = imageViewReference.get();
            if (imageView != null) {
                imageView.setImageBitmap(bitmap);
            }
        }
    }
}&lt;/pre&gt;
[/java]

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/ref/WeakReference.html">WeakReference</a></code> to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> ensures that the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> does not prevent the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> and anything it references from being garbage collected. There’s no guarantee the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> is still around when the task finishes, so you must also check the reference in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html#onPostExecute(Result)">onPostExecute()</a></code>. The<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> may no longer exist, if for example, the user navigates away from the activity or if a configuration change happens before the task finishes.

To start loading the bitmap asynchronously, simply create a new task and execute it:

译：

为<a href="http://developer.android.com/reference/android/widget/ImageView.html" target="_blank">ImageView</a>使用<a href="http://developer.android.com/reference/java/lang/ref/WeakReference.html" target="_blank">WeakReference</a> 确保了 AsyncTask 所引用的资源可以被GC(garbage collected)。因为当任务结束时不能确保 <a href="http://developer.android.com/reference/android/widget/ImageView.html" target="_blank">ImageView</a> 仍然存在，因此你必须在 onPostExecute() 里面去检查引用。这个ImageView 也许已经不存在了，例如，在任务结束时用户已经不在那个Activity或者是设备已经发生配置改变(旋转屏幕等)。

开始异步加载位图，只需要创建一个新的任务并执行它即可:

[java]
&lt;pre&gt;public void loadBitmap(int resId, ImageView imageView) {
    BitmapWorkerTask task = new BitmapWorkerTask(imageView);
    task.execute(resId);
}&lt;/pre&gt;
[/java]
<h2 id="concurrency">Handle Concurrency</h2>

<hr />

Common view components such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> introduce another issue when used in conjunction with the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> as demonstrated in the previous section. In order to be efficient with memory, these components recycle child views as the user scrolls. If each child view triggers an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code>, there is no guarantee that when it completes, the associated view has not already been recycled for use in another child view. Furthermore, there is no guarantee that the order in which asynchronous tasks are started is the order that they complete.

注：这么的一段话，我不翻译了，翻译过来就变了味道。慢慢体会。

The blog post <a href="http://android-developers.blogspot.com/2010/07/multithreading-for-performance.html">Multithreading for Performance</a> further discusses dealing with concurrency, and offers a solution where the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> stores a reference to the most recent <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> which can later be checked when the task completes. Using a similar method, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> from the previous section can be extended to follow a similar pattern.

译：<a href="http://android-developers.blogspot.com/2010/07/multithreading-for-performance.html" target="_blank">Multithreading for Performance</a> 这篇博文更进一步的讨论了如何处理并发并且提供了一种解决方法，当任务结束时ImageView 保存一个最近常使用的AsyncTask引用。使用类似的方法, AsyncTask 可以扩展出一个类似的模型。创建一个专用的 Drawable 子类来保存一个可以回到当前工作任务的引用。在这种情况下，BitmapDrawable 被用来作为占位图片，它可以在任务结束时显示到ImageView中。

注：上面的翻译始终感觉很挫。还是看英文吧。

Create a dedicated <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/drawable/Drawable.html">Drawable</a></code> subclass to store a reference back to the worker task. In this case, a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/drawable/BitmapDrawable.html">BitmapDrawable</a></code> is used so that a placeholder image can be displayed in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> while the task completes:

译：

创建一个专用的<a href="http://developer.android.com/reference/android/graphics/drawable/Drawable.html" target="_blank">Drawable</a>的子类来储存返回工作任务的引用。在这种情况下，当任务完成时<a href="http://developer.android.com/reference/android/graphics/drawable/BitmapDrawable.html" target="_blank">BitmapDrawable</a>会被使用，placeholder image才会在<a href="http://developer.android.com/reference/android/widget/ImageView.html" target="_blank">ImageView</a>中被显示:

[java]
&lt;pre&gt;static class AsyncDrawable extends BitmapDrawable {
    private final WeakReference&lt;BitmapWorkerTask&gt; bitmapWorkerTaskReference;

    public AsyncDrawable(Resources res, Bitmap bitmap,
            BitmapWorkerTask bitmapWorkerTask) {
        super(res, bitmap);
        bitmapWorkerTaskReference =
            new WeakReference&lt;BitmapWorkerTask&gt;(bitmapWorkerTask);
    }

    public BitmapWorkerTask getBitmapWorkerTask() {
        return bitmapWorkerTaskReference.get();
    }
}&lt;/pre&gt;
[/java]

Before executing the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#BitmapWorkerTask"><code>BitmapWorkerTask</code></a>, you create an <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#AsyncDrawable"><code>AsyncDrawable</code></a> and bind it to the target<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>:

[java]
&lt;pre&gt;public void loadBitmap(int resId, ImageView imageView) {
    if (cancelPotentialWork(resId, imageView)) {
        final BitmapWorkerTask task = new BitmapWorkerTask(imageView);
        final AsyncDrawable asyncDrawable =
                new AsyncDrawable(getResources(), mPlaceHolderBitmap, task);
        imageView.setImageDrawable(asyncDrawable);
        task.execute(resId);
    }
}&lt;/pre&gt;
[/java]

The <code>cancelPotentialWork</code> method referenced in the code sample above checks if another running task is already associated with the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>. If so, it attempts to cancel the previous task by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html#cancel(boolean)">cancel()</a></code>. In a small number of cases, the new task data matches the existing task and nothing further needs to happen. Here is the implementation of <code>cancelPotentialWork</code>:

[java]
&lt;pre&gt;public static boolean cancelPotentialWork(int data, ImageView imageView) {
    final BitmapWorkerTask bitmapWorkerTask = getBitmapWorkerTask(imageView);

    if (bitmapWorkerTask != null) {
        final int bitmapData = bitmapWorkerTask.data;
        // If bitmapData is not yet set or it differs from the new data
        if (bitmapData == 0 || bitmapData != data) {
            // Cancel previous task
            bitmapWorkerTask.cancel(true);
        } else {
            // The same work is already in progress
            return false;
        }
    }
    // No task associated with the ImageView, or an existing task was cancelled
    return true;
}&lt;/pre&gt;
[/java]

A helper method, <code>getBitmapWorkerTask()</code>, is used above to retrieve the task associated with a particular <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>:

[java]
&lt;pre&gt;private static BitmapWorkerTask getBitmapWorkerTask(ImageView imageView) {
   if (imageView != null) {
       final Drawable drawable = imageView.getDrawable();
       if (drawable instanceof AsyncDrawable) {
           final AsyncDrawable asyncDrawable = (AsyncDrawable) drawable;
           return asyncDrawable.getBitmapWorkerTask();
       }
    }
    return null;
}&lt;/pre&gt;
[/java]

[java]
&lt;pre&gt;class BitmapWorkerTask extends AsyncTask&lt;Integer, Void, Bitmap&gt; {
...

@Override
protected void onPostExecute(Bitmap bitmap) {
&lt;strong&gt;if (isCancelled()) {
bitmap = null;
}&lt;/strong&gt;

if (imageViewReference != null &amp;&amp; bitmap != null) {
final ImageView imageView = imageViewReference.get();
&lt;strong&gt;final BitmapWorkerTask bitmapWorkerTask =
getBitmapWorkerTask(imageView);&lt;/strong&gt;
if (&lt;strong&gt;this == bitmapWorkerTask &amp;&amp;&lt;/strong&gt; imageView != null) {
imageView.setImageBitmap(bitmap);
}
}
}
}
[/java]

This implementation is now suitable for use in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> components as well as any other components that recycle their child views. Simply call <code>loadBitmap</code> where you normally set an image to your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>. For example, in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> implementation this would be in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Adapter.html#getView(int, android.view.View, android.view.ViewGroup)">getView()</a></code> method of the backing adapter.

译：

这个方法不仅仅适用于 ListView 与 GridView 组件，在那些需要循环利用子视图的组件中同样适用。只需要在设置图片到ImageView的地方调用 <code>loadBitmap</code> 方法。例如，在GridView 中实现这个方法会是在 getView() 方法里面调用。

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>223</wp:post_id>
		<wp:post_date>2015-01-31 11:59:00</wp:post_date>
		<wp:post_date_gmt>2015-01-31 03:59:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>processing-bitmaps-off-the-ui-thread</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="bitmapdrawable"><![CDATA[BitmapDrawable]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707500]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Caching Bitmaps</title>
		<link>http://1.duoinfo.sinaapp.com/?p=228</link>
		<pubDate>Mon, 02 Feb 2015 02:23:08 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=228</guid>
		<description></description>
		<content:encoded><![CDATA[Loading a single bitmap into your user interface (UI) is straightforward, however things get more complicated if you need to load a larger set of images at once. In many cases (such as with components like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code>), the total number of images on-screen combined with images that might soon scroll onto the screen are essentially unlimited.

Memory usage is kept down with components like this by recycling the child views as they move off-screen. The garbage collector also frees up your loaded bitmaps, assuming you don't keep any long lived references. This is all good and well, but in order to keep a fluid and fast-loading UI you want to avoid continually processing these images each time they come back on-screen. A memory and disk cache can often help here, allowing components to quickly reload processed images.

This lesson walks you through using a memory and disk bitmap cache to improve the responsiveness and fluidity of your UI when loading multiple bitmaps.

译：

加载单个Bitmap到UI是简单直接的，但是如果你需要一次加载大量的图片，事情则会变得复杂起来。在大多数情况下(例如在使用ListView,GridView或ViewPager时), 屏幕上的图片和因滑动将要显示的图片的数量通常是没有限制的。

通过循环利用子视图可以抑制内存的使用，GC(garbage collector)也会释放那些不再需要使用的bitmap。这些机制都非常好，但是为了保持一个流畅的用户体验，你想要在屏幕滑回来时避免每次重复处理那些图片。内存与磁盘缓存通常可以起到帮助的作用，允许组件快速的重新加载那些处理过的图片。

这一课会介绍在加载多张位图时使用内存Cache与磁盘Cache来提高反应速度与UI的流畅度。
<h2 id="memory-cache">Use a Memory Cache</h2>

<hr />

A memory cache offers fast access to bitmaps at the cost of taking up valuable application memory. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code> class (also available in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/util/LruCache.html">Support Library</a> for use back to API Level 4) is particularly well suited to the task of caching bitmaps, keeping recently referenced objects in a strong referenced <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/util/LinkedHashMap.html">LinkedHashMap</a></code> and evicting the least recently used member before the cache exceeds its designated size.

<strong>Note:</strong> In the past, a popular memory cache implementation was a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/ref/SoftReference.html">SoftReference</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/ref/WeakReference.html">WeakReference</a></code>bitmap cache, however this is not recommended. Starting from Android 2.3 (API Level 9) the garbage collector is more aggressive with collecting soft/weak references which makes them fairly ineffective. In addition, prior to Android 3.0 (API Level 11), the backing data of a bitmap was stored in native memory which is not released in a predictable manner, potentially causing an application to briefly exceed its memory limits and crash.

In order to choose a suitable size for a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code>, a number of factors should be taken into consideration, for example:

译：

内存缓存以花费宝贵的程序内存为前提来快速访问位图。<a href="http://developer.android.com/reference/android/util/LruCache.html" target="_blank">LruCache</a> 类(在API Level 4的Support Library中也可以找到) 特别合适用来caching bitmaps，用一个强引用(strong referenced)的 <a href="http://developer.android.com/reference/java/util/LinkedHashMap.html" target="_blank">LinkedHashMap</a> 来保存最近引用的对象，并且在Cache超出设置大小的时候踢出(evict)最近最少使用到的对象。
<blockquote><strong>Note:</strong> 在过去, 一个比较流行的内存缓存的实现方法是使用软引用(SoftReference)或弱引用(WeakReference)bitmap缓存, 然而这是不推荐的。从Android 2.3 (API Level 9) 开始，GC变得更加频繁的去释放soft/weak references，这使得他们就显得效率低下。而且在Android 3.0 (API Level 11)之前，备份的bitmap是存放在native memory 中，它不是以可预知的方式被释放，这样可能导致程序超出它的内存限制而崩溃。</blockquote>
为了给LruCache选择一个合适的大小，有下面一些因素需要考虑到：
<ul>
	<li>How memory intensive is the rest of your activity and/or application?</li>
	<li>How many images will be on-screen at once? How many need to be available ready to come on-screen?</li>
	<li>What is the screen size and density of the device? An extra high density screen (xhdpi) device like <a href="http://www.android.com/devices/detail/galaxy-nexus">Galaxy Nexus</a> will need a larger cache to hold the same number of images in memory compared to a device like <a href="http://www.android.com/devices/detail/nexus-s">Nexus S</a> (hdpi).</li>
	<li>What dimensions and configuration are the bitmaps and therefore how much memory will each take up?</li>
	<li>How frequently will the images be accessed? Will some be accessed more frequently than others? If so, perhaps you may want to keep certain items always in memory or even have multiple <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code>objects for different groups of bitmaps.</li>
	<li>Can you balance quality against quantity? Sometimes it can be more useful to store a larger number of lower quality bitmaps, potentially loading a higher quality version in another background task.</li>
</ul>
译：
<ul>
	<li>你的程序剩下了多少可用的内存?</li>
	<li>多少图片会被一次呈现到屏幕上？有多少图片需要准备好以便马上显示到屏幕？</li>
	<li>设备的屏幕大小与密度是多少? 一个具有特别高密度屏幕(xhdpi)的设备，像 Galaxy Nexus 会比 Nexus S (hdpi)需要一个更大的Cache来缓存同样数量的图片.</li>
	<li>位图的尺寸与配置是多少，会花费多少内存？</li>
	<li>图片被访问的频率如何？是其中一些比另外的访问更加频繁吗？如果是，也许你想要保存那些最常访问的到内存中，或者为不同组别的位图(按访问频率分组)设置多个LruCache 对象。</li>
	<li>你可以平衡质量与数量吗? 某些时候保存大量低质量的位图会非常有用，在加载更高质量图片的任务则交给另外一个后台线程。</li>
</ul>
没有指定的大小与公式能够适用与所有的程序，你需要负责分析你的使用情况后提出一个合适的解决方案。一个太小的Cache会导致额外的花销却没有明显的好处，一个太大的Cache同样会导致java.lang.OutOfMemory的异常(Cache占用太多内存，其他活动则会因为内存不够而异常)，并且使得你的程序只留下小部分的内存用来工作。

下面是一个为bitmap建立LruCache 的示例：

[java]private LruCache&lt;String, Bitmap&gt; mMemoryCache;

@Override
protected void onCreate(Bundle savedInstanceState) {
...
// Get max available VM memory, exceeding this amount will throw an
// OutOfMemory exception. Stored in kilobytes as LruCache takes an
// int in its constructor.
final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);

// Use 1/8th of the available memory for this memory cache.
final int cacheSize = maxMemory / 8;

mMemoryCache = new LruCache&lt;String, Bitmap&gt;(cacheSize) {
@Override
protected int sizeOf(String key, Bitmap bitmap) {
// The cache size will be measured in kilobytes rather than
// number of items.
return bitmap.getByteCount() / 1024;
}
};
...
}

public void addBitmapToMemoryCache(String key, Bitmap bitmap) {
if (getBitmapFromMemCache(key) == null) {
mMemoryCache.put(key, bitmap);
}
}

public Bitmap getBitmapFromMemCache(String key) {
return mMemoryCache.get(key);
}[/java]

<strong>Note:</strong> In this example, one eighth of the application memory is allocated for our cache. On a normal/hdpi device this is a minimum of around 4MB (32/8). A full screen <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> filled with images on a device with 800x480 resolution would use around 1.5MB (800*480*4 bytes), so this would cache a minimum of around 2.5 pages of images in memory.

When loading a bitmap into an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code> is checked first. If an entry is found, it is used immediately to update the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code>, otherwise a background thread is spawned to process the image:

译：
<blockquote><strong>Note:</strong>在上面的例子中, 有1/8的程序内存被作为Cache. 在一个常见的设备上(hdpi)，最小大概有4MB (32/8). 如果一个填满图片的GridView组件放置在800x480像素的手机屏幕上，大概会花费1.5MB (800x480x4 bytes), 因此缓存的容量大概可以缓存2.5页的图片内容.</blockquote>
当加载位图到 ImageView 时，LruCache 会先被检查是否存在这张图片。如果找到有，它会被用来立即更新 ImageView 组件，否则一个后台线程则被触发去处理这张图片。

[java]public void loadBitmap(int resId, ImageView imageView) {
final String imageKey = String.valueOf(resId);

final Bitmap bitmap = getBitmapFromMemCache(imageKey);
if (bitmap != null) {
mImageView.setImageBitmap(bitmap);
} else {
mImageView.setImageResource(R.drawable.image_placeholder);
BitmapWorkerTask task = new BitmapWorkerTask(mImageView);
task.execute(resId);
}
}[/java]

The <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#BitmapWorkerTask"><code>BitmapWorkerTask</code></a> also needs to be updated to add entries to the memory cache:

[java]class BitmapWorkerTask extends AsyncTask&lt;Integer, Void, Bitmap&gt; {
...
// Decode image in background.
@Override
protected Bitmap doInBackground(Integer... params) {
final Bitmap bitmap = decodeSampledBitmapFromResource(
getResources(), params[0], 100, 100));
addBitmapToMemoryCache(String.valueOf(params[0]), bitmap);
return bitmap;
}
...
}[/java]
<h2 id="disk-cache">Use a Disk Cache</h2>

<hr />

A memory cache is useful in speeding up access to recently viewed bitmaps, however you cannot rely on images being available in this cache. Components like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> with larger datasets can easily fill up a memory cache. Your application could be interrupted by another task like a phone call, and while in the background it might be killed and the memory cache destroyed. Once the user resumes, your application has to process each image again.

A disk cache can be used in these cases to persist processed bitmaps and help decrease loading times where images are no longer available in a memory cache. Of course, fetching images from disk is slower than loading from memory and should be done in a background thread, as disk read times can be unpredictable.

译：

内存缓存能够提高访问最近查看过的位图的速度，但是你不能保证这个图片会在Cache中。像类似 GridView 等带有大量数据的组件很容易就填满内存Cache。你的程序可能会被类似Phone call等任务而中断，这样后台程序可能会被杀死，那么内存缓存就会被销毁。一旦用户恢复前面的状态，你的程序就又需要重新处理每个图片。

磁盘缓存可以用来保存那些已经处理好的位图，并且在那些图片在内存缓存中不可用时减少加载的次数。当然从磁盘读取图片会比从内存要慢，而且读取操作需要在后台线程中处理，因为磁盘读取操作是不可预期的。

<strong>Note:</strong> A <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/ContentProvider.html">ContentProvider</a></code> might be a more appropriate place to store cached images if they are accessed more frequently, for example in an image gallery application.

The sample code of this class uses a <code>DiskLruCache</code> implementation that is pulled from the <a href="https://android.googlesource.com/platform/libcore/+/jb-mr2-release/luni/src/main/java/libcore/io/DiskLruCache.java">Android source</a>. Here’s updated example code that adds a disk cache in addition to the existing memory cache:

译：
<blockquote><strong>Note:</strong>如果图片被更频繁的访问到，也许使用 <a href="http://developer.android.com/reference/android/content/ContentProvider.html" target="_blank">ContentProvider</a> 会更加的合适，比如在Gallery程序中。</blockquote>
这一节的范例代码中使用了一个从<a href="https://android.googlesource.com/platform/libcore/+/jb-mr2-release/luni/src/main/java/libcore/io/DiskLruCache.java" target="_blank">Android源码</a>中剥离出来的 <code>DiskLruCache</code> 。升级过的范例代码给已有的内存缓存添加了磁盘缓存.

[java]private DiskLruCache mDiskLruCache;
private final Object mDiskCacheLock = new Object();
private boolean mDiskCacheStarting = true;
private static final int DISK_CACHE_SIZE = 1024 * 1024 * 10; // 10MB
private static final String DISK_CACHE_SUBDIR = &quot;thumbnails&quot;;

@Override
protected void onCreate(Bundle savedInstanceState) {
...
// Initialize memory cache
...
// Initialize disk cache on background thread
File cacheDir = getDiskCacheDir(this, DISK_CACHE_SUBDIR);
new InitDiskCacheTask().execute(cacheDir);
...
}

class InitDiskCacheTask extends AsyncTask&lt;File, Void, Void&gt; {
@Override
protected Void doInBackground(File... params) {
synchronized (mDiskCacheLock) {
File cacheDir = params[0];
mDiskLruCache = DiskLruCache.open(cacheDir, DISK_CACHE_SIZE);
mDiskCacheStarting = false; // Finished initialization
mDiskCacheLock.notifyAll(); // Wake any waiting threads
}
return null;
}
}

class BitmapWorkerTask extends AsyncTask&lt;Integer, Void, Bitmap&gt; {
...
// Decode image in background.
@Override
protected Bitmap doInBackground(Integer... params) {
final String imageKey = String.valueOf(params[0]);

// Check disk cache in background thread
Bitmap bitmap = getBitmapFromDiskCache(imageKey);

if (bitmap == null) { // Not found in disk cache
// Process as normal
final Bitmap bitmap = decodeSampledBitmapFromResource(
getResources(), params[0], 100, 100));
}

// Add final bitmap to caches
addBitmapToCache(imageKey, bitmap);

return bitmap;
}
...
}

public void addBitmapToCache(String key, Bitmap bitmap) {
// Add to memory cache as before
if (getBitmapFromMemCache(key) == null) {
mMemoryCache.put(key, bitmap);
}

// Also add to disk cache
synchronized (mDiskCacheLock) {
if (mDiskLruCache != null &amp;&amp; mDiskLruCache.get(key) == null) {
mDiskLruCache.put(key, bitmap);
}
}
}

public Bitmap getBitmapFromDiskCache(String key) {
synchronized (mDiskCacheLock) {
// Wait while disk cache is started from background thread
while (mDiskCacheStarting) {
try {
mDiskCacheLock.wait();
} catch (InterruptedException e) {}
}
if (mDiskLruCache != null) {
return mDiskLruCache.get(key);
}
}
return null;
}

// Creates a unique subdirectory of the designated app cache directory. Tries to use external
// but if not mounted, falls back on internal storage.
public static File getDiskCacheDir(Context context, String uniqueName) {
// Check if media is mounted or storage is built-in, if so, try and use external cache dir
// otherwise use internal cache dir
final String cachePath =
Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState()) ||
!isExternalStorageRemovable() ? getExternalCacheDir(context).getPath() :
context.getCacheDir().getPath();

return new File(cachePath + File.separator + uniqueName);
}[/java]
备注：
Google给的上面的代码做了很多简化，实际需要参考DiskLruCache的源码，参考Google给的DisplayBitmap的这个demo.</pre>
<strong>Note:</strong> Even initializing the disk cache requires disk operations and therefore should not take place on the main thread. However, this does mean there's a chance the cache is accessed before initialization. To address this, in the above implementation, a lock object ensures that the app does not read from the disk cache until the cache has been initialized.

While the memory cache is checked in the UI thread, the disk cache is checked in the background thread. Disk operations should never take place on the UI thread. When image processing is complete, the final bitmap is added to both the memory and disk cache for future use.
<pre>译：</pre>
<blockquote><strong>Note</strong>:初始化磁盘缓存涉及到I/O操作，所以不应该在主线程中进行。但是这也意味着在初始化完成之前缓存可以被访问。为了解决这个问题，在上面的实现中，有一个锁对象(lock object)用来确保在磁盘缓存完成初始化之前，app无法对它进行读取。</blockquote>
内存缓存的检查是可以在UI线程中进行的，磁盘缓存的检查需要在后台线程中处理。磁盘操作永远都不应该在UI线程中发生。当图片处理完成后，最后的位图需要添加到内存缓存与磁盘缓存中，方便之后的使用。
<h2 id="config-changes">Handle Configuration Changes</h2>

<hr />

Runtime configuration changes, such as a screen orientation change, cause Android to destroy and restart the running activity with the new configuration (For more information about this behavior, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/resources/runtime-changes.html">Handling Runtime Changes</a>). You want to avoid having to process all your images again so the user has a smooth and fast experience when a configuration change occurs.

Luckily, you have a nice memory cache of bitmaps that you built in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html#memory-cache">Use a Memory Cache</a> section. This cache can be passed through to the new activity instance using a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> which is preserved by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html#setRetainInstance(boolean)">setRetainInstance(true)</a></code>). After the activity has been recreated, this retained <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> is reattached and you gain access to the existing cache object, allowing images to be quickly fetched and re-populated into the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> objects.

Here’s an example of retaining a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code> object across configuration changes using a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code>:

译：

运行时配置改变，例如屏幕方向的改变会导致Android去destory并restart当前运行的Activity。(关于这一行为的更多信息，请参考<a href="http://developer.android.com/guide/topics/resources/runtime-changes.html" target="_blank">Handling Runtime Changes</a>). 你需要在配置改变时避免重新处理所有的图片，这样才能提供给用户一个良好的平滑过度的体验。

幸运的是，在前面介绍Use a Memory Cache的部分，你已经知道如何建立一个内存缓存。通过调用<a href="http://developer.android.com/reference/android/app/Fragment.html#setRetainInstance(boolean" target="_blank">setRetainInstance(true)</a>)保留一个<a href="http://developer.android.com/reference/android/app/Fragment.html" target="_blank">Fragment</a>实例, 这个缓存可以通过被保留的Fragment传递给新的Activity实例。在这个activity被recreate之后, 这个保留的 Fragment 会被重新附着上。这样你就可以访问Cache对象，从中获取到图片信息并快速的重新添加到ImageView对象中。

下面是配置改变时使用Fragment来保留LruCache 的示例：（翻译的变味了。。。）

[java]private LruCache&lt;String, Bitmap&gt; mMemoryCache;

@Override
protected void onCreate(Bundle savedInstanceState) {
...
RetainFragment retainFragment =
RetainFragment.findOrCreateRetainFragment(getFragmentManager());
mMemoryCache = retainFragment.mRetainedCache;
if (mMemoryCache == null) {
mMemoryCache = new LruCache&lt;String, Bitmap&gt;(cacheSize) {
... // Initialize cache here as usual
}
retainFragment.mRetainedCache = mMemoryCache;
}
...
}

class RetainFragment extends Fragment {
private static final String TAG = &quot;RetainFragment&quot;;
public LruCache&lt;String, Bitmap&gt; mRetainedCache;

public RetainFragment() {}

public static RetainFragment findOrCreateRetainFragment(FragmentManager fm) {
RetainFragment fragment = (RetainFragment) fm.findFragmentByTag(TAG);
if (fragment == null) {
fragment = new RetainFragment();
fm.beginTransaction().add(fragment, TAG).commit();
}
return fragment;
}

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
&lt;strong&gt;setRetainInstance(true);&lt;/strong&gt;
}
}[/java]

To test this out, try rotating a device both with and without retaining the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code>. You should notice little to no lag as the images populate the activity almost instantly from memory when you retain the cache. Any images not found in the memory cache are hopefully available in the disk cache, if not, they are processed as usual.

为了测试上面的效果，尝试在保留Fragment与没有这样做的情况下旋转屏幕。你会发现当你保留缓存时,从内存缓存中重新绘制几乎没有延迟的现象. 内存缓存中没有的图片可能在存在磁盘缓存中.如果两个缓存中都没有，则图像会像平时一样被处理。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>228</wp:post_id>
		<wp:post_date>2015-02-02 10:23:08</wp:post_date>
		<wp:post_date_gmt>2015-02-02 02:23:08</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>caching-bitmaps</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="bitmap"><![CDATA[bitmap]]></category>
		<category domain="post_tag" nicename="disklrucache"><![CDATA[DiskLruCache]]></category>
		<category domain="post_tag" nicename="handle-configuration-changes"><![CDATA[Handle Configuration Changes]]></category>
		<category domain="post_tag" nicename="lrucache"><![CDATA[LruCache]]></category>
		<category domain="post_tag" nicename="%e5%b1%8f%e5%b9%95%e6%97%8b%e8%bd%ac%e5%a4%84%e7%90%86"><![CDATA[屏幕旋转处理]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707501]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Managing Bitmap Memory</title>
		<link>http://1.duoinfo.sinaapp.com/?p=230</link>
		<pubDate>Mon, 02 Feb 2015 02:42:42 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=230</guid>
		<description></description>
		<content:encoded><![CDATA[In addition to the steps described in <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html">Caching Bitmaps</a>, there are specific things you can do to facilitate garbage collection and bitmap reuse. The recommended strategy depends on which version(s) of Android you are targeting. The <a href="http://developer.android.com/downloads/samples/DisplayingBitmaps.zip" target="_blank">DisplayingBitmaps</a> sample app included with this class shows you how to design your app to work efficiently across different versions of Android.

To set the stage for this lesson, here is how Android's management of bitmap memory has evolved:
<ul>
	<li>On Android Android 2.2 (API level 8) and lower, when garbage collection occurs, your app's threads get stopped. This causes a lag that can degrade performance. <strong>Android 2.3 adds concurrent garbage collection, which means that the memory is reclaimed soon after a bitmap is no longer referenced.</strong></li>
	<li>On Android 2.3.3 (API level 10) and lower, the backing pixel data for a bitmap is stored in native memory. It is separate from the bitmap itself, which is stored in the Dalvik heap. The pixel data in native memory is not released in a predictable manner, potentially causing an application to briefly exceed its memory limits and crash. <strong>As of Android 3.0 (API level 11), the pixel data is stored on the Dalvik heap along with the associated bitmap.</strong></li>
</ul>
The following sections describe how to optimize bitmap memory management for different Android versions.

译：

作为缓存Bitmaps的进一步延伸, 为了促进GC与bitmap的重用，你还有一些特定的事情可以做. 推荐的策略会根据Android的版本不同而有所差异. <a href="http://developer.android.com/downloads/samples/DisplayingBitmaps.zip" target="_blank">DisplayingBitmaps</a>的示例程序会演示如何设计你的程序使得能够在不同的Android平台上高效的运行.

为了给这节课奠定基础，我们首先要知道Android管理bitmap memory的演变进程:
<ul>
	<li>在Android 2.2 (API level 8)以及之前, 当GC发生时, 你的应用的线程是会stopped的. 这导致了一个滞后，它会降低效率. <strong>在Android 2.3上，添加了并发GC的机制, 这意味着在一个bitmap不再被引用到之后，内存会被立即回收.</strong></li>
	<li>在Android 2.3.3 (API level 10)以及之前, 一个bitmap的像素级数据是存放在native内存中的. 这些数据与bitmap本身是隔离的, bitmap本身是被存放在Dalvik heap中。在native内存中的pixel数据的释放是不可预测的，这意味着有可能导致一个程序容易超过它的内存限制并Crash。 <strong>自Android 3.0 (API Level 11)起, pixel数据则是与bitmap本身一起存放在dalvik heap中。</strong></li>
</ul>
下面会介绍如何在不同的Android版本上优化bitmap内存使用。
<h2 id="recycle">Manage Memory on Android 2.3.3 and Lower</h2>

<hr />

On Android 2.3.3 (API level 10) and lower, using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html#recycle()">recycle()</a></code> is recommended. If you're displaying large amounts of bitmap data in your app, you're likely to run into <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/OutOfMemoryError.html">OutOfMemoryError</a></code> errors. The<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html#recycle()">recycle()</a></code> method allows an app to reclaim memory as soon as possible.

<strong>Caution:</strong> You should use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html#recycle()">recycle()</a></code> only when you are sure that the bitmap is no longer being used. If you call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html#recycle()">recycle()</a></code> and later attempt to draw the bitmap, you will get the error: <code>"Canvas: trying to use a recycled bitmap"</code>.

The following code snippet gives an example of calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html#recycle()">recycle()</a></code>. It uses reference counting (in the variables <code>mDisplayRefCount</code> and <code>mCacheRefCount</code>) to track whether a bitmap is currently being displayed or in the cache. The code recycles the bitmap when these conditions are met:
<ul>
	<li>The reference count for both <code>mDisplayRefCount</code> and <code>mCacheRefCount</code> is 0.</li>
	<li>The bitmap is not <code>null</code>, and it hasn't been recycled yet.</li>
</ul>
译：

在Android 2.3.3 (API level 10) 以及更低版本上，推荐使用<a href="http://developer.android.com/reference/android/graphics/Bitmap.html#recycle()">recycle()</a>. 如果在你的程序中显示了大量的bitmap数据，你很可能会遇到<a href="http://developer.android.com/reference/java/lang/OutOfMemoryError.html" target="_blank">OutOfMemoryError</a>错误. <a href="http://developer.android.com/reference/android/graphics/Bitmap.html#recycle()">recycle()</a>方法可以使得程序尽快的释放内存.
<blockquote><strong>Caution:</strong>只有你确保这个bitmap不再需要用到的时候才应该使用recycle(). 如果你执行recycle()，然后尝试绘制这个bitmap, 你将得到错误:<code>"Canvas: trying to use a recycled bitmap"</code>.</blockquote>
下面的代码片段演示了使用recycle()的例子. 它使用了引用计数的方法(<code>mDisplayRefCount</code> 与<code>mCacheRefCount</code>)来追踪一个bitmap目前是否有被显示或者是在缓存中. 当下面条件满足时回收bitmap:
<ul>
	<li><code>mDisplayRefCount</code> 与 <code>mCacheRefCount</code> 的引用计数均为 0.</li>
	<li>bitmap不为<code>null</code>, 并且它还没有被回收.</li>
</ul>
[java]private int mCacheRefCount = 0;
private int mDisplayRefCount = 0;
...
// Notify the drawable that the displayed state has changed.
// Keep a count to determine when the drawable is no longer displayed.
public void setIsDisplayed(boolean isDisplayed) {
synchronized (this) {
if (isDisplayed) {
mDisplayRefCount++;
mHasBeenDisplayed = true;
} else {
mDisplayRefCount--;
}
}
// Check to see if recycle() can be called.
checkState();
}

// Notify the drawable that the cache state has changed.
// Keep a count to determine when the drawable is no longer being cached.
public void setIsCached(boolean isCached) {
synchronized (this) {
if (isCached) {
mCacheRefCount++;
} else {
mCacheRefCount--;
}
}
// Check to see if recycle() can be called.
checkState();
}

private synchronized void checkState() {
// If the drawable cache and display ref counts = 0, and this drawable
// has been displayed, then recycle.
if (mCacheRefCount &lt;= 0 &amp;&amp; mDisplayRefCount &lt;= 0 &amp;&amp; mHasBeenDisplayed
&amp;&amp; hasValidBitmap()) {
getBitmap().recycle();
}
}

private synchronized boolean hasValidBitmap() {
Bitmap bitmap = getBitmap();
return bitmap != null &amp;&amp; !bitmap.isRecycled();
}[/java]
<h2 id="inBitmap">Manage Memory on Android 3.0 and Higher</h2>

<hr />

Android 3.0 (API level 11) introduces the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">BitmapFactory.Options.inBitmap</a></code> field. If this option is set, decode methods that take the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html">Options</a></code> object will attempt to reuse an existing bitmap when loading content. This means that the bitmap's memory is reused, resulting in improved performance, and removing both memory allocation and de-allocation. However, there are certain restrictions with how <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code> can be used. In particular, before Android 4.4 (API level 19), only equal sized bitmaps are supported. For details, please see the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code> documentation.
<h3>Save a bitmap for later use</h3>
The following snippet demonstrates how an existing bitmap is stored for possible later use in the sample app. When an app is running on Android 3.0 or higher and a bitmap is evicted from the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/LruCache.html">LruCache</a></code>, a soft reference to the bitmap is placed in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/util/HashSet.html">HashSet</a></code>, for possible reuse later with<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code>:

译：

在Android 3.0 (API Level 11) 引进了<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inBitmap" target="_blank">BitmapFactory.Options.inBitmap</a>. 如果这个值被设置了，decode方法会在加载内容的时候去重用已经存在的bitmap. 这意味着bitmap的内存是被重新利用的，这样可以提升性能, 并且减少了内存的分配与回收。然而，使用<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inBitmap" target="_blank">inBitmap</a>有一些限制。特别是在Android 4.4 (API level 19)之前，只支持同等大小的位图。详情请查看<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inBitmap" target="_blank">inBitmap文档</a>.
<h3 id="bitmapsave-a-bitmap-for-later-use">保存bitmap供以后使用(Save a bitmap for later use)</h3>
下面演示了一个已经存在的bitmap是如何被存放起来以便后续使用的. 当一个应用运行在Android 3.0或者更高的平台上并且bitmap从LruCache中移除时, bitmap的一个软引用会被存放在<a href="http://developer.android.com/reference/java/util/HashSet.html" target="_blank">Hashset</a>中，这样便于之后可能被<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inBitmap" target="_blank">inBitmap</a>重用:

[java]Set&lt;SoftReference&lt;Bitmap&gt;&gt; mReusableBitmaps;
private LruCache&lt;String, BitmapDrawable&gt; mMemoryCache;

// If you're running on Honeycomb or newer, create a
// synchronized HashSet of references to reusable bitmaps.
if (Utils.hasHoneycomb()) {
mReusableBitmaps =
Collections.synchronizedSet(new HashSet&lt;SoftReference&lt;Bitmap&gt;&gt;());
}

mMemoryCache = new LruCache&lt;String, BitmapDrawable&gt;(mCacheParams.memCacheSize) {

// Notify the removed entry that is no longer being cached.
@Override
protected void entryRemoved(boolean evicted, String key,
BitmapDrawable oldValue, BitmapDrawable newValue) {
if (RecyclingBitmapDrawable.class.isInstance(oldValue)) {
// The removed entry is a recycling drawable, so notify it
// that it has been removed from the memory cache.
((RecyclingBitmapDrawable) oldValue).setIsCached(false);
} else {
// The removed entry is a standard BitmapDrawable.
if (Utils.hasHoneycomb()) {
// We're running on Honeycomb or later, so add the bitmap
// to a SoftReference set for possible use with inBitmap later.
mReusableBitmaps.add
(new SoftReference&lt;Bitmap&gt;(oldValue.getBitmap()));
}
}
}
....
}[/java]
<h3>Use an existing bitmap</h3>
In the running app, decoder methods check to see if there is an existing bitmap they can use. For example:

[java]public static Bitmap decodeSampledBitmapFromFile(String filename,
int reqWidth, int reqHeight, ImageCache cache) {

final BitmapFactory.Options options = new BitmapFactory.Options();
...
BitmapFactory.decodeFile(filename, options);
...

// If we're running on Honeycomb or newer, try to use inBitmap.
if (Utils.hasHoneycomb()) {
addInBitmapOptions(options, cache);
}
...
return BitmapFactory.decodeFile(filename, options);
}[/java]
The next snippet shows the <code>addInBitmapOptions()</code> method that is called in the above snippet. It looks for an existing bitmap to set as the value for <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code>. Note that this method only sets a value for<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code> if it finds a suitable match (your code should never assume that a match will be found):
[java]private static void addInBitmapOptions(BitmapFactory.Options options,
ImageCache cache) {
// inBitmap only works with mutable bitmaps, so force the decoder to
// return mutable bitmaps.
options.inMutable = true;

if (cache != null) {
// Try to find a bitmap to use for inBitmap.
Bitmap inBitmap = cache.getBitmapFromReusableSet(options);

if (inBitmap != null) {
// If a suitable bitmap has been found, set it as the value of
// inBitmap.
options.inBitmap = inBitmap;
}
}
}

// This method iterates through the reusable bitmaps, looking for one
// to use for inBitmap:
protected Bitmap getBitmapFromReusableSet(BitmapFactory.Options options) {
Bitmap bitmap = null;

if (mReusableBitmaps != null &amp;&amp; !mReusableBitmaps.isEmpty()) {
synchronized (mReusableBitmaps) {
final Iterator&lt;SoftReference&lt;Bitmap&gt;&gt; iterator
= mReusableBitmaps.iterator();
Bitmap item;

while (iterator.hasNext()) {
item = iterator.next().get();

if (null != item &amp;&amp; item.isMutable()) {
// Check to see it the item can be used for inBitmap.
if (canUseForInBitmap(item, options)) {
bitmap = item;

// Remove from reusable set so it can't be used again.
iterator.remove();
break;
}
} else {
// Remove from the set if the reference has been cleared.
iterator.remove();
}
}
}
}
return bitmap;
}[/java]

Finally, this method determines whether a candidate bitmap satisfies the size criteria to be used for <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/BitmapFactory.Options.html#inBitmap">inBitmap</a></code>:

[java]static boolean canUseForInBitmap(
Bitmap candidate, BitmapFactory.Options targetOptions) {

if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) {
// From Android 4.4 (KitKat) onward we can re-use if the byte size of
// the new bitmap is smaller than the reusable bitmap candidate
// allocation byte count.
int width = targetOptions.outWidth / targetOptions.inSampleSize;
int height = targetOptions.outHeight / targetOptions.inSampleSize;
int byteCount = width * height * getBytesPerPixel(candidate.getConfig());
return byteCount &lt;= candidate.getAllocationByteCount();
}

// On earlier versions, the dimensions must match exactly and the inSampleSize must be 1
return candidate.getWidth() == targetOptions.outWidth
&amp;&amp; candidate.getHeight() == targetOptions.outHeight
&amp;&amp; targetOptions.inSampleSize == 1;
}

/**
* A helper function to return the byte usage per pixel of a bitmap based on its configuration.
*/
static int getBytesPerPixel(Config config) {
if (config == Config.ARGB_8888) {
return 4;
} else if (config == Config.RGB_565) {
return 2;
} else if (config == Config.ARGB_4444) {
return 2;
} else if (config == Config.ALPHA_8) {
return 1;
}
return 1;
}[/java]

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>230</wp:post_id>
		<wp:post_date>2015-02-02 10:42:42</wp:post_date>
		<wp:post_date_gmt>2015-02-02 02:42:42</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>managing-bitmap-memory</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="inbitmap"><![CDATA[inBitmap]]></category>
		<category domain="post_tag" nicename="managing-bitmap-memory"><![CDATA[Managing Bitmap Memory]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707502]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Displaying Bitmaps in Your UI</title>
		<link>http://1.duoinfo.sinaapp.com/?p=232</link>
		<pubDate>Mon, 02 Feb 2015 06:23:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=232</guid>
		<description></description>
		<content:encoded><![CDATA[This lesson brings together everything from previous lessons, showing you how to load multiple bitmaps into<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> components using a background thread and bitmap cache, while dealing with concurrency and configuration changes.
<h2 id="viewpager">Load Bitmaps into a ViewPager Implementation</h2>

<hr />

The <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/design/patterns/swipe-views.html">swipe view pattern</a> is an excellent way to navigate the detail view of an image gallery. You can implement this pattern using a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> component backed by a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/PagerAdapter.html">PagerAdapter</a></code>. However, a more suitable backing adapter is the subclass <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentStatePagerAdapter.html">FragmentStatePagerAdapter</a></code> which automatically destroys and saves state of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragments</a></code>in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> as they disappear off-screen, keeping memory usage down.

<strong>Note:</strong> If you have a smaller number of images and are confident they all fit within the application memory limit, then using a regular <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/PagerAdapter.html">PagerAdapter</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentPagerAdapter.html">FragmentPagerAdapter</a></code> might be more appropriate.

Here’s an implementation of a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> children. The main activity holds the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/view/ViewPager.html">ViewPager</a></code> and the adapter:

译：

这一课会演示如何运用前面几节课的内容，使用后台线程与Cache机制来加载图片到 ViewPager 与 GridView 组件，并且学习处理并发与配置改变问题。
<h2 id="viewpagerload-bitmaps-into-a-viewpager-implementation">实现加载图片到ViewPager(Load Bitmaps into a ViewPager Implementation)</h2>
<a href="http://developer.android.com/design/patterns/swipe-views.html" target="_blank">swipe view pattern</a>是一个用来切换显示不同详情界面的很好的方法。(关于这种效果请先参看<a href="http://developer.android.com/design/patterns/swipe-views.html" target="_blank">Android Design: Swipe Views</a>).

你可以通过 <a href="http://developer.android.com/reference/android/support/v4/view/PagerAdapter.html" target="_blank">PagerAdapter</a> 与 <a href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html" target="_blank">ViewPager</a> 组件来实现这个效果。 然而，一个更加合适的Adapter是PagerAdapter 的子类 <a href="http://developer.android.com/reference/android/support/v4/app/FragmentStatePagerAdapter.html" target="_blank">FragmentStatePagerAdapter</a>:它可以在某个ViewPager中的子视图切换出屏幕时自动销毁与保存 Fragments 的状态。这样能够保持消耗更少的内存。
<blockquote><strong>Note:</strong> 如果你只有为数不多的图片并且确保不会超出程序内存限制，那么使用 PagerAdapter 或 FragmentPagerAdapter 会更加合适。</blockquote>
下面是一个使用ViewPager与ImageView作为子视图的示例。主Activity包含有ViewPager 和adapter。

[java]public class ImageDetailActivity extends FragmentActivity {
public static final String EXTRA_IMAGE = &quot;extra_image&quot;;

private ImagePagerAdapter mAdapter;
private ViewPager mPager;

// A static dataset to back the ViewPager adapter
public final static Integer[] imageResIds = new Integer[] {
R.drawable.sample_image_1, R.drawable.sample_image_2, R.drawable.sample_image_3,
R.drawable.sample_image_4, R.drawable.sample_image_5, R.drawable.sample_image_6,
R.drawable.sample_image_7, R.drawable.sample_image_8, R.drawable.sample_image_9};

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.image_detail_pager); // Contains just a ViewPager

mAdapter = new ImagePagerAdapter(getSupportFragmentManager(), imageResIds.length);
mPager = (ViewPager) findViewById(R.id.pager);
mPager.setAdapter(mAdapter);
}

public static class ImagePagerAdapter extends FragmentStatePagerAdapter {
private final int mSize;

public ImagePagerAdapter(FragmentManager fm, int size) {
super(fm);
mSize = size;
}

@Override
public int getCount() {
return mSize;
}

@Override
public Fragment getItem(int position) {
return ImageDetailFragment.newInstance(position);
}
}
}[/java]
Here is an implementation of the details <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> which holds the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> children. This might seem like a perfectly reasonable approach, but can you see the drawbacks of this implementation? How could it be improved?
[java]public class ImageDetailFragment extends Fragment {
private static final String IMAGE_DATA_EXTRA = &quot;resId&quot;;
private int mImageNum;
private ImageView mImageView;

static ImageDetailFragment newInstance(int imageNum) {
final ImageDetailFragment f = new ImageDetailFragment();
final Bundle args = new Bundle();
args.putInt(IMAGE_DATA_EXTRA, imageNum);
f.setArguments(args);
return f;
}

// Empty constructor, required as per Fragment docs
public ImageDetailFragment() {}

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
mImageNum = getArguments() != null ? getArguments().getInt(IMAGE_DATA_EXTRA) : -1;
}

@Override
public View onCreateView(LayoutInflater inflater, ViewGroup container,
Bundle savedInstanceState) {
// image_detail_fragment.xml contains just an ImageView
final View v = inflater.inflate(R.layout.image_detail_fragment, container, false);
mImageView = (ImageView) v.findViewById(R.id.imageView);
return v;
}

@Override
public void onActivityCreated(Bundle savedInstanceState) {
super.onActivityCreated(savedInstanceState);
final int resId = ImageDetailActivity.imageResIds[mImageNum];
&lt;strong&gt;mImageView.setImageResource(resId);&lt;/strong&gt; // Load image into ImageView
}
}[/java]
Hopefully you noticed the issue: the images are being read from resources on the UI thread, which can lead to an application hanging and being force closed. Using an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> as described in the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html">Processing Bitmaps Off the UI Thread</a> lesson, it’s straightforward to move image loading and processing to a background thread:
[java]public class ImageDetailActivity extends FragmentActivity {
...

public void loadBitmap(int resId, ImageView imageView) {
mImageView.setImageResource(R.drawable.image_placeholder);
BitmapWorkerTask task = new BitmapWorkerTask(mImageView);
task.execute(resId);
}

... // include &lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#BitmapWorkerTask&quot;&gt;&lt;code&gt;BitmapWorkerTask&lt;/code&gt;&lt;/a&gt; class
}

public class ImageDetailFragment extends Fragment {
...

@Override
public void onActivityCreated(Bundle savedInstanceState) {
super.onActivityCreated(savedInstanceState);
if (ImageDetailActivity.class.isInstance(getActivity())) {
final int resId = ImageDetailActivity.imageResIds[mImageNum];
// Call out to ImageDetailActivity to load the bitmap in a background thread
((ImageDetailActivity) getActivity()).loadBitmap(resId, mImageView);
}
}
}[/java]
Any additional processing (such as resizing or fetching images from the network) can take place in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#BitmapWorkerTask"><code>BitmapWorkerTask</code></a> without affecting responsiveness of the main UI. If the background thread is doing more than just loading an image directly from disk, it can also be beneficial to add a memory and/or disk cache as described in the lesson <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html#memory-cache">Caching Bitmaps</a>. Here's the additional modifications for a memory cache:
[java]public class ImageDetailActivity extends FragmentActivity {
...
private LruCache&lt;String, Bitmap&gt; mMemoryCache;

@Override
public void onCreate(Bundle savedInstanceState) {
...
// initialize LruCache as per &lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html#memory-cache&quot;&gt;Use a Memory Cache&lt;/a&gt; section
}

public void loadBitmap(int resId, ImageView imageView) {
final String imageKey = String.valueOf(resId);

final Bitmap bitmap = mMemoryCache.get(imageKey);
if (bitmap != null) {
mImageView.setImageBitmap(bitmap);
} else {
mImageView.setImageResource(R.drawable.image_placeholder);
BitmapWorkerTask task = new BitmapWorkerTask(mImageView);
task.execute(resId);
}
}

... // include updated BitmapWorkerTask from &lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/cache-bitmap.html#memory-cache&quot;&gt;Use a Memory Cache&lt;/a&gt; section
}[/java]
<h2 id="gridview">Load Bitmaps into a GridView Implementation</h2>

<hr />

The <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/design/building-blocks/grid-lists.html">grid list building block</a> is useful for showing image data sets and can be implemented using a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> component in which many images can be on-screen at any one time and many more need to be ready to appear if the user scrolls up or down. When implementing this type of control, you must ensure the UI remains fluid, memory usage remains under control and concurrency is handled correctly (due to the way <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> recycles its children views).

To start with, here is a standard <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> implementation with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ImageView.html">ImageView</a></code> children placed inside a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code>. Again, this might seem like a perfectly reasonable approach, but what would make it better?

译：

<a href="http://developer.android.com/design/building-blocks/grid-lists.html" target="_blank">Grid list building block</a> 是一种有效显示大量图片的方式。这样能够一次显示许多图片，而且那些即将被显示的图片也处于准备显示状态。如果你想要实现这种效果，你必须确保UI是流畅的，能够控制内存使用，并且正确的处理并发问题（因为 GridView 会循环使用子视图)。

下面是一个在Fragment里面内置了ImageView作为GridView子视图的示例：

Once again, the problem with this implementation is that the image is being set in the UI thread. While this may work for small, simple images (due to system resource loading and caching), if any additional processing needs to be done, your UI grinds to a halt.

The same asynchronous processing and caching methods from the previous section can be implemented here. However, you also need to wary of concurrency issues as the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/GridView.html">GridView</a></code> recycles its children views. To handle this, use the techniques discussed in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#concurrency">Processing Bitmaps Off the UI Thread</a>lesson. Here is the updated solution:

译：

又一次，这一个实现的问题是图片是在UI线程中被设置。当处理小的图片时可以，但其他需要额外操作的处理，都会使你的UI慢下来。

与前面加载到图片到ViewPager一样，如果setImageResource的操作会比较耗时，有可能会卡到UI Thread。可以使用类似前面异步处理图片与增加缓存的方法来解决那个问题。然而，我们还需要考虑GridView的循环机制所带来的并发问题。为了处理这个问题，请参考前面的课程 。下面是一个更新的解决方案：

[java]public class ImageGridFragment extends Fragment implements AdapterView.OnItemClickListener {
...

private class ImageAdapter extends BaseAdapter {
...

@Override
public View getView(int position, View convertView, ViewGroup container) {
...
&lt;strong&gt;loadBitmap(imageResIds[position], imageView)&lt;/strong&gt;
return imageView;
}
}

public void loadBitmap(int resId, ImageView imageView) {
if (cancelPotentialWork(resId, imageView)) {
final BitmapWorkerTask task = new BitmapWorkerTask(imageView);
final AsyncDrawable asyncDrawable =
new AsyncDrawable(getResources(), mPlaceHolderBitmap, task);
imageView.setImageDrawable(asyncDrawable);
task.execute(resId);
}
}

static class AsyncDrawable extends BitmapDrawable {
private final WeakReference&lt;BitmapWorkerTask&gt; bitmapWorkerTaskReference;

public AsyncDrawable(Resources res, Bitmap bitmap,
BitmapWorkerTask bitmapWorkerTask) {
super(res, bitmap);
bitmapWorkerTaskReference =
new WeakReference&lt;BitmapWorkerTask&gt;(bitmapWorkerTask);
}

public BitmapWorkerTask getBitmapWorkerTask() {
return bitmapWorkerTaskReference.get();
}
}

public static boolean cancelPotentialWork(int data, ImageView imageView) {
final BitmapWorkerTask bitmapWorkerTask = getBitmapWorkerTask(imageView);

if (bitmapWorkerTask != null) {
final int bitmapData = bitmapWorkerTask.data;
if (bitmapData != data) {
// Cancel previous task
bitmapWorkerTask.cancel(true);
} else {
// The same work is already in progress
return false;
}
}
// No task associated with the ImageView, or an existing task was cancelled
return true;
}

private static BitmapWorkerTask getBitmapWorkerTask(ImageView imageView) {
if (imageView != null) {
final Drawable drawable = imageView.getDrawable();
if (drawable instanceof AsyncDrawable) {
final AsyncDrawable asyncDrawable = (AsyncDrawable) drawable;
return asyncDrawable.getBitmapWorkerTask();
}
}
return null;
}

... // include updated &lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/displaying-bitmaps/process-bitmap.html#BitmapWorkerTaskUpdated&quot;&gt;&lt;code&gt;BitmapWorkerTask&lt;/code&gt;&lt;/a&gt; class[/java]

<strong>Note:</strong> The same code can easily be adapted to work with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code> as well.

This implementation allows for flexibility in how the images are processed and loaded without impeding the smoothness of the UI. In the background task you can load images from the network or resize large digital camera photos and the images appear as the tasks finish processing.

For a full example of this and other concepts discussed in this lesson, please see the included sample application.

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>232</wp:post_id>
		<wp:post_date>2015-02-02 14:23:52</wp:post_date>
		<wp:post_date_gmt>2015-02-02 06:23:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>displaying-bitmaps-in-your-ui</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="displaying-bitmaps-in-your-ui"><![CDATA[Displaying Bitmaps in Your UI]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707503]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Displaying Bitmap小结</title>
		<link>http://1.duoinfo.sinaapp.com/?p=235</link>
		<pubDate>Mon, 02 Feb 2015 06:29:09 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=235</guid>
		<description></description>
		<content:encoded><![CDATA[Google的关于展示位图的课程学习完毕了。主要的内容主要包括了下面的几个部分：

1.<a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/load-bitmap.html"><strong>高效的加载大图(Loading Large Bitmaps Efficiently)</strong></a>

2.<a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/process-bitmap.html"><strong>非UI线程处理Bitmap(Processing Bitmaps Off the UI Thread)</strong></a>

3.<strong><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/cache-bitmap.html">缓存Bitmaps(Caching Bitmaps)</a>（LruCache和DiskLruCache，但是DiskLruCache需要异步操作，这一节同样提到了如何解决屏幕旋转带来的问题）</strong>

4.<a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/manage-memory.html"><strong>管理Bitmap占用的内存(Managing Bitmap Memory)</strong></a>

5.<strong><a href="http://hukai.me/android-training-course-in-chinese/graphics/displaying-bitmaps/display-bitmap.html">在UI上显示Bitmap(Displaying Bitmaps in Your UI)</a>（综合的小例子）</strong>

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>235</wp:post_id>
		<wp:post_date>2015-02-02 14:29:09</wp:post_date>
		<wp:post_date_gmt>2015-02-02 06:29:09</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>displaying-bitmap%e5%b0%8f%e7%bb%93</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="%e9%ab%98%e6%95%88%e5%b1%95%e7%a4%babitmap"><![CDATA[高效展示Bitmap]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707504]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>ViewTreeObserver.addOnGlobalLayoutListener(listener)</title>
		<link>http://1.duoinfo.sinaapp.com/?p=237</link>
		<pubDate>Mon, 02 Feb 2015 09:20:31 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=237</guid>
		<description></description>
		<content:encoded><![CDATA[有时候需要在onCreate方法中知道某个View组件的宽度和高度等信息，而直接调用View组件的getWidth()、getHeight()、getMeasuredWidth()、getMeasuredHeight()、getTop()、getLeft()等方法是无法获取到真实值的，只会得到0。这是因为View组件布局要在onResume回调后完成。下面提供实现方法，onGlobalLayout回调会在view布局完成时自动调用:(我的项目中视频缩略图界面)：

[java]// This listener is used to get the final width of the GridView and then calculate the
// number of columns and the width of each column. The width of each column is variable
// as the GridView has stretchMode=columnWidth. The column width is used to set the height
// of each view so we get nice square thumbnails.
mGridView.getViewTreeObserver().addOnGlobalLayoutListener( //view 布局完成时调用，每次view改变时都会调用
 new ViewTreeObserver.OnGlobalLayoutListener() {
 @Override
 public void onGlobalLayout() {
 if (mAdapter.getNumColumns() == 0) {
 final int numColumns = (int) Math.floor(
 mGridView.getWidth() / (mImageThumbSize + mImageThumbSpacing));
 if (numColumns &gt; 0) {
 &lt;span style=&quot;white-space:pre&quot;&gt; &lt;/span&gt;final int columnWidth =
 (mGridView.getWidth() / numColumns) - mImageThumbSpacing;
 mAdapter.setNumColumns(numColumns); //设置 列数
 mAdapter.setItemHeight(columnWidth); //设置 高度
 }
 }
 }
 });[/java]

在gridview布局完成后，根据girdview的宽和高设置adapter列数和每个item高度]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>237</wp:post_id>
		<wp:post_date>2015-02-02 17:20:31</wp:post_date>
		<wp:post_date_gmt>2015-02-02 09:20:31</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>void-android-view-viewtreeobserver-addongloballayoutlistenerongloballayoutlistener-listener</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="viewtreeobserver"><![CDATA[ViewTreeObserver]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707505]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>ImageView.ScaleType设置图解</title>
		<link>http://1.duoinfo.sinaapp.com/?p=241</link>
		<pubDate>Mon, 02 Feb 2015 11:30:17 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=241</guid>
		<description></description>
		<content:encoded><![CDATA[ImageView的Scaletype决定了图片在View上显示时的样子，如进行何种比例的缩放，及显示图片的整体还是部分，等等。

设置的方式包括：

1. 在layout xml中定义android:scaleType="CENTER"

2. 或在代码中调用imageView.setScaleType(ImageView.ScaleType.CENTER);

&nbsp;

接下来，将对ScaleType的值和对应的显示效果用最直观的方式——真图演示的方法，来进行说明。

&nbsp;

首先，是测试使用的原始图片：

<img src="http://hi.csdn.net/attachment/201110/30/0_1319976827wW01.gif" alt="" width="128" height="128" />（Dimensions: 128 * 128）

<img src="http://hi.csdn.net/attachment/201110/30/0_1319976939pkgr.gif" alt="" /> (Dimensions: 640 * 428)

&nbsp;

好，开始下面的测试：

1. SetScaleType(ImageView.ScaleType.CENTER);

按图片的原来size居中显示，当图片长/宽超过View的长/宽，则截取图片的居中部分显示

<img src="http://hi.csdn.net/attachment/201110/30/0_1319980238S0ht.gif" alt="" />               <img src="http://hi.csdn.net/attachment/201110/30/0_1319980257h8NT.gif" alt="" />

&nbsp;

2. SetScaleType(ImageView.ScaleType.CENTER_CROP);

按比例扩大图片的size居中显示，使得图片长(宽)等于或大于View的长(宽)

<img src="http://hi.csdn.net/attachment/201110/30/0_1319980210oDm8.gif" alt="" />               <img src="http://hi.csdn.net/attachment/201110/30/0_13199802252Hvf.gif" alt="" />

&nbsp;

3. setScaleType(ImageView.ScaleType.CENTER_INSIDE);

将图片的内容完整居中显示，通过按比例缩小或原来的size使得图片长/宽等于或小于View的长/宽

<img src="http://hi.csdn.net/attachment/201110/30/0_1319980180mJsK.gif" alt="" />               <img src="http://hi.csdn.net/attachment/201110/30/0_1319980194fb0b.gif" alt="" />

&nbsp;

4. setScaleType(ImageView.ScaleType.FIT_CENTER);

把图片按比例扩大/缩小到View的宽度，居中显示

<img src="http://hi.csdn.net/attachment/201110/30/0_1319980150BcCh.gif" alt="" />               <img src="http://hi.csdn.net/attachment/201110/30/0_13199801347auQ.gif" alt="" />

&nbsp;

5. FIT_START, FIT_END在图片缩放效果上与FIT_CENTER一样，只是显示的位置不同，FIT_START是置于顶部，FIT_CENTER居中，FIT_END置于底部。

在此就不给出示例了。

&nbsp;

6. FIT_XY

不按比例缩放图片，目标是把图片塞满整个View。

<img src="http://hi.csdn.net/attachment/201110/30/0_1319980055JRlc.gif" alt="" width="244" height="402" />               <img src="http://hi.csdn.net/attachment/201110/30/0_1319980073vF07.gif" alt="" width="243" height="402" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>241</wp:post_id>
		<wp:post_date>2015-02-02 19:30:17</wp:post_date>
		<wp:post_date_gmt>2015-02-02 11:30:17</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>imageview-scaletype%e8%ae%be%e7%bd%ae%e5%9b%be%e8%a7%a3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="scaletype"><![CDATA[ScaleType]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707506]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>获取视频缩略图心得</title>
		<link>http://1.duoinfo.sinaapp.com/?p=243</link>
		<pubDate>Mon, 02 Feb 2015 12:53:28 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=243</guid>
		<description></description>
		<content:encoded><![CDATA[实现后的效果如下图，也许你会说，这个多简单啊，不就是ContentResolver根据媒体库的URI去query视频嘛，然后将结果扔给GridView展示一下。额，我开始也这么想的，后来我错了，因为在实现的时候，出现了很多错误（比如OOM也就是OutOfMemory，还有视频超过15M的时候，直接崩掉，滑动的时候卡滞等等）。（处理思路严格按照Google文档DisplayBitmap的思路）。

1.我拍的都是很清晰的视频，这里做了处理，我们不需要在这里做很清晰的展示；

<strong><span style="color: #000080;">2.获取缩略图耗时，放到子线程中执行；</span></strong>

<strong><span style="color: #000080;">3.LruCache+DiskLruCache二级缓存；</span></strong>

<strong><span style="color: #000080;">4.滑动操作的时候，暂停后台线程的任务（滑动卡滞，主要是要异步操作）</span></strong>

<strong><span style="color: #000080;">5.获取缩略图的时候，用户的屏幕旋转了，Activity重建了，这时候怎么办；</span></strong>

<strong><span style="color: #000080;">6.缩略图的资源回收；</span></strong>

<strong><span style="color: #000080;">7.怎么判断GridView绘制多少列和多少行；</span></strong>

<strong><span style="color: #000080;">8.如何复用历史缓存；</span></strong>

<strong><span style="color: #000080;">9.缩略图显示错位怎么办；</span></strong>

发送图片和查看大图片，获取视频缩略图，经过这些磨练，看到OOM，不再像以前那样手舞足蹈了。

<img src="http://img.blog.csdn.net/20150202203156108?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>243</wp:post_id>
		<wp:post_date>2015-02-02 20:53:28</wp:post_date>
		<wp:post_date_gmt>2015-02-02 12:53:28</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e8%8e%b7%e5%8f%96%e8%a7%86%e9%a2%91%e7%bc%a9%e7%95%a5%e5%9b%be%e5%bf%83%e5%be%97</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="gridview"><![CDATA[GridView]]></category>
		<category domain="category" nicename="%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af"><![CDATA[即时通讯]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707507]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>5</wp:comment_id>
			<wp:comment_author><![CDATA[哈哈]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url></wp:comment_author_url>
			<wp:comment_author_IP>61.190.88.143</wp:comment_author_IP>
			<wp:comment_date>2015-02-03 17:44:24</wp:comment_date>
			<wp:comment_date_gmt>2015-02-03 09:44:24</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[不错啊，有demo吗？]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_parent_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707456]]></wp:meta_value>
			</wp:commentmeta>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_post_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707460]]></wp:meta_value>
			</wp:commentmeta>
		</wp:comment>
	</item>
	<item>
		<title>BeautyProj知识点</title>
		<link>http://1.duoinfo.sinaapp.com/?p=246</link>
		<pubDate>Wed, 04 Feb 2015 03:39:11 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=246</guid>
		<description></description>
		<content:encoded><![CDATA[1.程序崩溃日志收集处理类；

2.Android Studio自定义控件在XML中指定命名空间和Eclipse不同，Eclipse在后缀上加上包名，如果在Android Studio上一样写的话，他会提示你替换成res-auto；

3.圆角头像的框架（参考github上的框架）；

4.butterknife注入事件框架（详细参考github上给的demo，注意Adapter结合ViewHolder的写法）；

5.自定义类继承自PopupWindow实现PopupWindow(可抽离出来形成demo)；

6.自定义Toast（可以单独抽离出demo）；

7.自定义日志工具（可以单独抽离成demo）；

8.判断SD卡是否存在，内存大小，屏幕宽高，网络是否可用等等工具方法（项目utils包下的CommonUtil）；

9.Java Formatter Best practices(这篇文章来自国外的文章，了解下)；

10.拍照，相册选择图片并裁剪（可抽离demo）；

//以上整理：2015.02.04========================================================]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>246</wp:post_id>
		<wp:post_date>2015-02-04 11:39:11</wp:post_date>
		<wp:post_date_gmt>2015-02-04 03:39:11</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>beautyproj%e7%9f%a5%e8%af%86%e7%82%b9</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="beautyproj"><![CDATA[BeautyProj]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707508]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Java Formatters Best Practices</title>
		<link>http://1.duoinfo.sinaapp.com/?p=249</link>
		<pubDate>Wed, 04 Feb 2015 05:52:41 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=249</guid>
		<description></description>
		<content:encoded><![CDATA[这篇文章来自：<a title="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html" href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html" target="_blank">http://blog.vityuk.com/2011/03/java-formatters-best-practices.html</a>

为什么有这篇文章？在BeautyProj这个项目的日志管理类，我需要<code>java.text.DateFormat</code> and <code>java.text.NumberFormat去处理日期，考虑到线程安全的问题，我查下了资料（大百度没有找到，Google上找到的上面那个哥们的博客）</code>

在这个哥们的博客当中，他提到了四种方案：看下：

Java API has set of classes for formatting and parsing dates and numbers. Mostly used are:<code>java.text.DateFormat</code> and <code>java.text.NumberFormat</code>. Often when interviewing candidates I ask them whether JDK date and number formatters are <span style="color: #0000ff;"><strong>thread-safe</strong></span>. Surprisingly most of them don’t know the right answer, hence I decided to describe common pitfalls with formatters usage.

As you can guess <strong><span style="color: #0000ff;">both <code>DateFormat</code> and <code>NumberFormat</code> are not thread-safe</span></strong>. This is old known Java API design mistake. Nowadays all agreed that they supposed to be immutable instead of mutable. There is awesome alternative for dates - <a href="http://joda-time.sourceforge.net/">Joda Time</a>. （<a title="http://www.joda.org/joda-time/" href="http://www.joda.org/joda-time/" target="_blank">http://www.joda.org/joda-time/</a>）Which is pretty mature and was taken as a base for <a href="http://java.net/projects/jsr-310/">JSR-310</a>. I am personally recommend to stick with Joda Time if you can choose, because on our project we have great impression of using it. But if you have to deal with JDK date (and I don’t know good alternatives for numbers) you should be ready to use them correctly. Let’s go over formatting common patterns. In my examples I will use <code>SimpleDateFormatter</code> for formatting date. But all examples applicable for<code>NumberFormat</code> and for parsing strings.
<h3 id="1">1. Local format</h3>
<div>

[java]import java.text.SimpleDateFormat;
import java.util.Date;

public class FormatLocal {
 public static void main(String[] args) {
 format(new Date());
 }

static String format(Date date) {
 SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
 return format.format(date);
 }
}[/java]

</div>
This is the most obvious and straightforward way of formatter usage. You just create local instance and use it right away. In most cases it’s sufficient and preferable way to use it. But a lot of people trying to optimize it and turn it into <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#2">2</a>.
<h3 id="2">2. Shared not synchronized format</h3>
<div>

[java]import java.text.SimpleDateFormat;
import java.util.Date;

public class FormatSharedBuggy {
 public static void main(String[] args) {
 format(new Date());
 }

// DON'T DO IT!!! DateFormat is not thread-safe
 private static final SimpleDateFormat FORMAT = new SimpleDateFormat(
 &quot;yyyy-MM-dd HH:mm:ss&quot;);

static String format(Date date) {
 return FORMAT.format(date);
 }
}[/java]

</div>
This solution is a result of assumption (which looks logically) that <code>SimpleDateFormat</code> is thread-safe. But it’s not and this example is buggy. In multithread environment you’ll definitely get unpredictable results.<strong>DON’T DO IT!!!</strong>
<h3 id="3">3. Shared synchronized format</h3>
<div>

[java]import java.text.SimpleDateFormat;
import java.util.Date;

public class FormatSharedSynchronized {
 public static void main(String[] args) {
 format(new Date());
 }

// It's safe to reuse it from synchronized method
 private static final SimpleDateFormat FORMAT = new SimpleDateFormat(
 &quot;yyyy-MM-dd HH:mm:ss&quot;);

synchronized static String format(Date date) {
 return FORMAT.format(date);
 }
}[/java]

</div>
This is quick obvious fix of previous approach. You just synchronize access to formatter. But this is not recommended way. This solution is not scalable by nature and suffer from thread contention. On multiprocessor systems it could become a bottleneck. And in this case even the <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#1">1</a> solution is a better way to go.
<h3 id="4">4. Shared thread local format</h3>
<div>

[java]import java.text.SimpleDateFormat;
import java.util.Date;

public class FormatThreadLocal {
 public static void main(String[] args) {
 format(new Date());
 }

private static final ThreadLocal&lt;SimpleDateFormat&gt; FORMAT = new ThreadLocal&lt;SimpleDateFormat&gt;() {
 @Override
 protected SimpleDateFormat initialValue() {
 return new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
 }
 };

static String format(Date date) {
 return FORMAT.get().format(date);
 }
}[/java]

</div>
But if you really think (at this place you should measure real performance benefit) you will gain from formatter reuse, you should consider to use <a href="http://download.oracle.com/javase/6/docs/api/java/lang/ThreadLocal.html">TreadLocal</a>. In this example formatter will be shared only within thread.

We reviewed all cases and I would really recommend to keep away from <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#2">2</a> and <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#3">3</a> solutions. <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#1">1</a> example is straightforward and preferable, unless you undesrstand that you’ll win from reusing instance - then you should go with <a href="http://blog.vityuk.com/2011/03/java-formatters-best-practices.html#4">4</a>. These advices applicable for any not thread-safe classes, so you can use them as patterns. But for your classes prefer immutability, which is naturally thread-safe.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>249</wp:post_id>
		<wp:post_date>2015-02-04 13:52:41</wp:post_date>
		<wp:post_date_gmt>2015-02-04 05:52:41</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>java-formatters-best-practices</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="formatting"><![CDATA[formatting]]></category>
		<category domain="category" nicename="java"><![CDATA[Java]]></category>
		<category domain="post_tag" nicename="java-2"><![CDATA[java]]></category>
		<category domain="post_tag" nicename="multithreading"><![CDATA[multithreading]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707509]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>基础复习</title>
		<link>http://1.duoinfo.sinaapp.com/?p=253</link>
		<pubDate>Fri, 06 Feb 2015 06:19:07 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=253</guid>
		<description></description>
		<content:encoded><![CDATA[1.大位图处理，参考DisplayingBitmap（demo已完成）、加水印（demo加的水印是加上拍照的时间）

2.回退栈

3.手机拍照

4.手机拍照和选择本地图片

5.视频播放VideoView

6.Service后台下载+VideoView视频播放

7.Handler更新TextView

8.Handler下载图片

9.Handler更新进度条

10.Handler封装下载图片工具类（接口）

11.Handler，Message，Looper之间的关系

12.BroadcastReceiver的生命周期

13.有序广播

14.监听电量的改变

15.开机启动

16.WebView加载网页（提供放大、缩小、前进和后退的方法）

17.WebView和JS（服务器端）（demo未实现）

18.WebView和NativeApp（无demo）

19.关于WebView参考我的这个文章：<a title="http://1.duoinfo.sinaapp.com/?p=254" href="http://1.duoinfo.sinaapp.com/?p=254" target="_blank">http://1.duoinfo.sinaapp.com/?p=254</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>253</wp:post_id>
		<wp:post_date>2015-02-06 14:19:07</wp:post_date>
		<wp:post_date_gmt>2015-02-06 06:19:07</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%9f%ba%e7%a1%80%e5%a4%8d%e4%b9%a0</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="webview"><![CDATA[WebView]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707511]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android WebView开发问题及优化汇总</title>
		<link>http://1.duoinfo.sinaapp.com/?p=254</link>
		<pubDate>Fri, 06 Feb 2015 06:15:29 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=254</guid>
		<description></description>
		<content:encoded><![CDATA[本篇文章整理自：<a title="http://bbs.csdn.net/topics/390905615" href="http://bbs.csdn.net/topics/390905615" target="_blank">http://bbs.csdn.net/topics/390905615</a>

1.加快HTML网页装载完成的速度

默认情况html代码下载到WebView后，webkit开始解析网页各个节点，发现有外部样式文件或者外部脚本文件时，会异步发起网络请求下载文件，但如果在这之前也有解析到image节点，那势必也会发起网络请求下载相应的图片。在网络情况较差的情况下，过多的网络请求就会造成带宽紧张，影响到css或js文件加载完成的时间，造成页面空白loading过久。解决的方法就是告诉WebView先不要自动加载图片，等页面finish后再发起图片加载。

故在WebView初始化时设置如下代码：

[java]public void int () {
if(Build.VERSION.SDK_INT &gt;= 19) {
webView.getSettings().setLoadsImagesAutomatically(true);
} else {
webView.getSettings().setLoadsImagesAutomatically(false);
}
}[/java]


同时在WebView的WebViewClient实例中的onPageFinished()方法添加如下代码：
[java]@Override
public void onPageFinished(WebView view, String url) {
if(!webView.getSettings().getLoadsImagesAutomatically()) {
webView.getSettings().setLoadsImagesAutomatically(true);
}
}[/java]



从上面的代码，可以看出我们对系统API在19以上的版本作了兼容。因为4.4以上系统在onPageFinished时再恢复图片加载时,如果存在多张图片引用的是相同的src时，会只有一个image标签得到加载，因而对于这样的系统我们就先直接加载。

2.自定义出错界面

当WebView加载页面出错时（一般为404 NOT FOUND），安卓WebView会默认显示一个卖萌的出错界面。但我们怎么能让用户发现原来我使用的是网页应用呢，我们期望的是用户在网页上得到是如原生般应用的体验，那就先要从干掉这个默认出错页面开始。当WebView加载出错时，我们会在WebViewClient实例中的onReceivedError()方法接收到错误，我们就在这里做些手脚：
[java]@Override
public void onReceivedError (WebView view, int errorCode, String description, String failingUrl) {
super.onReceivedError(view, errorCode, description, failingUrl);
loadDataWithBaseURL(null, &quot;&quot;, &quot;text/html&quot;, &quot;utf-8&quot;, null);
mErrorFrame.setVisibility(View.VISIBLE);
}[/java]


从上面可以看出，我们先使用loadDataWithBaseURL清除掉默认错误页内容，再让我们自定义的View得到显示（mErrorFrame为蒙在WebView之上的一个LinearLayout布局，默认为View.GONE）。

3.是否存在滚动条

当我们做类似上拉加载下一页这样的功能的时候，页面初始的时候需要知道当前WebView是否存在纵向滚动条，如果有则不加载下一页，如果没有则加载下一页直到其出现纵向滚动条。首先继承WebView类，在子类添加下面的代码：
[java]public boolean existVerticalScrollbar () {
return computeVerticalScrollRange() &gt; computeVerticalScrollExtent();
}[/java]




computeVerticalScrollRange得到的是可滑动的最大高度，computeVerticalScrollExtent得到的是滚动把手自身的高，当不存在滚动条时，两者的值是相等的。当有滚动条时前者一定是大于后者的。

4.是否已滚动到页面底部

同样我们在做上拉加载下一页这样的功能时，也需要知道当前页面滚动条所处的状态，如果快到底部，则要发起网络请求数据更新网页。同样继承WebView类，在子类覆盖onScrollChanged方法，具体如下：
[java]@Override
protected void onScrollChanged(int newX, int newY, int oldX, int oldY) {
super.onScrollChanged(newX, newY, oldX, oldY);
if (newY != oldY) {
float contentHeight = getContentHeight() * getScale();
// 当前内容高度下从未触发过, 浏览器存在滚动条且滑动到将抵底部位置
if (mCurrContentHeight != contentHeight &amp;&amp; newY &gt; 0 &amp;&amp; contentHeight &lt;= newY + getHeight() + mThreshold) {
// TODO Something...
mCurrContentHeight = contentHeight;
}
}
}[/java]



上面mCurrContentHeight用于记录上次触发时的网页高度，用来防止在网页总高度未发生变化而目标区域发生连续滚动时会多次触发TODO，mThreshold是一个阈值，当页面底部距离滚动条底部的高度差&lt;=这个值时会触发TODO。

5.远程网页需访问本地资源

当我们在WebView中加载出从web服务器上拿取的内容时，是无法访问本地资源的，如assets目录下的图片资源，因为这样的行为属于跨域行为（Cross-Domain），而WebView是禁止的。解决这个问题的方案是把html内容先下载到本地，然后使用loadDataWithBaseURL加载html。这样就可以在html中使用 file:///android_asset/xxx.png 的链接来引用包里面assets下的资源了。示例如下：
[java]private void loadWithAccessLocal(final String htmlUrl) {
new Thread(new Runnable() {
public void run() {
try {
final String htmlStr = NetService.fetchHtml(htmlUrl);
if (htmlStr != null) {
TaskExecutor.runTaskOnUiThread(new Runnable() {
@Override
public void run() {
loadDataWithBaseURL(htmlUrl, htmlStr, &quot;text/html&quot;, &quot;UTF-8&quot;, &quot;&quot;);
}
});
return;
}
} catch (Exception e) {
Log.e(&quot;Exception:&quot; + e.getMessage());
}

TaskExecutor.runTaskOnUiThread(new Runnable() {
@Override
public void run() {
onPageLoadedError(-1, &quot;fetch html failed&quot;);
}
});
}
}).start();
}[/java]




上面有几点需要注意：
•从网络上下载html的过程应放在工作线程中
•html下载成功后渲染出html的步骤应放在UI主线程，不然WebView会报错
•html下载失败则可以使用我们前面讲述的方法来显示自定义错误界面
•
•完整的demo项目代码我已放到：http://yunpan.cn/cgQPvJQxxkCBj （提取码：6712）。

6.ViewPager里非首屏WebView点击事件不响应

如果你的多个WebView是放在ViewPager里一个个加载出来的，那么就会遇到这样的问题。ViewPager首屏WebView的创建是在前台，点击时没有问题；而其他非首屏的WebView是在后台创建，滑动到它后点击页面会出现如下错误日志：



20955-20968/xx.xxx.xxx E/webcoreglue﹕ Should not happen: no rect-based-test nodes found

解决这个问题的办法是继承WebView类，在子类覆盖onTouchEvent方法，填入如下代码：
[java]@Override
public boolean onTouchEvent(MotionEvent ev) {
if (ev.getAction() == MotionEvent.ACTION_DOWN) {
onScrollChanged(getScrollX(), getScrollY(), getScrollX(), getScrollY());
}
return super.onTouchEvent(ev);
}[/java]




7.WebView硬件加速导致页面渲染闪烁

4.0以上的系统我们开启硬件加速后，WebView渲染页面更加快速，拖动也更加顺滑。但有个副作用就是，当WebView视图被整体遮住一块，然后突然恢复时（比如使用SlideMenu将WebView从侧边滑出来时），这个过渡期会出现白块同时界面闪烁。解决这个问题的方法是在过渡期前将WebView的硬件加速临时关闭，过渡期后再开启，代码如下：
[java]if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) {
webview.setLayerType(View.LAYER_TYPE_SOFTWARE, null);
}[/java]




.避免addJavaScriptInterface带来的安全问题

使用开源项目Safe Java-JS WebView Bridge可以很好替代addJavaScriptInterface方法，同时增加了异步回调等支持，并且不存在了安全风险。

9.WebView与上层父元素的TouchMove事件冲突

在开发过程中你可能会遇到这样一种情况。端里面使用ViewPager嵌套了多个WebView页面，同时某一个WebView中的页面元素需要响应TouchMove事件。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>254</wp:post_id>
		<wp:post_date>2015-02-06 14:15:29</wp:post_date>
		<wp:post_date_gmt>2015-02-06 06:15:29</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-webview%e5%bc%80%e5%8f%91%e9%97%ae%e9%a2%98%e5%8f%8a%e4%bc%98%e5%8c%96%e6%b1%87%e6%80%bb</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="webview"><![CDATA[WebView]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707510]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>6</wp:comment_id>
			<wp:comment_author><![CDATA[基础复习 | 陈福多]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=253</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.229</wp:comment_author_IP>
			<wp:comment_date>2015-02-06 14:19:10</wp:comment_date>
			<wp:comment_date_gmt>2015-02-06 06:19:10</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] 19.关于WebView参考我的这个文章：http://1.duoinfo.sinaapp.com/?p=254    上一篇 /   分享到： QQ空间 新浪微博 腾讯微博 人人网 搜狐微博 开心网 百度空间 更多     if (typeof DUOSHUO !== &#039;undefined&#039;) DUOSHUO.EmbedThread(&#039;.ds-thread&#039;); [...]]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>IntentService中显示Toast</title>
		<link>http://1.duoinfo.sinaapp.com/?p=258</link>
		<pubDate>Fri, 06 Feb 2015 08:14:26 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=258</guid>
		<description></description>
		<content:encoded><![CDATA[今天练习使用Service个IntentService下载图片，其中IntentService这块除了一点问题。我在onHandleIntent中，当图片下载完毕，弹出Toast，提示用户下载完毕了。但是Logcat出现了下面的异常：

<strong><span style="color: #ff00ff;">"RuntimeException: Handler{4051e4a0} sending message to a Handler on a dead thread"</span></strong>

其实为什么抛出这个异常，我也大致了解了。下面的内容参考了这篇文章：<a title="http://www.cnblogs.com/dyllove98/archive/2013/07/30/3225944.html" href="http://www.cnblogs.com/dyllove98/archive/2013/07/30/3225944.html" target="_blank">http://www.cnblogs.com/dyllove98/archive/2013/07/30/3225944.html</a>

<strong>1. 表象</strong>
<div><strong>
</strong></div>
<div>    Service中可以正常显示Toast，IntentService中不能正常显示Toast，在2.3系统上，不显示toast，在4.3系统上，toast显示，但是不会消失。</div>
<div></div>
<div><strong>2. 原因</strong></div>
<div></div>
<div>    Toast要求运行在UI主线程中。</div>
<div>    Service运行在主线程中，因此Toast是正常的。</div>
<div>    IntentService运行在独立的线程中，因此Toast不正常。</div>
<div></div>
<div><strong>3. 在IntentService中显示Toast</strong></div>
<div></div>
<div>    利用Handler，将显示Toast的工作，放在主线程中来做。具体有两个实现方式。</div>
<div></div>
<div>    Handler的post方式实现，这个方式比较简单。</div>
<div>[java]private void showToastByRunnable(final IntentService context, final CharSequence text, final int duration)     {
        Handler handler = new Handler(Looper.getMainLooper());
        handler.post(new Runnable() {
            @Override
            public void run() {
                Toast.makeText(context, text, duration).show();
            }
        });
    }[/java]
<div></div>
Handler的msg方式实现，这个方式比较复杂。

</div>
<div>[java]Handler msgHandler = new Handler(Looper.getMainLooper()) {
        @Override
        public void handleMessage(Message msg) {
            Toast.makeText(ToastIntentService.this, msg.getData().getString(&quot;Text&quot;), Toast.LENGTH_SHORT).show();
            super.handleMessage(msg);
        }
    };
    private void showToastByMsg(final IntentService context, final CharSequence text, final int duration) {
        Bundle data = new Bundle();
        data.putString(&quot;Text&quot;, text.toString());
        Message msg = new Message();
        msg.setData(data);
        msgHandler.sendMessage(msg);
    }
[/java]

</div>
<div></div>
<div>4. 关于耗时操作</div>
<div></div>
<div>    Service中如果有耗时的操作，要开启一个Thread来做。</div>
<div>    IntentService是在独立的线程中，所以可以进行一些耗时操作。</div>
<div></div>
<div>5.<strong> 考虑AsyncTask与Service的使用区别</strong></div>
<div></div>
<div>    如果是全后台的工作，使用Service，结果的提示可以使用Notification。</div>
<div>    如果是异步工作，工作结束后需要更新UI，那么最好使用Thread或者AsyncTask。</div>
<div></div>
<div><strong>6. 参考</strong></div>
<div></div>
<div>    <a href="http://xiaofanqingzjj.iteye.com/blog/1764675">Android Handler机制详解</a></div>
<div>    <a href="http://developer.android.com/reference/android/os/Handler.html">http://developer.android.com/reference/android/os/Handler.html</a></div>
<div>     <a href="http://www.cnblogs.com/Greenwood/archive/2011/02/27/1966472.html">深入理解ANDROID消息处理系统——LOOPER、HANDLER、THREAD</a></div>
<div></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>258</wp:post_id>
		<wp:post_date>2015-02-06 16:14:26</wp:post_date>
		<wp:post_date_gmt>2015-02-06 08:14:26</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>intentservice%e4%b8%ad%e6%98%be%e7%a4%batoast</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="handler"><![CDATA[Handler]]></category>
		<category domain="post_tag" nicename="intentservice"><![CDATA[IntentService]]></category>
		<category domain="post_tag" nicename="looper"><![CDATA[Looper]]></category>
		<category domain="post_tag" nicename="toast"><![CDATA[Toast]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707512]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android Messenger 跨进程通信</title>
		<link>http://1.duoinfo.sinaapp.com/?p=261</link>
		<pubDate>Sat, 07 Feb 2015 13:19:49 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=261</guid>
		<description></description>
		<content:encoded><![CDATA[Google的文档这样说的：

Reference to a Handler, which others can use to send messages to it. This allows for the implementation of message-based communication across processes, by creating a Messenger pointing to a Handler in one process, and handing that Messenger to another process.

Note: the implementation underneath is just a simple wrapper around a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Binder.html">Binder</a></code> that is used to perform the communication. This means semantically you should treat it as such: this class does not impact process lifecycle management (you must be using some higher-level component to tell the system that your process needs to continue running), the connection will break if your process goes away for any reason, etc.

大致意思就是：它引用了一个Handler对象，以便others能够向它发送消息(使用mMessenger.send(Message msg)方法)。该类允许跨进程间基于Message的通信(即两个进程间可以通过Message进行通信)，在服务端使用Handler创建一个Messenger，客户端持有这个Messenger就可以与服务端通信了。

以前我们使用Handler+Message的方式进行通信，都是在同一个进程中，从线程持有一个主线程的Handler对象，并向主线程发送消息。

而<a title="Android" href="http://www.linuxidc.com/topicnews.aspx?tid=11" target="_blank">Android</a>既然可以使用bindler机制进行跨进行通信，所以我们当然可以将Handler与bindler结合起来进行跨进程发送消息。

查看API就可以发现，Messenger就是这种方式的实现。

一般使用方法如下：

1.远程通过
<div> [java] final Messenger messenger = new Messenger(new IncomingHandler());[/java]

</div>
<div>

创建一个信使对象

2.客户端使用bindlerService请求连接远程

[java]bindService(new Intent(this, MyService.class), connection, Context.BIND_AUTO_CREATE);[/java]

3.远程onBind方法返回一个bindler
<div>

  [java]@Override
 public IBinder onBind(Intent intent) {
 return messenger.getBinder();
 }[/java]

4.客户端使用远程返回的bindler得到一个信使（即得到远程信使）
<div>

[java]@Override
 public void onServiceConnected(ComponentName name, IBinder binder) {
 messenger = new Messenger(binder);
 }[/java]

</div>
这里虽然是new了一个Messenger，但我们查看它的实现

[java]public Messenger(IBinder target) {

mTarget = IMessenger.Stub.asInterface(target);  }  [/java]

发现它的mTarget是通过Aidl得到的，实际上就是远程创建的那个。

5.客户端可以使用这个远程信使对象向远程发送消息：

[java] messenger.send(message);[/java]

这样远程服务端的Handler对象就能收到消息了，然后可以在其handlerMessage(Message msg)方法中进行处理。（该Handler对象就是第一步服务端创建Messenger时使用的参数IncomingHandler）.

经过这５个步骤貌似只有客户端向服务端发送消息，这样的消息传递是单向的，那么如何实现双向传递呢？

首先需要在第５步稍加修改，在send(msg)前通过message.replyTo = clientMessenger;将自己的信使设置到消息中，这样服务端接收到消息时同时也得到了客户端的信使对象了，然后服务端可以通过/得到客户端的信使对象，并向它发送消息

[java]replyMessenger = message.replyTo;
 replyMessenger.send(message);[/java]

即完成了从服务端向客户端发送消息的功能，这样客服端可以在自己的Handler对象的handlerMessage方法中接收服务端发送来的message进行处理。

双向通信宣告完成。
<div> demo参见apidemo。</div>
</div>
<div></div>
</div>
<div></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>261</wp:post_id>
		<wp:post_date>2015-02-07 21:19:49</wp:post_date>
		<wp:post_date_gmt>2015-02-07 13:19:49</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-messenger-%e8%b7%a8%e8%bf%9b%e7%a8%8b%e9%80%9a%e4%bf%a1</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="aidl"><![CDATA[AIDL]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="messenger"><![CDATA[Messenger]]></category>
		<category domain="post_tag" nicename="%e8%b7%a8%e8%bf%9b%e7%a8%8b%e9%80%9a%e4%bf%a1"><![CDATA[跨进程通信]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707513]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>2015开始啦</title>
		<link>http://1.duoinfo.sinaapp.com/?p=266</link>
		<pubDate>Sun, 01 Mar 2015 02:58:31 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=266</guid>
		<description></description>
		<content:encoded><![CDATA[寒假结束，今天开始正式奋斗！加油2015.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>266</wp:post_id>
		<wp:post_date>2015-03-01 10:58:31</wp:post_date>
		<wp:post_date_gmt>2015-03-01 02:58:31</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>2015%e5%bc%80%e5%a7%8b%e5%95%a6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%8a%b1%e5%bf%97"><![CDATA[励志]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707514]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android源码分析-点击事件派发机制</title>
		<link>http://1.duoinfo.sinaapp.com/?p=268</link>
		<pubDate>Sun, 01 Mar 2015 03:19:07 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=268</guid>
		<description></description>
		<content:encoded><![CDATA[转自：<a title="http://blog.csdn.net/singwhatiwanna/article/details/17339857" href="http://blog.csdn.net/singwhatiwanna/article/details/17339857" target="_blank">http://blog.csdn.net/singwhatiwanna/article/details/17339857</a>
<h2>概述</h2>
一直想写篇关于Android事件派发机制的文章，却一直没写，这两天刚好是周末，有时间了，想想写一篇吧，不然总是只停留在会用的层次上但是无法了解其内部机制。我用的是4.4源码，打开看看，挺复杂的，尤其是事件是怎么从Activity派发出来的，太费解了。了解Windows消息机制的人会发现，觉得Android的事件派发机制和Windows的消息派发机制挺像的，其实这是一种典型的消息“冒泡”机制，很多平台采用这个机制，消息最先到达最底层View，然后它先进行判断是不是它所需要的，否则就将消息传递给它的子View，这样一来，消息就从水底的气泡一样向上浮了一点距离，以此类推，气泡达到顶部和空气接触，破了（消息被处理了），当然也有气泡浮出到顶层了，还没破（消息无人处理），这个消息将由系统来处理，对于Android来说，会由Activity来处理。
<h2><a name="t1"></a>Android点击事件的派发机制</h2>
<h4><a name="t2"></a>1. 从Activity传递到底层View</h4>
点击事件用MotionEvent来表示，当一个点击操作发生时，事件最先传递给当前Activity，由Activity的dispatchTouchEvent来进行事件派发，具体的工作是由Activity内部的Window来完成的，Window会将事件传递给decor view，decor view一般就是当前界面的底层容器（即setContentView所设置的View的父容器），通过Activity.getWindow.getDecorView（）可以获得。另外，看下面代码的的时候，主要看我注释的地方，代码很多很复杂，我无法一一说明，但是我注释的地方都是关键点，是博主仔细读代码总结出来的。

源码解读：

事件是由哪里传递给Activity的，这个我还不清楚，但是不要紧，我们从activity开始分析，已经足够我们了解它的内部实现了。

Code：Activity#dispatchTouchEvent

[java]/**
 * Called to process touch screen events. You can override this to
 * intercept all touch screen events before they are dispatched to the
 * window. Be sure to call this implementation for touch screen events
 * that should be handled normally.
 *
 * @param ev The touch screen event.
 *
 * @return boolean Return true if this event was consumed.
 */
 public boolean dispatchTouchEvent(MotionEvent ev) {
 if (ev.getAction() == MotionEvent.ACTION_DOWN) {
 //这个函数其实是个空函数，啥也没干，如果你没重写的话，不用关心
 onUserInteraction();
 }
 //这里事件开始交给Activity所附属的Window进行派发，如果返回true，整个事件循环就结束了
 //返回false意味着事件没人处理，所有人的onTouchEvent都返回了false，那么Activity就要来做最后的收场。
 if (getWindow().superDispatchTouchEvent(ev)) {
 return true;
 }
 //这里，Activity来收场了，Activity的onTouchEvent被调用
 return onTouchEvent(ev);
 }[/java]

Window是如何将事件传递给ViewGroup的

Code：Window#superDispatchTouchEvent

[java]/**
 * Used by custom windows, such as Dialog, to pass the touch screen event
 * further down the view hierarchy. Application developers should
 * not need to implement or call this.
 *
 */
 public abstract boolean superDispatchTouchEvent(MotionEvent event);[/java]

这竟然是一个抽象函数，还注明了应用开发者不要实现它或者调用它，这是什么情况？再看看如下类的说明，大意是说：这个类可以控制顶级View的外观和行为策略，而且还说这个类的唯一一个实现位于android.policy.PhoneWindow，当你要实例化这个Window类的时候，你并不知道它的细节，因为这个类会被重构，只有一个工厂方法可以使用。好吧，还是很模糊啊，不太懂，不过我们可以看一下android.policy.PhoneWindow这个类，尽管实例化的时候此类会被重构，但是重构而已，功能是类似的。

Abstract base class for a top-level window look and behavior policy. An instance of this class should be used as the top-level view added to the window manager. It provides standard UI policies such as a background, title area, default key processing, etc.

The only existing implementation of this abstract class is android.policy.PhoneWindow, which you should instantiate when needing a Window. Eventually that class will be refactored and a factory method added for creating Window instances without knowing about a particular implementation.

Code：PhoneWindow#superDispatchTouchEvent

[java]@Override
 public boolean superDispatchTouchEvent(MotionEvent event) {
 return mDecor.superDispatchTouchEvent(event);
 }[/java]

这个逻辑很清晰了，PhoneWindow将事件传递给DecorView了，这个DecorView是啥呢，请看下面

[java]private final class DecorView extends FrameLayout implements RootViewSurfaceTaker

// This is the top-level view of the window, containing the window decor.
 private DecorView mDecor;

@Override
 public final View getDecorView() {
 if (mDecor == null) {
 installDecor();
 }
 return mDecor;
 }[/java]

顺便说一下，平时Window用的最多的就是((ViewGroup)getWindow().getDecorView().findViewById(android.R.id.content)).getChildAt(0)即通过Activity来得到内部的View。这个mDecor显然就是getWindow().getDecorView()返回的View，而我们通过setContentView设置的View是它的一个子View。目前事件传递到了DecorView 这里，由于DecorView 继承自FrameLayout且是我们的父View，所以最终事件会传递给我们的View，原因先不管了，换句话来说，事件肯定会传递到我们的View，不然我们的应用如何响应点击事件呢。不过这不是我们的重点，重点是事件到了我们的View以后应该如何传递，这是对我们更有用的。从这里开始，事件已经传递到我们的顶级View了，注意：顶级View实际上是最底层View，也叫根View。
<h4>2.底层View对事件的分发过程</h4>
点击事件到底层View（一般是一个ViewGroup）以后，会调用ViewGroup的dispatchTouchEvent方法，然后的逻辑是这样的：如果底层ViewGroup拦截事件即onInterceptTouchEvent返回true，则事件由ViewGroup处理，这个时候，如果ViewGroup的mOnTouchListener被设置，则会onTouch会被调用，否则，onTouchEvent会被调用，也就是说，如果都提供的话，onTouch会屏蔽掉onTouchEvent。在onTouchEvent中，如果设置了mOnClickListener，则onClick会被调用。如果顶层ViewGroup不拦截事件，则事件会传递给它的在点击事件链上的子View，这个时候，子View的dispatchTouchEvent会被调用，到此为止，事件已经从最底层View传递给了上一层View，接下来的行为和其底层View一致，如此循环，完成整个事件派发。另外要说明的是，ViewGroup默认是不拦截点击事件的，其onInterceptTouchEvent返回false。

源码解读：

Code：ViewGroup#dispatchTouchEvent

[java]@Override
 public boolean dispatchTouchEvent(MotionEvent ev) {
 if (mInputEventConsistencyVerifier != null) {
 mInputEventConsistencyVerifier.onTouchEvent(ev, 1);
 }

boolean handled = false;
 if (onFilterTouchEventForSecurity(ev)) {
 final int action = ev.getAction();
 final int actionMasked = action &amp; MotionEvent.ACTION_MASK;

// Handle an initial down.
 if (actionMasked == MotionEvent.ACTION_DOWN) {
 // Throw away all previous state when starting a new touch gesture.
 // The framework may have dropped the up or cancel event for the previous gesture
 // due to an app switch, ANR, or some other state change.
 cancelAndClearTouchTargets(ev);
 resetTouchState();
 }

// Check for interception.
 final boolean intercepted;
 if (actionMasked == MotionEvent.ACTION_DOWN
 || mFirstTouchTarget != null) {
 final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;
 if (!disallowIntercept) {
 //这里判断是否拦截点击事件，如果拦截，则intercepted=true
 intercepted = onInterceptTouchEvent(ev);
 ev.setAction(action); // restore action in case it was changed
 } else {
 intercepted = false;
 }
 } else {
 // There are no touch targets and this action is not an initial down
 // so this view group continues to intercept touches.
 intercepted = true;
 }

// Check for cancelation.
 final boolean canceled = resetCancelNextUpFlag(this)
 || actionMasked == MotionEvent.ACTION_CANCEL;

// Update list of touch targets for pointer down, if needed.
 final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0;
 TouchTarget newTouchTarget = null;
 boolean alreadyDispatchedToNewTouchTarget = false;
 //这里面一大堆是派发事件到子View，如果intercepted是true，则直接跳过
 if (!canceled &amp;&amp; !intercepted) {
 if (actionMasked == MotionEvent.ACTION_DOWN
 || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)
 || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
 final int actionIndex = ev.getActionIndex(); // always 0 for down
 final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex)
 : TouchTarget.ALL_POINTER_IDS;

// Clean up earlier touch targets for this pointer id in case they
 // have become out of sync.
 removePointersFromTouchTargets(idBitsToAssign);

final int childrenCount = mChildrenCount;
 if (newTouchTarget == null &amp;&amp; childrenCount != 0) {
 final float x = ev.getX(actionIndex);
 final float y = ev.getY(actionIndex);
 // Find a child that can receive the event.
 // Scan children from front to back.
 final View[] children = mChildren;

final boolean customOrder = isChildrenDrawingOrderEnabled();
 for (int i = childrenCount - 1; i &gt;= 0; i--) {
 final int childIndex = customOrder ?
 getChildDrawingOrder(childrenCount, i) : i;
 final View child = children[childIndex];
 if (!canViewReceivePointerEvents(child)
 || !isTransformedTouchPointInView(x, y, child, null)) {
 continue;
 }

newTouchTarget = getTouchTarget(child);
 if (newTouchTarget != null) {
 // Child is already receiving touch within its bounds.
 // Give it the new pointer in addition to the ones it is handling.
 newTouchTarget.pointerIdBits |= idBitsToAssign;
 break;
 }

resetCancelNextUpFlag(child);
 if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
 // Child wants to receive touch within its bounds.
 mLastTouchDownTime = ev.getDownTime();
 mLastTouchDownIndex = childIndex;
 mLastTouchDownX = ev.getX();
 mLastTouchDownY = ev.getY();
 //注意下面两句，如果有子View处理了点击事件，则newTouchTarget会被赋值，
 //同时alreadyDispatchedToNewTouchTarget也会为true，这两个变量是直接影响下面的代码逻辑的。
 newTouchTarget = addTouchTarget(child, idBitsToAssign);
 alreadyDispatchedToNewTouchTarget = true;
 break;
 }
 }
 }

if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) {
 // Did not find a child to receive the event.
 // Assign the pointer to the least recently added target.
 newTouchTarget = mFirstTouchTarget;
 while (newTouchTarget.next != null) {
 newTouchTarget = newTouchTarget.next;
 }
 newTouchTarget.pointerIdBits |= idBitsToAssign;
 }
 }
 }

// Dispatch to touch targets.
 //这里如果当前ViewGroup拦截了事件，或者其子View的onTouchEvent都返回了false，则事件会由ViewGroup处理
 if (mFirstTouchTarget == null) {
 // No touch targets so treat this as an ordinary view.
 //这里就是ViewGroup对点击事件的处理
 handled = dispatchTransformedTouchEvent(ev, canceled, null,
 TouchTarget.ALL_POINTER_IDS);
 } else {
 // Dispatch to touch targets, excluding the new touch target if we already
 // dispatched to it. Cancel touch targets if necessary.
 TouchTarget predecessor = null;
 TouchTarget target = mFirstTouchTarget;
 while (target != null) {
 final TouchTarget next = target.next;
 if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {
 handled = true;
 } else {
 final boolean cancelChild = resetCancelNextUpFlag(target.child)
 || intercepted;
 if (dispatchTransformedTouchEvent(ev, cancelChild,
 target.child, target.pointerIdBits)) {
 handled = true;
 }
 if (cancelChild) {
 if (predecessor == null) {
 mFirstTouchTarget = next;
 } else {
 predecessor.next = next;
 }
 target.recycle();
 target = next;
 continue;
 }
 }
 predecessor = target;
 target = next;
 }
 }

// Update list of touch targets for pointer up or cancel, if needed.
 if (canceled
 || actionMasked == MotionEvent.ACTION_UP
 || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
 resetTouchState();
 } else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) {
 final int actionIndex = ev.getActionIndex();
 final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex);
 removePointersFromTouchTargets(idBitsToRemove);
 }
 }

if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) {
 mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1);
 }
 return handled;
 }[/java]

下面再看ViewGroup对点击事件的处理

Code：ViewGroup#dispatchTransformedTouchEvent

[java]/**
 * Transforms a motion event into the coordinate space of a particular child view,
 * filters out irrelevant pointer ids, and overrides its action if necessary.
 * If child is null, assumes the MotionEvent will be sent to this ViewGroup instead.
 */
 private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,
 View child, int desiredPointerIdBits) {
 final boolean handled;

// Canceling motions is a special case. We don't need to perform any transformations
 // or filtering. The important part is the action, not the contents.
 final int oldAction = event.getAction();
 if (cancel || oldAction == MotionEvent.ACTION_CANCEL) {
 event.setAction(MotionEvent.ACTION_CANCEL);
 if (child == null) {
 //这里就是ViewGroup对点击事件的处理，其调用了View的dispatchTouchEvent方法
 handled = super.dispatchTouchEvent(event);
 } else {
 handled = child.dispatchTouchEvent(event);
 }
 event.setAction(oldAction);
 return handled;
 }

// Calculate the number of pointers to deliver.
 final int oldPointerIdBits = event.getPointerIdBits();
 final int newPointerIdBits = oldPointerIdBits &amp; desiredPointerIdBits;

// If for some reason we ended up in an inconsistent state where it looks like we
 // might produce a motion event with no pointers in it, then drop the event.
 if (newPointerIdBits == 0) {
 return false;
 }

// If the number of pointers is the same and we don't need to perform any fancy
 // irreversible transformations, then we can reuse the motion event for this
 // dispatch as long as we are careful to revert any changes we make.
 // Otherwise we need to make a copy.
 final MotionEvent transformedEvent;
 if (newPointerIdBits == oldPointerIdBits) {
 if (child == null || child.hasIdentityMatrix()) {
 if (child == null) {
 handled = super.dispatchTouchEvent(event);
 } else {
 final float offsetX = mScrollX - child.mLeft;
 final float offsetY = mScrollY - child.mTop;
 event.offsetLocation(offsetX, offsetY);

handled = child.dispatchTouchEvent(event);

event.offsetLocation(-offsetX, -offsetY);
 }
 return handled;
 }
 transformedEvent = MotionEvent.obtain(event);
 } else {
 transformedEvent = event.split(newPointerIdBits);
 }

// Perform any necessary transformations and dispatch.
 if (child == null) {
 handled = super.dispatchTouchEvent(transformedEvent);
 } else {
 final float offsetX = mScrollX - child.mLeft;
 final float offsetY = mScrollY - child.mTop;
 transformedEvent.offsetLocation(offsetX, offsetY);
 if (! child.hasIdentityMatrix()) {
 transformedEvent.transform(child.getInverseMatrix());
 }

handled = child.dispatchTouchEvent(transformedEvent);
 }

// Done.
 transformedEvent.recycle();
 return handled;
 }[/java]

再看

Code：View#dispatchTouchEvent

[java]/**
 * Pass the touch screen motion event down to the target view, or this
 * view if it is the target.
 *
 * @param event The motion event to be dispatched.
 * @return True if the event was handled by the view, false otherwise.
 */
 public boolean dispatchTouchEvent(MotionEvent event) {
 if (mInputEventConsistencyVerifier != null) {
 mInputEventConsistencyVerifier.onTouchEvent(event, 0);
 }

if (onFilterTouchEventForSecurity(event)) {
 //noinspection SimplifiableIfStatement
 ListenerInfo li = mListenerInfo;
 if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED
 &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {
 return true;
 }

if (onTouchEvent(event)) {
 return true;
 }
 }

if (mInputEventConsistencyVerifier != null) {
 mInputEventConsistencyVerifier.onUnhandledEvent(event, 0);
 }
 return false;
 }[/java]

&nbsp;

这段代码比较简单，View对事件的处理是这样的：如果设置了OnTouchListener就调用onTouch，否则就直接调用onTouchEvent，而onClick是在onTouchEvent内部通过performClick触发的。简单来说，事件如果被ViewGroup拦截或者子View的onTouchEvent都返回了false，则事件最终由ViewGroup处理。
<h4><a name="t4"></a>3.无人处理的点击事件</h4>
如果一个点击事件，子View的onTouchEvent返回了false，则父View的onTouchEvent会被直接调用，以此类推。如果所有的View都不处理，则最终会由Activity来处理，这个时候，Activity的onTouchEvent会被调用。这个问题已经在1和2中做了说明。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>268</wp:post_id>
		<wp:post_date>2015-03-01 11:19:07</wp:post_date>
		<wp:post_date_gmt>2015-03-01 03:19:07</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-%e7%82%b9%e5%87%bb%e4%ba%8b%e4%bb%b6%e6%b4%be%e5%8f%91%e6%9c%ba%e5%88%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><![CDATA[Android源码分析]]></category>
		<category domain="post_tag" nicename="%e4%ba%8b%e4%bb%b6%e5%88%86%e5%8f%91"><![CDATA[事件分发]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707515]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android源码分析-消息队列和Looper</title>
		<link>http://1.duoinfo.sinaapp.com/?p=270</link>
		<pubDate>Sun, 01 Mar 2015 03:34:55 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=270</guid>
		<description></description>
		<content:encoded><![CDATA[<h2>概念</h2>
<h4><a name="t2"></a>1. 什么是消息队列</h4>
消息队列在android中对应MessageQueue这个类，顾名思义，消息队列中存放了大量的消息（Message）
<h4><a name="t3"></a>2.什么是消息</h4>
消息（Message）代表一个行为（what）或者一串动作（Runnable），有两处会用到Message：<span style="color: #800080;">Handler和Messenger</span>
<h4><a name="t4"></a>3.什么是Handler和Messenger</h4>
Handler大家都知道，主要用来在线程中发消息通知ui线程更新ui。Messenger可以翻译为信使，可以实现进程间通信（IPC），Messenger采用一个单线程来处理所有的消息，而且进程间的通信都是通过发消息来完成的，感觉不能像AIDL那样直接调用对方的接口方法（具体有待考证），这是其和AIDL的主要区别，也就是说<span style="color: #800080;">Messenger无法处理多线程</span>，所有的调用都是在一个线程中串行执行的。<span style="color: #800080;">Messenger的典型代码是这样的：new Messenger(service).send(msg)，它的本质还是调用了Handler的sendMessage方法</span>
<h4><a name="t5"></a>4.什么是Looper</h4>
Looper是循环的意思，它负责从消息队列中循环的取出消息然后把消息交给目标处理
<h4><a name="t6"></a>5.线程有没有Looper有什么区别？</h4>
<span style="color: #800080;">线程如果没有Looper，就没有消息队列，就无法处理消息，线程内部就无法使用Handler。</span>这就是为什么在子线程内部创建Handler会报错：<span style="color: #800080;">"Can't create handler inside thread that has not called Looper.prepare()"</span>，具体原因下面再分析。
<h4><a name="t7"></a>6.如何让线程有Looper从而正常使用Handler？</h4>
在线程的run方法中加入如下两句：

Looper.prepare();

Looper.loop();

这一切不用我们来做，有现成的，HandlerThread就是带有Looper的线程。

想用线程的Looper来创建Handler，很简单，Handler handler = new Handler(thread.getLooper())，有了上面这几步，你就可以在子线程中创建Handler了，好吧，其实android早就为我们想到这一点了，也不用自己写，IntentService把我们该做的都做了，我们只要用就好了，具体怎么用后面再说。
<h2><a name="t8"></a>消息队列和Looper的工作机制</h2>
一个Handler会有一个Looper，一个Looper会有一个消息队列，Looper的作用就是循环的遍历消息队列，如果有新消息，就把新消息交给它的目标处理。每当我们用Handler来发送消息，消息就会被放入消息队列中，然后Looper就会取出消息发送给它的目标target。<span style="color: #800080;">一般情况，一个消息的target是发送这个消息的Handler</span>，这么一来，Looper就会把消息交给Handler处理，这个时候Handler的<span style="color: #800080;">dispatchMessage</span>方法就会被调用，一般情况最终会调用Handler的<span style="color: #800080;">handleMessage</span>来处理消息，用handleMessage来处理消息是我们常用的方式。

源码分析
<h4><a name="t9"></a>1. Handler发送消息的过程</h4>
[java]public final boolean sendMessage(Message msg)
 {
 return sendMessageDelayed(msg, 0);
 }

 public final boolean sendMessageDelayed(Message msg, long delayMillis)
 {
 if (delayMillis &lt; 0) {
 delayMillis = 0;
 }
 return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);
 }

 public boolean sendMessageAtTime(Message msg, long uptimeMillis) {
 MessageQueue queue = mQueue;
 if (queue == null) {
 RuntimeException e = new RuntimeException(
 this + &quot; sendMessageAtTime() called with no mQueue&quot;);
 Log.w(&quot;Looper&quot;, e.getMessage(), e);
 return false;
 }
 return enqueueMessage(queue, msg, uptimeMillis);
 }

 private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
 msg.target = this;
 if (mAsynchronous) {
 msg.setAsynchronous(true);
 }
 //这里msg被加入消息队列queue
 return queue.enqueueMessage(msg, uptimeMillis);
 }[/java]
<h4>2.Looper的工作过程</h4>
[java]public static void loop() {
 final Looper me = myLooper();
 if (me == null) {
 throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn't called on this thread.&quot;);
 }
 //从Looper中取出消息队列
 final MessageQueue queue = me.mQueue;

// Make sure the identity of this thread is that of the local process,
 // and keep track of what that identity token actually is.
 Binder.clearCallingIdentity();
 final long ident = Binder.clearCallingIdentity();

//死循环，循环的取消息，没有新消息就会阻塞
 for (;;) {
 Message msg = queue.next(); // might block 这里会被阻塞，如果没有新消息
 if (msg == null) {
 // No message indicates that the message queue is quitting.
 return;
 }

// This must be in a local variable, in case a UI event sets the logger
 Printer logging = me.mLogging;
 if (logging != null) {
 logging.println(&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot; + msg.target + &quot; &quot; +
 msg.callback + &quot;: &quot; + msg.what);
 }

//将消息交给target处理，这个target就是Handler类型
 msg.target.dispatchMessage(msg);

if (logging != null) {
 logging.println(&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot; + msg.target + &quot; &quot; + msg.callback);
 }

// Make sure that during the course of dispatching the
 // identity of the thread wasn't corrupted.
 final long newIdent = Binder.clearCallingIdentity();
 if (ident != newIdent) {
 Log.wtf(TAG, &quot;Thread identity changed from 0x&quot;
 + Long.toHexString(ident) + &quot; to 0x&quot;
 + Long.toHexString(newIdent) + &quot; while dispatching to &quot;
 + msg.target.getClass().getName() + &quot; &quot;
 + msg.callback + &quot; what=&quot; + msg.what);
 }

msg.recycle();
 }
 }[/java]
<h4>3.Handler如何处理消息</h4>
[java]/**
 * Subclasses must implement this to receive messages.
 */
 public void handleMessage(Message msg) {
 }

 /**
 * Handle system messages here.
 */
 public void dispatchMessage(Message msg) {
 if (msg.callback != null) {
 //这个方法很简单，直接调用msg.callback.run();
 handleCallback(msg);
 } else {
 //如果我们设置了callback会由callback来处理消息
 if (mCallback != null) {
 if (mCallback.handleMessage(msg)) {
 return;
 }
 }
 //否则消息就由这里来处理，这是我们最常用的处理方式
 handleMessage(msg);
 }
 }[/java]

我们再看看msg.callback和mCallback是啥东西

&nbsp;

/*package*/ Runnable callback;

现在已经很明确了，msg.callback是个Runnable，什么时候会设置这个callback：handler.post(runnable)，相信大家都常用这个方法吧

[java]/**
 * Callback interface you can use when instantiating a Handler to avoid
 * having to implement your own subclass of Handler.
 *
 * @param msg A {@link android.os.Message Message} object
 * @return True if no further handling is desired
 */
public interface Callback {
 public boolean handleMessage(Message msg);
}

final Callback mCallback;[/java]

而mCallback是个接口，可以这样来设置 Handler handler = new Handler(callback)，这个callback的意义是什么呢，代码里面的注释已经说了，可以让你不用创建Handler的子类但是还能照样处理消息，恐怕大家常用的方式都是新new一个Handler然后override其handleMessage方法来处理消息吧，从现在开始，我们知道，不创建Handler的子类也可以处理消息。多说一句，为什么创建Handler的子类不好？这是因为，类也是占空间的，一个应用class太多，其占用空间会变大，也就是应用会更耗内存。
<h2>HandlerThread简介</h2>
[java]@Override
 public void run() {
 mTid = Process.myTid();
 Looper.prepare();
 synchronized (this) {
 mLooper = Looper.myLooper();
 notifyAll();
 }
 Process.setThreadPriority(mPriority);
 onLooperPrepared();
 Looper.loop();
 mTid = -1;
 }[/java]

HandlerThread继承自Thread，其在run方法内部为自己创建了一个Looper，使用上HandlerThread和普通的Thread不一样，无法执行常见的后台操作，只能用来处理新消息，这是因为Looper.loop()是死循环，你的code根本执行不了，不过貌似你可以把你的code放在super.run()之前执行，但是这好像不是主流玩法，所以不建议这么做。

&nbsp;
<h2><a name="t13"></a>IntentService简介</h2>
[java]public void onCreate() {
 // TODO: It would be nice to have an option to hold a partial wakelock
 // during processing, and to have a static startService(Context, Intent)
 // method that would launch the service &amp; hand off a wakelock.

super.onCreate();
 HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);
 thread.start();

mServiceLooper = thread.getLooper();
 mServiceHandler = new ServiceHandler(mServiceLooper);
 }[/java]

IntentService继承自Service，它是一个抽象类，其被创建的时候就new了一个HandlerThread和ServiceHandler，有了它，就可以利用IntentService做一些优先级较高的task，IntentService不会被系统轻易杀掉。使用IntentService也是很简单，首先startService(intent)，然后IntentService会把你的intent封装成Message然后通过ServiceHandler进行发送，接着ServiceHandler会调用onHandleIntent(Intent intent)来处理这个Message，onHandleIntent(Intent intent)中的intent就是你startService(intent)中的intent，ok，现在你需要做的是从IntentService派生一个子类并重写onHandleIntent方法，然后你只要针对不同的intent做不同的事情即可，事情完成后IntentService会自动停止。所以，IntentService是除了Thread和AsyncTask外又一执行耗时操作的方式，而且其不容易被系统干掉，建议关键操作采用IntentService。
<h2><a name="t14"></a>在子线程创建Handler为什么会报错？</h2>
[java]public Handler(Callback callback, boolean async) {
 if (FIND_POTENTIAL_LEAKS) {
 final Class&lt;? extends Handler&gt; klass = getClass();
 if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;
 (klass.getModifiers() &amp; Modifier.STATIC) == 0) {
 Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +
 klass.getCanonicalName());
 }
 }
 //获取当前线程的Looper
 mLooper = Looper.myLooper();
 //报错的根本原因是：当前线程没有Looper
 if (mLooper == null) {
 throw new RuntimeException(
 &quot;Can't create handler inside thread that has not called Looper.prepare()&quot;);
 }
 mQueue = mLooper.mQueue;
 mCallback = callback;
 mAsynchronous = async;
 }[/java]

如何避免这种错误：在ui线程使用Handler或者给子线程加上Looper。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>270</wp:post_id>
		<wp:post_date>2015-03-01 11:34:55</wp:post_date>
		<wp:post_date_gmt>2015-03-01 03:34:55</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e5%92%8clooper</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><![CDATA[Android源码分析]]></category>
		<category domain="post_tag" nicename="handler"><![CDATA[Handler]]></category>
		<category domain="post_tag" nicename="looper"><![CDATA[Looper]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707516]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>getBackStackEntryCount()和popBackStack(String name, int flags)方法</title>
		<link>http://1.duoinfo.sinaapp.com/?p=274</link>
		<pubDate>Mon, 02 Mar 2015 09:31:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=274</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="color: #333399;">int getBackStackEntryCount();　</span>　返回堆栈的总数目。

<span style="color: #333399;">void popBackStack(String name, int flags);</span>　针对第一个参数，如果name为null，那么只有顶部的状态被弹出；如果name不为null，并且找到了这个name所指向的Fragment对象；根据flags的值，如果是flag=0，那么将会弹出该状态以上的所有状态；如果flag=POP_BACK_STACK_INCLUSIVE，那么将会弹出该状态（包括该状态）以上的所有状态。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>274</wp:post_id>
		<wp:post_date>2015-03-02 17:31:32</wp:post_date>
		<wp:post_date_gmt>2015-03-02 09:31:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>getbackstackentrycount%e5%92%8cpopbackstackstring-name-int-flags%e6%96%b9%e6%b3%95</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="dandelion"><![CDATA[Dandelion]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707517]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android Fragment getActivity返回null解决</title>
		<link>http://1.duoinfo.sinaapp.com/?p=276</link>
		<pubDate>Tue, 03 Mar 2015 00:54:03 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=276</guid>
		<description></description>
		<content:encoded><![CDATA[在Android开发中，如果我们用到V4包里面的Fragment，<span style="color: #333399;">在应用被切换到后台的时候，Activity可能被回收，但是创建的所有Fragment则会被保存到Bundle里面</span>，下面是FragmentActivity的部分源码

[java]@Override
protected void onSaveInstanceState(Bundle outState) {
super.onSaveInstanceState(outState);
Parcelable p = mFragments.saveAllState();
if (p != null) {
outState.putParcelable(FRAGMENTS_TAG, p);
}
}[/java]

如果从最近使用的应用里面点击我们的应用，系统会恢复之前被回收的Activity，这个时候FragmentActivity在oncreate里面也会做Fragment的恢复

[java]@Override
protected void onCreate(Bundle savedInstanceState) {
 mFragments.attachActivity(this, mContainer, null);
 // Old versions of the platform didn't do this!
 if (getLayoutInflater().getFactory() == null) {
 getLayoutInflater().setFactory(this);
 }

super.onCreate(savedInstanceState);

NonConfigurationInstances nc = (NonConfigurationInstances)
 getLastNonConfigurationInstance();
 if (nc != null) {
 mAllLoaderManagers = nc.loaders;
 }
 if (savedInstanceState != null) {
 Parcelable p = savedInstanceState.getParcelable(FRAGMENTS_TAG);
 mFragments.restoreAllState(p, nc != null ? nc.fragments : null);
 }
 mFragments.dispatchCreate();
 }[/java]
但是此时恢复出的Fragment，在调用getActivity的时候会返回null&lt;/span&gt;，具体什么原因还没详细研究，这里我的解决方法是在恢复Fragment之前把保存Bundle里面的数据给清除，也就是保存的Fragment信息，然后自己重新replace。方法如下：
[java]if(arg0 != null)
{
String FRAGMENTS_TAG = &quot;android:support:fragments&quot;;
// remove掉保存的Fragment
arg0.remove(FRAGMENTS_TAG);
}[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>276</wp:post_id>
		<wp:post_date>2015-03-03 08:54:03</wp:post_date>
		<wp:post_date_gmt>2015-03-03 00:54:03</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-fragment-getactivity%e8%bf%94%e5%9b%9enull%e8%a7%a3%e5%86%b3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="uncategorized"><![CDATA[未分类]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707518]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>开发中关于Fragment异常的两个问题</title>
		<link>http://1.duoinfo.sinaapp.com/?p=283</link>
		<pubDate>Tue, 03 Mar 2015 06:55:34 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=283</guid>
		<description></description>
		<content:encoded><![CDATA[下边两个问题，是在开发中碰到的一些关于Fragment的偶发性的问题，今天时间比较多，就在网上搜了一些解决方式：

1、<span style="color: #000080;">关于Fragment（XXFragment） not attached to Activity</span> 异常。出现该异常，是因为Fragment的还没有Attach到Activity时，调用了如getResource()等，需要上下文Content的函数。解决方法，就是等将调用的代码写在OnStart（）中。网上还有几处这样的参考：<a title="http://stackoverflow.com/questions/10919240/fragment-myfragment-not-attached-to-activity" href="http://stackoverflow.com/questions/10919240/fragment-myfragment-not-attached-to-activity">http://stackoverflow.com/questions/10919240/fragment-myfragment-not-attached-to-activity</a> 回答的主要是在调用

[java]getResources().getString(R.string.app_name);[/java]

之前增加一个判断isAdded(),两外说这个异常解决办法的有 <a title="http://stackoverflow.com/questions/6870325/android-compatibility-package-fragment-not-attached-to-activity" href="http://stackoverflow.com/questions/6870325/android-compatibility-package-fragment-not-attached-to-activity" target="_blank">http://stackoverflow.com/questions/6870325/android-compatibility-package-fragment-not-attached-to-activity</a>

这个是针对另外一种情况下的解决方式。

2、在使用Fragment保存参数的时候，可能是因为需要保存的参数比较大或者比较多，这种情况下页会引起异常。比如代码

[java]Bundle b = new Bundle();

b.putParcelable(&quot;bitmap&quot;, bitmap2);

imageRecognitionFragment.setArguments(b);[/java]

设置好参数，并且添加hide(),add(),方法之后，需要commit()，来实现两个Fragment跳转的时候，这种情形下参数需要进行系统保存，但是这个时候你已经实现了跳转，系统参数却没有保存。此时就会报

[java]java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState[/java]

异常。分析原因：你并不需要系统保存的参数，只要你自己设置的参数能够传递过去，在另外一个Fragment里能够顺利接受就行了，现在android里提供了另外一种形式的提交方式commitAllowingStateLoss()，从名字上就能看出，这种提交是允许状态值丢失的。到此问题得到完美解决，值的传递是你自己控制的。这里也说一下另外一个问题，bitmap 也可以通过Bundle传递的，使用putParacelable就可以了.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>283</wp:post_id>
		<wp:post_date>2015-03-03 14:55:34</wp:post_date>
		<wp:post_date_gmt>2015-03-03 06:55:34</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%bc%80%e5%8f%91%e4%b8%ad%e5%85%b3%e4%ba%8efragment%e5%bc%82%e5%b8%b8%e7%9a%84%e4%b8%a4%e4%b8%aa%e9%97%ae%e9%a2%98</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707519]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>关于Fragment的commit方法</title>
		<link>http://1.duoinfo.sinaapp.com/?p=286</link>
		<pubDate>Tue, 03 Mar 2015 06:59:25 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=286</guid>
		<description></description>
		<content:encoded><![CDATA[调用commit()方法<span style="color: #000080;">并不能立即执行transaction中包含的改变动作</span>，commit()方法把transaction加入activity的UI线程队列中。

但是，如果觉得有必要的话，可以调用executePendingTransactions()方法来<span style="color: #000080;">立即执行commit()</span>提供的transaction。

这样做通常是没有必要的，除非这个transaction被其他线程依赖。

注意：你只能在activity存储它的状态（当用户要离开activity时）之前调用commit()，如果在存储状态之后调用commit()，将会抛出一个异常。

这是因为当activity再次被恢复时commit之后的状态将丢失。如果丢失也没关系，那么使用commitAllowingStateLoss()方法。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>286</wp:post_id>
		<wp:post_date>2015-03-03 14:59:25</wp:post_date>
		<wp:post_date_gmt>2015-03-03 06:59:25</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%85%b3%e4%ba%8efragment%e7%9a%84commit%e6%96%b9%e6%b3%95</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707520]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Java垃圾回收机制</title>
		<link>http://1.duoinfo.sinaapp.com/?p=290</link>
		<pubDate>Tue, 03 Mar 2015 07:38:35 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=290</guid>
		<description></description>
		<content:encoded><![CDATA[文章转载自：

<a title="http://www.cnblogs.com/dolphin0520/p/3783345.html" href="http://www.cnblogs.com/dolphin0520/p/3783345.html" target="_blank">http://www.cnblogs.com/dolphin0520/p/3783345.html</a>

以下是本文的目录大纲：

一.如何确定某个对象是“垃圾”？

二.典型的垃圾收集算法

三.典型的垃圾收集器

&nbsp;
<h2>一.如何确定某个对象是“垃圾”？</h2>
在这一小节我们先了解一个最基本的问题：如果确定某个对象是“垃圾”？既然垃圾收集器的任务是回收垃圾对象所占的空间供新的对象使用，那么垃圾收集器如何确定某个对象是“垃圾”？—即通过什么方法判断一个对象可以被回收了。

在java中是通过引用来和对象进行关联的，也就是说如果要操作对象，必须通过引用来进行。那么很显然一个简单的办法就是通过引用计数来判断一个对象是否可以被回收。不失一般性，如果一个对象没有任何引用与之关联，则说明该对象基本不太可能在其他地方被使用到，那么这个对象就成为可被回收的对象了。这种方式成为引用计数法。

这种方式的特点是实现简单，而且效率较高，但是它无法解决循环引用的问题，因此在Java中并没有采用这种方式（Python采用的是引用计数法）。看下面这段代码：
<div>
<div>
<div id="highlighter_197464">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>public</code> <code>class</code> <code>Main {</code></div>
<div><code>    </code><code>public</code> <code>static</code> <code>void</code> <code>main(String[] args) {</code></div>
<div><code>        </code><code>MyObject object1 = </code><code>new</code> <code>MyObject();</code></div>
<div><code>        </code><code>MyObject object2 = </code><code>new</code> <code>MyObject();</code></div>
<div><code>        </code></div>
<div><code>        </code><code>object1.object = object2;</code></div>
<div><code>        </code><code>object2.object = object1;</code></div>
<div><code>        </code></div>
<div><code>        </code><code>object1 = </code><code>null</code><code>;</code></div>
<div><code>        </code><code>object2 = </code><code>null</code><code>;</code></div>
<div><code>    </code><code>}</code></div>
<div><code>}</code></div>
<div></div>
<div><code>class</code> <code>MyObject{</code></div>
<div><code>    </code><code>public</code> <code>Object object = </code><code>null</code><code>;</code></div>
<div><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
最后面两句将object1和object2赋值为null，也就是说object1和object2指向的对象已经不可能再被访问，但是由于它们互相引用对方，导致它们的引用计数都不为0，那么垃圾收集器就永远不会回收它们。

为了解决这个问题，在Java中采取了 可达性分析法。该方法的基本思想是通过一系列的“GC Roots”对象作为起点进行搜索，如果在“GC Roots”和一个对象之间没有可达路径，则称该对象是不可达的，不过要注意的是被判定为不可达的对象不一定就会成为可回收对象。被判定为不可达的对象要成为可回收对象必须至少经历两次标记过程，如果在这两次标记过程中仍然没有逃脱成为可回收对象的可能性，则基本上就真的成为可回收对象了。

至于可达性分析法具体是如何操作的我暂时也没有看得很明白，如果有哪位朋友比较清楚的话请不吝指教。

下面来看个例子：
<div>
<div>
<div id="highlighter_134017">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div></td>
<td>
<div>
<div><code>Object aobj = </code><code>new</code> <code>Object ( ) ;</code></div>
<div><code>Object bobj = </code><code>new</code> <code>Object ( ) ;</code></div>
<div><code>Object cobj = </code><code>new</code> <code>Object ( ) ;</code></div>
<div><code>aobj = bobj;</code></div>
<div><code>aobj = cobj;</code></div>
<div><code>cobj = </code><code>null</code><code>;</code></div>
<div><code>aobj = </code><code>null</code><code>;</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
第几行有可能会使得某个对象成为可回收对象？第7行的代码会导致有对象会成为可回收对象。至于为什么留给读者自己思考。

再看一个例子：
<div>
<div>
<div id="highlighter_122750">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div></td>
<td>
<div>
<div><code>String str = </code><code>new</code> <code>String(</code><code>"hello"</code><code>);</code></div>
<div><code>SoftReference&lt;String&gt; sr = </code><code>new</code> <code>SoftReference&lt;String&gt;(</code><code>new</code> <code>String(</code><code>"java"</code><code>));</code></div>
<div><code>WeakReference&lt;String&gt; wr = </code><code>new</code> <code>WeakReference&lt;String&gt;(</code><code>new</code> <code>String(</code><code>"world"</code><code>));</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
这三句哪句会使得String对象成为可回收对象？第2句和第3句，第2句在内存不足的情况下会将String对象判定为可回收对象，第3句无论什么情况下String对象都会被判定为可回收对象。

最后总结一下平常遇到的比较常见的将对象判定为可回收对象的情况：

1）显示地将某个引用赋值为null或者将已经指向某个对象的引用指向新的对象，比如下面的代码：
<div>
<div>
<div id="highlighter_69717">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div></td>
<td>
<div>
<div><code>Object obj = </code><code>new</code> <code>Object();</code></div>
<div><code>obj = </code><code>null</code><code>;</code></div>
<div><code>Object obj1 = </code><code>new</code> <code>Object();</code></div>
<div><code>Object obj2 = </code><code>new</code> <code>Object();</code></div>
<div><code>obj1 = obj2;</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
2）局部引用所指向的对象，比如下面这段代码：
<div>
<div>
<div id="highlighter_763507">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div></td>
<td>
<div>
<div><code>void</code> <code>fun() {</code></div>
<div></div>
<div><code>.....</code></div>
<div><code>    </code><code>for</code><code>(</code><code>int</code> <code>i=</code><code>0</code><code>;i&lt;</code><code>10</code><code>;i++) {</code></div>
<div><code>        </code><code>Object obj = </code><code>new</code> <code>Object();</code></div>
<div><code>        </code><code>System.out.println(obj.getClass());</code></div>
<div><code>    </code><code>}   </code></div>
<div><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
循环每执行完一次，生成的Object对象都会成为可回收的对象。

3）只有弱引用与其关联的对象，比如：
<div>
<div>
<div id="highlighter_996799">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>WeakReference&lt;String&gt; wr = </code><code>new</code> <code>WeakReference&lt;String&gt;(</code><code>new</code> <code>String(</code><code>"world"</code><code>));</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h2>二.典型的垃圾收集算法</h2>
在确定了哪些垃圾可以被回收后，垃圾收集器要做的事情就是开始进行垃圾回收，但是这里面涉及到一个问题是：如何高效地进行垃圾回收。由于Java虚拟机规范并没有对如何实现垃圾收集器做出明确的规定，因此各个厂商的虚拟机可以采用不同的方式来实现垃圾收集器，所以在此只讨论几种常见的垃圾收集算法的核心思想。

1.Mark-Sweep（标记-清除）算法

这是最基础的垃圾回收算法，之所以说它是最基础的是因为它最容易实现，思想也是最简单的。标记-清除算法分为两个阶段：标记阶段和清除阶段。标记阶段的任务是标记出所有需要被回收的对象，清除阶段就是回收被标记的对象所占用的空间。具体过程如下图所示：

<img src="http://images.cnitblog.com/i/288799/201406/181024382398115.jpg" alt="" />

从图中可以很容易看出标记-清除算法实现起来比较容易，但是有一个比较严重的问题就是容易产生内存碎片，碎片太多可能会导致后续过程中需要为大对象分配空间时无法找到足够的空间而提前触发新的一次垃圾收集动作。

2.Copying（复制）算法

为了解决Mark-Sweep算法的缺陷，Copying算法就被提了出来。它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用的内存空间一次清理掉，这样一来就不容易出现内存碎片的问题。具体过程如下图所示：

<img src="http://images.cnitblog.com/i/288799/201406/181041528488728.jpg" alt="" />

这种算法虽然实现简单，运行高效且不容易产生内存碎片，但是却对内存空间的使用做出了高昂的代价，因为能够使用的内存缩减到原来的一半。

很显然，Copying算法的效率跟存活对象的数目多少有很大的关系，如果存活对象很多，那么Copying算法的效率将会大大降低。

3.Mark-Compact（标记-整理）算法

为了解决Copying算法的缺陷，充分利用内存空间，提出了Mark-Compact算法。该算法标记阶段和Mark-Sweep一样，但是在完成标记之后，它不是直接清理可回收对象，而是将存活对象都向一端移动，然后清理掉端边界以外的内存。具体过程如下图所示：

<img src="http://images.cnitblog.com/i/288799/201406/181100129575916.jpg" alt="" />

4.Generational Collection（分代收集）算法

分代收集算法是目前大部分JVM的垃圾收集器采用的算法。它的核心思想是根据对象存活的生命周期将内存划分为若干个不同的区域。一般情况下将堆区划分为老年代（Tenured Generation）和新生代（Young Generation），老年代的特点是每次垃圾收集时只有少量对象需要被回收，而新生代的特点是每次垃圾回收时都有大量的对象需要被回收，那么就可以根据不同代的特点采取最适合的收集算法。

目前大部分垃圾收集器对于新生代都采取Copying算法，因为新生代中每次垃圾回收都要回收大部分对象，也就是说需要复制的操作次数较少，但是实际中并不是按照1：1的比例来划分新生代的空间的，一般来说是将新生代划分为一块较大的Eden空间和两块较小的Survivor空间，每次使用Eden空间和其中的一块Survivor空间，当进行回收时，将Eden和Survivor中还存活的对象复制到另一块Survivor空间中，然后清理掉Eden和刚才使用过的Survivor空间。

而由于老年代的特点是每次回收都只回收少量对象，一般使用的是Mark-Compact算法。

注意，在堆区之外还有一个代就是永久代（Permanet Generation），它用来存储class类、常量、方法描述等。对永久代的回收主要回收两部分内容：废弃常量和无用的类。
<h2>三.典型的垃圾收集器</h2>
垃圾收集算法是 内存回收的理论基础，而垃圾收集器就是内存回收的具体实现。下面介绍一下HotSpot（JDK 7)虚拟机提供的几种垃圾收集器，用户可以根据自己的需求组合出各个年代使用的收集器。

1.Serial/Serial Old

Serial/Serial Old收集器是最基本最古老的收集器，它是一个单线程收集器，并且在它进行垃圾收集时，必须暂停所有用户线程。Serial收集器是针对新生代的收集器，采用的是Copying算法，Serial Old收集器是针对老年代的收集器，采用的是Mark-Compact算法。它的优点是实现简单高效，但是缺点是会给用户带来停顿。

2.ParNew

ParNew收集器是Serial收集器的多线程版本，使用多个线程进行垃圾收集。

3.Parallel Scavenge

Parallel Scavenge收集器是一个新生代的多线程收集器（并行收集器），它在回收期间不需要暂停其他用户线程，其采用的是Copying算法，该收集器与前两个收集器有所不同，它主要是为了达到一个可控的吞吐量。

4.Parallel Old

Parallel Old是Parallel Scavenge收集器的老年代版本（并行收集器），使用多线程和Mark-Compact算法。

5.CMS

CMS（Current Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器，它是一种并发收集器，采用的是Mark-Sweep算法。

6.G1

G1收集器是当今收集器技术发展最前沿的成果，它是一款面向服务端应用的收集器，它能充分利用多CPU、多核环境。因此它是一款并行与并发收集器，并且它能建立可预测的停顿时间模型。

下面补充一下关于内存分配方面的东西：

<img src="http://images.cnitblog.com/i/288799/201406/181512325519249.jpg" alt="" />

对象的内存分配，往大方向上讲就是在堆上分配，对象主要分配在新生代的Eden Space和From Space，少数情况下会直接分配在老年代。如果新生代的Eden Space和From Space的空间不足，则会发起一次GC，如果进行了GC之后，Eden Space和From Space能够容纳该对象就放在Eden Space和From Space。在GC的过程中，会将Eden Space和From  Space中的存活对象移动到To Space，然后将Eden Space和From Space进行清理。如果在清理的过程中，To Space无法足够来存储某个对象，就会将该对象移动到老年代中。在进行了GC之后，使用的便是Eden space和To Space了，下次GC时会将存活对象复制到From Space，如此反复循环。当对象在Survivor区躲过一次GC的话，其对象年龄便会加1，默认情况下，如果对象年龄达到15岁，就会移动到老年代中。

一般来说，大对象会被直接分配到老年代，所谓的大对象是指需要大量连续存储空间的对象，最常见的一种大对象就是大数组，比如：

byte[] data = new byte[4*1024*1024]

这种一般会直接在老年代分配存储空间。

当然分配的规则并不是百分之百固定的，这要取决于当前使用的是哪种垃圾收集器组合和JVM的相关参数。

参考资料：

《深入理解Java虚拟机》]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>290</wp:post_id>
		<wp:post_date>2015-03-03 15:38:35</wp:post_date>
		<wp:post_date_gmt>2015-03-03 07:38:35</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>java%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e6%9c%ba%e5%88%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="gc"><![CDATA[GC]]></category>
		<category domain="category" nicename="java"><![CDATA[Java]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707521]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>忆游</title>
		<link>http://1.duoinfo.sinaapp.com/?p=300</link>
		<pubDate>Fri, 06 Mar 2015 08:20:29 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=300</guid>
		<description></description>
		<content:encoded><![CDATA[应用官方地址：<a title="http://duoinfo.sinaapp.com/travelinfo/index.html" href="http://duoinfo.sinaapp.com/travelinfo/index.html" target="_blank">http://duoinfo.sinaapp.com/travelinfo/index.html</a>

360市场：<a title="http://zhushou.360.cn/detail/index/soft_id/2716677?recrefer=SE_D_%E5%BF%86%E6%B8%B8" href="http://zhushou.360.cn/detail/index/soft_id/2716677?recrefer=SE_D_%E5%BF%86%E6%B8%B8" target="_blank">http://zhushou.360.cn/detail/index/soft_id/2716677?recrefer=SE_D_%E5%BF%86%E6%B8%B8</a>

木蚂蚁市场：<a title="http://www.mumayi.com/android-930228.html" href="http://www.mumayi.com/android-930228.html" target="_blank">http://www.mumayi.com/android-930228.html</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>300</wp:post_id>
		<wp:post_date>2015-03-06 16:20:29</wp:post_date>
		<wp:post_date_gmt>2015-03-06 08:20:29</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%bf%86%e6%b8%b8</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="%e5%bf%86%e6%b8%b8"><![CDATA[忆游]]></category>
		<category domain="category" nicename="%e5%bf%86%e6%b8%b8"><![CDATA[忆游]]></category>
		<category domain="category" nicename="%e9%a1%b9%e7%9b%ae"><![CDATA[项目]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707522]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>阿里内推面试总结</title>
		<link>http://1.duoinfo.sinaapp.com/?p=303</link>
		<pubDate>Sat, 07 Mar 2015 00:41:43 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=303</guid>
		<description></description>
		<content:encoded><![CDATA[第一轮是个比较年长的人，问了几个很简单的问题，都是项目上面的。

第二轮是两个年轻人问的，分别是java和Android。

每轮面试开始的时候都要求自我介绍一下。

java问的有：

面向对象；抽象类和普通类的区别；多态；重载和重写；多线程的实现方式；线程池；最后还问了5L的容器和3L的容器怎么称出4L的水；

Android问的有：

Fragment和Activity的生命周期，EventBus（常见的开源库必须了解一下啊）；组件间通信；开发工具；怎么管理引入的库；其他都是项目上的问题了。

&nbsp;

开发过程中遇到的问题，怎么解决的。

&nbsp;

准备的不是很好，问的很基础，没答好，惨痛的教训，下次一定要理一下基础。加油。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>303</wp:post_id>
		<wp:post_date>2015-03-07 08:41:43</wp:post_date>
		<wp:post_date_gmt>2015-03-07 00:41:43</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%98%bf%e9%87%8c%e5%86%85%e6%8e%a8%e9%9d%a2%e8%af%95%e6%80%bb%e7%bb%93</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e9%9d%a2%e8%af%95"><![CDATA[面试]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707523]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Creating a View Class</title>
		<link>http://1.duoinfo.sinaapp.com/?p=310</link>
		<pubDate>Wed, 11 Mar 2015 00:53:35 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=310</guid>
		<description></description>
		<content:encoded><![CDATA[<div>

A well-designed custom view is much like any other well-designed class. It encapsulates a specific set of functionality with an easy to use interface, it uses CPU and memory efficiently, and so forth. In addition to being a well-designed class, though, a custom view should:
<ul>
	<li>Conform to Android standards</li>
	<li>Provide custom styleable attributes that work with Android XML layouts</li>
	<li>Send accessibility events</li>
	<li>Be compatible with multiple Android platforms.</li>
</ul>
上面说了自定义View需要符合的四个条件。

The Android framework provides a set of base classes and XML tags to help you create a view that meets all of these requirements. This lesson discusses how to use the Android framework to create the core functionality of a view class.
<h2 id="subclassview"><a name="t0"></a>Subclass a View</h2>

<hr />

All of the view classes defined in the Android framework extend<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html" target="_blank">View</a></code>. Your custom view can also extend <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html" target="_blank">View</a></code> directly, or you can save time by extending one of the existing view subclasses, such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Button.html" target="_blank">Button</a></code>.

To allow the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/developing/tools/adt.html" target="_blank">Android Developer Tools </a>to interact with your view, at a minimum you must provide a constructor that takes a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html" target="_blank">Context</a></code> and an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html" target="_blank">AttributeSet</a></code> object as parameters. This constructor allows the layout editor to create and edit an instance of your view.

[java]class PieChart extends View {
    public PieChart(Context context, AttributeSet attrs) {
        super(context, attrs);
    }
}[/java]
<h2 id="customattr"><a name="t1"></a>Define Custom Attributes</h2>

<hr />

To add a built-in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html" target="_blank">View</a></code> to your user interface, you specify it in an XML element and control its appearance and behavior with element attributes. Well-written custom views can also be added and styled via XML. To enable this behavior in your custom view, you must:
<ul>
	<li>Define custom attributes for your view in a <code>&lt;declare-styleable&gt; </code>resource element</li>
	<li>Specify values for the attributes in your XML layout</li>
	<li>Retrieve attribute values at runtime</li>
	<li>Apply the retrieved attribute values to your view</li>
</ul>
This section discusses how to define custom attributes and specify their values. The next section deals with retrieving and applying the values at runtime.

To define custom attributes, add <code>&lt;declare-styleable&gt; </code>resources to your project. It's customary to put these resources into a <code>res/values/attrs.xml</code> file. Here's an example of an <code>attrs.xml</code> file:

[java]&lt;resources&gt;
   &lt;declare-styleable name=&quot;PieChart&quot;&gt;
       &lt;attr name=&quot;showText&quot; format=&quot;boolean&quot; /&gt;
       &lt;attr name=&quot;labelPosition&quot; format=&quot;enum&quot;&gt;
           &lt;enum name=&quot;left&quot; value=&quot;0&quot;/&gt;
           &lt;enum name=&quot;right&quot; value=&quot;1&quot;/&gt;
       &lt;/attr&gt;
   &lt;/declare-styleable&gt;
&lt;/resources&gt;[/java]

This code declares two custom attributes, <code>showText</code> and <code>labelPosition</code>, that belong to a styleable entity named<code>PieChart</code>. The name of the styleable entity is, by convention, the same name as the name of the class that defines the custom view. Although it's not strictly necessary to follow this convention, many popular code editors depend on this naming convention to provide statement completion.

Once you define the custom attributes, you can use them in layout XML files just like built-in attributes. The only difference is that your custom attributes belong to a different namespace. Instead of belonging to the<code>http://schemas.android.com/apk/res/android</code> namespace, they belong to<code>http://schemas.android.com/apk/res/[your package name]</code>. For example, here's how to use the attributes defined for <code>PieChart</code>:

&nbsp;

[java]&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
   xmlns:custom=&quot;http://schemas.android.com/apk/res/com.example.customviews&quot;&gt;
 &lt;com.example.customviews.charting.PieChart
     custom:showText=&quot;true&quot;
     custom:labelPosition=&quot;left&quot; /&gt;
&lt;/LinearLayout&gt;[/java]

In order to avoid having to repeat the long namespace URI, the sample uses an <code>xmlns</code> directive. This directive assigns the alias <code>custom</code> to the namespace <code>http://schemas.android.com/apk/res/com.example.customviews</code>. You can choose any alias you want for your namespace.

Notice the name of the XML tag that adds the custom view to the layout. It is the fully qualified name of the custom view class. If your view class is an inner class, you must further qualify it with the name of the view's outer class. further. For instance, the <code>PieChart</code> class has an inner class called <code>PieView</code>. To use the custom attributes from this class, you would use the tag <code>com.example.customviews.charting.PieChart$PieView</code>.
<h2 id="applyattr"><a name="t2"></a>Apply Custom Attributes</h2>

<hr />

When a view is created from an XML layout, all of the attributes in the XML tag are read from the resource bundle and passed into the view's constructor as an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html" target="_blank">AttributeSet</a></code>. Although it's possible to read values from the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html" target="_blank">AttributeSet</a></code> directly, doing so has some disadvantages:
<ul>
	<li>Resource references within attribute values are not resolved</li>
	<li>Styles are not applied</li>
</ul>
Instead, pass the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/util/AttributeSet.html" target="_blank">AttributeSet</a></code> to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/Resources.Theme.html#obtainStyledAttributes(android.util.AttributeSet, int[], int, int)" target="_blank">obtainStyledAttributes()</a></code>. This method passes back a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html" target="_blank">TypedArray</a></code> array of values that have already been dereferenced and styled.

The Android resource compiler does a lot of work for you to make calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/Resources.Theme.html#obtainStyledAttributes(android.util.AttributeSet, int[], int, int)" target="_blank">obtainStyledAttributes()</a></code> easier. For each <code>&lt;declare-styleable&gt;</code> resource in the res directory, the generated R.java defines both an array of attribute ids and a set of constants that define the index for each attribute in the array. You use the predefined constants to read the attributes from the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html" target="_blank">TypedArray</a></code>. Here's how the <code>PieChart</code> class reads its attributes:

[java]public PieChart(Context context, AttributeSet attrs) {
   super(context, attrs);
   TypedArray a = context.getTheme().obtainStyledAttributes(
        attrs,
        R.styleable.PieChart,
        0, 0);

   try {
       mShowText = a.getBoolean(R.styleable.PieChart_showText, false);
       mTextPos = a.getInteger(R.styleable.PieChart_labelPosition, 0);
   } finally {
       a.recycle();
   }
}[/java]

Note that <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/res/TypedArray.html" target="_blank">TypedArray</a></code> objects are a shared resource and must be recycled after use.
<h2 id="addprop"><a name="t3"></a>Add Properties and Events</h2>

<hr />

Attributes are a powerful way of controlling the behavior and appearance of views, but they can only be read when the view is initialized. To provide dynamic behavior, expose a property getter and setter pair for each custom attribute. The following snippet shows how <code>PieChart</code> exposes a property called <code>showText</code>:

[java]public boolean isShowText() {
   return mShowText;
}

public void setShowText(boolean showText) {
   mShowText = showText;
   invalidate();
   requestLayout();
}[/java]

Notice that <code>setShowText</code> calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#invalidate()" target="_blank">invalidate()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#requestLayout()" target="_blank">requestLayout()</a></code>. These calls are crucial to ensure that the view behaves reliably. You have to invalidate the view after any change to its properties that might change its appearance, so that the system knows that it needs to be redrawn. Likewise, you need to request a new layout if a property changes that might affect the size or shape of the view. Forgetting these method calls can cause hard-to-find bugs.

Custom views should also support event listeners to communicate important events. For instance, <code>PieChart</code>exposes a custom event called <code>OnCurrentItemChanged</code> to notify listeners that the user has rotated the pie chart to focus on a new pie slice.

It's easy to forget to expose properties and events, especially when you're the only user of the custom view. Taking some time to carefully define your view's interface reduces future maintenance costs. A good rule to follow is to always expose any property that affects the visible appearance or behavior of your custom view.
<h2 id="accessibility"><a name="t4"></a>Design For Accessibility</h2>

<hr />

Your custom view should support the widest range of users. This includes users with disabilities that prevent them from seeing or using a touchscreen. To support users with disabilities, you should:
<ul>
	<li>Label your input fields using the <code>android:contentDescription</code> attribute</li>
	<li>Send accessibility events by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/accessibility/AccessibilityEventSource.html#sendAccessibilityEvent(int)" target="_blank">sendAccessibilityEvent()</a></code> when appropriate.</li>
	<li>Support alternate controllers, such as D-pad and trackball</li>
</ul>
For more information on creating accessible views, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/accessibility/apps.html#custom-views" target="_blank">Making Applications Accessible</a> in the Android Developers Guide.

&nbsp;

总结一下：

第一步：在attrs.xml文件下面定义一些属性

第二步：定义一个类继承自View或者其他

</div>
<div>
<div>第三步：在这个类的构造器中得到TypedArray这样一个数组，通过这个数组，取出属性。</div>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>310</wp:post_id>
		<wp:post_date>2015-03-11 08:53:35</wp:post_date>
		<wp:post_date_gmt>2015-03-11 00:53:35</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>creating-a-view-class</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707524]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Custom Drawing</title>
		<link>http://1.duoinfo.sinaapp.com/?p=312</link>
		<pubDate>Wed, 11 Mar 2015 01:03:19 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=312</guid>
		<description></description>
		<content:encoded><![CDATA[<h2 id="overrideondraw">Override onDraw()</h2>

<hr />

The most important step in drawing a custom view is to override the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code> method. The parameter to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code> is a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code>object that the view can use to draw itself. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code> class defines methods for drawing text, lines, bitmaps, and many other graphics primitives. You can use these methods in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code> to create your custom user interface (UI).

Before you can call any drawing methods, though, it's necessary to create a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> object. The next section discusses <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> in more detail.
<h2 id="createobject">Create Drawing Objects</h2>

<hr />

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/package-summary.html" target="_blank">android.graphics</a></code> framework divides drawing into two areas:
<ul>
	<li>What to draw, handled by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code></li>
	<li>How to draw, handled by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code>.</li>
</ul>
For instance, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code> provides a method to draw a line, while <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> provides methods to define that line's color.<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code> has a method to draw a rectangle, while <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> defines whether to fill that rectangle with a color or leave it empty. Simply put, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html" target="_blank">Canvas</a></code> defines shapes that you can draw on the screen, while <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> defines the color, style, font, and so forth of each shape you draw.

So, before you draw anything, you need to create one or more <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html" target="_blank">Paint</a></code> objects. The <code>PieChart</code> example does this in a method called <code>init</code>, which is called from the constructor:

[java]private void init() {
   mTextPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
   mTextPaint.setColor(mTextColor);
   if (mTextHeight == 0) {
       mTextHeight = mTextPaint.getTextSize();
   } else {
       mTextPaint.setTextSize(mTextHeight);
   }

   mPiePaint = new Paint(Paint.ANTI_ALIAS_FLAG);
   mPiePaint.setStyle(Paint.Style.FILL);
   mPiePaint.setTextSize(mTextHeight);

   mShadowPaint = new Paint(0);
   mShadowPaint.setColor(0xff101010);
   mShadowPaint.setMaskFilter(new BlurMaskFilter(8, BlurMaskFilter.Blur.NORMAL));[/java]

Creating objects ahead of time is an important optimization. Views are redrawn very frequently, and many drawing objects require expensive initialization. Creating drawing objects within your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code> method significantly reduces performance and can make your UI appear sluggish.
<h2 id="layouteevent">Handle Layout Events</h2>

<hr />

In order to properly draw your custom view, you need to know what size it is. Complex custom views often need to perform multiple layout calculations depending on the size and shape of their area on screen. You should never make assumptions about the size of your view on the screen. Even if only one app uses your view, that app needs to handle different screen sizes, multiple screen densities, and various aspect ratios in both portrait and landscape mode.

Although <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html" target="_blank">View</a></code> has many methods for handling measurement, most of them do not need to be overridden. If your view doesn't need special control over its size, you only need to override one method: <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int)" target="_blank">onSizeChanged()</a></code>.

<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int)" target="_blank">onSizeChanged()</a></code> is called when your view is first assigned a size, and again if the size of your view changes for any reason. Calculate positions, dimensions, and any other values related to your view's size in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int)" target="_blank">onSizeChanged()</a></code>, instead of recalculating them every time you draw. In the <code>PieChart</code> example, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onSizeChanged(int, int, int, int)" target="_blank">onSizeChanged()</a></code> is where the<code>PieChart</code> view calculates the bounding rectangle of the pie chart and the relative position of the text label and other visual elements.

When your view is assigned a size, the layout manager assumes that the size includes all of the view's padding. You must handle the padding values when you calculate your view's size. Here's a snippet from<code>PieChart.onSizeChanged()</code> that shows how to do this:

[java]// Account for padding
       float xpad = (float)(getPaddingLeft() + getPaddingRight());
       float ypad = (float)(getPaddingTop() + getPaddingBottom());

       // Account for the label
       if (mShowText) xpad += mTextWidth;

       float ww = (float)w - xpad;
       float hh = (float)h - ypad;

       // Figure out how big we can make the pie.
       float diameter = Math.min(ww, hh);[/java]

If you need finer control over your view's layout parameters, implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int)" target="_blank">onMeasure()</a></code>. This method's parameters are <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html" target="_blank">View.MeasureSpec</a></code> values that tell you how big your view's parent wants your view to be, and whether that size is a hard maximum or just a suggestion. As an optimization, these values are stored as packed integers, and you use the static methods of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html" target="_blank">View.MeasureSpec</a></code> to unpack the information stored in each integer.

Here's an example implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int)" target="_blank">onMeasure()</a></code>. In this implementation, <code>PieChart</code> attempts to make its area big enough to make the pie as big as its label:

[java]@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
   // Try for a width based on our minimum
   int minw = getPaddingLeft() + getPaddingRight() + getSuggestedMinimumWidth();
   int w = resolveSizeAndState(minw, widthMeasureSpec, 1);

   // Whatever the width ends up being, ask for a height that would let the pie
   // get as big as it can
   int minh = MeasureSpec.getSize(w) - (int)mTextWidth + getPaddingBottom() + getPaddingTop();
   int h = resolveSizeAndState(MeasureSpec.getSize(w) - (int)mTextWidth, heightMeasureSpec, 0);

   setMeasuredDimension(w, h);
}[/java]

There are three important things to note in this code:
<ul>
	<li>The calculations take into account the view's padding. As mentioned earlier, this is the view's responsibility.</li>
	<li>The helper method <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#resolveSizeAndState(int, int, int)" target="_blank">resolveSizeAndState()</a></code> is used to create the final width and height values. This helper returns an appropriate <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.MeasureSpec.html" target="_blank">View.MeasureSpec</a></code> value by comparing the view's desired size to the spec passed into<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int)" target="_blank">onMeasure()</a></code>.</li>
	<li><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onMeasure(int, int)" target="_blank">onMeasure()</a></code> has no return value. Instead, the method communicates its results by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#setMeasuredDimension(int, int)" target="_blank">setMeasuredDimension()</a></code>. Calling this method is mandatory. If you omit this call, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html" target="_blank">View</a></code> class throws a runtime exception.</li>
</ul>
<h2 id="draw">Draw!</h2>

<hr />

Once you have your object creation and measuring code defined, you can implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code>. Every view implements <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)" target="_blank">onDraw()</a></code> differently, but there are some common operations that most views share:
<ul>
	<li>Draw text using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawText(char[], int, int, float, float, android.graphics.Paint)" target="_blank">drawText()</a></code>. Specify the typeface by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setTypeface(android.graphics.Typeface)" target="_blank">setTypeface()</a></code>, and the text color by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setColor(int)" target="_blank">setColor()</a></code>.</li>
	<li>Draw primitive shapes using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawRect(android.graphics.Rect, android.graphics.Paint)" target="_blank">drawRect()</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawOval(android.graphics.RectF, android.graphics.Paint)" target="_blank">drawOval()</a></code>, and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawArc(android.graphics.RectF, float, float, boolean, android.graphics.Paint)" target="_blank">drawArc()</a></code>. Change whether the shapes are filled, outlined, or both by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setStyle(android.graphics.Paint.Style)" target="_blank">setStyle()</a></code>.</li>
	<li>Draw more complex shapes using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Path.html" target="_blank">Path</a></code> class. Define a shape by adding lines and curves to a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Path.html" target="_blank">Path</a></code> object, then draw the shape using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawPath(android.graphics.Path, android.graphics.Paint)" target="_blank">drawPath()</a></code>. Just as with primitive shapes, paths can be outlined, filled, or both, depending on the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setStyle(android.graphics.Paint.Style)" target="_blank">setStyle()</a></code>.</li>
	<li>Define gradient fills by creating <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/LinearGradient.html" target="_blank">LinearGradient</a></code> objects. Call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Paint.html#setShader(android.graphics.Shader)" target="_blank">setShader()</a></code> to use your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/LinearGradient.html" target="_blank">LinearGradient</a></code> on filled shapes.</li>
	<li>Draw bitmaps using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Canvas.html#drawBitmap(android.graphics.Bitmap, android.graphics.Matrix, android.graphics.Paint)" target="_blank">drawBitmap()</a></code>.</li>
</ul>
For example, here's the code that draws <code>PieChart</code>. It uses a mix of text, lines, and shapes.

[java]protected void onDraw(Canvas canvas) {
   super.onDraw(canvas);

   // Draw the shadow
   canvas.drawOval(
           mShadowBounds,
           mShadowPaint
   );

   // Draw the label text
   canvas.drawText(mData.get(mCurrentItem).mLabel, mTextX, mTextY, mTextPaint);

   // Draw the pie slices
   for (int i = 0; i &lt; mData.size(); ++i) {
       Item it = mData.get(i);
       mPiePaint.setShader(it.mShader);
       canvas.drawArc(mBounds,
               360 - it.mEndAngle,
               it.mEndAngle - it.mStartAngle,
               true, mPiePaint);
   }

   // Draw the pointer
   canvas.drawLine(mTextX, mPointerY, mPointerX, mPointerY, mTextPaint);
   canvas.drawCircle(mPointerX, mPointerY, mPointerSize, mTextPaint);
}[/java]
总结一下：
第一：在构造器中完成init操作，初始化画笔等等操作；
第二：onSizeChanged()方法和onMeasure方法
第三：onDraw()方法，处理</pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>312</wp:post_id>
		<wp:post_date>2015-03-11 09:03:19</wp:post_date>
		<wp:post_date_gmt>2015-03-11 01:03:19</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>custom-drawing</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707525]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Making the View Interactive</title>
		<link>http://1.duoinfo.sinaapp.com/?p=316</link>
		<pubDate>Wed, 11 Mar 2015 01:13:27 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=316</guid>
		<description></description>
		<content:encoded><![CDATA[Drawing a UI is only one part of creating a custom view. You also need to make your view respond to user input in a way that closely resembles the real-world action you're mimicking. Objects should always act in the same way that real objects do. For example, images should not immediately pop out of existence and reappear somewhere else, because objects in the real world don't do that. Instead, images should move from one place to another.

Users also sense subtle behavior or feel in an interface, and react best to subtleties that mimic the real world. For example, when users fling a UI object, they should sense friction at the beginning that delays the motion, and then at the end sense momentum that carries the motion beyond the fling.

This lesson demonstrates how to use features of the Android framework to add these real-world behaviors to your custom view.

前面两篇写了绘制的过程，下面是处理与用户交互。
<h2 id="inputgesture">Handle Input Gestures</h2>

<hr />

Like many other UI frameworks, Android supports an input event model. User actions are turned into events that trigger callbacks, and you can override the callbacks to customize how your application responds to the user. The most common input event in the Android system is <em>touch</em>, which triggers<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onTouchEvent(android.view.MotionEvent)">onTouchEvent(android.view.MotionEvent)</a></code>. Override this method to handle the event:

[java]@Override
   public boolean onTouchEvent(MotionEvent event) {
    return super.onTouchEvent(event);
   }[/java]

Touch events by themselves are not particularly useful. Modern touch UIs define interactions in terms of gestures such as tapping, pulling, pushing, flinging, and zooming. To convert raw touch events into gestures, Android provides <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code>.

Construct a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code> by passing in an instance of a class that implements<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html">GestureDetector.OnGestureListener</a></code>. If you only want to process a few gestures, you can extend<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html">GestureDetector.SimpleOnGestureListener</a></code> instead of implementing the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html">GestureDetector.OnGestureListener</a></code>interface. For instance, this code creates a class that extends <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html">GestureDetector.SimpleOnGestureListener</a></code> and overrides <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html#onDown(android.view.MotionEvent)">onDown(MotionEvent)</a></code>.

[java]class mListener extends GestureDetector.SimpleOnGestureListener {
   @Override
   public boolean onDown(MotionEvent e) {
       return true;
   }
}
mDetector = new GestureDetector(PieChart.this.getContext(), new mListener());[/java]

Whether or not you use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html">GestureDetector.SimpleOnGestureListener</a></code>, you must always implement an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent)">onDown()</a></code>method that returns <code>true</code>. This step is necessary because all gestures begin with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent)">onDown()</a></code> message. If you return <code>false</code> from <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent)">onDown()</a></code>, as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.SimpleOnGestureListener.html">GestureDetector.SimpleOnGestureListener</a></code> does, the system assumes that you want to ignore the rest of the gesture, and the other methods of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html">GestureDetector.OnGestureListener</a></code> never get called. The only time you should return <code>false</code> from <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html#onDown(android.view.MotionEvent)">onDown()</a></code> is if you truly want to ignore an entire gesture. Once you've implemented <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.OnGestureListener.html">GestureDetector.OnGestureListener</a></code> and created an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code>, you can use your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code> to interpret the touch events you receive in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html#onTouchEvent(android.view.MotionEvent)">onTouchEvent()</a></code>.

[java]@Override
public boolean onTouchEvent(MotionEvent event) {
   boolean result = mDetector.onTouchEvent(event);
   if (!result) {
       if (event.getAction() == MotionEvent.ACTION_UP) {
           stopScrolling();
           result = true;
       }
   }
   return result;
}[/java]

When you pass <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html#onTouchEvent(android.view.MotionEvent)">onTouchEvent()</a></code> a touch event that it doesn't recognize as part of a gesture, it returns <code>false</code>. You can then run your own custom gesture-detection code.
<h2 id="motion">Create Physically Plausible Motion</h2>

<hr />

Gestures are a powerful way to control touchscreen devices, but they can be counterintuitive and difficult to remember unless they produce physically plausible results. A good example of this is the <em>fling</em> gesture, where the user quickly moves a finger across the screen and then lifts it. This gesture makes sense if the UI responds by moving quickly in the direction of the fling, then slowing down, as if the user had pushed on a flywheel and set it spinning.

However, simulating the feel of a flywheel isn't trivial. A lot of physics and math are required to get a flywheel model working correctly. Fortunately, Android provides helper classes to simulate this and other behaviors. The<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html">Scroller</a></code> class is the basis for handling flywheel-style <em>fling</em> gestures.

To start a fling, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int)">fling()</a></code> with the starting velocity and the minimum and maximum x and y values of the fling. For the velocity value, you can use the value computed for you by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code>.

[java]@Override
public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {
   mScroller.fling(currentX, currentY, velocityX / SCALE, velocityY / SCALE, minX, minY, maxX, maxY);
   postInvalidate();
}[/java]

<strong>Note:</strong> Although the velocity calculated by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/GestureDetector.html">GestureDetector</a></code> is physically accurate, many developers feel that using this value makes the fling animation too fast. It's common to divide the x and y velocity by a factor of 4 to 8.

The call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int)">fling()</a></code> sets up the physics model for the fling gesture. Afterwards, you need to update the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html">Scroller</a></code>by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#computeScrollOffset()">Scroller.computeScrollOffset()</a></code> at regular intervals. <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#computeScrollOffset()">computeScrollOffset()</a></code> updates the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html">Scroller</a></code>object's internal state by reading the current time and using the physics model to calculate the x and y position at that time. Call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#getCurrX()">getCurrX()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#getCurrY()">getCurrY()</a></code> to retrieve these values.

Most views pass the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html">Scroller</a></code> object's x and y position directly to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#scrollTo(int, int)">scrollTo()</a></code>. The PieChart example is a little different: it uses the current scroll y position to set the rotational angle of the chart.

[java]if (!mScroller.isFinished()) {
    mScroller.computeScrollOffset();
    setPieRotation(mScroller.getCurrY());
}[/java]

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html">Scroller</a></code> class computes scroll positions for you, but it does not automatically apply those positions to your view. It's your responsibility to make sure you get and apply new coordinates often enough to make the scrolling animation look smooth. There are two ways to do this:
<ul>
	<li>Call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#postInvalidate()">postInvalidate()</a></code> after calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Scroller.html#fling(int, int, int, int, int, int, int, int)">fling()</a></code>, in order to force a redraw. This technique requires that you compute scroll offsets in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)">onDraw()</a></code> and call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#postInvalidate()">postInvalidate()</a></code> every time the scroll offset changes.</li>
	<li>Set up a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html">ValueAnimator</a></code> to animate for the duration of the fling, and add a listener to process animation updates by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html#addUpdateListener(android.animation.ValueAnimator.AnimatorUpdateListener)">addUpdateListener()</a></code>.</li>
</ul>
The PieChart example uses the second approach. This technique is slightly more complex to set up, but it works more closely with the animation system and doesn't require potentially unnecessary view invalidation. The drawback is that <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html">ValueAnimator</a></code> is not available prior to API level 11, so this technique cannot be used on devices running Android versions lower than 3.0.

<strong>Note:</strong> <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html">ValueAnimator</a></code> isn't available prior to API level 11, but you can still use it in applications that target lower API levels. You just need to make sure to check the current API level at runtime, and omit the calls to the view animation system if the current level is less than 11.

[java]mScroller = new Scroller(getContext(), null, true);
       mScrollAnimator = ValueAnimator.ofFloat(0,1);
       mScrollAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
           @Override
           public void onAnimationUpdate(ValueAnimator valueAnimator) {
               if (!mScroller.isFinished()) {
                   mScroller.computeScrollOffset();
                   setPieRotation(mScroller.getCurrY());
               } else {
                   mScrollAnimator.cancel();
                   onScrollFinished();
               }
           }
       });[/java]
<h2 id="makesmooth">Make Your Transitions Smooth</h2>

<hr />

Users expect a modern UI to transition smoothly between states. UI elements fade in and out instead of appearing and disappearing. Motions begin and end smoothly instead of starting and stopping abruptly. The Android <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/graphics/prop-animation.html">property animation framework</a>, introduced in Android 3.0, makes smooth transitions easy.

To use the animation system, whenever a property changes that will affect your view's appearance, do not change the property directly. Instead, use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html">ValueAnimator</a></code> to make the change. In the following example, modifying the currently selected pie slice in PieChart causes the entire chart to rotate so that the selection pointer is centered in the selected slice. <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/animation/ValueAnimator.html">ValueAnimator</a></code> changes the rotation over a period of several hundred milliseconds, rather than immediately setting the new rotation value.

[java]mAutoCenterAnimator = ObjectAnimator.ofInt(PieChart.this, &quot;PieRotation&quot;, 0);
mAutoCenterAnimator.setIntValues(targetAngle);
mAutoCenterAnimator.setDuration(AUTOCENTER_ANIM_DURATION);
mAutoCenterAnimator.start();[/java]

If the value you want to change is one of the base <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code> properties, doing the animation is even easier, because Views have a built-in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewPropertyAnimator.html">ViewPropertyAnimator</a></code> that is optimized for simultaneous animation of multiple properties. For example:

[java]animate().rotation(targetAngle).setDuration(ANIM_DURATION).start();[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>316</wp:post_id>
		<wp:post_date>2015-03-11 09:13:27</wp:post_date>
		<wp:post_date_gmt>2015-03-11 01:13:27</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>making-the-view-interactive</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707526]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Optimizing the View</title>
		<link>http://1.duoinfo.sinaapp.com/?p=320</link>
		<pubDate>Wed, 11 Mar 2015 01:27:43 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=320</guid>
		<description></description>
		<content:encoded><![CDATA[Now that you have a well-designed view that responds to gestures and transitions between states, you need to ensure that the view runs fast. To avoid a UI that feels sluggish or stutters during playback, you must ensure that your animations consistently run at 60 frames per second.

To speed up your view, eliminate unnecessary code from routines that are called frequently. Start by working on <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)">onDraw()</a></code>, which will give you the biggest payback. In particular you should eliminate allocations in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)">onDraw()</a></code>, because allocations may lead to a garbage collection that would cause a stutter. Allocate objects during initialization, or between animations. Never make an allocation while an animation is running.

In addition to making <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)">onDraw()</a></code> leaner, you should also make sure it's called as infrequently as possible. Most calls to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#onDraw(android.graphics.Canvas)">onDraw()</a></code>are the result of a call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#invalidate()">invalidate()</a></code>, so eliminate unnecessary calls to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#invalidate()">invalidate()</a></code>. When possible, call the four-parameter variant of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#invalidate()">invalidate()</a></code> rather than the version that takes no parameters. The no-parameter variant invalidates the entire view, while the four-parameter variant invalidates only a specified portion of the view. This approach allows draw calls to be more efficient and can eliminate unnecessary invalidation of views that fall outside the invalid rectangle.

上面的总结：尽量让onDraw()方法精简一点，大多数情况下onDraw方法的调用使用invalidate方法的调用，要尽量使用invalidate的四个参数的方法而不是没有参数的invalidate的方法。

Another very expensive operation is traversing layouts. Any time a view calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#requestLayout()">requestLayout()</a></code>, the Android UI system needs to traverse the entire view hierarchy to find out how big each view needs to be. If it finds conflicting measurements, it may need to traverse the hierarchy multiple times. UI designers sometimes create deep hierarchies of nested <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewGroup.html">ViewGroup</a></code> objects in order to get the UI to behave properly. These deep view hierarchies cause performance problems. Make your view hierarchies as shallow as possible.

总结：requestLayout方法会遍历UI，然后xml文件的不能嵌套太深。

If you have a complex UI, you should consider writing a custom <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewGroup.html">ViewGroup</a></code> to perform its layout. Unlike the built-in views, your custom view can make application-specific assumptions about the size and shape of its children, and thus avoid traversing its children to calculate measurements. The PieChart example shows how to extend<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ViewGroup.html">ViewGroup</a></code> as part of a custom view. PieChart has child views, but it never measures them. Instead, it sets their sizes directly according to its own custom layout algorithm.

总结：

内置的view不同，自定义的view可以使得程序仅仅测量这一部分，这避免了遍历整个view的层级结构来计算大小。
<h2 id="accelerate">Use Hardware Acceleration</h2>

<hr />

As of Android 3.0, the Android 2D graphics system can be accelerated by the GPU (Graphics Processing Unit) hardware found in most newer Android devices. GPU hardware acceleration can result in a tremendous performance increase for many applications, but it isn't the right choice for every application. The Android framework gives you the ability to finely control which parts of your application are or are not hardware accelerated.

See <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/graphics/hardware-accel.html">Hardware Acceleration</a> in the Android Developers Guide for directions on how to enable acceleration at the application, activity, or window level. Notice that in addition to the directions in the developer guide, you must also set your application's target API to 11 or higher by specifying <code>&lt;uses-sdk android:targetSdkVersion="11"/&gt;</code> in your <code>AndroidManifest.xml</code> file.

Once you've enabled hardware acceleration, you may or may not see a performance increase. Mobile GPUs are very good at certain tasks, such as scaling, rotating, and translating bitmapped images. They are not particularly good at other tasks, such as drawing lines or curves. To get the most out of GPU acceleration, you should maximize the number of operations that the GPU is good at, and minimize the number of operations that the GPU isn't good at.

In the PieChart example, for instance, drawing the pie is relatively expensive. Redrawing the pie each time it's rotated causes the UI to feel sluggish. The solution is to place the pie chart into a child <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code> and set that <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code>'s<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#setLayerType(int, android.graphics.Paint)">layer type</a> to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#LAYER_TYPE_HARDWARE">LAYER_TYPE_HARDWARE</a></code>, so that the GPU can cache it as a static image. The sample defines the child view as an inner class of <code>PieChart</code>, which minimizes the amount of code changes that are needed to implement this solution.

[java]private class PieView extends View {

public PieView(Context context) {
super(context);
if (!isInEditMode()) {
setLayerType(View.LAYER_TYPE_HARDWARE, null);
}
}

@Override
protected void onDraw(Canvas canvas) {
super.onDraw(canvas);

for (Item it : mData) {
mPiePaint.setShader(it.mShader);
canvas.drawArc(mBounds,
360 - it.mEndAngle,
it.mEndAngle - it.mStartAngle,
true, mPiePaint);
}
}

@Override
protected void onSizeChanged(int w, int h, int oldw, int oldh) {
mBounds = new RectF(0, 0, w, h);
}

RectF mBounds;
}[/java]

After this code change, <code>PieChart.PieView.onDraw()</code> is called only when the view is first shown. During the rest of the application's lifetime, the pie chart is cached as an image, and redrawn at different rotation angles by the GPU. GPU hardware is particularly good at this sort of thing, and the performance difference is immediately noticeable.

There is a tradeoff, though. Caching images as hardware layers consumes video memory, which is a limited resource. For this reason, the final version of <code>PieChart.PieView</code> only sets its layer type to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#LAYER_TYPE_HARDWARE">LAYER_TYPE_HARDWARE</a></code>while the user is actively scrolling. At all other times, it sets its layer type to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#LAYER_TYPE_NONE">LAYER_TYPE_NONE</a></code>, which allows the GPU to stop caching the image.

Finally, don't forget to profile your code. Techniques that improve performance on one view might negatively affect performance on another.

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>320</wp:post_id>
		<wp:post_date>2015-03-11 09:27:43</wp:post_date>
		<wp:post_date_gmt>2015-03-11 01:27:43</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>optimizing-the-view</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707527]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android面试</title>
		<link>http://1.duoinfo.sinaapp.com/?p=322</link>
		<pubDate>Wed, 11 Mar 2015 01:36:14 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=322</guid>
		<description></description>
		<content:encoded><![CDATA[<div id="article_content">

1.listView的优化方式
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">重用convertView</td>
</tr>
<tr>
<td valign="top">viewHolder</td>
</tr>
<tr>
<td valign="top">static class viewHolder</td>
</tr>
<tr>
<td valign="top">在列表里面有图片的情况下,监听滑动不加载图片</td>
</tr>
<tr>
<td valign="top">多个不同布局，可以创建不同的viewHolder和convertView进行重用</td>
</tr>
</tbody>
</table>
2.listView展示数据几种形式
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">从sqlite拉取数据源显示</td>
</tr>
<tr>
<td valign="top">从xml使用pull解析拉取数据源显示</td>
</tr>
<tr>
<td valign="top">从网络上拉取数据源显示</td>
</tr>
<tr>
<td valign="top"></td>
</tr>
</tbody>
</table>
3.ipc
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">进程间通信主要包括管道, 系统IPC(Inter-Process Communication，进程间通信)(包括消息队列,信号,共享存储), 套接字(SOCKET).
目的:
l 数据传输：一个进程需要将它的数据发送给另一个进程，发送的数据量在一个字节到几兆字节之间。
l 共享数据：多个进程想要操作共享数据，一个进程对共享数据的修改，别的进程应该立刻看到。
l 通知事件：一个进程需要向另一个或一组进程发送消息，通知它（它们）发生了某种事件（如进程终止时要通知父进程）。
l 资源共享：多个进程之间共享同样的资源。为了作到这一点，需要内核提供锁和同步机制。
l 进程控制：有些进程希望完全控制另一个进程的执行（如Debug进程），此时控制进程希望能够拦截另一个进程的所有陷入和异常，并能够及时知道它的状态改变。
进程通过与内核及其它进程之间的互相通信来协调它们的行为。Linux支持多种进程间通信（IPC）机制，信号和管道是其中的两种。除此之外，Linux还支持System V 的IPC机制（用首次出现的Unix版本命名）。</td>
</tr>
</tbody>
</table>
4.Parcel的机制
<table width="731" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android中的Parcel机制
实现了Bundle传递对象
使用Bundle传递对象，首先要将其序列化，但是，在Android中要使用这种传递对象的方式需要用到Android Parcel机制，即，Android实现的轻量级的高效的对象序列化和反序列化机制。JAVA中的Serialize机制，译成串行化、序列化……，其作用是能将数据对象存入字节流当中，在需要时重新生成对象。主要应用是利用外部存储设备保存对象状态，以及通过网络传输对象等。Android中的新的序列化机制
在Android系统中，定位为针对内存受限的设备，因此对性能要求更高，另外系统中采用了新的IPC（进程间通信）机制，必然要求使用性能更出色的对象传输方式。在这样的环境下，
Parcel被设计出来，其定位就是轻量级的高效的对象序列化和反序列化机制。
Android中序列化有以下几个特征：
1. 整个读写全是在内存中进行，所以效率比JAVA序列化中使用外部存储器会高很多；
2. 读写时是4字节对齐的
3. 如果预分配的空间不够时，会一次多分配50%；
4. 对于普通数据，使用的是mData内存地址，对于IBinder类型的数据以及FileDescriptor使用的是mObjects内存地址。后者是通过flatten_binder()和unflatten_binder()实现的，目的是反序列化时读出的对象就是原对象而不用重新new一个新对象。

代码：
activity代码：
Intent mIntent =<strong>new</strong>Intent(<strong>this</strong>,ParcelableDemo.class);
Bundle mBundle =<strong>new</strong>Bundle();
mBundle.putParcelable(PAR_KEY, mPolice);
mIntent.putExtras(mBundle);

实体类：
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="baseline">public class Police implements Parcelable {private String name;
private int workTime;public String getName() {
<strong>return</strong>name;
}

public void setName(String name) {
<strong>this</strong>.name = name;
}

public int getWorkTime() {
<strong>return</strong>workTime;
}

public void setWorkTime(int workTime) {
<strong>this</strong>.workTime = workTime;
}

public static final Parcelable.Creator&lt;Police&gt; CREATOR =<strong>new</strong>Creator&lt;Police&gt;() {

@Override
public Police createFromParcel(Parcel source) {
Police police =<strong>new</strong>Police();
<span style="text-decoration: underline;">police.name</span> = source.readString();
police.workTime = source.readInt();
<strong>return</strong>police;
}

@Override
public Police[] newArray(int size) {
<strong>return</strong><strong>new</strong>Police[size];
}
};

@Override
public int describeContents() {
<strong>return</strong>0;
}

@Override
public void writeToParcel(Parcel parcel, int flags) {
parcel.writeString(name);
parcel.writeInt(workTime);
}
}</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
5.JNI调用
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">(1) Eclipse中新建android工程
工程名 JNItest
Package名com.ura.test
Activity名 JNItest
应用程序名 JNItest
(2) 编辑main.xml
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
android:orientation="vertical"
android:layout_width="fill_parent"
android:layout_height="fill_parent"
&gt;
&lt;TextView
android:id="@+id/JNITest"
android:layout_width="fill_parent"
android:layout_height="wrap_content"
android:text="@string/JNITest"
/&gt;
&lt;/LinearLayout&gt;
(3)编辑java文件
package com.ura.test;import android.app.Activity;
import android.os.Bundle;
import android.widget.TextView;
public class JNITest extends Activity {
/** Called when the activity is first created. */
static {
System.loadLibrary("JNITest");
}
public native String GetTest();
@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.main);
String str =GetTest();
TextView JNITest = (TextView)findViewById(R.id.JNITest);
JNITest.setText(str);
}
}
(4)生成head文件
编译上面工程声称class文件，然后用javah工具生成c/c++ 头文件
javah -classpath bin -d jni com.ura.test.JNItest
生成的头文件如下
/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class com_ura_test_JNITest */#ifndef _Included_com_ura_test_JNITest
#define _Included_com_ura_test_JNITest
#ifdef __cplusplus
extern "C" {
#endif
/*
* Class:     com_ura_test_JNITest
* Method:    GetTest
* Signature: ()Ljava/lang/String;
*/
JNIEXPORT jstring JNICALL Java_com_ura_test_JNITest_GetTest
(JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
(5)编写c/c++文件如下
include "com_ura_test_JNITest.h"

#define LOG_TAG "JNITest"
#undef LOG
#include &lt;utils/Log.h&gt;

JNIEXPORT jstring JNICALL Java_com_ura_test_JNITest_GetTest
(JNIEnv * env, jobject obj)
{
return (*env)-&gt;NewStringUTF(env, (char *)"JNITest Native String");
LOGD("Hello LIB!\n");

}
(6)编写android.mk文件
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)
LOCAL_SRC_FILES:= \
com_ura_test_JNITest.c
LOCAL_C_INCLUDES := \
$(JNI_H_INCLUDE)
LOCAL_SHARED_LIBRARIES := libutils
LOCAL_PRELINK_MODULE := false
LOCAL_MODULE := libJNITest
include $(BUILD_SHARED_LIBRARY)
(7)编译生成动态库
新建文件夹
~/mydroid/external/libJNITest
把上面编写好的头文件，c/c++源文件，make文件拷贝进上面目录中
* 需要注意的是把PRELINK_MOUDULE设置成false
否则需要重新做成img文件再烧入。
在 ubuntu中执行
cd
cd mydroid/build/
<span style="text-decoration: underline;">envsetup.sh</span>
cd ~/mydroid
cd external/libJNITest/
mm
编译成功的后会在下面目录中生成libJNITest.so文件
~mydroid/out/target/product/generic/system/lib/
(8)在模拟器中执行程序
首先要把动态库拷进/system/lib中。
启动模拟器
adb shell
adb remount
adb push <span style="text-decoration: underline;">libJNITest.so</span> /system/lib
确认拷贝成功
cd /system/lib
ls
然后不要关闭模拟器（关掉再开动态库就没了，因为模拟器rom是只读）
执行java程序JNITest
会看到屏幕上打印出
JNITest Native String</td>
</tr>
</tbody>
</table>
6.细谈四大组件

activity

1.什么是activity？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">四大组件之一,一般的,一个用户交互界面对应一个activity
setContentView() ,// 要显示的布局
button.setOnclickLinstener{
}
, activity 是Context的子类,同时实现了window.callback和keyevent.callback, 可以处理与窗体用户交互的事件.里面不能进行耗时操作我开发常用的的有ListActivity  , PreferenceActivity ,TabAcitivty等…

如果界面有共同的特点或者功能的时候,还会自己定义一个BaseActivity.</td>
</tr>
</tbody>
</table>
2.activity生命周期？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"><strong>Activity生命周期</strong>
1 完整生命周期
onCreate()
--&gt; onStart()
--&gt; onResume()
可以在手机上看见activity
---&gt; onPause()
--&gt; onStop()
看不见了
---&gt; onDestory()
销毁了2 前台生命周期
onstart()  ---&gt; onStop()之间进行切换
onCreate() --&gt; onStart() --&gt; onResume()
现在有一个activity完全覆盖
onPause()  ----&gt; onStop()
如果上面的activity关闭
onRestart() ---&gt; onStart() --&gt; onResume()3 可视生命周期
onResume()  ---&gt; onPause()之间进行切换
onCreate() --&gt; onStart() --&gt; onResume()
现在有一个activity没有完全覆盖
onPause()
如果上面的activity关闭
onResume()</td>
</tr>
</tbody>
</table>
3.横竖屏切换时候activity的生命周期？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"> 这个生命周期跟清单文件里的配置有关系
1、不设置Activity的android:configChanges时，切屏会重新调用各个生命周期
默认首先销毁当前activity,然后重新加载2、设置Activity的android:configChanges="orientation|keyboardHidden"时，切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法游戏开发中, 屏幕的朝向都是写死的.</td>
</tr>
</tbody>
</table>
4.如何将一个activity设置成窗口的样式？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"> 可以自定义一个activity的样式,详细见手机卫士的程序详细信息
android:theme="@style/FloatActivity"
E:\day9\mobilesafe\res\values\style</td>
</tr>
</tbody>
</table>
5.activity启动模式？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="middle"><strong>Activity启动模式任务堆栈</strong>
Activity中的任务是与用户交互的一组Activity的集合，Activity会被按打开顺序安排在一个堆栈里。
任务栈：并不是Activity是Activity的引用（内存地址）
<strong>standard 标准模式</strong>
每次激活Activity时都会创建Activity，并放入任务栈中
默认模式
<strong>singleTop 独享堆栈顶端</strong>
如果在任务的栈顶正好存在该Activity的实例，就重用该实例，否者就会创建新的实例并放入栈顶(即使栈中已经存在该Activity实例，只要不在栈顶，都会创建实例)
浏览器的书签
<strong>singleTask 独享任务堆栈</strong>
如果在栈中已经有该Activity的实例，就重用该实例(会调用实例的onNewIntent())。重用时，会让该实例回到栈顶，因此在它上面的实例将会被移除栈。如果栈中不存在该实例，将会创建新的实例放入栈中
浏览器的主页
<strong>singleInstance单例</strong>
在一个新栈中创建该Activity实例，并让多个应用共享该栈中的该Activity实例。一旦该模式的Activity的实例存在于某个栈中，任何应用再激活该Activity时都会重用该栈中的实例，其效果相当于多个应用程序共享一个应用，不管谁激活该Activity都会进入同一个应用中
通话界面
Singletop：如果重复使用上一次的Activity，就重用。
singleTask：如果使用已经实例化Activity，就重用，并且删除重用Activity前面的Activity，重用的Activity置顶任务栈。
singleInstance：在一个新栈中创建该Activity实例，并让多个应用共享该栈中的该Activity实例。（调用Activity和重用Activity不在一个栈中）
singleTop 、singleTask 、singleInstance 优化性能、重用Activity。</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
6.后台activity被系统回收了怎么办？如果后台activity由于某种原因被系统回收了，如何保存之前状态？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">除了在栈顶的activity,其他的activity都有可能在内存不足的时候被系统回收,一个activity越处于栈底,被回收的可能性越大.
<strong>protected void</strong> onSaveInstanceState(Bundle outState) {
<strong>super</strong>.onSaveInstanceState(outState);
outState.putLong("id", 1234567890);
}
<strong>public void</strong> onCreate(Bundle savedInstanceState) {
//判断savedInstanceState是不是空.
//如果不为空就取出来
<strong>super</strong>.onCreate(savedInstanceState);
}</td>
</tr>
</tbody>
</table>
7.如何退出activity,如何安全退出已调用多个activity的application？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">退出activity 直接调用 finish () 方法 . //用户点击back键 就是退出一个activity
退出activity 会执行 onDestroy()方法 .
1、抛异常强制退出：
该方法通过抛异常，使程序Force Close。
验证可以，但是，需要解决的问题是，如何使程序结束掉，而不弹出Force Close的窗口。//安全结束进程        android.os.Process.killProcess(android.os.Process.myPid());
2、记录打开的Activity：
每打开一个Activity，就记录下来。在需要退出时，关闭每一个Activity即可。List&lt;Activity&gt; lists ; 在application 全集的环境里面
lists = new ArrayList&lt;Activity&gt;();

lists.add(activity);

for(Activity activity: lists)
{
activity.finish();
}

3、发送特定广播：
在需要结束应用时，发送一个特定的广播，每个Activity收到广播后，关闭即可。
//给某个activity 注册接受接受广播的意图
registerReceiver(receiver, filter)

//如果过接受到的是 关闭activity的广播  就调用finish()方法 把当前的activity finish()掉

4、递归退出
在打开新的Activity时使用startActivityForResult，然后自己加标志，在onActivityResult中处理，递归关闭。

上面是网上的一些做法.

其实 可以通过 intent的flag 来实现.. intent.setFlag(FLAG_ACTIVITY_CLEAR_TOP)激活一个新的activity,然后在新的activity的oncreate方法里面 finish掉.</td>
</tr>
</tbody>
</table>
8.两activity之间怎么传递数据？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">基本数据类型可以通过.  Intent 传递数据
在A activity中
Intent intent = new Intent();
intent.putExtra(name, value)
Bundle bundle = <strong>new</strong> Bundle();
bundle.putBoolean(<span style="text-decoration: underline;">key</span>,<span style="text-decoration: underline;">value</span>);
intent.putExtras(bundle);
extras.putDouble(<span style="text-decoration: underline;">key</span>, <span style="text-decoration: underline;">value)</span>
// 通过intent putExtra 方法 基本数据类型 都传递Intent i = getIntent();
i.getExtras();intent.getStringExtra("key","value");
intent.getBooleanExtra("key","value")
Bundle bundle = new  Bundle();
bumdle.putShort(key, value);
intent.putExtras(bumdle);
intent.putExtras(bundle<span style="text-decoration: underline;">)</span>
--------------
Application 全局里面存放 对象 ,自己去实现自己的application的这个类,
基础系统的application , 每个activity都可以取到
-----------------

让对象实现 implements  Serializable 接口把对象存放到文件上.
让类实现Serializable 接口,然后可以通过ObjectOutputStream              //对象输出流
File file = new File("c:\1.obj");
FileOutputStream fos  = new FileOutputStream(file);
ObjectOutputStream oos = new ObjectOutputStream(fos);

Student stu = new Student();
oos.writeObject(stu);

//从文件中把对象读出来
ObjectInputStream ois = new ObjectInputStream(arg0);
Student stu1 = (Student) ois.readObject();

文件/网络

intent.setData(Uri)
Uri.fromFile();  //大图片的传递</td>
</tr>
</tbody>
</table>
9.讲一讲对activity的理解？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">把上面的几点用自己的心得写出来</td>
</tr>
</tbody>
</table>
service

1.什么是Service以及描述下它的生命周期。Service有哪些启动方法，有什么区别，怎样停用Service？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">在Service的生命周期中，被回调的方法比Activity少一些，只有onCreate, onStart, onDestroy,
onBind和onUnbind。
通常有两种方式启动一个Service,他们对Service生命周期的影响是不一样的。
1 通过startService
Service会经历 onCreate 到onStart，然后处于运行状态，stopService的时候调用onDestroy方法。
如果是调用者自己直接退出而没有调用stopService的话，Service会一直在后台运行。
2 通过bindService
Service会运行onCreate，然后是调用onBind， 这个时候调用者和Service绑定在一起。调用者退出了，Srevice就会调用onUnbind-&gt;onDestroyed方法。
所谓绑定在一起就共存亡了。调用者也可以通过调用unbindService方法来停止服务，这时候Srevice就会调用onUnbind-&gt;onDestroyed方法。
需要注意的是如果这几个方法交织在一起的话，会出现什么情况呢？
一个原则是Service的onCreate的方法只会被调用一次，就是你无论多少次的startService又bindService，Service只被创建一次。
如果先是bind了，那么start的时候就直接运行Service的onStart方法，如果先是start，那么bind的时候就直接运行onBind方法。如果service运行期间调用了bindService，这时候再调用stopService的话，service是不会调用onDestroy方法的，service就stop不掉了，只能调用UnbindService, service就会被销毁

如果一个service通过startService 被start之后，多次调用startService 的话，service会多次调用onStart方法。多次调用stopService的话，service只会调用一次onDestroyed方法。

如果一个service通过bindService被start之后，多次调用bindService的话，service只会调用一次onBind方法。

多次调用unbindService的话会抛出异常。</td>
</tr>
</tbody>
</table>
2.service是否在main thread中执行, service里面是否能执行耗时的操作?
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">默认情况,如果没有显示的指定service所运行的进程, Service和activity是运行在当前app所在进程的main thread(UI主线程)里面
service里面不能执行耗时的操作(网络请求,拷贝数据库,大文件 )
在子线程中执行 new Thread(){}.start();特殊情况 ,可以在清单文件配置 service 执行所在的进程 ,让service在另外的进程中执行</td>
</tr>
</tbody>
</table>
3.怎么让在启动一个Activity是就启动一个service？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">在activity的onCreate()方法里面 startService();</td>
</tr>
</tbody>
</table>
4.Activity怎么和service绑定，怎么在activity中启动自己对应的service？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">startService() 一旦被创建  调用着无关   没法使用service里面的方法
bindService () 把service 与调用者绑定 ,如果调用者被销毁, service会销毁
bindService() 我们可以使用service 里面的方法
bindService().  让activity能够访问到 service里面的方法
构建一个intent对象,
Intent service = new Intent(this,MyService.class);
通过bindService的方法去启动一个服务,
bindService(intent, new MyConn(), BIND_AUTO_CREATE);
ServiceConnection 对象(重写onServiceConnected和OnServiceDisconnected方法) 和BIND_AUTO_CREATE.
private class myconn implements ServiceConnection{public void onServiceConnected(ComponentName name, IBinder service) {
// TODO Auto-generated method stub
//可以通过IBinder的对象 去使用service里面的方法
}

public void onServiceDisconnected(ComponentName name) {
// TODO Auto-generated method stub

}

}</td>
</tr>
</tbody>
</table>
5.不用service，B页面为音乐播放，从A跳转到B，再返回，如何使音乐继续播放？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"> 这个问题问的很山寨.默认不做任何处理,B里面的音乐都能播放.
遇到问题, 可以随机应变,灵活发挥,多考虑些细节,比如说这个题就可以这样说,说说你对startActivityForResult的理解()
B的结束的时候 setResult()A会调用到onActivityResult()
就会获取到resultCode
A开启B的时候,用startActivityForResult()方法, B返回的时候把播放的状态信息返回给A ,A继续播放音乐.
seekTo(resultCode)</td>
</tr>
</tbody>
</table>
6.什么是IntentService？有何优点？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">普通的service ,默认运行在ui main 主线程
Sdk给我们提供的方便的,带有异步处理的service类,
可以在OnHandleIntent() 处理耗时的操作</td>
</tr>
</tbody>
</table>
7.什么时候使用Service?
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">后台操作，耗时操作的时候拥有service的进程具有较高的优先级
官方文档告诉我们，Android系统会尽量保持拥有service的进程运行，只要在该service已经被启动(start)或者客户端连接(bindService)到它。当内存不足时，需要保持，拥有service的进程具有较高的优先级。
1． 如果service正在调用onCreate,  onStartCommand或者onDestory方法，那么用于当前service的进程相当于前台进程以避免被killed。
2． 如果当前service已经被启动(start)，拥有它的进程则比那些用户可见的进程优先级低一些，但是比那些不可见的进程更重要，这就意味着service一般不会被killed.
3． 如果客户端已经连接到service (bindService),那么拥有Service的进程则拥有最高的优先级，可以认为service是可见的。
4． 如果service可以使用startForeg round(int, Notification)方法来将service设置为前台状态，那么系统就认为是对用户可见的，并不会在内存不足时killed。
如果有其他的应用组件作为Service,Activity等运行在相同的进程中，那么将会增加该进程的重要性。
1.Service的特点可以让他在后台一直运行,可以在service里面创建线程去完成耗时的操作.
new Thread(){
TimerTask // 循环的执行一个定时的任务}.start();
2.Broadcast receiver捕获到一个事件之后,可以起一个service来完成一个耗时的操作.
ANR  new Service()

3.远程的service如果被启动起来,可以被多次bind, 但不会重新create.  索爱手机X10i的人脸识别的service可以被图库使用,可以被摄像机,照相机等程序使用.
画廊 摄像机 照相机  bindService()  Ibinder的对象, 访问service</td>
</tr>
</tbody>
</table>
8.如何在让Service杀不死？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android开发的过程中，每次调用startService(Intent)的时候，都会调用该Service对象的onStartCommand(Intent,int,int)方法，然后在onStartCommand方法中做一些处理。
从Android官方文档中，我们知道onStartCommand有4种int返回值，首先简单地讲讲int返回值的作用。
一、onStartCommand有4种返回值：
START_STICKY：如果service进程被kill掉，保留service的状态为开始状态，但不保留递送的intent对象。随后系统会尝试重新创建service，由于服务状态为开始状态，所以创建服务后一定会调用onStartCommand(Intent,int,int)方法。如果在此期间没有任何启动命令被传递到service，那么参数Intent将为null。
START_NOT_STICKY：“非粘性的”。使用这个返回值时，如果在执行完onStartCommand后，服务被异常kill掉，系统不会自动重启该服务。
START_REDELIVER_INTENT：重传Intent。使用这个返回值时，如果在执行完onStartCommand后，服务被异常kill掉，系统会自动重启该服务，并将Intent的值传入。
START_STICKY_COMPATIBILITY：START_STICKY的兼容版本，但不保证服务被kill后一定能重启。二、创建不被杀死的service
1.在service中重写下面的方法，这个方法有三个返回值， START_STICKY（或START_STICKY_COMPATIBILITY）是service被kill掉后自动重写创建
@Override  public int onStartCommand(Intent intent, int flags, int startId)  {   return START_STICKY_COMPATIBILITY;    //return super.onStartCommand(intent, flags, startId);  }
或
@Override  public int onStartCommand(Intent intent, int flags, int startId)  {   flags = START_STICKY;   return super.onStartCommand(intent, flags, startId);   // return START_REDELIVER_INTENT;  }
@Override public void onStart(Intent intent, int startId) { // 再次动态注册广播 IntentFilter localIntentFilter = new IntentFilter("android.intent.action.USER_PRESENT"); localIntentFilter.setPriority(Integer.MAX_VALUE);// 整形最大值 myReceiver searchReceiver = new myReceiver(); registerReceiver(searchReceiver, localIntentFilter); super.onStart(intent, startId); }
2.在Service的onDestroy()中重启Service.
public void onDestroy()  {   Intent localIntent = new Intent();   localIntent.setClass(this, MyService.class); // 销毁时重新启动Service   this.startService(localIntent);  }
3.创建一个广播
public class myReceiver extends BroadcastReceiver {  @Override  public void onReceive(Context context, Intent intent)  {   context.startService(new Intent(context, Google.class));  } }
4.AndroidManifest.xml中注册广播myReceiver及MyService服务
&lt;receiver android:name=".myReceiver" &gt;             &lt;intent-filter android:priority="2147483647" &gt;&lt;!--优先级加最高--&gt;                 &lt;!-- 系统启动完成后会调用 --&gt;                 &lt;action android:name="android.intent.action.BOOT_COMPLETED" /&gt;                                &lt;!-- 解锁完成后会调用 --&gt;                 &lt;action android:name="android.intent.action.USER_PRESENT" /&gt;                 &lt;!-- 监听情景切换 --&gt;                 &lt;action android:name="android.media.RINGER_MODE_CHANGED" /&gt;                            &lt;/intent-filter&gt; &lt;/receiver&gt;
&lt;service android:name=".MyService" &gt;
注：解锁，启动，切换场景激活广播需加权限，如启动完成，及手机机状态等。
&lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" /&gt; &lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt;
亲测ZTE U795手机Android 4.0.4版本adb push到system\app下android:persistent="true" 变成核心程序，在360杀掉进程的时候，myReceiver照样有效，保证service重生。呃
KILL问题： 1. settings 中stop service onDestroy方法中，调用startService进行Service的重启。 2.settings中force stop 应用 捕捉系统进行广播（action为android.intent.action.PACKAGE_RESTARTED） 3. 借助第三方应用kill掉running task 提升service的优先级，程序签名，或adb push到system\app下等
相较于/data/app下的应用，放在/system/app下的应用享受更多的特权，比如若在其Manifest.xml文件中设置persistent属性为true，则可使其免受out-of-memory killer的影响。如应用程序'Phone'的AndroidManifest.xml文件：
&lt;application android:name="PhoneApp"
android:persistent="true"
android:label="@string/dialerIconLabel"
android:icon="@drawable/ic_launcher_phone"&gt;
...
&lt;/application&gt;
设置后app提升为系统核心级别</td>
</tr>
</tbody>
</table>
Broadcast Receiver

1.什么是Broadcast Receiver
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"><strong>下面是Android Doc中关于BroadcastReceiver的概述：</strong>①广播接收器是一个专注于接收广播通知信息，并做出对应处理的组件。很多广播是源自于系统代码的──比如，通知时区改变、电池电量低、拍摄了一张照片或者用户改变了语言选项。应用程序也可以进行广播──比如说，通知其它应用程序一些数据下载完成并处于可用状态。
②应用程序可以拥有任意数量的广播接收器以对所有它感兴趣的通知信息予以响应。所有的接收器均继承自BroadcastReceiver基类。
③广播接收器没有用户界面。然而，它们可以启动一个activity来响应它们收到的信息，或者用NotificationManager来通知用户。通知可以用很多种方式来吸引用户的注意力──闪动背灯、震动、播放声音等等。一般来说是在状态栏上放一个持久的图标，用户可以打开它并获取消息。有很多广播接收者 ,系统已经实现了.
广播分两种 有序广播
无序广播
指定接收者的有序广播 .
sendOrderedBroadcast(<span style="text-decoration: underline;">intent</span>,<span style="text-decoration: underline;">receiverPermission</span>,<span style="text-decoration: underline;">resultReceiver</span>,<span style="text-decoration: underline;">scheduler</span>,<span style="text-decoration: underline;">initialCode</span>,<span style="text-decoration: underline;">initialData</span>,<span style="text-decoration: underline;">initialExtras)</span>
接受者一定会获取到 广播的事件sendStickyBroadcast(<span style="text-decoration: underline;">intent)</span>  //阴魂不散
广播接受者在onReceive 方法获取到广播的事件

Wifi设置  等待wifi状态更新完毕

是不可以被拦截掉的
&lt;intent-filter android:priority="1000"&gt; -1000 - 1000
&lt;action android:name="android.provider.Telephony.SMS_RECEIVED"/&gt;
&lt;/intent-filter&gt;
abortBroadcast();

代码配置优先级比xml配置优先级的级别高，因为代码运行在内存中，而清单在系统中

手机卫士中自定义一个broadcast receiver
&lt;intent-filter  android:&gt; &lt;action&gt; sms_received &lt;/action&gt;  &lt;/intent-filter&gt;

来获取短信到来的广播, 根据黑名单来判断是否拦截该短信.
画画板生成图片后,发送一个sd挂载的通知,通知系统的gallery去获取到新的图片.
Intent intent = <strong>new</strong>Intent(Intent.<em>ACTION_MEDIA_MOUNTED</em>,Uri.<em>parse</em>("file://"+Environment.<em>getExternalStorageDirectory</em>()));
sendBroadcast(intent);</td>
</tr>
</tbody>
</table>
2.什么时候使用Broadcast Receiver
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">用于接收系统的广播通知, 系统会有很多sd卡挂载,手机重启,广播通知,低电量,来电,来短信等….</td>
</tr>
</tbody>
</table>
3.如何使用Broadcast Receiver
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">设置广播接收者的优先级,设置广播接受者的action名字 等…
详细见工程代码.
&lt;intent-filter android:priority="1000"&gt;
&lt;action android:name="android.intent.action.NEW_OUTGOING_CALL"/&gt;
&lt;/intent-filter&gt;
&lt;/receiver&gt;
&lt;receiver android:name=".SmsReceiver"&gt;
&lt;intent-filter android:priority="1000"&gt;
&lt;action android:name="android.provider.Telephony.SMS_RECEIVED"/&gt;
&lt;/intent-filter&gt;
&lt;/receiver&gt;
&lt;receiver android:name=".BootCompleteReceiver"&gt;
&lt;intent-filter &gt;
&lt;action android:name="android.intent.action.BOOT_COMPLETED"      /&gt;
&lt;/intent-filter&gt;
&lt;/receiver&gt;可以通过代码   registerReceiver(<span style="text-decoration: underline;">receiver</span>,<span style="text-decoration: underline;">filter)</span></td>
</tr>
</tbody>
</table>
ContentProvider

1.什么是ContentProvider
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="middle"><strong>ContentProvider内容提供者</strong>
ContentProvider 进程间通讯，进程间数据的访问/对外共享数据用
优点：提供了统一的访问方式
原理分析图</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
2.什么时候使用ContentProvider
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">需要访问别人的数据的时候</td>
</tr>
</tbody>
</table>
3.如何使用ContentProvider
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">1.先是提供的数据类型等数据的类。package org.juetion.cp;import android.net.Uri;
import android.provider.BaseColumns;/**
* 提供的数据类型等数据。
* Created by juetionke on 13-12-21.
*/
public class MyProviderMetaData {

public static final String AUTHORIY = "org.juetion.cp.MyContentProvider";
/**
* 数据库名称
*/
public static final String DATABASE_NAME = "MyProvider.db";
/**
* 数据库版本
*/
public static final int DATABASE_VERSION = 1;
/**
* 表名
*/
public static final String USERS_TABLE_NAME = "users";

/**
* 继承了BaseColumns，所以已经有了_ID
*/
public static final class UserTableMetaData implements BaseColumns {
/**
* 表名
*/
public static final String TABLE_NAME = "users";
/**
* 访问该ContentProvider的URI
*/
public static final Uri CONTENT_URI = Uri.parse("content://" + AUTHORIY + "/users");
/**
* 该ContentProvider所返回的数据类型定义
*/
public static final String CONTENT_TYPE = "vnd.android.cursor.dir/org.juetion.user";
public static final String CONTENT_TYPE_ITEM = "vnd.android.cursor.item/org.juetion.user";
/**
* 列名
*/
public static final String USER_NAME = "name";
public static final String USER_AGE = "age";
/**
* 默认的排序方法
*/
public static final String DEFAULT_SORT_ORDER = "_id desc";
}
}
2，继承ContentProvider的类：
package org.juetion.cp;

import android.content.ContentProvider;
import android.content.ContentUris;
import android.content.ContentValues;
import android.content.UriMatcher;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteQueryBuilder;
import android.net.Uri;
import android.text.TextUtils;
import android.util.Log;

import org.juetion.sqlite3.DatabaseHelper;

import java.util.HashMap;

/**
* Created by juetionke on 13-12-21.
*/
public class MyContentProvider extends ContentProvider {

/**
* 定义规则
*/
public static final UriMatcher uriMatcher;
public static final int USERS_COLLECTION = 1;//用于标记
public static final int USERS_SINGLE = 2;//用于标记
private DatabaseHelper databaseHelper;//这里的数据共享是共享Sqlite里的数据，当然，可以试用其他，如文本数据共享。
static {
uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);//试用一个没有规则的Uri。然后下面自己匹配。
uriMatcher.addURI(MyProviderMetaData.AUTHORIY,"/users",USERS_COLLECTION);//自己定义的规则，有点像路由器，是uri匹配的方案。
uriMatcher.addURI(MyProviderMetaData.AUTHORIY,"/users/#",USERS_SINGLE);//同上。
}

/**
* 为列定义别名
*/
public static HashMap&lt;String,String&gt; usersMap;
static {
usersMap = new HashMap&lt;String, String&gt;();
usersMap.put(MyProviderMetaData.UserTableMetaData._ID, MyProviderMetaData.UserTableMetaData._ID);
usersMap.put(MyProviderMetaData.UserTableMetaData.USER_NAME, MyProviderMetaData.UserTableMetaData.USER_NAME);
usersMap.put(MyProviderMetaData.UserTableMetaData.USER_AGE, MyProviderMetaData.UserTableMetaData.USER_AGE);
}

@Override
public boolean onCreate() {
Log.i("juetion","onCreate");
databaseHelper = new DatabaseHelper(getContext(), MyProviderMetaData.DATABASE_NAME);//这里的实现，常见前篇关于Sqlite的文章。
return true;
}

@Override
public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {
Log.i("juetion","query");
SQLiteQueryBuilder sqLiteQueryBuilder = new SQLiteQueryBuilder();//写入查询条件，有点像Hibernate。
switch (uriMatcher.match(uri)) {//判断查询的是单个数据还是多个数据。
case USERS_SINGLE:
sqLiteQueryBuilder.setTables(MyProviderMetaData.UserTableMetaData.TABLE_NAME);//需要查询的表
sqLiteQueryBuilder.setProjectionMap(usersMap);//列的别名定义
sqLiteQueryBuilder.appendWhere(MyProviderMetaData.UserTableMetaData._ID + "=" + uri.getPathSegments().get(1));
//查询条件，uri.getPathSegments().get(1)，getPathSegments是将内容根据／划分成list。
break;
case USERS_COLLECTION:
sqLiteQueryBuilder.setTables(MyProviderMetaData.UserTableMetaData.TABLE_NAME);
sqLiteQueryBuilder.setProjectionMap(usersMap);
break;
}
String orderBy;//判断sortOrder是否为空，加入默认。
if (TextUtils.isEmpty(sortOrder)) {
orderBy = MyProviderMetaData.UserTableMetaData.DEFAULT_SORT_ORDER;
} else {
orderBy = sortOrder;
}
SQLiteDatabase sqLiteDatabase = databaseHelper.getWritableDatabase();
Cursor cursor = sqLiteQueryBuilder.query(sqLiteDatabase, projection, selection, selectionArgs, null, null, sortOrder);//可以使用下面的方法，不过此时sqLiteDatabase将会没有用。
//Cursor cursor = sqLiteDatabase.query(MyProviderMetaData.UserTableMetaData.TABLE_NAME, projection, selection, selectionArgs, null, null, orderBy);
cursor.setNotificationUri(getContext().getContentResolver(),uri);
return cursor;
}

/**
* 根据传入的URI，返回URI说表示的数据类型
* @param uri
* @return
*/
@Override
public String getType(Uri uri) {
Log.i("juetion","getType");
switch (uriMatcher.match(uri)) {//匹配uri的规则
case USERS_COLLECTION:
return MyProviderMetaData.UserTableMetaData.CONTENT_TYPE;
case USERS_SINGLE:
return MyProviderMetaData.UserTableMetaData.CONTENT_TYPE_ITEM;
default:
throw new IllegalArgumentException("Unknown URI" + uri);
}
}

@Override
public Uri insert(Uri uri, ContentValues values) {
Log.i("juetion","insert");
SQLiteDatabase sqLiteDatabase = databaseHelper.getWritableDatabase();
long rowId = sqLiteDatabase.insert(MyProviderMetaData.UserTableMetaData.TABLE_NAME, null, values);
if (rowId &gt; 0) {
Uri insertUserUri = ContentUris.withAppendedId(MyProviderMetaData.UserTableMetaData.CONTENT_URI, rowId);//简单来说就是字符串拼凑一下。只不过是uri专用的。
//通知监听器
getContext().getContentResolver().notifyChange(insertUserUri,null);
return insertUserUri;
}else
throw new IllegalArgumentException("Failed to insert row into" + uri);
}

@Override
public int delete(Uri uri, String selection, String[] selectionArgs) {
Log.i("juetion","delete");
return 0;
}

@Override
public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) {
Log.i("juetion","update");
return 0;
}
}
还有重要的一点，再第二个APP的AndroidManifest.xml里面需要添加
&lt;!-- provider name填写ContentProvider那个类的全称，authorities填写MyProviderMetaData里的AUTHORIY --&gt;
&lt;provider
android:authorities="org.juetion.cp.MyContentProvider"
android:name="org.juetion.cp.MyContentProvider”/&gt;

以下代码是在第一个APP里面的。
关于使用。只需要将uri的string提供给第一个APP。
例如在第一个APP的Activity调用数据插入：
ContentValues contentValues = new ContentValues();
contentValues.put("name","zhangsan");
contentValues.put("age",19);
Uri uri = getContentResolver().insert(Uri.parse("content://org.juetion.cp.MyContentProvider/users"),contentValues);
Log.i("juetion", "insert uri--&gt;" + uri.toString());

例如在第一个APP的Activity调用数据的查询：
Cursor cursor = getContentResolver().query(Uri.parse("content://org.juetion.cp.MyContentProvider/users"),
new String[]{"name", "age"},
null, null, null);
while (cursor.moveToNext()) {
Log.i("juetion", cursor.getString(cursor.getColumnIndex("name")));
}</td>
</tr>
</tbody>
</table>
4.请介绍下ContentProvider是如何实现数据共享的。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">ContentProvider 可以屏蔽数据操作的细节 文件 xml
MyContentProvider 可以在不同应用程序之间共享数据  sharedpreference db
把自己的数据通过uri的形式共享出去
android  系统下 不同程序 数据默认是不能共享访问需要去实现一个类去继承ContentProvider
public class PersonContentProvider extends ContentProvider{
public boolean onCreate(){
//..
}
query(Uri, String[], String, String[], String)
insert(Uri, ContentValues)
update(Uri, ContentValues, String, String[])
delete(Uri, String, String[])联系人的信息 sms的内容content://sms/
}</td>
</tr>
</tbody>
</table>
安全共同点
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">android安全学习
签名作用
1.sharedUserId 一样并且签名一次 可以实现数据共享
2.升级应用
权限：细粒度的特权管理
权限与操作关联
应用需要显式申请权限
用户对权限可知（不可控）
对特权权限单独控制
四大组件
exported = true 等于public
exported = false 等于private
默认组件private
如果该组件设置了intent-filter默认是public
如果同时希望是private，就需要主动设置expoted=false
Securing Activities
可知指定权限才能启动activity
service同上
BoradcastReceiver可以设置接发的权限
ContentPrivider 可设置读写Permission</td>
</tr>
</tbody>
</table>
7.多线程管理
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">本篇随笔将讲解一下Android的多线程的知识，以及如何通过AsyncTask机制来实现线程之间的通信。
一、Android当中的多线程
在Android当中，当一个应用程序的组件启动的时候，并且没有其他的应用程序组件在运行时，Android系统就会为该应用程序组件开辟一个新的线程来执行。默认的情况下，在一个相同Android应用程序当中，其里面的组件都是运行在同一个线程里面的，这个线程我们称之为Main线程。当我们通过某个组件来启动另一个组件的时候，这个时候默认都是在同一个线程当中完成的。当然，我们可以自己来管理我们的Android应用的线程，我们可以根据我们自己的需要来给应用程序创建额外的线程。
二、Main Thread 和 Worker Thread
在Android当中，通常将线程分为两种，一种叫做Main Thread，除了Main Thread之外的线程都可称为Worker Thread。
当一个应用程序运行的时候，Android操作系统就会给该应用程序启动一个线程，这个线程就是我们的Main Thread，这个线程非常的重要，它主要用来加载我们的UI界面，完成系统和我们用户之间的交互，并将交互后的结果又展示给我们用户，所以Main Thread又被称为UI Thread。
Android系统默认不会给我们的应用程序组件创建一个额外的线程，所有的这些组件默认都是在同一个线程中运行。然而，某些时候当我们的应用程序需要完成一个耗时的操作的时候，例如访问网络或者是对数据库进行查询时，此时我们的UI Thread就会被阻塞。例如，当我们点击一个Button，然后希望其从网络中获取一些数据，如果此操作在UI Thread当中完成的话，当我们点击Button的时候，UI线程就会处于阻塞的状态，此时，我们的系统不会调度任何其它的事件，更糟糕的是，当我们的整个现场如果阻塞时间超过5秒钟(官方是这样说的)，这个时候就会出现 ANR (Application Not Responding)的现象，此时，应用程序会弹出一个框，让用户选择是否退出该程序。对于Android开发来说，出现ANR的现象是绝对不能被允许的。
另外，由于我们的Android UI控件是线程不安全的，所以我们不能在UI Thread之外的线程当中对我们的UI控件进行操作。因此在Android的多线程编程当中，我们有两条非常重要的原则必须要遵守：
绝对不能在UI Thread当中进行耗时的操作，不能阻塞我们的UI Thread
不能在UI Thread之外的线程当中操纵我们的UI元素
三、如何处理UI Thread 和 Worker Thread之间的通信
既然在Android当中有两条重要的原则要遵守，那么我们可能就有疑问了？我们既不能在主线程当中处理耗时的操作，又不能在工作线程中来访问我们的UI控件，那么我们比如从网络中要下载一张图片，又怎么能将其更新到UI控件上呢？这就关系到了我们的主线程和工作线程之间的通信问题了。在Android当中，提供了两种方式来解决线程直接的通信问题，一种是通过Handler的机制(这种方式在后面的随笔中将详细介绍),还有一种就是今天要详细讲解的 AsyncTask 机制。
四、AsyncTask
AsyncTask：异步任务，从字面上来说，就是在我们的UI主线程运行的时候，异步的完成一些操作。AsyncTask允许我们的执行一个异步的任务在后台。我们可以将耗时的操作放在异步任务当中来执行，并随时将任务执行的结果返回给我们的UI线程来更新我们的UI控件。通过AsyncTask我们可以轻松的解决多线程之间的通信问题。
怎么来理解AsyncTask呢？通俗一点来说，AsyncTask就相当于Android给我们提供了一个多线程编程的一个框架，其介于Thread和Handler之间，我们如果要定义一个AsyncTask，就需要定义一个类来继承AsyncTask这个抽象类，并实现其唯一的一个 doInBackgroud 抽象方法。要掌握AsyncTask，我们就必须要一个概念，总结起来就是: 3个泛型，4个步骤。
3个泛型指的是什么呢？我们来看看AsyncTask这个抽象类的定义，当我们定义一个类来继承AsyncTask这个类的时候，我们需要为其指定3个泛型参数：
AsyncTask　&lt;Params, Progress, Result&gt;
<strong>Params</strong>: 这个泛型指定的是我们传递给异步任务执行时的参数的类型
<strong>Progress</strong>: 这个泛型指定的是我们的异步任务在执行的时候将执行的进度返回给UI线程的参数的类型
<strong>Result</strong>: 这个泛型指定的异步任务执行完后返回给UI线程的结果的类型
我们在定义一个类继承AsyncTask类的时候，必须要指定好这三个泛型的类型，如果都不指定的话，则都将其写成Void，例如：
AsyncTask &lt;Void, Void, Void&gt;
4个步骤：当我们执行一个异步任务的时候，其需要按照下面的4个步骤分别执行
<strong>onPreExecute():</strong> 这个方法是在执行异步任务之前的时候执行，并且是在UI Thread当中执行的，通常我们在这个方法里做一些UI控件的初始化的操作，例如弹出要给ProgressDialog
<strong>doInBackground(Params... params):</strong> 在onPreExecute()方法执行完之后，会马上执行这个方法，这个方法就是来处理异步任务的方法，Android操作系统会在后台的线程池当中开启一个worker thread来执行我们的这个方法，所以这个方法是在worker thread当中执行的，这个方法执行完之后就可以将我们的执行结果发送给我们的最后一个 onPostExecute 方法，在这个方法里，我们可以从网络当中获取数据等一些耗时的操作
<strong>onProgressUpdate(Progess... values):</strong> 这个方法也是在UI Thread当中执行的，我们在异步任务执行的时候，有时候需要将执行的进度返回给我们的UI界面，例如下载一张网络图片，我们需要时刻显示其下载的进度，就可以使用这个方法来更新我们的进度。这个方法在调用之前，我们需要在 doInBackground 方法中调用一个 publishProgress(Progress) 的方法来将我们的进度时时刻刻传递给 onProgressUpdate 方法来更新
<strong>onPostExecute(Result... result):</strong> 当我们的异步任务执行完之后，就会将结果返回给这个方法，这个方法也是在UI Thread当中调用的，我们可以将返回的结果显示在UI控件上
为什么我们的AsyncTask抽象类只有一个 doInBackground 的抽象方法呢？？原因是，我们如果要做一个异步任务，我们必须要为其开辟一个新的Thread，让其完成一些操作，而在完成这个异步任务时，我可能并不需要弹出要给ProgressDialog，我并不需要随时更新我的ProgressDialog的进度条，我也并不需要将结果更新给我们的UI界面，所以除了 doInBackground 方法之外的三个方法，都不是必须有的，因此我们必须要实现的方法是 doInBackground 方法。
五、通过AsyncTask来从网络上下载一张图片
下面我们就通过两个代码示例，来看看如何通过AsyncTask来从网络上下载一张图片，并更新到我们的ImageView控件上。
①下载图片时，弹出一个ProgressDialog，但是不显示实时进度
我们来看看布局文件：&lt;RelativeLayoutxmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
xmlns:tools="<span style="text-decoration: underline;">http://schemas.android.com/tools</span>"
android:layout_width="match_parent"
android:layout_height="match_parent"]]
&gt;&lt;ImageView
android:id="@+id/imageView"
android:layout_width="wrap_content"
android:layout_height="200dp"
android:layout_alignParentRight="true"
android:layout_alignParentTop="true"
android:scaleType="fitCenter"/&gt;

&lt;Button
android:id="@+id/button"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:layout_below="@+id/imageView"
android:layout_centerHorizontal="true"
android:layout_marginTop="41dp"
android:text="从网络上下载一张图片"/&gt;

&lt;/RelativeLayout]]
&gt;

就是很简单的一个ImageView控件和一个Button控件，当点击Button控件时，弹出一个ProgressDialog，然后开启一个异步任务，从网络中下载一张图片，并更新到我们的ImageView上。这里还要注意一点，如果我们要使用手机访问网络，必须还要给其授权才行，在后续的学习当中，将会详细讲解Android当中的授权的知识。我们来看看
AndroidManifest.xml文件：

&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;manifestxmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
package="com.xiaoluo.android_asynctast"
android:versionCode="1"
android:versionName="1.0"]]
&gt;

&lt;uses-sdk
android:minSdkVersion="8"
android:targetSdkVersion="18"/&gt;

&lt;!-- 授权手机能够访问网络 --&gt;
&lt;uses-permissionandroid:name="android.permission.INTERNET"/&gt;

&lt;application
android:allowBackup="true"
android:icon="@drawable/ic_launcher"
android:label="@string/app_name"
android:theme="@style/AppTheme"]]
&gt;

&lt;activity
android:name="com.xiaoluo.android_asynctast.MainActivity"
android:label="@string/app_name"]]
&gt;

&lt;intent-filter]]
&gt;

&lt;actionandroid:name="android.intent.action.MAIN"/&gt;

&lt;categoryandroid:name="android.intent.category.LAUNCHER"/&gt;
&lt;/intent-filter]]
&gt;

&lt;/activity]]
&gt;

&lt;/application]]
&gt;

&lt;/manifest]]
&gt;

接下来我们来看看我们的Activity代码：

publicclass MainActivityextends Activity
{
private Button button;
private ImageView imageView;
private ProgressDialog progressDialog;
privatefinal String IMAGE_PATH = "<span style="text-decoration: underline;">http://developer.android.com/images/home/kk-hero.jpg</span>";
//    private final String IMAGE_PATH2 = "<span style="text-decoration: underline;">http://ww2.sinaimg.cn/mw690/69c7e018jw1e6hd0vm3pej20fa0a674c.jpg</span>";    @Override
protectedvoid onCreate(Bundle savedInstanceState)
{
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);

button = (Button)findViewById(R.id.button);
imageView = (ImageView)findViewById(R.id.imageView);
//    弹出要给ProgressDialog
progressDialog =new ProgressDialog(MainActivity.this);
progressDialog.setTitle("提示信息");
progressDialog.setMessage("正在下载中，请稍后......");
//    设置setCancelable(false); 表示我们不能取消这个弹出框，等下载完成之后再让弹出框消失
progressDialog.setCancelable(false);
//    设置ProgressDialog样式为圆圈的形式        progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);

button.setOnClickListener(new View.OnClickListener()
{
@Override
publicvoid onClick(View v)
{　　　　　　　　　// 在UI Thread当中实例化AsyncTask对象，并调用execute方法
new MyAsyncTask().execute(IMAGE_PATH);
}
});
}

/**
* 定义一个类，让其继承AsyncTask这个类
* Params: String类型，表示传递给异步任务的参数类型是String，通常指定的是URL路径
* Progress: Integer类型，进度条的单位通常都是Integer类型
* Result：byte[]类型，表示我们下载好的图片以字节数组返回
*@author xiaoluo
*
*/
publicclass MyAsyncTaskextends AsyncTask&lt;String, Integer,byte[]&gt;
{
@Override
protectedvoid onPreExecute()
{
super.onPreExecute();
//    在onPreExecute()中我们让ProgressDialog显示出来            progressDialog.show();
}
@Override
protectedbyte[] doInBackground(String... params)
{
//    通过Apache的HttpClient来访问请求网络中的一张图片
HttpClient httpClient =new DefaultHttpClient();
HttpGet httpGet =new HttpGet(params[0]);
byte[] image =newbyte[]{};
try
{
HttpResponse httpResponse = httpClient.execute(httpGet);
HttpEntity httpEntity = httpResponse.getEntity();
if(httpEntity !=null &amp;&amp; httpResponse.getStatusLine().getStatusCode() == HttpStatus.SC_OK)
{
image = EntityUtils.toByteArray(httpEntity);
}
}
catch (Exception e)
{
e.printStackTrace();
}
finally
{
httpClient.getConnectionManager().shutdown();
}
return image;
}
@Override
protectedvoid onProgressUpdate(Integer... values)
{
super.onProgressUpdate(values);
}
@Override
protectedvoid onPostExecute(byte[] result)
{
super.onPostExecute(result);
//    将doInBackground方法返回的byte[]解码成要给Bitmap
Bitmap bitmap = BitmapFactory.decodeByteArray(result, 0, result.length);
//    更新我们的ImageView控件            imageView.setImageBitmap(bitmap);
//    使ProgressDialog框消失            progressDialog.dismiss();
}
}

@Override
publicboolean onCreateOptionsMenu(Menu menu)
{
getMenuInflater().inflate(R.menu.main, menu);
returntrue;
}

}

我们来看看效果图：

②带有进度条更新的下载一张网络图片
下面这个代码示例，将会在下载图片的时候，显示进度条的更新，配置文件都不变，我们来看看Activity代码：

publicclass MainActivityextends Activity
{
private Button button;
private ImageView imageView;
private ProgressDialog progressDialog;
privatefinal String IMAGE_PATH = "<span style="text-decoration: underline;">http://developer.android.com/images/home/kk-hero.jpg</span>";
//    private final String IMAGE_PATH2 = "<span style="text-decoration: underline;">http://ww2.sinaimg.cn/mw690/69c7e018jw1e6hd0vm3pej20fa0a674c.jpg</span>";    @Override
protectedvoid onCreate(Bundle savedInstanceState)
{
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);

button = (Button)findViewById(R.id.button);
imageView = (ImageView)findViewById(R.id.imageView);
//    弹出要给ProgressDialog
progressDialog =new ProgressDialog(MainActivity.this);
progressDialog.setTitle("提示信息");
progressDialog.setMessage("正在下载中，请稍后......");
//    设置setCancelable(false); 表示我们不能取消这个弹出框，等下载完成之后再让弹出框消失
progressDialog.setCancelable(false);
//    设置ProgressDialog样式为水平的样式        progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);

button.setOnClickListener(new View.OnClickListener()
{
@Override
publicvoid onClick(View v)
{
new MyAsyncTask().execute(IMAGE_PATH);
}
});
}

/**
* 定义一个类，让其继承AsyncTask这个类
* Params: String类型，表示传递给异步任务的参数类型是String，通常指定的是URL路径
* Progress: Integer类型，进度条的单位通常都是Integer类型
* Result：byte[]类型，表示我们下载好的图片以字节数组返回
*@author xiaoluo
*
*/
publicclass MyAsyncTaskextends AsyncTask&lt;String, Integer,byte[]&gt;
{
@Override
protectedvoid onPreExecute()
{
super.onPreExecute();
//    在onPreExecute()中我们让ProgressDialog显示出来            progressDialog.show();
}
@Override
protectedbyte[] doInBackground(String... params)
{
//    通过Apache的HttpClient来访问请求网络中的一张图片
HttpClient httpClient =new DefaultHttpClient();
HttpGet httpGet =new HttpGet(params[0]);
byte[] image =newbyte[]{};
try
{
HttpResponse httpResponse = httpClient.execute(httpGet);
HttpEntity httpEntity = httpResponse.getEntity();
InputStream inputStream =null;
ByteArrayOutputStream byteArrayOutputStream =newByteArrayOutputStream();
if(httpEntity !=null &amp;&amp; httpResponse.getStatusLine().getStatusCode() == HttpStatus.SC_OK)
{
//    得到文件的总长度
long file_length = httpEntity.getContentLength();
//    每次读取后累加的长度
long total_length = 0;
int length = 0;
//    每次读取1024个字节
byte[] data =newbyte[1024];
inputStream = httpEntity.getContent();
while(-1 != (length = inputStream.read(data)))
{
//    每读一次，就将total_length累加起来
total_length += length;
//    边读边写到ByteArrayOutputStream当中
byteArrayOutputStream.write(data, 0, length);
//    得到当前图片下载的进度
int progress = ((int)(total_length/(float)file_length) * 100);
//    时刻将当前进度更新给onProgressUpdate方法                        publishProgress(progress);
}
}
image = byteArrayOutputStream.toByteArray();
inputStream.close();
byteArrayOutputStream.close();
}
catch (Exception e)
{
e.printStackTrace();
}
finally
{
httpClient.getConnectionManager().shutdown();
}
return image;
}
@Override
protectedvoid onProgressUpdate(Integer... values)
{
super.onProgressUpdate(values);
//    更新ProgressDialog的进度条
progressDialog.setProgress(values[0]);
}
@Override
protectedvoid onPostExecute(byte[] result)
{
super.onPostExecute(result);
//    将doInBackground方法返回的byte[]解码成要给Bitmap
Bitmap bitmap = BitmapFactory.decodeByteArray(result, 0, result.length);
//    更新我们的ImageView控件            imageView.setImageBitmap(bitmap);
//    使ProgressDialog框消失            progressDialog.dismiss();
}
}

@Override
publicboolean onCreateOptionsMenu(Menu menu)
{
getMenuInflater().inflate(R.menu.main, menu);
returntrue;
}

}

我们来看看效果图：

这样我们就能够通过AsyncTask来实现从网络中下载一张图片，然后将其更新到UI控件中，并时时刻刻的更新当前的进度这个功能了。
六、AsyncTask的重要知识点
在上面两节已经详细讲解了AsyncTask的工作原理了，这里我们还要补充一下AsyncTask的一些其他知识点：
1.Cancelling a Task
我们可以在任何时刻来取消我们的异步任务的执行，通过调用 cancel(boolean)方法，调用完这个方法后系统会随后调用 isCancelled() 方法并且返回true。如果调用了这个方法，那么在 doInBackgroud() 方法执行完之后，就不会调用 onPostExecute() 方法了，取而代之的是调用 onCancelled() 方法。为了确保Task已经被取消了，我们需要经常调用 isCancelled() 方法来判断，如果有必要的话。
2.在使用AsyncTask做异步任务的时候必须要遵循的原则：
AsyncTask类必须在UI Thread当中加载，在Android Jelly_Bean版本后这些都是自动完成的
AsyncTask的对象必须在UI Thread当中实例化
execute方法必须在UI Thread当中调用
不要手动的去调用AsyncTask的onPreExecute, doInBackground, publishProgress, onProgressUpdate, onPostExecute方法，这些都是由Android系统自动调用的
AsyncTask任务只能被执行一次

到此，有关AsyncTask的总结就到此为止了，本篇随笔主要讲解了Android中的多线程知识，并且详细地讲解了 AsyncTask 异步任务的概念和实现机制，并通过实例来了解 AsyncTask 的执行过程，最后还补充了 AsyncTask 的一些重要知识点，包括如何取消一个 AsyncTask 以及，我们在使用 AsyncTask 时所必须遵循的规则。
<strong>  </strong></td>
</tr>
</tbody>
</table>
8.android内存优化及管理
<table width="1260" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"><strong>1、使用优化过的数据容器。 </strong>在Android framework下，建议使用优化过的数据容器比如：SparseArray,SparseBooleanArray,LongSparseArray。通用的HashMap实现的内存使用率非常的低，因为他需要为每一个mapping创建一个分离的entry object。另外，SparseArray类避免了系统对有些key的自动装箱，因而带来了更高的效率。 <strong>2、注意内存的开销。</strong><strong>[size=12.800000190734863px]  </strong>注意你使用的语言和第三方库的成本和开销，要自始至终的将这些因素考虑在你的程序设计中。通常，有些事情表面上看着没什么问题但实际上的开销让人惊叹。比如：
·枚举相对于静态常量来说，需要两倍甚至更多的内存。你应该完全避免在Android中使用枚举。
[size=12.666666984558105px]·每一个在java中的类（包括匿名内部类）使用大约500 bytes的代码量。    ·每一个类的实例拥有12-16 bytes的RAM消耗。    ·放置一个单独的实体到HashMap中，一个额外加的实体对象分配需要花费32 bytes。
[size=12.666666984558105px]<strong>3、关于代码的抽象  </strong>抽象是一个好的编程的基础，因为抽象可以提高代码的灵活性和可维护性。然而抽象也带来了一定的花销，一般情况下，他们有更多的代码需要执行，需要更多的时间和更多RAM来将这些代码映射到内存中。因此，如果你的抽象不能带来巨大的好处，你就应该割掉你的赘肉。
<strong>4、避免依赖注入框架  </strong>虽然注入框架给我们带来了很多方便，但是在使用这些框架的时候，框架需要花费很多时间来扫描我们自己写的代码，甚至会将哪些你根本不需要的东西也加载到内存中。
<strong>5、小心的使用扩展库  </strong>很多扩展库的代码不是针对手机环境开发的，可能在用到移动客户端的时候会导致很低的效率。因此在使用之前，需要评估一下其占用内存的大小。     即使库针对手机开发，也会有潜在的危险，因为每一个Library做的事情不尽相同。比如，一个Library使用nano protobufs而另一个使用micro protobufs。现在，在你的app中就有两个protobuf。类似情况经常发生。
<strong>6、使用混淆器移除不必要的代码  </strong>ProGuard工具通过移除无用代码，使用语意模糊来保留类，字段和方法来压缩，优化和混淆代码。可以使你的代码更加完整，更少的RAM 映射页。
<strong>7、使用多个进程（注意是process 不是 thread ok？）  </strong>如果这适合你的app，可能帮助你管理你的app的内存就是将你的app多个部分分配到多个进程中。该技术必须小心使用并且大多数应用不应该运行在多个进程下。这个技术的主要应用是后台工作跟天台工作一样重要的情况下。典型应用就是：当音乐播放器从服务器下载并长时间播放音乐，一般将其分为两个进程：一个是UI，另一个位置后台服务的运行。 like this:
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" valign="top">1</td>
<td valign="middle">&lt;<strong>service</strong>android:name=".PlaybackService"         android:process=":background"/&gt;</td>
<td valign="middle"></td>
</tr>
</tbody>
</table>
[size=12.666666984558105px]process后面需要记住要有个":",这表示该进程属于你的app。 一般情况下，一块基本的空进程需要的内存大小在1.4m左右。
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" valign="top">1</td>
<td valign="middle">adb shell dumpsys meminfo com.example.android.apis:empty</td>
<td valign="middle"></td>
</tr>
</tbody>
</table>
<strong>8、基本性能优化方法的基本原则：</strong>

1）不要做你不必要的工作；

2）不要申请不必要的内存；
例如，你明明知道一个方法返回一个String之后，你需要对这个String重新进行修改，那么就不要返回一个String，返回一个StringBuffer会是你更好的选择。     再比如，使用int比使用Integer占用更少的空间。这个大家肯定都是晓得的。     数组比一个Map拥有更好的性能。     如果你的方法不需要访问类字段，那么让你的方法是static的吧，这将会带来15%-20%速度的提升。     对于常量，请尽量使用static and final定义。如果使用final定义常量之后，会减少编译器在类生成时初始化&lt;clinit&gt;方法调用时对常量的存储，对于int型常量，将会直接使用其数值来进行替换，而对于String对象将会使用相对廉价的“string constant”指令来替换字段查找表。虽然这个方法并不完全对所有类型都有效，但是，将常量声明为static final绝对是一个好的做法。     避免Getters/Setters。虽然在一般的面向对象的设计模式中使用Getter和Setter是稀松平常的事情，但是在Android中使用getters/Setters是一个非常糟糕的主意，方法的调用相对于直接查找字段来说十分的昂贵。在没有JIT的情况下，直接对字段进行访问要比通过Getter访问快了近3倍。在有JIT的情况下，前者比后者快近7倍。     使用最新的循环方式。比如增强for。     避免使用浮点类型。在某些可以的情况下，将浮点替换成整型数据，然后进行计算会得到更精确的结果和更快的速度。     小心使用Native Methods。这里需要纠正的是，Native 方法并不一定能提高你应用的速度，有些甚至会拖后腿，因为，首先来说就需要一部分开销在Java-native transition上，而且JIT并不能对其进行优化。另外你需要为每个你想要在其上运行的系统结构上进行编译；即便是同一个处理器上，你也可能需要多个版本，比如为G1上的ARM处理器编译的就不能很好的在Nexus One的ARM上运行。Native代码最主要的用途是，你已经有了很多native 代码，并且你迫切希望接入Android中。而不是使用Native Method来提高你应用中某部分代码的运行速度。     [size=12.666666984558105px] 对于效率的提高除了使用遵守上面两条外基本准则外，选择合适的算法和数据结构也是非常关键的。

<strong>9、关于UI上的一些问题[size=12.800000190734863px]  </strong>Hierarchy Viewer[size=12.666666984558105px] [size=12.666666984558105px]通过他，可以看到你自己的Layout文件存在的问题。你可以看到你的Layout每一部分计算，布局，渲染所需要的时间。尽量的使你的Layout扁平话，深度最好保持 在三层之内[size=12.666666984558105px] 。RelativeLayout[size=12.666666984558105px] 是解决使用LinearLayout堆叠多层问题的利剑。那些为了方便 使[size=12.666666984558105px] 用LinearLayout的layout_weight属性[size=12.666666984558105px] 的哥们，需要重点注意，这个属性真的可以减慢measure速度。所以在使用之前，一定要再三考虑，是否真的不能通过其他方法来完成你要的效果？
官方文档上 推荐使用RelativeLayout和GridLayout来避免Layout深度过深的问题[size=12.666666984558105px] 。
之前看文档，Google提供一个叫 ViewSub[size=12.666666984558105px] 的控件来优化那些不是必须要立即在UI上显示的控件，感兴趣的同学可以去看看。在API Level 1中就提供了这个东西，但是在实际开发中很少见到有人用或者提及（可能是我孤陋寡闻，公司就两个<span style="text-decoration: underline;">Android开发</span>，另一个还要转IOS，我们俩的Android技术就代表了我们公司的Android技术能力，想想真悲哀！），其实蛮好用的。
重用Layout。可以使用&lt;include/&gt; &lt;merge/&gt;将其他布局嵌入到当前布局中。
ListView的优化：ViewHolder的使用；AsyncTask的使用；针对ListView当前滑动状态，对图片数据的加载进行控制；（ListView在配以AsyncTask加载图片时需要注[size=12.666666984558105px] 意图片的加载完显示的位置以及图片的缓存问题，具体可以参考Google的Demo[size=12.666666984558105px] ）[size=12.666666984558105px]
[size=12.800000190734863px]<strong>10、将大消耗操作交给多个线程。 11、如果你的应用需要发送Broadcast但是又不希望别的应用获取到，或者你不希望处理别的应用发送的同样的action，那么请使用</strong><strong>LocalBroadcastManager</strong><strong>。</strong>
[size=12.666666984558105px]    该类是在Android Support v4中提供的，用来在同一个应用内的不同组件之间发送Broadcast。好处上面说了，可以保证应用的私密性。会比全局广播有更高的效率，但是官方文档没有说明具体数值。具体使用方法：
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" valign="top">1</td>
<td valign="middle">LocalBroadcastManager.getInstance(this).registerReceiver( mStateReceiver, mStatusIntentFilter);LocalBroadcastManager.getInstance(this).sendBroadcast(localBroadcastIntent);</td>
<td valign="middle"></td>
</tr>
</tbody>
</table>
使用oc计数器的方式可以更好的控制内存

Android OnLowMemory和OnTrimMemory

OnLowMemory
OnLowMemory是Android提供的API，在系统内存不足，所有后台程序（优先级为background的进程，不是指后台运行的进程）都被杀死时，系统会调用OnLowMemory。系统提供的回调有：
Application.onLowMemory()
Activity.OnLowMemory()
Fragement.OnLowMemory()
Service.OnLowMemory()
ContentProvider.OnLowMemory()
除了上述系统提供的API，还可以自己实现ComponentCallbacks，通过API注册，这样也能得到OnLowMemory回调。例如：
public static class MyCallback implements ComponentCallbacks {

@Override
public void onConfigurationChanged(Configuration arg) {

}

@Override
public void onLowMemory() {
//do release operation
}
}
然后，通过Context.registerComponentCallbacks ()在合适的时候注册回调就可以了。通过这种自定义的方法，可以在很多地方注册回调，而不需要局限于系统提供的组件。
OnTrimMemory
OnTrimMemory是Android 4.0之后提供的API，系统会根据不同的内存状态来回调。系统提供的回调有：
Application.onTrimMemory()
Activity.onTrimMemory()
Fragement.OnTrimMemory()
Service.onTrimMemory()
ContentProvider.OnTrimMemory()
OnTrimMemory的参数是一个int数值，代表不同的内存状态：
TRIM_MEMORY_COMPLETE：内存不足，并且该进程在后台进程列表最后一个，马上就要被清理
TRIM_MEMORY_MODERATE：内存不足，并且该进程在后台进程列表的中部。
TRIM_MEMORY_BACKGROUND：内存不足，并且该进程是后台进程。
TRIM_MEMORY_UI_HIDDEN：内存不足，并且该进程的UI已经不可见了。
以上4个是4.0增加
TRIM_MEMORY_RUNNING_CRITICAL：内存不足(后台进程不足3个)，并且该进程优先级比较高，需要清理内存
TRIM_MEMORY_RUNNING_LOW：内存不足(后台进程不足5个)，并且该进程优先级比较高，需要清理内存
TRIM_MEMORY_RUNNING_MODERATE：内存不足(后台进程超过5个)，并且该进程优先级比较高，需要清理内存

以上3个是4.1增加
系统也提供了一个ComponentCallbacks2，通过Context.registerComponentCallbacks()注册后，就会被系统回调到。
OnLowMemory和OnTrimMemory的比较
1，OnLowMemory被回调时，已经没有后台进程；而onTrimMemory被回调时，还有后台进程。 2，OnLowMemory是在最后一个后台进程被杀时调用，一般情况是low memory killer 杀进程后触发；而OnTrimMemory的触发更频繁，每次计算进程优先级时，只要满足条件，都会触发。 3，通过一键清理后，OnLowMemory不会被触发，而OnTrimMemory会被触发一次。</td>
</tr>
</tbody>
</table>
9.图片缓存机制
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">目前很多商业应用都会涉及到从网络上读取图片数据的问题，为了节约用户流量，应用一般会将图片缓存起来。图片缓存一般分为内存缓存和外存缓存。内存缓存运用java的缓存机制，在程序完全退出后，缓存所在的内存空间可能被其它应用程序占用从而丢失。外存缓存一般放在程序特有的访问空间或者sd卡中，在sd卡中存放的资源为公有资源，其它程序也可以访问，且对用户来讲没有一个强制清除缓存的规范机制。综合以上，本文采用将缓存图片放置在程序的特有空间中， 其它应用程序无法访问，且用户可以在应用程序管理中的"清除数据"选项中清除缓存。
本文提供三种缓存策略：（1）LRU算法，固定缓存图片数量(max_num)，当图片数量超出max_num时，将缓存中最近用的最少的图片删除。（2）FTU算法，固定每张图片的缓存时限，以最后一次使用算起，超过时限后删除。（3）FMU算法，在存储器中固定一定大小的存储空间，超过固定空间后将缓存中占用最大尺寸的图片删除。使用时只需要向方法体中传递图片的URL即可。代码片段使用方法：
1.导入jar;
2. 获取服务；
3.提交url,交给程序去判断是否下载。

public class ImagecachetacticsdemoActivity extends Activity {     public void onCreate(Bundle savedInstanceState) {         super.onCreate(savedInstanceState);         setContentView(R.layout.item);         /*FMU*/        imageCacheManager = ImageCacheManager.getImageCacheService(this,                 ImageCacheManager.MODE_FIXED_MEMORY_USED, "memory");         imageCacheManager.setMax_Memory(1024 * 1024);         /*FTU*/        // imageCacheManager = ImageCacheManager.getImageCacheService(this,         // ImageCacheManager.MODE_FIXED_TIMED_USED, "time");         // imageCacheManager.setDelay_millisecond(3 * 60 * 1000);                    /*LRU*/        // imageCacheManager = ImageCacheManager.getImageCacheService(this,         // ImageCacheManager.MODE_LEAST_RECENTLY_USED, "num");         // imageCacheManager.setMax_num(5);         // imageCacheManager = ImageCacheManager.getImageCacheService(this,         // ImageCacheManager.MODE_NO_CACHE_USED, "nocache");        mImageView = (ImageView) findViewById(R.id.imageView);         new DownloadTask()                 .execute("<span style="text-decoration: underline;">http://www.touxiang99.com/uploads/allimg/110417/1_110417112640_2.jpg</span>");     }     private class DownloadTask extends AsyncTask&lt;String, Void, Bitmap&gt; {         @Override         protected Bitmap doInBackground(String... params) {             try {                 return imageCacheManager.downlaodImage(new URL(params[0]));             } catch (IOException e) {                 e.printStackTrace();             }             return null;         }         @Override         protected void onPostExecute(Bitmap result) {             mImageView.setImageBitmap(result);             super.onPostExecute(result);         }         @Override         protected void onPreExecute() {             mImageView.setImageResource(R.drawable.ic_launcher);             super.onPreExecute();         }     }     private ImageView mImageView;     private ImageCacheManager imageCacheManager;
}</td>
</tr>
</tbody>
</table>
10.Handler机制
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"></td>
</tr>
</tbody>
</table>
11.什么是ANR 如何避免它？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">ANR：Application NotResponding，五秒
在Android中，活动管理器和窗口管理器这两个系统服务负责监视应用程序的响应。当出现下列情况时，Android就会显示ANR对话框了：
对输入事件(如按键、触摸屏事件)的响应超过5秒
意向接受器(intentReceiver)超过10秒钟仍未执行完毕
Android应用程序完全运行在一个独立的线程中(例如main)。这就意味着，任何在主线程中运行的，需要消耗大量时间的操作都会引发ANR。因为此时，你的应用程序已经没有机会去响应输入事件和意向广播(Intentbroadcast)。
因此，任何运行在主线程中的方法，都要尽可能的只做少量的工作。特别是活动生命周期中的重要方法如onCreate()和 onResume()等更应如此。潜在的比较耗时的操作，如访问网络和数据库;或者是开销很大的计算，比如改变位图的大小，需要在一个单独的子线程中完成(或者是使用异步请求，如数据库操作)。但这并不意味着你的主线程需要进入阻塞状态已等待子线程结束 -- 也不需要调用Therad.wait()或者Thread.sleep()方法。取而代之的是，主线程为子线程提供一个句柄(Handler)，让子线程在即将结束的时候调用它(xing:可以参看Snake的例子，这种方法与以前我们所接触的有所不同)。使用这种方法涉及你的应用程序，能够保证你的程序对输入保持良好的响应，从而避免因为输入事件超过5秒钟不被处理而产生的ANR。这种实践需要应用到所有显示用户界面的线程，因为他们都面临着同样的超时问题。</td>
</tr>
</tbody>
</table>
12.sqlite操作使用
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="middle">本帖最后由 y_m 于 2013-6-2 00:27 编辑<strong>SQLite数据库</strong>
数据库:它就是一个软件，需要安装，安装完后就有自己的目录结构。
都有客户端和服务端，所有的数据库都实现了SQL标准
SQLite数据库:它是一个轻量级数据库，设计目的是嵌入式的，而且它占用的资源非常少
注意:除了主键不能存储任意的类型之外，其他的字段可以存放任意的数据类型
SqliteDatabase它要求:表的主键的字段名最好是_id，一定要_id  否则报错;<strong>Cmd操作指令：</strong>
sqlite3 qjq.db 进入数据库
.tables 查看数据库里面的表
<strong>创建数据库文件：</strong>
三种方式：
第一种通过上下文创建数据库：
public class DBsqlite {
private Context context;
public DBsqlite(Context context) {
super();
this.context = context;
}
public void createDB() {
//通过上下文创建数据库
context.openOrCreateDatabase("persons.db", Context.MODE_PRIVATE, null);
}
｝
第二种SQLiteDatabase创建数据库
public void createDB(){
String dir="/data/data/"+context.getPackageName();
File file=new File(dir,"persons.db");
SQLiteDatabase.openOrCreateDatabase(file, null);
}
第三种创建一个help类继承SQLiteOpenHelper
实现DBhelp构造onCreate方法onUpgrade方法
public class DBhelp extends SQLiteOpenHelper {
public DBhelp(Context context) {
//                上下文        ，数据库名，游标工厂 ，数据版本
super(context, "persons.db", null, 2);
// TODO Auto-generated constructor stub
}
//数据库第一次创建之后调用该方法。创建表、视图。。。 或者初始化表信息
public void onCreate(SQLiteDatabase db) {
// 创建数据库
db.execSQL("create table fish(_id integer primary key autoincrement,name text)");
}
@Override
//当数据版本被改变则会执行该方法super(context, "persons.db", null, 3)；
public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
// 版本修改表添加一列
db.execSQL("ALTER TABLE fish ADD amount integer");
}
<strong>Crud</strong>
以下分别用两种方式crud了，一种是面向SQL ，一种是面向对象，但是面向对象的源码里面其实也是在帮你拼接sql。
public class OtherFishService {
private SQLiteOpenHelper mOpenHelper;
public OtherFishService(Context context) {
// TODO Auto-generated constructor stub
mOpenHelper = new DBHelper(context);
}
/**
* 插入数据
* @param name
*/
public void insert(String name){
SQLiteDatabase db = mOpenHelper.getWritableDatabase();
//                String sql = "insert into fish(name) values(?)";
if(db.isOpen()){
//                        db.execSQL(sql, new Object[]{name});
//insert into fish
//ContentValues里面就是要插入的值
ContentValues values = new ContentValues();
values.put("name", name);
db.insert("fish", "_id", values);
db.close();
}
}
public List&lt;Fish&gt; query(){
List&lt;Fish&gt; fishs = new ArrayList&lt;Fish&gt;();
SQLiteDatabase db = mOpenHelper.getReadableDatabase();
//                String sql ="select * from fish";
if(db.isOpen()){
//cursor 就是resultset
//                        Cursor cursor = db.rawQuery(sql, null);
Cursor cursor = db.query("fish",//表名
new String[]{"*"},//要查询的列名
null,//查询条件
null,//条件参数
null,//分组
null,//条件
null);//排序
while(cursor.moveToNext()){
//得到_id的下标
int column_index = cursor.getColumnIndex("_id");
//得到_id的值
int _id = cursor.getInt(column_index);
String name = cursor.getString(cursor.getColumnIndex("name"));
Fish fish = new Fish(_id, name);
fishs.add(fish);
}
//cursor使用完成之后一定要关闭
cursor.close();
db.close();
}
return fishs;
}
public void update(Fish fish){
SQLiteDatabase db = mOpenHelper.getWritableDatabase();
if(db.isOpen()){
//                        String sql = "update Fish set name = ? where _id = ?";
//                        db.execSQL(sql,new Object[]{fish.name,fish._id});
ContentValues values = new ContentValues();
values.put("name",<span style="text-decoration: underline;">fish.name</span>);
String whereClause = " _id = ?";
String[] whereArgs = new String[]{fish._id+""};
db.update("fish", values, whereClause, whereArgs);
}
}
public void delete(int _id){
SQLiteDatabase db = mOpenHelper.getWritableDatabase();
if(db.isOpen()){
//                        String sql = "delete from fish where _id = ?";
//                        db.execSQL(sql,new Object[]{_id});
String whereClause = " _id = ?";
String[] whereArgs = new String[]{_id+""};
db.delete("fish", whereClause, whereArgs);
}
}
}
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="middle"><strong>SqliteDatabase事务列表显示多条数据</strong><strong>事务，以及事务的完整性SQLiteDatabase控制事务方法：</strong>
beginTransaction();        开启事务
setTransactionSuccessful();        设置事务成功
endTransaction();结束事务
db.beginTransaction();                //开始事务
try {
db.execSQL("update student set amount=amount-300 where name=?", new Object[]{"张三"});
db.execSQL("update student set amount=amount+300 where name=?", new Object[]{"李四"});
db.setTransactionSuccessful();         //设置事务成功} catch (Exception e) {
System.out.println("事务执行出现异常，不能设置事务成功！");
}finally{
//无论是否出现异常，都要结束事务。
db.endTransaction();
}
<strong>cmd常见指令：</strong>
Sqlite3 xx.db                查看xx数据库
.tables                        查看所有表
.exit                                退出
.databases                查看所有数据库
<strong>标签：</strong>
include标签实现组件复用
将另一个布局文件加载到当前布局文件，实现组件复用
&lt;!-- 加载一个布局文件 --&gt;
&lt;include layout="@layout/item"/&gt;
属性 android:visibility=有三个选项
&lt;!--
Visible :可见
都是不可见
invisible : 还占据空间
gone：不占据空间
--&gt;
<strong>列表显示多条数据 simpleAdapter</strong>
代码：
OtherFishService ofs = new OtherFishService(this);
List&lt;Fish&gt; fishs = ofs.query();
List&lt;Map&lt;String,Object&gt;&gt;data=new ArrayList&lt;Map&lt;String,Object&gt;&gt;();
for(Fish f:fishs){
Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;();
map.put("_id", f._id);
map.put("name",<span style="text-decoration: underline;">f.name</span>);
map.put("age", f.age);
data.add(map);
}
String[] from = new String[]{"_id","name","age"};
int[] to = new int[]{R.id.tv_id,R.id.tv_name,R.id.tv_age};
SimpleAdapter adapter = new SimpleAdapter(this,
data,
R.layout.item,
from,
to);
lv.setAdapter(adapter);
以上可以实现但是过于麻烦！
我们还可以使用专门为数据库提供的
Cursoradapter
OtherFishService ofs = new OtherFishService(this);
Cursor c = ofs.getAllCursor();
String[] from = new String[]{"_id","name","age"};
int[] to = new int[]{R.id.tv_id,R.id.tv_name,R.id.tv_age};
SimpleCursorAdapter adapter = new SimpleCursorAdapter(
this,
R.layout.item,
c,
from,
to);
lv.setAdapter(adapter);
我们不单单只用android给我们提过的CursorAdapter我们还可以自定义一个CursorAdapter
<strong>自定义</strong><strong>CursorAdapter</strong>
public class MyCursorAdapter extends CursorAdapter {
//布局加载器（是一个服务，用来加载xml布局文件到java代码中）
private LayoutInflater mInflater;public MyCursorAdapter(Context context, Cursor c) {
super(context, c);
mInflater=(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);

mInflater = LayoutInflater.from(context);

}
//创建一个item的布局
@Override
public View newView(Context context, Cursor cursor, ViewGroup parent) {
// TODO Auto-generated method stub
//通过布局加载器加载布局
View view = mInflater.inflate(R.layout.item, null);
return view;
}
//把数据绑定给item里面的布局
@Override
public void bindView(View view, Context context, Cursor cursor) {
// TODO Auto-generated method stub
//1 先得到控件
//2 得到数据
//3 绑定数据给控件
TextView tv_id = (TextView) view.findViewById(R.id.tv_id);
TextView tv_name = (TextView) view.findViewById(R.id.tv_name);
TextView tv_age = (TextView) view.findViewById(R.id.tv_age);

String _id = cursor.getString(0);
String name = cursor.getString(1);
String age = cursor.getString(2);

tv_id.setText(_id);
tv_name.setText(name);
tv_age.setText(age);

int position = cursor.getPosition();
if(position%2 ==0){
view.setBackgroundColor(Color.RED);
}else{
view.setBackgroundColor(Color.GREEN);
}

}
}
为了实现 我们想要的并且系统没提供的效果所以我们要自定义Adapter
不仅可以继承CursorAdapter 实现自定义CursorAdapter ，我们还可以通
过继承BaseAdapter 。
private class MyCursorAdapter extends BaseAdapter {
private Context context;
private Cursor c;
private LayoutInflater mInflater;

public MycursorAdapter1(Context context, Cursor c) {
super();
this.context = context;
this.c = c;
mInflater = (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);
}
@Override
public int getCount() {
// TODO Auto-generated method stub
return c.getCount();
}
@Override
public Object getItem(int position) {
Person p = null;
if (c.moveToPosition(position)) {
String id = c.getString(0);
String name = c.getString(1);
String age = c.getString(2);
p = new Person(id, name, age);
}
return p;
}
@Override
public long getItemId(int position) {
// TODO Auto-generated method stub
return position;
}
@Override
public View getView(int position, View convertView, ViewGroup parent) {
//1得到视图
//2从视图中拿到要显示对象
//3从cursor里面拿值
//4绑定
//5返回
注意：getView方法实际会执行原本次数2倍（例：7条数据与，getView执行7*2次），第一遍执行是为了测试有多少条数据，第2遍执行才是真正的现实操作
View view = mInflater.inflate(R.layout.item, null);
TextView tv_id = (TextView) view.findViewById(R.id.bt_id);
TextView tv_name = (TextView) view.findViewById(R.id.bt_name);
TextView tv_age = (TextView) view.findViewById(R.id.bt_age);
if (c.moveToPosition(position)) {
String id = c.getString(0);
String name = c.getString(1);
String age = c.getString(2);
tv_id.setText(id);
tv_name.setText(name);
tv_age.setText(age);

}
if ( position% 2 == 0) {
view.setBackgroundColor(Color.RED);
}
return view;
}
}
当我们用完cursor的时候，怎么关闭他？
//应用回收资源  退出程序时调用该方法
@Override
protected void onDestroy() {
// TODO Auto-generated method stub
super.onDestroy();r
Cursor c = adapter.getCursor();
if(c != null &amp;&amp; !c.isClosed()){
c.close();
}
}</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
13请描述一下Intent 和 Intent Filter。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android 中通过 Intent 对象来表示一条消息，一个 Intent 对象不仅包含有这个消息的目的地，还可以包含消息的内容，这好比一封Email，其中不仅应该包含收件地址，还可以包含具体的内容。对于一个 Intent 对象，消息“目的地”是必须的，而内容则是可选项。
通过Intent 可以实现各种系统组件的调用与激活.Intent filter: 可以理解为邮局或者是一个信笺的分拣系统…
这个分拣系统通过3个参数来识别
Action: 动作    view
Data: 数据uri   uri
Category : 而外的附加信息
Action 匹配
Action 是一个用户定义的字符串，用于描述一个 Android 应用程序组件，一个 Intent Filter 可以包含多个 Action。在 AndroidManifest.xml 的 Activity 定义时可以在其 &lt;intent-filter &gt;节点指定一个 Action 列表用于标示 Activity 所能接受的“动作”，例如：
&lt;intent-filter &gt;
&lt;action android:name="android.intent.action.MAIN" /&gt;
&lt;action android:name="cn.itcast.action" /&gt;
……
&lt;/intent-filter&gt;如果我们在启动一个 Activity 时使用这样的 Intent 对象：
Intent intent =new Intent();
intent.setAction("cn.itcast.action");
startActivity(intent);

那么所有的 Action 列表中包含了“cn.itcast”的 Activity 都将会匹配成功。
Android 预定义了一系列的 Action 分别表示特定的系统动作。这些 Action 通过常量的方式定义在 android.content. Intent中，以“ACTION_”开头。我们可以在 Android 提供的文档中找到它们的详细说明。
URI 数据匹配
一个 Intent 可以通过 URI 携带外部数据给目标组件。在 &lt;intent-filter &gt;节点中，通过 &lt;data/&gt;节点匹配外部数据。
mimeType 属性指定携带外部数据的数据类型，scheme 指定协议，host、port、path 指定数据的位置、端口、和路径。如下：
&lt;data android:mimeType="mimeType" android:scheme="scheme"
android:host="host" android:port="port" android:path="path"/&gt;
Intent intent = new Intent();
intent.setAction(Intent.ACTION_CALL);
insent.setData( Uri.parse(tel:12345));
startAcitivty();
电话的uri   tel: 12345
<span style="text-decoration: underline;">http://www.baidu.com</span>
自己定义的uri  itcast://cn.itcast/person/10

如果在 Intent Filter 中指定了这些属性，那么只有所有的属性都匹配成功时 URI 数据匹配才会成功。
Category 类别匹配
&lt;intent-filter &gt;节点中可以为组件定义一个 Category 类别列表，当 Intent 中包含这个列表的所有项目时 Category 类别匹配才会成功。
默认是DEFAULT</td>
</tr>
</tbody>
</table>
14.Intent传递数据时，可以传递哪些类型数据？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">1.一般的基本数据类型  Intent .putextra() intent.getextra();
Parselable Serializable2.数据的uri, intent.setData() intent.getData();</td>
</tr>
</tbody>
</table>
15.Android事件传递机制
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android中dispatchTouchEvent,onInterceptTouchEvent, onTouchEvent的理解ec
android中的事件类型分为按键事件和屏幕触摸事件，Touch事件是屏幕触摸事件的基础事件，有必要对它进行深入的了解。 一个最简单的屏幕触摸动作触发了一系列Touch事件：ACTION_DOWN-&gt;ACTION_MOVE-&gt;ACTION_MOVE-&gt;ACTION_MOVE...-&gt;ACTION_MOVE-&gt;ACTION_UP
android的事件处理分为3步。
1）public booleandispatchTouchEvent(MotionEvent ev)  这个方法用来分发TouchEvent 2）public boolean onInterceptTouchEvent(MotionEvent ev) 这个方法用来拦截TouchEvent 3）public boolean onTouchEvent(MotionEvent ev) 这个方法用来处理TouchEvent
假设当前Activity 布局如下：<strong>dispatchTouchEvent事件分发</strong>
当TouchEvent发生时，首先Activity将TouchEvent传递给最顶层的View， TouchEvent最先到达最顶层 view 的 dispatchTouchEvent 。然后由  dispatchTouchEvent 方法进行分发，如果dispatchTouchEvent返回true ，则交给这个view的onTouchEvent处理，如果dispatchTouchEvent返回 false ，则交给这个 view 的 onInterceptTouchEvent方法来决定是否要拦截这个事件，
如果onInterceptTouchEvent返回 true ，也就是拦截掉了，则交给它的 onTouchEvent 来处理，如果onInterceptTouchEvent返回 false ，那么就传递给子 view，由子 view 的 dispatchTouchEvent 再来开始这个事件的分发。
如图：<strong>事件拦截：onInterceptTouchEvent</strong>
onInterceptTouchEvent用于改变事件的传递方向。决定传递方向的是返回值，返回为false时事件会传递给子控件，返回值为true时事件会传递给当前控件的onTouchEvent()，这就是所谓的Intercept(拦截)。
[tisa ps:正确的使用方法是，在此方法内仅判断事件是否需要拦截，然后返回。即便需要拦截也应该直接返回true，然后由onTouchEvent方法进行处理。]
onTouchEvent用于处理事件，返回值决定当前控件是否消费（consume）了这个事件。尤其对于ACTION_DOWN事件，返回true，表示我想要处理后续事件（ACTION_MOVE或者ACTION_UP）；返回false，表示不关心此事件，并返回由父类进行处理。
在没有重写onInterceptTouchEvent()和onTouchEvent()的情况下(他们的返回值都是false), 对上面这个布局，MotionEvent事件的传递顺序如下：

当某个控件的onInterceptTouchEvent()返回值为true时，就会发生截断，事件被传到当前控件的onTouchEvent()。如我们将LayoutView2的onInterceptTouchEvent()返回值为true,则传递流程变成：

如果我们同时将LayoutView2的onInterceptTouchEvent()和onTouchEvent()设置成true，那么LayoutView2将消费被传递的事件，同时后续事件（如跟着ACTION_DOWN的ACTION_MOVE或者ACTION_UP）会直接传给LayoutView2的onTouchEvent(),不传给其他任何控件的任何函数。同时传递给子空间一个ACTION_CANCEL事件。传递流程变成（图中没有画出ACTION_CANCEL事件）：

小总结：onInterceptTouchEvent是自rootiew向下传递, onTouchEvent正好相反。</td>
</tr>
</tbody>
</table>
16.请介绍下Android中常用的五种布局。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">FrameLayout（帧布局），LinearLayout （线性布局），AbsoluteLayout（绝对布局），RelativeLayout（相对布局），TableLayout（表格布局）
FrameLayout
从屏幕的左上角开始布局,叠加显示, 实际应用 播放器的暂停按钮.
LinearLayout
线性布局，这个东西，从外框上可以理解为一个div，他首先是一个一个从上往下罗列在屏幕上。每一个LinearLayout里面又可分为垂直布局
（android:orientation="vertical"）和水平布局（android:orientation="horizontal"
）。当垂直布局时，每一行就只有一个元素，多个元素依次垂直往下；水平布局时，只有一行，每一个元素依次向右排列。
AbsoluteLayout
绝对布局犹如div指定了absolute属性，用X,Y坐标来指定元素的位置android:layout_x="20px"  view
android:layout_y="12px" fwvga 854*480apk
qq斗地主 qq游戏大厅800*480 800*480.apk  fwvga  854*480
指定平板机型的游戏开发中经常用到绝对布局  widget 绝对布局
指定机型的平板游戏开发. 2.3 3.0
1.  界面布局  任务管理器 gridview
2.  手机 任务管理 listviewlephone
lepad
RelativeLayout
相对布局可以理解为某一个元素为参照物，来定位的布局方式。主要属性有：
相对于某一个元素
android:layout_below="@id/aaa" 该元素在 id为aaa的下面
android:layout_toLeftOf="@id/bbb" 改元素的左边是bbb
相对于父元素的地方
android:layout_alignParentLeft="true"  在父元素左对齐
android:layout_alignParentRight="true" 在父元素右对齐Android  oa客户端.
TableLayout &lt;table&gt;
表格布局类似Html里面的Table。每一个TableLayout里面有表格行TableRow，TableRow里面可以具体定义每一个元素，设定他的对齐方式android:gravity="" 。
每一个布局都有自己适合的方式，另外，这五个布局元素可以相互嵌套应用，做出美观的界面。
oa  自动化 生成报表 ,图标 表示   webview
css div
webview</td>
</tr>
</tbody>
</table>
17.谈谈UI中，Padding和Margin有什么区别？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Padding 文字对边框, margin是控件对父窗体.
Padding 盒子里面的内容距离盒子的距离 , margin 盒子与盒子之间的距离</td>
</tr>
</tbody>
</table>
18.请解释下在单线程模型中Message、Handler、Message Queue、Looper之间的关系。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">简单的说，<strong>Handler</strong>获取当前线程中的looper对象，looper用来从存放Message的MessageQueue中取出Message，再有Handler进行Message的分发和处理.
<strong>Message Queue(消息队列)</strong>：用来存放通过Handler发布的消息，通常附属于某一个创建它的线程，可以通过Looper.myQueue()得到当前线程的消息队列.
<strong>Handler：</strong>可以发布或者处理一个消息或者操作一个Runnable，通过Handler发布消息，消息将只会发送到与它关联的消息队列，然也只能处理该消息队列中的消息.
<strong>Looper：</strong>是Handler和消息队列之间通讯桥梁，程序组件首先通过Handler把消息传递给Looper，Looper把消息放入队列。Looper也把消息队列里的消息广播给所有的Handler：Handler接受到消息后调用handleMessage进行处理.
<strong>Message：</strong>消息的类型，在Handler类中的handleMessage方法中得到单个的消息进行处理,在单线程模型下，为了线程通信问题，Android设计了一个Message Queue(消息队列)，线程间可以通过该Message Queue并结合Handler和Looper组件进行信息交换。下面将对它们进行分别介绍：
<strong>1. Message</strong>
Message消息，理解为线程间交流的信息，处理数据后台线程需要更新UI，则发送Message内含一些数据给UI线程。
<strong>2. Handler</strong>
Handler处理者，是Message的主要处理者，负责Message的发送，Message内容的执行处理。后台线程就是通过传进来的 Handler对象引用来sendMessage(Message)。而使用Handler，需要implement 该类的 handleMessage(Message)方法，它是处理这些Message的操作内容，例如Update UI。通常需要子类化Handler来实现handleMessage方法。
<strong>3. Message Queue</strong>
Message Queue消息队列，用来存放通过Handler发布的消息，按照先进先出执行。
每个message queue都会有一个对应的Handler。Handler会向message queue通过两种方法发送消息：sendMessage或post。这两种消息都会插在message queue队尾并按先进先出执行。但通过这两种方法发送的消息执行的方式略有不同：通过sendMessage发送的是一个message对象,会被 Handler的handleMessage()函数处理；而通过post方法发送的是一个runnable对象，则会自己执行。
<strong>4. Looper</strong>
Looper是每条线程里的Message Queue的管家。Android没有Global的Message Queue，而Android会自动替主线程(UI线程)建立Message Queue，但在子线程里并没有建立Message Queue。所以调用Looper.getMainLooper()得到的主线程的Looper不为NULL，但调用Looper.myLooper() 得到当前线程的Looper就有可能为NULL。对于子线程使用Looper，API Doc提供了正确的使用方法：这个Message机制的大概流程：
1. 在Looper.loop()方法运行开始后，循环地按照接收顺序取出Message Queue里面的非NULL的Message。
2. 一开始Message Queue里面的Message都是NULL的。当Handler.sendMessage(Message)到Message Queue，该函数里面设置了那个Message对象的target属性是当前的Handler对象。随后Looper取出了那个Message，则调用该Message的target指向的Hander的dispatchMessage函数对Message进行处理。在dispatchMessage方法里，如何处理Message则由用户指定，三个判断，优先级从高到低：
1) Message里面的Callback，一个实现了Runnable接口的对象，其中run函数做处理工作；
2) Handler里面的mCallback指向的一个实现了Callback接口的对象，由其handleMessage进行处理；
3) 处理消息Handler对象对应的类继承并实现了其中handleMessage函数，通过这个实现的handleMessage函数处理消息。
由此可见，我们实现的handleMessage方法是优先级最低的！
3. Handler处理完该Message (update UI) 后，Looper则设置该Message为NULL，以便回收！
在网上有很多文章讲述主线程和其他子线程如何交互，传送信息，最终谁来执行处理信息之类的，个人理解是最简单的方法——判断Handler对象里面的Looper对象是属于哪条线程的，则由该线程来执行！
1. 当Handler对象的构造函数的参数为空，则为当前所在线程的Looper；
2. Looper.getMainLooper()得到的是主线程的Looper对象，Looper.myLooper()得到的是当前线程的Looper对象。</td>
</tr>
</tbody>
</table>
19.AIDL的全称是什么？如何工作？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">AIDL的英文全称是Android Interface Define Language当A进程要去调用B进程中的service时，并实现通信，我们通常都是通过AIDL来操作的A工程：首先我们在net.blogjava.mobile.aidlservice包中创建一个RemoteService.aidl文件，在里面我们自定义一个接口，含有方法get。ADT插件会在gen目录下自动生成一个RemoteService.java文件，该类中含有一个名为RemoteService.stub的内部类，该内部类中含有aidl文件接口的get方法。说明一：aidl文件的位置不固定，可以任意然后定义自己的MyService类，在MyService类中自定义一个内部类去继承RemoteService.stub这个内部类，实现get方法。在onBind方法中返回这个内部类的对象，系统会自动将这个对象封装成IBinder对象，传递给他的调用者。其次需要在AndroidManifest.xml文件中配置MyService类，代码如下：&lt;!-- 注册服务 --&gt;  &lt;service android:name=".MyService"&gt;    &lt;intent-filter&gt;    &lt;!--  指定调用AIDL服务的ID  --&gt;        &lt;action android:name="net.blogjava.mobile.aidlservice.RemoteService" /&gt;     &lt;/intent-filter&gt; &lt;/service&gt;为什么要指定调用AIDL服务的ID,就是要告诉外界MyService这个类能够被别的进程访问，只要别的进程知道这个ID，正是有了这个ID,B工程才能找到A工程实现通信。说明：AIDL并不需要权限B工程：      首先我们要将A工程中生成的RemoteService.java文件拷贝到B工程中，在bindService方法中绑定aidl服务      绑定AIDL服务就是将RemoteService的ID作为intent的action参数。      说明：如果我们单独将RemoteService.aidl文件放在一个包里，那个在我们将gen目录下的该包拷贝到B工程中。如果我们将RemoteService.aidl文件和我们的其他类存放在一起，那么我们在B工程中就要建立相应的包，以保证RmoteService.java文件的报名正确，我们不能修改RemoteService.java文件           bindService(new Inten("net.blogjava.mobile.aidlservice.RemoteService"), serviceConnection, Context.BIND_AUTO_CREATE);        ServiceConnection的onServiceConnected(ComponentName name, IBinder service)方法中的service参数就是A工程中MyService类中继承了RemoteService.stub类的内部类的对象。</td>
</tr>
</tbody>
</table>
20.请解释下Android程序运行时权限与文件系统权限的区别。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android程序执行需要读取到安全敏感项必需在androidmanifest.xml中声明相关权限请求, 打电话,访问网络,获取坐标,读写sd卡,读写联系人等..安装的时候会提示用户…文件系统的权限是linux权限. 比如说sharedpreference里面的Context.Mode.private  Context.Mode.world_read_able   Context.Mode_world_writeable
777自己 同组 其他</td>
</tr>
</tbody>
</table>
21.系统上安装了多种浏览器，能否指定某浏览器访问指定页面
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"> Intent intent =newIntent();
intent.setAction("android.intent.action.VIEW");
Uri content_url =Uri.parse("<span style="text-decoration: underline;">http://www.163.com</span>");
intent.setData(content_url);
intent.setClassName("com.android.browser","com.android.browser.BrowserActivity");
startActivity(intent);
只要修改以intent.setClassName("com.android.browser","com.android.browser.BrowserActivity");
中相应的应用程序packagename 和要启动的activity即可启动其他浏览器来
uc浏览器"："com.uc.browser", "com.uc.browser.ActivityUpdate“
opera浏览器："com.opera.mini.android", "com.opera.mini.android.Browser"
qq浏览器："com.tencent.mtt", "com.tencent.mtt.MainActivity"</td>
</tr>
</tbody>
</table>
22.对android主线程的运用和理解。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">主ui线程不能执行耗时的操作</td>
</tr>
</tbody>
</table>
23.对android虚拟机的理解，包括内存管理机制垃圾回收机制。dalvik和art区别
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">虚拟机很小,空间很小,谈谈移动设备的虚拟机的大小限制 16M ,
谈谈加载图片的时候怎么处理大图片的,
outmemoryException
BitmapFactory.option
垃圾回收,没有引用的对象,在某个时刻会被系统gc掉 .<strong>Dalvik和标准Java</strong>虚拟机<strong>(JVM)首要差别</strong>
Dalvik 基于寄存器，而 JVM 基于栈。
基于寄存器的虚拟机对于编译后变大的程序来说，在它们执行的时候，花费的时间更短。
<strong>Dalvik和Java运行环境的区别</strong>
1：Dalvik主要是完成对象生命周期管理，堆栈管理，线程管理，安全和异常管理，以及垃圾回收等等重要功能。
2：Dalvik负责进程隔离和线程管理，每一个Android应用在底层都会对应一个独立的Dalvik虚拟机实例，其代码在虚拟机的解释下得以执行。
3：不同于Java虚拟机运行java字节码，Dalvik虚拟机运行的是其专有的文件格式Dex
4:dex文件格式可以减少整体文件尺寸，提高I/o操作的类查找速度。
5:odex是为了在运行过程中进一步提高性能，对dex文件的进一步优化。
6：所有的Android应用的线程都对应一个Linux线程，虚拟机因而可以更多的依赖操作系统的线程调度和管理机制
7：有一个特殊的虚拟机进程Zygote，他是虚拟机实例的孵化器。它在系统启动的时候就会产生，它会完成虚拟机的初始化，库的加载，预制类库和初始化的操作。如果系统需要一个新的虚拟机实例，它会迅速复制自身，以最快的数据提供给系统。对于一些只读的系统库，所有虚拟机实例都和Zygote共享一块内存区域。
8：Dalvik是由Dan Bornstein编写的，名字来源于他的祖先曾经居住过名叫Dalvík的小渔村，村子位于冰岛Eyjafj&amp;ouml;r&amp;eth;ur许多GC实现都是在对象开头的地方留一小块空间给GC标记用。Dalvik VM则不同，在进行GC的时候会单独申请一块空间，以位图的形式来保存整个堆上的对象的标记，在GC结束后就释放该空间。
dalvik是执行的时候编译+运行，安装比较快，开启应用比较慢，应用占用空间小ART是安装的时候就编译好了，执行的时候直接就可以运行的，安装慢，开启应用快，占用空间大用个比喻来说就是，骑自行车dalvik 是已经折叠起来的自行车，每次骑都要先组装自行车才能骑ART 是已经组装好的自行车，每次骑直接上车就能走人效率高在开启的时候，运行中的速度是差不多的</td>
</tr>
</tbody>
</table>
24.Framework工作方式及原理，Activity是如何生成一个view的，机制是什么。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">主要用到反射和代理的知识。主要用pull解析xml，然后通过反射得到属性，在onDrew画出来反射 , 配置文件
可以讲下activity的源码,比如说 每个activity里面都有window.callback和keyevent.callback,一些回调的接口或者函数吧. 框架把activity创建出来就会调用里面的这些回调方法,会调用activity生命周期相关的方法.Activity创建一个view是通过ondraw 画出来的, 画这个view之前呢,还会调用onmeasure方法来计算显示的大小.</td>
</tr>
</tbody>
</table>
25.android本身的一些限制，比如apk包大小限制，读取大文件时的时间限
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">这个问题问的有问题, apk包大小限制不好说,
极品飞车有100M 还是能装到手机上,
世面google market 上大程序  主程序 很小 5~10M    下载sdcard
200~300M
15分钟之内 申请退款
apk包,精简包, 素材存放在服务器. 游戏程序.读大文件的时间限制应该是main线程里面的时间限制吧.5秒.</td>
</tr>
</tbody>
</table>
26.Android程序与Java程序的区别？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android程序用android sdk开发,java程序用javasdk开发.
Android SDK引用了大部分的Java SDK，少数部分被Android SDK抛弃，比如说界面部分，java.awt  swing  package除了java.awt.font被引用外，其他都被抛弃，在Android平台开发中不能使用。 android sdk 添加工具jar httpclient , pull  opengl将Java 游戏或者j2me程序移植到Android平台的过程中，
Android  SDK 与Java SDK的区别是很需要注意的地方。
sampleDataAdpter("YY-MM-DD")</td>
</tr>
</tbody>
</table>
27.Android中Task任务栈的分配
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">首先我们来看下Task的定义，Google是这样定义Task的：a task is what the user experiences as an "application." It's a group of related activities, arranged in a stack. A task is a stack of activities, not a class or an element in the manifest file. 这意思就是说Task实际上是一个Activity栈，通常用户感受的一个Application就是一个Task。从这个定义来看，Task跟Service或者其他Components是没有任何联系的，它只是针对Activity而言的。
Activity有不同的启动模式, 可以影响到task的分配
Task，简单的说，就是一组以栈的模式聚集在一起的Activity组件集合。它们有潜在的前后驱关联，新加入的Activity组件，位于栈顶，并仅有在栈顶的Activity，才会有机会与用户进行交互。而当栈顶的Activity完成使命退出的时候，Task会将其退栈，并让下一个将跑到栈顶的Activity来于用户面对面，直至栈中再无更多Activity，Task结束。
<table cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="middle"><strong>事件</strong></td>
<td valign="middle"><strong>Task栈（粗体为栈顶组件）</strong></td>
</tr>
<tr>
<td valign="middle">点开Email应用，进入收件箱（Activity A）</td>
<td valign="middle"><strong>A</strong></td>
</tr>
<tr>
<td valign="middle">选中一封邮件，点击查看详情（Activity B）</td>
<td valign="middle">A<strong>B</strong></td>
</tr>
<tr>
<td valign="middle">点击回复，开始写新邮件（Activity C）</td>
<td valign="middle">AB<strong>C</strong></td>
</tr>
<tr>
<td valign="middle">写了几行字，点击选择联系人，进入选择联系人界面（Activity D）</td>
<td valign="middle">ABC<strong>D</strong></td>
</tr>
<tr>
<td valign="middle">选择好了联系人，继续写邮件</td>
<td valign="middle">AB<strong>C</strong></td>
</tr>
<tr>
<td valign="middle">写好邮件，发送完成，回到原始邮件</td>
<td valign="middle">A<strong>B</strong></td>
</tr>
<tr>
<td valign="middle">点击返回，回到收件箱</td>
<td valign="middle"><strong>A</strong></td>
</tr>
<tr>
<td valign="middle">退出Email程序</td>
<td valign="middle">null</td>
</tr>
</tbody>
</table>
如上表所示，是一个实例。从用户从进入邮箱开始，到回复完成，退出应用整个过程的Task栈变化。这是一个标准的栈模式，对于大部分的状况，这样的Task模型，足以应付，但是，涉及到实际的性能、开销等问题，就会变得残酷许多。

比如，启动一个浏览器，在Android中是一个比较沉重的过程，它需要做很多初始化的工作，并且会有不小的内存开销。但与此同时，用浏览器打开一些内容，又是一般应用都会有的一个需求。设想一下，如果同时有十个运行着的应用（就会对应着是多个Task），都需要启动浏览器，这将是一个多么残酷的场面，十个Task栈都堆积着很雷同的浏览器Activity，
是多么华丽的一种浪费啊。
于是你会有这样一种设想，浏览器Activity，可不可以作为一个单独的Task而存在，不管是来自那个Task的请求，浏览器的Task，都不会归并过去。这样，虽然浏览器Activity本身需要维系的状态更多了，但整体的开销将大大的减少，这种舍小家为大家的行为，还是很值得歌颂的
standard", "singleTop", "singleTask", "singleInstance"。

standard模式， 是默认的也是标准的Task模式，在没有其他因素的影响下，使用此模式的Activity，会构造一个Activity的实例，加入到调用者的Task栈中去，对于使用频度一般开销一般什么都一般的Activity而言，standard模式无疑是最合适的，因为它逻辑简单条理清晰，所以是默认的选择。

而singleTop模式，基本上于standard一致，仅在请求的Activity正好位于栈顶时，有所区别。此时，配置成singleTop的Activity，不再会构造新的实例加入到Task栈中，而是将新来的Intent发送到栈顶Activity中，栈顶的Activity可以通过重载onNewIntent来处理新的Intent（当然，也可以无视...）。这个模式，降低了位于栈顶时的一些重复开销，更避免了一些奇异的行为（想象一下，如果在栈顶连续几个都是同样的Activity，再一级级退出的时候，这是怎么样的用户体验...），很适合一些会有更新的列表Activity展示。一个活生生的实例是，在Android默认提供的应用中，浏览器（Browser）的书签Activity（BrowserBookmarkPage），就用的是singleTop。

singleTask，和singleInstance，则都采取的另辟Task的蹊径。
标志为singleTask的Activity，最多仅有一个实例存在，并且，位于以它为根的Task中。所有对该Activity的请求，都会跳到该Activity的Task中展开进行。singleTask，很象概念中的单件模式，所有的修改都是基于一个实例，这通常用在构造成本很大，但切换成本较小的Activity中。最典型的例子，还是浏览器应用的主Activity（名为Browser...），它是展示当前tab，当前页面内容的窗口。它的构造成本大，但页面的切换还是较快的，于singleTask相配，还是挺天作之合的。

singleInstance显得更为极端一些。在大部分时候singleInstance与singleTask完全一致，唯一的不同在于，singleInstance的Activity，是它所在栈中仅有的一个Activity，如果涉及到的其他Activity，都移交到其他Task中进行。这使得singleInstance的Activity，像一座孤岛，彻底的黑盒，它不关注请求来自何方，也不计较后续由谁执行。在Android默认的各个应用中，很少有这样的Activity，在我个人的工程实践中，曾尝试在有道词典的快速取词Activity中采用过，
是因为我觉得快速取词入口足够方便（从notification中点选进入），并且会在各个场合使用，应该做得完全独立。

大的apk 拆成 很多小的apk
●Activity的android:affinity属性
1.配置后 当启动这个activity时就先去找有没有activity的亲和力属性相同 有就加入这个
activity所在的任务中没有就新开任务
2.affinity起作用需要的条件而者具备一个:
1.intent包含FLAG_ACTIVITY_NEW_TASK标记
2.activity元素启用了allowTaskReparenting属性.</td>
</tr>
</tbody>
</table>
28.在Android中，怎么节省内存的使用，怎么主动回收内存？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">  回收已经使用的资源,
合理的使用缓存
合理设置变量的作用范围…
application 对象
//未来的某一段时间执行
System.gc();</td>
</tr>
</tbody>
</table>
29.不同工程中的方法是否可以相互调用？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">可以,列举aidl访问远程服务的例子.</td>
</tr>
</tbody>
</table>
30.dvm的进程和Linux的进程, 应用程序的进程是否为同一个概念  是同一概念
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Dvm的进程是dalivk虚拟机进程,每个android程序都运行在自己的进程里面,
每个android程序系统都会给他分配一个单独的liunx  uid(user id),
每个dvm都是linux里面的一个进程.所以说这两个进程是一个进程.</td>
</tr>
</tbody>
</table>
31.在Android中是如何实现判断区分电话的状态，去电，来电、未接来电？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Day8 showAddressService.java
TelephoneyManger.listen();</td>
</tr>
</tbody>
</table>
32.谈谈Android的优点和不足之处。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">1、开放性,开源ophone  阿里云( 完全兼容android)
2、挣脱运营商束缚
3、丰富的硬件选择 mtk android
4、不受任何限制的开发商
5、无缝结合的Google应用缺点也有5处：
1、安全问题、隐私问题
2、卖手机的不是最大运营商
3、运营商对Android手机仍然有影响
4、山寨化严重
5、过分依赖开发商，缺乏标准配置</td>
</tr>
</tbody>
</table>
33.Android系统中GC什么情况下会出现内存泄露呢?
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">视频编解码/内存泄露
检测内存泄露   工具导致内存泄漏主要的原因是，先前申请了内存空间而忘记了释放。如果程序中存在对无用对象的引用，那么这些对象就会驻留内存，消耗内存，因为无法让垃圾回收器GC验证这些对象是否不再需要。如果存在对象的引用，这个对象就被定义为"有效的活动"，同时不会被释放。要确定对象所占内存将被回收，我们就要务必确认该对象不再会被使用。典型的做法就是把对象数据成员设为null或者从集合中移除该对象。但当局部变量不需要时，不需明显的设为null，因为一个方法执行完毕时，这些引用会自动被清理。
Java带垃圾回收的机制,为什么还会内存泄露呢?Vector v = new Vector(10);
for (int i = 1; i &lt; 100; i++)      {
Object o = new Object();
v.add(o);
o = null;
}//此时，所有的Object对象都没有被释放，因为变量v引用这些对象。

Java 内存泄露的根本原因就是 保存了不可能再被访问的变量类型的引用</td>
</tr>
</tbody>
</table>
34.Android UI中的View如何刷新。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">在主线程中  拿到view调用Invalide()方法,查看画画板里面更新imageview的方法在子线程里面可以通过postInvalide()方法;</td>
</tr>
</tbody>
</table>
35. 简单描述下Android 数字签名。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android 数字签名
在Android系统中，所有安装到系统的应用程序都必有一个数字证书，此数字证书用于标识应用程序的作者和在应用程序之间建立信任关系
Android系统要求每一个安装进系统的应用程序都是经过数字证书签名的，数字证书的私钥则保存在程序开发者的手中。Android将数字证书用来标识应用程序的作者和在应用程序之间建立信任关系，不是用来决定最终用户可以安装哪些应用程序。
这个数字证书并不需要权威的数字证书签名机构认证(CA)，它只是用来让应用程序包自我认证的。
同一个开发者的多个程序尽可能使用同一个数字证书，这可以带来以下好处。
(1)有利于程序升级，当新版程序和旧版程序的数字证书相同时，Android系统才会认为这两个程序是同一个程序的不同版本。如果新版程序和旧版程序的数字证书不相同，则Android系统认为他们是不同的程序，并产生冲突，会要求新程序更改包名。(2)有利于程序的模块化设计和开发。Android系统允许拥有同一个数字签名的程序运行在一个进程中，Android程序会将他们视为同一个程序。所以开发者可以将自己的程序分模块开发，而用户只需要在需要的时候下载适当的模块。
在签名时，需要考虑数字证书的有效期：
(1)数字证书的有效期要包含程序的预计生命周期，一旦数字证书失效，持有改数字证书的程序将不能正常升级。
(2)如果多个程序使用同一个数字证书，则该数字证书的有效期要包含所有程序的预计生命周期。
(3)Android Market强制要求所有应用程序数字证书的有效期要持续到2033年10月22日以后。
Android数字证书包含以下几个要点：
(1)所有的应用程序都必须有数字证书，Android系统不会安装一个没有数字证书的应用程序
(2)Android程序包使用的数字证书可以是自签名的，不需要一个权威的数字证书机构签名认证
(3)如果要正式发布一个Android ，必须使用一个合适的私钥生成的数字证书来给程序签名，而不能使用adt插件或者ant工具生成的调试证书来发布。
(4)数字证书都是有有效期的，Android只是在应用程序安装的时候才会检查证书的有效期。如果程序已经安装在系统中，即使证书过期也不会影响程序的正常功能。</td>
</tr>
</tbody>
</table>
36.android中的动画有哪几类，它们的特点和区别是什么？
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">两种，一种是Tween动画、还有一种是Frame动画。
Tween动画，这种实现方式可以使视图组件移动、放大、缩小以及产生透明度的变化；
可以通过布局文件,可以通过代码
1、  控制View的动画
a)     alpha(AlphaAnimation)
渐变透明
b)     scale(ScaleAnimation)
渐变尺寸伸缩
c)     translate(TranslateAnimation)
画面转换、位置移动
d)     rotate(RotateAnimation)
画面转移，旋转动画2、    控制一个Layout里面子View的动画效果
a)     layoutAnimation(LayoutAnimationController)
b)     gridAnimation(GridLayoutAnimationController)
另一种Frame动画，传统的动画方法，通过顺序的播放排列好的图片来实现，类似电影。</td>
</tr>
</tbody>
</table>
37.说说mvc模式的原理，它在android中的运用
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Android中没有mvc，只有在j2ee中有，是用于逻辑也界面分离的
MVC英文即Model-View-Controller，即把一个应用的输入、处理、输出流程按照Model、View、Controller的方式进行分离，这样一个应用被分成三个层——模型层、视图层、控制层。Android中界面部分也采用了当前比较流行的MVC框架，在Android中M就是应用程序中二进制的数据，V就是用户的界面。Android的界面直接采用XML文件保存的，界面开发变的很方便。在Android中C也是很简单的，一个Activity可以有多个界面，只需要将视图的ID传递到setContentView()，就指定了以哪个视图模型显示数据。在Android SDK中的数据绑定，也都是采用了与MVC框架类似的方法来显示数据。在控制层上将数据按照视图模型的要求（也就是Android SDK中的Adapter）封装就可以直接在视图模型上显示了，从而实现了数据绑定。比如显示Cursor中所有数据的ListActivity，其视图层就是一个ListView，将数据封装为ListAdapter，并传递给ListView，数据就在ListView中显示。</td>
</tr>
</tbody>
</table>
38.通过点击一个网页上的url 就可以完成程序的自动安装,描述下原理
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">Day11 AddJavascriptInterface
new Object{
callphone();
installapk();
}将js与java相互调用再来一个例子，解决相互调用之间的关系。首先说明一重要代码的情况：

android中的关键代码：
webview.getSettings().setJavaScriptEnabled(true);
webview.addJavascriptInterface(object,"name"); //把Name="name"<span style="text-decoration: underline;">的对象添加到object中。object如果是this，就是window.name</span>
webview.loadUrl("file:///android_asset/index.html"); //注意这个资源的位置放在assets文件夹下。

js或html中调用android中方法代码：
js中使用 window.name.java中的方法()；
android中调用js的function方法：
Callfunction(){
webview.loadUrl("javascript: function ()");
需要注意的地方，很多数据类型js中不认识，最好是在android那边封装好，提供必要的方法接口。比如传到js中的list，在js中是没办法去得到里面的元素的。
addJavascriptInterface：addJavascriptInterface方法中要绑定的Java对象及方法要运行在另外的线程中，不能运行在构造他的线程中，也就是说不能运行在当前的activity线程中，就是把这个方法绑定到页面中，js也可以调用。
文档中的解释：
Use this function to bind an object to Javascript so that the methods can be accessed from Javascript.
The Java object that is bound runs in another thread and not in the thread that it was constructed in.

下面给出具体的测试代码：
1、Activity 代码

[java][/java]


<strong></strong> view plaincopyprint?
<strong>public</strong> <strong>class</strong> TestWebView <strong>extends</strong> Activity {
<strong>private</strong> WebView mWebView;
<strong>private</strong> List list;
<strong>private</strong> <strong>int</strong> mkeyCode;

@Override
<strong>public</strong> <strong>void</strong> onCreate(Bundle savedInstanceState) {
<strong>super</strong>.onCreate(savedInstanceState);
setContentView(R.layout.main);
mWebView = (WebView) findViewById(R.id.htmlview);

initData();

WebSettings webSettings = mWebView.getSettings();

// 是否允许在webview中执行javascript
webSettings.setJavaScriptEnabled(<strong>true</strong>);

mWebView.addJavascriptInterface(<strong>this</strong>, "javatojs");

//加载网页
mWebView.loadUrl("file:///android_asset/index.html");
}

@Override
<strong>public</strong> <strong>boolean</strong> onKeyUp(<strong>int</strong> keyCode, KeyEvent event) {
mkeyCode = keyCode;
Log.i("AA","keyCode="+keyCode);
mWebView.loadUrl("javascript: OnKeyUp()");
<strong>return</strong> <strong>super</strong>.onKeyUp(keyCode, event);
}

<strong>public</strong> <strong>int</strong> getKeyCode(){
<strong>return</strong> mkeyCode;
}

<strong>void</strong> initData() {
list = <strong>new</strong> ArrayList();
<strong>for</strong> (<strong>int</strong> i = 0; i < 5; i++) {
list.add("我是List中的第" + (i + 1) + "行");
}
}

/**
* 该方法将在js脚本中，通过window.javatojs.....()进行调用
*
* @return
*/
<strong>public</strong> Object getObject(<strong>int</strong> index) {
Log.i("A","getObject");
<strong>return</strong> list.get(index);
}

<strong>public</strong> <strong>int</strong> getSize() {
Log.i("A","getSize");
<strong>return</strong> list.size();
}

<strong>public</strong> <strong>void</strong> Callfunction() {
Log.i("A","Callfunction");
mWebView.loadUrl("javascript: GetList()");
}

<strong>public</strong> <strong>void</strong> printStr(String str){
Log.i("A","GetList:" + str);
}
}
2、js 代码 index.html

<strong></strong>
[javascript][/javascript]<strong></strong> view plaincopyprint?






<script type="text/javascript" language="javascript">// <![CDATA[


<strong>function</strong> GetList(){
<strong>var</strong> i=window.javatojs.getSize();

<strong>for</strong>(<strong>var</strong> n=0;n<i;n++){
<strong>var</strong> jsdata= window.javatojs.getObject(n);//拿到activity里面的属性javadata
window.javatojs.printStr("test");
}
}

<strong>function</strong> OnKeyUp() {
<strong>var</strong> keycode = window.javatojs.getKeyCode();
window.javatojs.printStr(keycode);
}

// ]]]]><![CDATA[></script></pre>
<table width="400" align="center">
<tbody>
<tr>
<td>testonclick="document.getElementById('output').innerHTML=window.javatojs.Callfunction()"/></td>
</tr>
</tbody>
</table>
<pre>


以上代码主要测试js与java相互调用，而由于按键这种系统事件被webview截获掉，有如下两种方式进行处理

1、把方向键的流程改成：先传给webcore，假如没处理，再在webview里面处理，这个需要修改webview.java代码
2、直接应用搞定，java捕获按键，然后调js函数，上面代码就是使用这种方法。

测试结果如下： 点击buttons按钮：
I/A       ( 4990): Callfunction
I/A       ( 4990): getSize
I/A       ( 4990): getObject
I/A       ( 4990): GetList:test
I/A       ( 4990): getObject
I/A       ( 4990): GetList:test
I/A       ( 4990): getObject
I/A       ( 4990): GetList:test
I/A       ( 4990): getObject
I/A       ( 4990): GetList:test
I/A       ( 4990): getObject
I/A       ( 4990): GetList:test

you press KEY_RIGHT
I/AA      ( 4990): keyCode=22
I/A       ( 4990): GetList:22

you press KEY_UP
I/AA      ( 4990): keyCode=19
I/A       ( 4990): GetList:19

you press KEY_DOWN
I/AA      ( 4990): keyCode=20
I/A       ( 4990): GetList:20

you press KEY_LEFT
I/AA      ( 4990): keyCode=21
I/A       ( 4990): GetList:21

这里为何使用这种方式，是因为对于上下左右及确定这种功能键被webview截取掉了，无法传递到webcore中，而只能重载OnKeyDown/OnKeyUp方法，再由js调用java方法来获取得。
对于数字键的处理可以直接在js中进行处理：
logcat中会有明显的打印，对于这些键没有截掉，所以可以直接获取得到：
D/webcore ( 4990): proc key: code=12
D/webcore ( 4990): proc key: nativeKey return false
D/webcore ( 4990): proc key: nativeKey return true
js代码可以如此编写：

<strong>[javascript][/javascript]</strong> view plaincopyprint?
<script type="text/javascript" language="JavaScript">// <![CDATA[


document.onkeypress = grab_keypress_event;
document.onirkeypress = grab_irkeypress_event;
document.onsystemevent = grab_system_event;
document.onkeydown = grab_keydown_event;
document.onkeyup = grab_keyup_event;

<strong>function</strong> init()
{
document.getElementById("txt_keypress").innerHTML = "";
document.getElementById("txt_irkey").innerHTML= "";
document.getElementById("txt_systemevent").innerHTML="";
document.getElementById("txt_keydown").innerHTML="";
document.getElementById("txt_keyup").innerHTML="";
}

<strong>function</strong> grab_keypress_event(event)
{
<strong>var</strong> keycode = event.keyCode;
document.getElementById("txt_keypress").innerHTML=keycode;
}

<strong>function</strong> grab_irkeypress_event(event)
{
<strong>var</strong> keycode = event.keyCode;
document.getElementById("txt_irkey").innerHTML=keycode;
}

<strong>function</strong> grab_system_event(event)
{
<strong>var</strong> keycode = event.which;
document.getElementById("txt_systemevent").innerHTML=keycode;
}

<strong>function</strong> grab_keydown_event(event)
{
<strong>var</strong> keycode = event.keyCode;
<strong>var</strong> type = event.type;
<strong>var</strong> mod = event.modifiers;
document.getElementById("txt_keydown").innerHTML=keycode;
}

<strong>function</strong> grab_keyup_event(event)
{
<strong>var</strong> keycode = event.keyCode;
document.getElementById("txt_keyup").innerHTML=keycode;
}
// ]]]]><![CDATA[></script></pre>
</td>
</tr>
</tbody>
</table>
39.Service和Activity在同一个线程吗
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">默认情况同一线程 main主线程 ui线程</td>
</tr>
</tbody>
</table>
40.ViewStub的应用
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">  在开发应用程序的时候，经常会遇到这样的情况，会在运行时动态根据条件来决定显示哪个View或某个布局。那么最通常的想法就是把可能用到的View都写在上面，先把它们的可见性都设为View.<em>GONE</em>，然后在代码中动态的更改它的可见性。这样的做法的优点是逻辑简单而且控制起来比较灵活。但是它的缺点就是，耗费资源。虽然把View的初始可见View.<em>GONE</em>但是在Inflate布局的时候View仍然会被Inflate，也就是说仍然会创建对象，会被实例化，会被设置属性。也就是说，会耗费内存等资源。
推荐的做法是使用<em>android.view.ViewStub</em>，ViewStub是一个轻量级的View，它一个看不见的，不占布局位置，占用资源非常小的控件。可以为ViewStub指定一个布局，在Inflate布局的时候，只有ViewStub会被初始化，然后当ViewStub被设置为可见的时候，或是调用了ViewStub.inflate()的时候，ViewStub所向的布局就会被Inflate和实例化，然后ViewStub的布局属性都会传给它所指向的布局。这样，就可以使用ViewStub来方便的在运行时，要还是不要显示某个布局。
但ViewStub也不是万能的，下面总结下ViewStub能做的事儿和什么时候该用ViewStub，什么时候该用可见性的控制。
首先来说说ViewStub的一些特点：
1. ViewStub只能Inflate一次，之后ViewStub对象会被置为空。按句话说，某个被ViewStub指定的布局被Inflate后，就不会够再通过ViewStub来控制它了。
2. ViewStub只能用来Inflate一个布局文件，而不是某个具体的View，当然也可以把View写在某个布局文件中。
基于以上的特点，那么可以考虑使用ViewStub的情况有：
1. 在程序的运行期间，某个布局在Inflate后，就不会有变化，除非重新启动。
因为ViewStub只能Inflate一次，之后会被置空，所以无法指望后面接着使用ViewStub来控制布局。所以当需要在运行时不止一次的显示和隐藏某个布局，那么ViewStub是做不到的。这时就只能使用View的可见性来控制了。
2. 想要控制显示与隐藏的是一个布局文件，而非某个View。
因为设置给ViewStub的只能是某个布局文件的Id，所以无法让它来控制某个View。
所以，如果想要控制某个View(如Button或TextView)的显示与隐藏，或者想要在运行时不断的显示与隐藏某个布局或View，只能使用View的可见性来控制。
下面来看一个实例
在这个例子中，要显示二种不同的布局，一个是用TextView显示一段文字，另一个则是用ImageView显示一个图片。这二个是在onCreate()时决定是显示哪一个，这里就是应用ViewStub的最佳地点。
先来看看布局，一个是主布局，里面只定义二个ViewStub，一个用来控制TextView一个用来控制ImageView，另外就是一个是为显示文字的做的TextView布局，一个是为ImageView而做的布局：

<strong>[html][/html]</strong> view plaincopyprint?
<strong><strong><!--?xml </strong--> version="1.0" encoding="utf-8"<strong>?></strong>
<strong><LinearLayout</strong>
xmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
android:orientation="vertical"
android:layout_width="fill_parent"
android:layout_height="fill_parent"
android:gravity="center_horizontal"<strong>]] ></strong>
<strong><ViewStub</strong>
android:id="@+id/viewstub_demo_text"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:layout_marginLeft="5dip"
android:layout_marginRight="5dip"
android:layout_marginTop="10dip"
android:layout="@layout/viewstub_demo_text_layout"<strong>/></strong>
<strong><ViewStub</strong>
android:id="@+id/viewstub_demo_image"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:layout_marginLeft="5dip"
android:layout_marginRight="5dip"
android:layout="@layout/viewstub_demo_image_layout"<strong>/></strong>
<strong></strong>
为TextView的布局：

<strong>[html][/html]</strong> view plaincopyprint?
<strong><!--?xml </strong--> version="1.0" encoding="utf-8"<strong>?></strong>
<strong><LinearLayout</strong>
xmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
android:orientation="vertical"
android:layout_width="wrap_content"
android:layout_height="wrap_content"<strong>]] ></strong>
<strong><TextView</strong>
android:id="@+id/viewstub_demo_textview"
android:layout_width="fill_parent"
android:layout_height="wrap_content"
android:background="#aa664411"
android:textSize="16sp"<strong>/></strong>
<strong></strong>
为ImageView的布局：

<strong>[html][/html]</strong> view plaincopyprint?
<strong><!--?xml </strong--> version="1.0" encoding="utf-8"<strong>?></strong>
<strong><LinearLayout</strong>
xmlns:android="<span style="text-decoration: underline;">http://schemas.android.com/apk/res/android</span>"
android:orientation="vertical"
android:layout_width="wrap_content"
android:layout_height="wrap_content"<strong>]] ></strong>
<strong><ImageView</strong>
android:id="@+id/viewstub_demo_imageview"
android:layout_width="wrap_content"
android:layout_height="wrap_content"<strong>/></strong>
<strong></strong>
下面来看代码，决定来显示哪一个，只需要找到相应的ViewStub然后调用其infalte()就可以获得相应想要的布局：

<strong><strong>[java][/java]

</strong></strong></strong></strong></strong></strong>&nbsp;

<strong><strong><strong><strong> view plaincopyprint?
<strong>package</strong> com.effective;<strong>import</strong> android.app.Activity;
<strong>import</strong> android.os.Bundle;
<strong>import</strong> android.view.ViewStub;
<strong>import</strong> android.widget.ImageView;
<strong>import</strong> android.widget.TextView;</strong></strong></strong></strong><strong>public</strong> <strong>class</strong> ViewStubDemoActivity <strong>extends</strong> Activity {
@Override
<strong>public</strong> <strong>void</strong> onCreate(Bundle savedInstanceState) {
<strong>super</strong>.onCreate(savedInstanceState);
setContentView(R.layout.viewstub_demo_activity);
<strong>if</strong> ((((<strong>int</strong>) (Math.random() * 100)) &amp; 0x01) == 0) {
// to show text
// all you have to do is inflate the ViewStub for textview
ViewStub stub = (ViewStub) findViewById(R.id.viewstub_demo_text);
stub.inflate();
TextView text = (TextView) findViewById(R.id.viewstub_demo_textview);
text.setText("The tree of liberty must be refreshed from time to time" +
" with the blood of patroits and tyrants! Freedom is nothing but " +
"a chance to be better!");
} <strong>else</strong> {
// to show image
// all you have to do is inflate the ViewStub for imageview
ViewStub stub = (ViewStub) findViewById(R.id.viewstub_demo_image);
stub.inflate();
ImageView image = (ImageView) findViewById(R.id.viewstub_demo_imageview);
image.setImageResource(R.drawable.happy_running_dog);
}
}
}
运行结果：

使用的时候的注意事项：
1. 某些布局属性要加在ViewStub而不是实际的布局上面，才会起作用，比如上面用的android:layout_margin*系列属性，如果加在TextView上面，则不会起作用，需要放在它的ViewStub上面才会起作用。而ViewStub的属性在inflate()后会都传给相应的布局。</td>
</tr>
</tbody>
</table>
41.android开发中怎么去调试bug
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">逻辑错误
1.断点 debug
2. logcat ,
界面布局,显示 hierarchyviewer.bat</td>
</tr>
</tbody>
</table>
42.书写出android工程的目录结构以及相关作用
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">下面是HelloAndroid项目在eclipse中的目录层次结构：由上图可以看出项目的根目录下共有九个文件（夹），下面就这九个文件（夹）进行详解：
1.1src文件夹和assets文件夹：
每个Android程序都包含资源目录（src）和资产目录（assets），资源和资产听起来感觉没有多大差别，但在存储外部内容时用资源（src）比较多，其中它们的区别在于存放在资源（src）下的内容可以通过应用程序的R类进行访问，而存放在资产（assets）下的内容会保持原始文件的格式，如果需要访问，则必须使用AssetManager以字节流的方式来读取，用起来非常的不方便。为了方便使用，通常文件和数据都会保存在资源（src）目录下
1.2res(Resource)目录：资源目录
可以存放一些图标，界面文件和应用中用到的文字信息，下图为res目录截图:
1.2.1 drawable-*dpi文件夹:将图标按分辨率的高低放入不同的目录，其中draeable-hdpi用来存放高分辨率的图标，drawable-mdpi用来存放中等分辨率的图标，drawable-ldpi用来存放低分辨率的图标
1.2.2 values文件夹：用来存放文字的信息
（1）strings.xml:用来定义字符串和数值
&lt;?xml version=<em>"1.0"</em>encoding=<em>"utf-8"</em>?&gt;
&lt;resources&gt;&lt;string name=<em>"hello"</em>&gt;Hello World, Hello 3G&lt;/string&gt;
&lt;string name=<em>"app_name"</em>&gt;Android1.1&lt;/string&gt;
&lt;string name=<em>"test"</em>&gt;哥想你了&lt;/string&gt;
&lt;string name=<em>"startButton"</em>&gt;按钮1&lt;/string&gt;
&lt;string name=<em>"start"</em>&gt;按钮1&lt;/string&gt;
&lt;/resources&gt;
每个string标签生命了一个字符串，name属性指定它的引用值
（2）为什么要把这些出现的文字单独放在strings.xml文件中？
答案：一是为了国际化，如果需要将文件中的文字换成别的国家的语言，就可以只需要替换掉一个strings.xml文件就可以了
二是为了减少应用的体积，例如，我们要在应用中使用“哥想你了”这句话1000次，如果我们没有将“哥想你了”定义在strings.xml文件中，而是直接在应用中使用时写上这几个字，那么我们就会在应用中写4000个字。4000个字和4个字占用的内存可是有很大差距的啊，况且手机的内存本来就小，所以应该是能省就省
（3）另外还有arrays.xml,color.xml等定义数组，颜色的，都最好用单独的一个xml文档
1.2.3 layout文件：用来存放界面信息
本例中的布局文件是自动生成的“main.xml”
&lt;?xml version=<em>"1.0"</em>encoding=<em>"utf-8"</em>?&gt;
&lt;LinearLayout xmlns:android=<em>"</em><span style="text-decoration: underline;"><em>http://schemas.android.com/apk/res/android</em></span><em>"</em>
android:layout_width=<em>"fill_parent"</em>
android:layout_height=<em>"fill_parent"</em>
android:orientation=<em>"vertical"</em>&gt;

&lt;TextView
android:layout_width=<em>"fill_parent"</em>
android:layout_height=<em>"wrap_content"</em>
android:text=<em>"@string/test"</em>/&gt;

&lt;/LinearLayout&gt;
&lt;LinearLayout&gt;元素：线性布局的意思，在该元素下的所有子元素都会根据他的”orientation”属性来决定是按行还是按列或者按逐个显示进行布局的
&lt;TextView&gt;元素：是一种显示控件，他的”text”属性指定了在这个元素上显示的内容
1.3 gen目录：gen目录下只有一个自动生成的“R.java”文件
/*AUTO-GENERATED FILE.  DO NOT MODIFY.
*
* This class was automatically generated bythe
* <span style="text-decoration: underline;">aapt</span> tool from the resource data itfound.  It
* should not be modified by hand.
*/

<strong>package</strong>cn.csdn.android.demo;

<strong>public final class</strong> R {
<strong>public static final class</strong> attr {
}
<strong>public static final class</strong> drawable {
<strong>public static final int</strong> ic_launcher=0x7f020000;
}
<strong>public static final class</strong> id {
<strong>public static final int</strong> button1=0x7f050000;
<strong>public static final int</strong> radioButton1=0x7f050001;
<strong>public static final int</strong> toggleButton1=0x7f050002;
}
<strong>public static final class</strong> layout {
<strong>public static final int</strong> main=0x7f030000;
}
<strong>public static final class</strong> string {
<strong>public static final int</strong> app_name=0x7f040001;
<strong>public static final int</strong> hello=0x7f040000;
<strong>public static final int</strong> start=0x7f040004;
<strong>public static final int</strong> startButton=0x7f040003;
<strong>public static final int</strong> test=0x7f040002;
}
}

R.java文件：默认有attr,drawable,layout,string这四个静态内部类，每个静态内部类对应一中资源，如layout静态内部类对应layout中的界面文件，string静态内部类对应string内部的string标签。如果在layout中在增加一个界面文件或者在string内增加一个string标签，R.java会自动在其对应的内部类增加所增加的内容。
R.java除了自动标识资源的索引功能外，还有另一个功能，就是当res文件中的某个资源在应用中没有被用到，在这个应用被编译时，系统不会把对应的资源编译到应用中的APR包中。
1.4 AndroidManifest.xml 功能清单文件
每个应用程序都会有一个AndroidManifest在它的根目录里面。这个清单为Android系统提供了这个应用的基本信息，系统在运行之前必须知道这些信息，另外，如果我们使用系统自带的服务，如拨号服务，应用安装服务等，都必须在AndroidManifest.xml文件中声明权限
AndroidManifest.xml的功能：
命名应用程序的Java应用包，这个包名用来唯一标识应用程序；
描述应用程序的组件，对实现每个组件和公布其功能的类进行命名，这些声明使得Android系统了解这些组件以及它们在什么条件下可以被启动
决定哪个组件运行在哪个进程里面
声明应用程序必须具备的权限，用以访问受保护的API，以及和其他进程的交互
声明应用程序其他的必备权限，用以组件之间的交互
列举application所需要链接的库
以HelloAndroid项目的功能清单为例子进行讲解：
&lt;?xml version=<em>"1.0"</em>encoding=<em>"utf-8"</em>?&gt;
&lt;manifest xmlns:android=<em>"</em><span style="text-decoration: underline;"><em>http://schemas.android.com/apk/res/android</em></span><em>"</em>
package=<em>"cn.csdn.android.demo"</em>
android:versionCode=<em>"1"</em>
android:versionName=<em>"1.0"</em>&gt;

&lt;uses-sdk android:minSdkVersion=<em>"8"</em>/&gt;

&lt;application
android:icon=<em>"@drawable/ic_launcher"</em>
android:label=<em>"@string/app_name"</em>&gt;
&lt;activity
android:label=<em>"@string/app_name"</em>
android:name=<em>".HelloActivity"</em>&gt;
&lt;intent-filter &gt;
&lt;action android:name=<em>"android.intent.action.MAIN"</em> /&gt;

&lt;category android:name=<em>"android.intent.category.LAUNCHER"</em> /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
&lt;/application&gt;
&lt;/manifest&gt;
1.4.1 &lt;manifest&gt;元素
&lt;manifest xmlns:android=<em>"</em><span style="text-decoration: underline;"><em>http://schemas.android.com/apk/res/android</em></span><em>"</em>
package=<em>"cn.csdn.android.demo"</em>
android:versionCode=<em>"1"</em>
android:versionName=<em>"1.0"</em>&gt;
&lt;manifest&gt;元素是AndroidManifest.xml的根元素,”xmlns:android”是指该文件的命名空间，“package”属性是Android应用所在的包，“android:versionCode”指定应用的版本号，如果应用不断升级，则需要修改这个值，”android:versionName”是版本的名称，这个可以根据自己的喜爱改变
1.4.2 &lt;application&gt; 元素
&lt;application
android:icon=<em>"@drawable/ic_launcher"</em>
android:label=<em>"@string/app_name"</em>&gt;
&lt;activity
android:label=<em>"@string/app_name"</em>
android:name=<em>".HelloActivity"</em>&gt;
&lt;intent-filter &gt;
&lt;action android:name=<em>"android.intent.action.MAIN"</em>/&gt;

&lt;category android:name=<em>"android.intent.category.LAUNCHER"</em> /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
&lt;/application&gt;
&lt;application&gt;元素是一个很重要的元素，开发组件都会在此下定义
&lt;application&gt;元素的”icon”属性是用来设定应用的图标，其中“@drawable/ic_launcher”的意思是:在R.java文件中的drawable静态内部类下的icon，如下图所示
&lt;application&gt;元素的“label”属性用来设定应用的名称，其中“@string/app_name”和上述的一样，也是R.java文件中的string静态内部类下的app_name
1.4.3 &lt;activity&gt;元素
&lt;activity
android:label=<em>"@string/app_name"</em>
android:name=<em>".HelloActivity"</em> &gt;
&lt;intent-filter &gt;
&lt;action android:name=<em>"android.intent.action.MAIN"</em> /&gt;

&lt;category android:name=<em>"android.intent.category.LAUNCHER"</em> /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
&lt;activity&gt;元素的作用是注册一个activity信息，当我们在创建“HelloAndroid”这个项目时，指定了“Created Activity”属性为“HelloActivity”，然后ADT在生成项目时帮我们自动创建了一个Activity，就是“HelloActivity.java”；
&lt;activity&gt;元素的“name“属性指定的是Activity的类名，其中“.HelloActivity”中的“.”指的是&lt;manifest&gt;元素中的“package”属性中指定的当前包，所以“.HelloActivity”就相当于“<em>cn.csdn.android.demo.HelloActivity.java</em>”，如果Activity在应用的包中可以不写“.”，但是为了避免出错，还是写上这个点把
1.4.4&lt;intent-filter&gt;元素
&lt;intent-filter &gt;
&lt;action android:name=<em>"android.intent.action.MAIN"</em> /&gt;

&lt;category android:name=<em>"android.intent.category.LAUNCHER"</em> /&gt;
&lt;/intent-filter&gt;
&lt;intent-filter&gt;如果直接翻译的话是“意图过滤器”，组件通过&lt;intent-filter&gt;告诉它们所具备的功能，就是能响应意图类型，在intent中设置action, data, categroy之后在对应的intentfilter中设置相同的属性即可通过过滤被activity调用
1.5&lt;project.properties&gt;应用要求运行的最低Android版本
1.6&lt;android 2.2&gt;  存放Android自身的jar包</td>
</tr>
</tbody>
</table>
43.ddms 和traceview的区别.
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"> daivilk debug manager system
1.在应用的主activity的onCreate方法中加入Debug.startMethodTracing("要生成的traceview文件的名字");
2.同样在主activity的onStop方法中加入Debug.stopMethodTracing();
3.同时要在AndroidManifest.xml文件中配置权限
&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"&gt;&lt;/uses-permission&gt;
3.重新编译，安装，启动服务，测试完成取对应的traceview文件(adb pull /sdcard/xxxx.trace)。
4.直接在命令行输入traceview xxxxtrace，弹出traceview窗口，分析对应的应用即可。traceview 分析程序执行时间和效率KPI : key performance information : 关键性能指标:
splash界面不能超过5秒
从splash 界面加载mainactivity 不能超过0.7秒</td>
</tr>
</tbody>
</table>
44.谈谈NDK
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">NDK全称：Native Development Kit。
1、NDK是一系列工具的集合。
* NDK提供了一系列的工具，帮助开发者快速开发C（或C++）的动态库，并能自动将so和java应用一起打包成apk。这些工具对开发者的帮助是巨大的。[1]
* NDK集成了交叉编译器，并提供了相应的mk文件隔离平台、CPU、API等差异，开发人员只需要简单修改mk文件（指出“哪些文件需要编译”、“编译特性要求”等），就可以创建出so。
* NDK可以自动地将so和Java应用一起打包，极大地减轻了开发人员的打包工作。
2、NDK提供了一份稳定、功能有限的API头文件声明。
Google明确声明该API是稳定的，在后续所有版本中都稳定支持当前发布的API。从该版本的NDK中看出，这些API支持的功能非常有限，包含有：C标准库（libc）、标准数学库（libm）、压缩库（libz）、Log库（liblog）。</td>
</tr>
</tbody>
</table>
45.请介绍下Android的数据存储方式。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">一.SharedPreferences方式
二sdcard
三内部存储
四SqliteDatabase
五. 网络存储方式</td>
</tr>
</tbody>
</table>
46.谈谈推送,优缺点以及实现原理
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">本文主旨在于，对目前Android平台上最主流的几种消息推送方案进行分析和对比，比较客观地反映出这些推送方案的优缺点，帮助大家选择最合适的实施方案。<strong>方案1、</strong>使用GCM服务（Google Cloud Messaging）
简介：Google推出的云消息服务，即第二代的C2DM。
优点：Google提供的服务、原生、简单，无需实现和部署服务端。
缺点：Android版本限制（必须大于2.2版本），该服务在国内不够稳定、需要用户绑定Google帐号，受限于Google。<strong>方案2、</strong>使用XMPP协议（Openfire + Spark + Smack）
简介：基于XML协议的通讯协议，前身是Jabber，目前已由IETF国际标准化组织完成了标准化工作。
优点：协议成熟、强大、可扩展性强、目前主要应用于许多聊天系统中，且已有开源的Java版的开发实例androidpn。
缺点：协议较复杂、冗余（基于XML）、费流量、费电，部署硬件成本高。

<strong>方案3、</strong>使用MQTT协议（更多信息见：http://mqtt.org/）
简介：轻量级的、基于代理的“发布/订阅”模式的消息传输协议。
优点：协议简洁、小巧、可扩展性强、省流量、省电，目前已经应用到企业领域（参考：http://mqtt.org/software），且已有C++版的服务端组件rsmb。
缺点：不够成熟、实现较复杂、服务端组件rsmb不开源，部署硬件成本较高。

<strong>方案4、</strong>使用HTTP轮循方式
简介：定时向HTTP服务端接口（Web Service API）获取最新消息。
优点：实现简单、可控性强，部署硬件成本低。
缺点：实时性差。

对各个方案的优缺点的研究和对比，推荐使用MQTT协议的方案进行实现，主要原因是：<span style="text-decoration: underline;">MQTT最快速，也最省流量（固定头长度仅为2字节），且极易扩展，适合二次开发</span>。接下来，我们就来分析使用MQTT方案进行Android消息的原理和方法，并架设自己的推送服务。
<strong>1、推送原理分析</strong>

实际上，其他推送系统（包括GCM、XMPP方案）的原理都与此类似。

<strong>2、推送服务端准备</strong>

a&gt; 下载&amp;解压rsmb安装包（下载地址：http://www.alphaworks.ibm.com/tech/rsmb）
b&gt; 进入对应的目录，比如32位的Linux系统则应该进入linux_ia32目录。
c&gt; 编辑配置文件broker_1883.cfg，配置如下：

[html][/html]

<strong></strong> view plaincopy
port 1883
max_inflight_messages 10
max_queued_messages 1000
d&gt; 运行./broker broker_1883.cfg，显示如下：
20120823 110454.039 CWNAN9999I Really Small Message Broker
20120823 110454.039 CWNAN9997I Licensed Materials - Property of IBM
20120823 110454.039 CWNAN9996I Copyright IBM Corp. 2007, 2010 All Rights Reserved
20120823 110454.039 CWNAN9995I US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
20120823 110454.039 CWNAN0049I Configuration file name is broker_1883.cfg
20120823 110454.040 CWNAN0053I Version 1.2.0, Aug 18 2010 17:03:35
20120823 110454.040 CWNAN0054I Features included: bridge
20120823 110454.040 CWNAN9993I Author: Ian Craggs (<span style="text-decoration: underline;">icraggs@uk.ibm.com</span>)
20120823 110454.040 CWNAN0014I MQTT protocol starting, listening on port 1883
... ...
这样，推送服务的服务端就已经准备好了，监听1883端口。

<strong>3、推送客户端准备</strong>

a&gt; 下载&amp;解压AndroidPushNotificationsDemo项目（下载地址：https://github.com/tokudu/AndroidPushNotificationsDemo）
b&gt; 将该项目导入Eclipse中（File -&gt; Export -&gt; Existing Projects into Workspace）
c&gt; 修改PushService.java中的<strong>MQTT_HOST</strong>常量为推送服务端的IP地址。
d&gt; 启动Android模拟器，并安装该项目。

<strong>注意：</strong>在新版本的Android SDK中可能会遇到以下错误。
... ...
08-23 02:28:44.184: W/dalvikvm(282): VFY: unable to find class referenced in signature (Lcom/ibm/mqtt/MqttPersistence;)
08-23 02:28:44.194: I/dalvikvm(282): Failed resolving Lcom/tokudu/demo/PushService$MQTTConnection; interface 35 'Lcom/ibm/mqtt/MqttSimpleCallback;'
08-23 02:28:44.194: W/dalvikvm(282): Link of class 'Lcom/tokudu/demo/PushService$MQTTConnection;' failed
08-23 02:28:44.194: E/dalvikvm(282): Could not find class 'com.tokudu.demo.PushService$MQTTConnection', referenced from method com.tokudu.demo.PushService.connect
08-23 02:28:44.194: W/dalvikvm(282): VFY: unable to resolve new-instance 42 (Lcom/tokudu/demo/PushService$MQTTConnection;) in Lcom/tokudu/demo/PushService;
... ...
08-23 02:28:44.404: E/AndroidRuntime(282): java.lang.VerifyError: com.tokudu.demo.PushService
08-23 02:28:44.404: E/AndroidRuntime(282):     at com.tokudu.demo.PushActivity$1.onClick(PushActivity.java:32)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.view.View.performClick(View.java:2408)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.view.View$PerformClick.run(View.java:8816)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.os.Handler.handleCallback(Handler.java:587)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.os.Handler.dispatchMessage(Handler.java:92)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.os.Looper.loop(Looper.java:123)
08-23 02:28:44.404: E/AndroidRuntime(282):     at android.app.ActivityThread.main(ActivityThread.java:4627)
08-23 02:28:44.404: E/AndroidRuntime(282):     at java.lang.reflect.Method.invokeNative(Native Method)
08-23 02:28:44.404: E/AndroidRuntime(282):     at java.lang.reflect.Method.invoke(Method.java:521)
08-23 02:28:44.404: E/AndroidRuntime(282):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)
08-23 02:28:44.404: E/AndroidRuntime(282):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)
08-23 02:28:44.404: E/AndroidRuntime(282):     at dalvik.system.NativeStart.main(Native Method)
... ...
原因是发布的时候没有加入wmqtt.jar包，解决办法如下：
1&gt; 在项目根目录下创建libs目录，并把wmqtt.jar包移入该目录。
2&gt; 重新配置项目的Java Build Path（右键菜单中的Properties选项中）。
3&gt; 重新打包发布即可。

运行效果如下：

点击“Start Push Service”按钮即可开启推送服务。这时我们可以看到rsmb的服务日志中打出以下提示：
20120823 113742.297 CWNAN0033I Connection attempt to listener 1883 received from client tokudu/9774d56d682e549c on address 192.168.28.39:3345
其中的“9774d56d682e549c”就是对应的客户端ID号。

<strong>4、发送服务准备</strong>

a&gt; 下载&amp;解压PHP版的发送服务端代码send_mqtt.zip（下载地址：http://download.csdn.net/detail/shagoo/4520102）
b&gt; 修改etc/config.php中推送服务端的IP地址和端口号，即<strong>MQTT_SERVER_HOST</strong>和<strong>MQTT_SERVER_POST</strong>常量。
c&gt; 打开对应的URL地址，就可以看到发送服务的界面，实际上就是向对应的推送客户端推送消息。</td>
</tr>
</tbody>
</table>
47.谈谈数据加密
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">数据加密又称密码学，它是一门历史悠久的技术，指通过加密算法和加密密钥将明文转变为密文，而解密则是通过解密算法和解密密钥将密文恢复为明文。数据加密目前仍是计算机系统对信息进行保护的一种最可靠的办法。它利用密码技术对信息进行加密，实现信息隐蔽，从而起到保护信息的安全的作用。用自己的话来说就是，只有双方才知道的协议。
<strong>数据加密 - 密码算法分类</strong>
1按发展进程分密码的发展:古典密码,对称密钥 密码公开密钥密码.
2按加密模式分对称算法:序列密码和分组密码.
经典密码 代替密码: 简单代替多名或同音代替多表代替多字母或多码代替换位密码: •对称加密算法 DES AES •非对称公钥算法 RSA 背包密码McEliece密码Rabin 椭圆曲线EIGamal D_H</td>
</tr>
</tbody>
</table>
48.解决问题和思考问题的方式
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">首先查看官方提供的API，通过自己对功能的理解，然后通过网络的途径，下载demo可以选择 github ，查找问题可以选择 stackover flow，然后可以问身边的朋友。</td>
</tr>
</tbody>
</table>
49.列举7到12个设计模式  以及它们的应用场景
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">设计模式，提供了很多软件工程问题所需处理的解决方案。
根据模式的目的可分为3类： 1.创建型模式：与对象的创建有关。 2.结构性模式：处理类与对象的组合。 3.行为性模式：对类或对象怎样交互和怎样 分配职责进行描述。
面向对象设计的2个基本原则: 1.针对接口编程，而不是针对实现编程。 2.优先使用对象组合，而不是类继承。
面向对象设计的5个设计原则： 1.单一职责原则(SRP) 2.开放封闭原则(OCP)  3.Liskov替换原则(LSP) 4.依赖倒置原则(DIP) 5.接口隔离原则(ISP)
23中设计模式： 1.创建型模式： (1).工厂方法模式 (2).抽象工厂模式 (3).创建者模式 (4).原型模式 (5).单例模式 2.结构型模式： (6).适配器模式 (7).桥模式 (8).组合模式 (9).装饰模式 (10).外观模式 (11).享元模式 (12).代理模式 3.行为型模式 (13).解释器模式 (14).模板方法模式 (15).职责链模式 (16).命令模式 (17).迭代器模式 (18).中介者模式 (19).备忘录模式 (20).观察者模式 (21).状态模式 (22).策略模式 (23).访问者模式  除此之外，后来人发现很多新的模式，如空模式等。
下面列举几个常见的问题导致重新设计，可能需要设计模式来分析解决： 1.通过显示的指定一个类来创建对象 2.对特殊操作的依赖 3.对硬件和软件平台的依赖 4.对对象表示或实现的依赖 5.算法依赖 6.紧耦合 7.通过生产子类来扩展功能 8.不能方便的对类进行修改
软件的设计臭味： 1.僵化性 2.脆弱性 3.顽固性 4.粘滞性 5.不必要的复杂性 6.不必要的重复 7.晦涩性  ... ... 总而言之，一句话，面向对象特性+原则+模式，折腾来折腾去就是这么个回事。<strong>设计模式（Design Patterns）</strong>
——可复用面向对象软件的基础
设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了可重用代码、让代码更容易被他人理解、保证代码可靠性。 毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理的运用设计模式可以完美的解决很多问题，每种模式在现在中都有相应的原理来与之对应，每一个模式描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是它能被广泛应用的原因。本章系<strong>Java之美[从菜鸟到高手演变]系列</strong>之设计模式，我们会以理论与实践相结合的方式来进行本章的学习，希望广大程序爱好者，学好设计模式，做一个优秀的软件工程师！
<strong>在阅读过程中有任何问题，请及时联系：egg。</strong>
<span style="text-decoration: underline;">邮箱：xtfggef@gmail.com</span> 微博：http://weibo.com/xtfggef
<strong>如有转载，请说明出处：</strong><span style="text-decoration: underline;"><strong>http://blog.csdn.net/zhangerqing</strong></span>
<strong>企业级项目实战(带源码)地址：http://zz563143188.iteye.com/blog/1825168</strong>
<strong>23种模式java实现源码及收集五年的开发资料下载地址</strong><strong>： </strong> http://pan.baidu.com/share/home?uk=4076915866&amp;view=share
<strong>一、设计模式的分类</strong>
总体来说设计模式分为三大类：
创建型模式，共五种：工厂方法模式、抽象工厂模式、单例模式、建造者模式、原型模式。
结构型模式，共七种：适配器模式、装饰器模式、代理模式、外观模式、桥接模式、组合模式、享元模式。
行为型模式，共十一种：策略模式、模板方法模式、观察者模式、迭代子模式、责任链模式、命令模式、备忘录模式、状态模式、访问者模式、中介者模式、解释器模式。
其实还有两类：并发型模式和线程池模式。用一个图片来整体描述一下：<strong>二、设计模式的六大原则</strong>
<strong>1、开闭原则（Open Close Principle）</strong>
开闭原则就是说<strong>对扩展开放，对修改关闭</strong>。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。所以一句话概括就是：为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。
<strong>2、里氏代换原则（Liskov Substitution Principle）</strong>
里氏代换原则(Liskov Substitution Principle LSP)面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。 LSP是继承复用的基石，只有当衍生类可以替换掉基类，软件单位的功能不受到影响时，基类才能真正被复用，而衍生类也能够在基类的基础上增加新的行为。里氏代换原则是对“开-闭”原则的补充。实现“开-闭”原则的关键步骤就是抽象化。而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。—— From Baidu 百科
<strong>3、依赖倒转原则（Dependence Inversion Principle）</strong>
这个是开闭原则的基础，具体内容：真对接口编程，依赖于抽象而不依赖于具体。
<strong>4、接口隔离原则（Interface Segregation Principle）</strong>
这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。还是一个降低类之间的耦合度的意思，从这儿我们看出，其实设计模式就是一个软件的设计思想，从大型软件架构出发，为了升级和维护方便。所以上文中多次出现：降低依赖，降低耦合。
<strong>5、迪米特法则（最少知道原则）（Demeter Principle）</strong>
为什么叫最少知道原则，就是说：一个实体应当尽量少的与其他实体之间发生相互作用，使得系统功能模块相对独立。
<strong>6、合成复用原则（Composite Reuse Principle）</strong>
原则是尽量使用合成/聚合的方式，而不是使用继承。
<strong>三、Java的23中设计模式</strong>
从这一块开始，我们详细介绍Java中23种设计模式的概念，应用场景等情况，并结合他们的特点及设计模式的原则进行分析。
<strong>1、工厂方法模式（Factory Method）</strong>
工厂方法模式分为三种：
<strong><em>11、普通工厂模式</em></strong>，就是建立一个工厂类，对实现了同一接口的一些类进行实例的创建。首先看下关系图：

举例如下：（我们举一个发送邮件和短信的例子）
首先，创建二者的共同接口：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sender {
<strong>public</strong> <strong>void</strong> Send();
}
其次，创建实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MailSender <strong>implements</strong> Sender {
@Override
<strong>public</strong> <strong>void</strong> Send() {
System.out.println("this is mailsender!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SmsSender <strong>implements</strong> Sender {

@Override
<strong>public</strong> <strong>void</strong> Send() {
System.out.println("this is sms sender!");
}
}
最后，建工厂类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SendFactory {

<strong>public</strong> Sender produce(String type) {
<strong>if</strong> ("mail".equals(type)) {
<strong>return</strong> <strong>new</strong> MailSender();
} <strong>else</strong> <strong>if</strong> ("sms".equals(type)) {
<strong>return</strong> <strong>new</strong> SmsSender();
} <strong>else</strong> {
System.out.println("请输入正确的类型!");
<strong>return</strong> <strong>null</strong>;
}
}
}
我们来测试下：
<strong>public</strong> <strong>class</strong> FactoryTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
SendFactory factory = <strong>new</strong> SendFactory();
Sender sender = factory.produce("sms");
sender.Send();
}
}
输出：this is sms sender!
<strong><em>22、多个工厂方法模式</em></strong>，是对普通工厂方法模式的改进，在普通工厂方法模式中，如果传递的字符串出错，则不能正确创建对象，而多个工厂方法模式是提供多个工厂方法，分别创建对象。关系图：

将上面的代码做下修改，改动下SendFactory类就行，如下：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span><strong>public</strong> <strong>class</strong> SendFactory {
<strong>public</strong> Sender produceMail(){
<strong>return</strong> <strong>new</strong> MailSender();
}

<strong>public</strong> Sender produceSms(){
<strong>return</strong> <strong>new</strong> SmsSender();
}
}
测试类如下：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> FactoryTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
SendFactory factory = <strong>new</strong> SendFactory();
Sender sender = factory.produceMail();
sender.Send();
}
}
输出：this is mailsender!
<strong><em>33、静态工厂方法模式</em></strong>，将上面的多个工厂方法模式里的方法置为静态的，不需要创建实例，直接调用即可。
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SendFactory {

<strong>public</strong> <strong>static</strong> Sender produceMail(){
<strong>return</strong> <strong>new</strong> MailSender();
}

<strong>public</strong> <strong>static</strong> Sender produceSms(){
<strong>return</strong> <strong>new</strong> SmsSender();
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> FactoryTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Sender sender = SendFactory.produceMail();
sender.Send();
}
}
输出：this is mailsender!
总体来说，工厂模式适合：凡是出现了大量的产品需要创建，并且具有共同的接口时，可以通过工厂方法模式进行创建。在以上的三种模式中，第一种如果传入的字符串有误，不能正确创建对象，第三种相对于第二种，不需要实例化工厂类，所以，大多数情况下，我们会选用第三种——静态工厂方法模式。
<strong>2、抽象工厂模式（Abstract Factory）</strong>
工厂方法模式有一个问题就是，类的创建依赖工厂类，也就是说，如果想要拓展程序，必须对工厂类进行修改，这违背了闭包原则，所以，从设计角度考虑，有一定的问题，如何解决？就用到抽象工厂模式，创建多个工厂类，这样一旦需要增加新的功能，直接增加新的工厂类就可以了，不需要修改之前的代码。因为抽象工厂不太好理解，我们先看看图，然后就和代码，就比较容易理解。

请看例子：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sender {
<strong>public</strong> <strong>void</strong> Send();
}
两个实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MailSender <strong>implements</strong> Sender {
@Override
<strong>public</strong> <strong>void</strong> Send() {
System.out.println("this is mailsender!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SmsSender <strong>implements</strong> Sender {

@Override
<strong>public</strong> <strong>void</strong> Send() {
System.out.println("this is sms sender!");
}
}
两个工厂类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SendMailFactory <strong>implements</strong> Provider {

@Override
<strong>public</strong> Sender produce(){
<strong>return</strong> <strong>new</strong> MailSender();
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SendSmsFactory <strong>implements</strong> Provider{

@Override
<strong>public</strong> Sender produce() {
<strong>return</strong> <strong>new</strong> SmsSender();
}
}
在提供一个接口：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Provider {
<strong>public</strong> Sender produce();
}
测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Provider provider = <strong>new</strong> SendMailFactory();
Sender sender = provider.produce();
sender.Send();
}
}
其实这个模式的好处就是，如果你现在想增加一个功能：发及时信息，则只需做一个实现类，实现Sender接口，同时做一个工厂类，实现Provider接口，就OK了，无需去改动现成的代码。这样做，拓展性较好！
<strong>3、单例模式（Singleton）</strong>
单例对象（Singleton）是一种常用的设计模式。在Java应用中，单例对象能保证在一个JVM中，该对象只有一个实例存在。这样的模式有几个好处：
1、某些类创建比较频繁，对于一些大型的对象，这是一笔很大的系统开销。
2、省去了new操作符，降低了系统内存的使用频率，减轻GC压力。
3、有些类如交易所的核心交易引擎，控制着交易流程，如果该类可以创建多个的话，系统完全乱了。（比如一个军队出现了多个司令员同时指挥，肯定会乱成一团），所以只有使用单例模式，才能保证核心交易服务器独立控制整个流程。
首先我们写一个简单的单例类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Singleton {

/* 持有私有静态实例，防止被引用，此处赋值为null，目的是实现延迟加载 */
<strong>private</strong> <strong>static</strong> Singleton instance = <strong>null</strong>;

/* 私有构造方法，防止被实例化 */
<strong>private</strong> Singleton() {
}

/* 静态工程方法，创建实例 */
<strong>public</strong> <strong>static</strong> Singleton getInstance() {
<strong>if</strong> (instance == <strong>null</strong>) {
instance = <strong>new</strong> Singleton();
}
<strong>return</strong> instance;
}

/* 如果该对象被用于序列化，可以保证对象在序列化前后保持一致 */
<strong>public</strong> Object readResolve() {
<strong>return</strong> instance;
}
}
这个类可以满足基本要求，但是，像这样毫无线程安全保护的类，如果我们把它放入多线程的环境下，肯定就会出现问题了，如何解决？我们首先会想到对getInstance方法加synchronized关键字，如下：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>static</strong> <strong>synchronized</strong> Singleton getInstance() {
<strong>if</strong> (instance == <strong>null</strong>) {
instance = <strong>new</strong> Singleton();
}
<strong>return</strong> instance;
}
但是，synchronized关键字锁住的是这个对象，这样的用法，在性能上会有所下降，因为每次调用getInstance()，都要对对象上锁，事实上，只有在第一次创建对象的时候需要加锁，之后就不需要了，所以，这个地方需要改进。我们改成下面这个：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>static</strong> Singleton getInstance() {
<strong>if</strong> (instance == <strong>null</strong>) {
<strong>synchronized</strong> (instance) {
<strong>if</strong> (instance == <strong>null</strong>) {
instance = <strong>new</strong> Singleton();
}
}
}
<strong>return</strong> instance;
}
似乎解决了之前提到的问题，将synchronized关键字加在了内部，也就是说当调用的时候是不需要加锁的，只有在instance为null，并创建对象的时候才需要加锁，性能有一定的提升。但是，这样的情况，还是有可能有问题的，看下面的情况：在Java指令中创建对象和赋值操作是分开进行的，也就是说instance = new Singleton();语句是分两步执行的。但是JVM并不保证这两个操作的先后顺序，也就是说有可能JVM会为新的Singleton实例分配空间，然后直接赋值给instance成员，然后再去初始化这个Singleton实例。这样就可能出错了，我们以A、B两个线程为例：
a&gt;A、B线程同时进入了第一个if判断
b&gt;A首先进入synchronized块，由于instance为null，所以它执行instance = new Singleton();
c&gt;由于JVM内部的优化机制，JVM先画出了一些分配给Singleton实例的空白内存，并赋值给instance成员（注意此时JVM没有开始初始化这个实例），然后A离开了synchronized块。
d&gt;B进入synchronized块，由于instance此时不是null，因此它马上离开了synchronized块并将结果返回给调用该方法的程序。
e&gt;此时B线程打算使用Singleton实例，却发现它没有被初始化，于是错误发生了。
所以程序还是有可能发生错误，其实程序在运行过程是很复杂的，从这点我们就可以看出，尤其是在写多线程环境下的程序更有难度，有挑战性。我们对该程序做进一步优化：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>private</strong> <strong>static</strong> <strong>class</strong> SingletonFactory{
<strong>private</strong> <strong>static</strong> Singleton instance = <strong>new</strong> Singleton();
}
<strong>public</strong> <strong>static</strong> Singleton getInstance(){
<strong>return</strong> SingletonFactory.instance;
}
实际情况是，单例模式使用内部类来维护单例的实现，JVM内部的机制能够保证当一个类被加载的时候，这个类的加载过程是线程互斥的。这样当我们第一次调用getInstance的时候，JVM能够帮我们保证instance只被创建一次，并且会保证把赋值给instance的内存初始化完毕，这样我们就不用担心上面的问题。同时该方法也只会在第一次调用的时候使用互斥机制，这样就解决了低性能问题。这样我们暂时总结一个完美的单例模式：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Singleton {

/* 私有构造方法，防止被实例化 */
<strong>private</strong> Singleton() {
}

/* 此处使用一个内部类来维护单例 */
<strong>private</strong> <strong>static</strong> <strong>class</strong> SingletonFactory {
<strong>private</strong> <strong>static</strong> Singleton instance = <strong>new</strong> Singleton();
}

/* 获取实例 */
<strong>public</strong> <strong>static</strong> Singleton getInstance() {
<strong>return</strong> SingletonFactory.instance;
}

/* 如果该对象被用于序列化，可以保证对象在序列化前后保持一致 */
<strong>public</strong> Object readResolve() {
<strong>return</strong> getInstance();
}
}
其实说它完美，也不一定，如果在构造函数中抛出异常，实例将永远得不到创建，也会出错。所以说，十分完美的东西是没有的，我们只能根据实际情况，选择最适合自己应用场景的实现方法。也有人这样实现：因为我们只需要在创建类的时候进行同步，所以只要将创建和getInstance()分开，单独为创建加synchronized关键字，也是可以的：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SingletonTest {

<strong>private</strong> <strong>static</strong> SingletonTest instance = <strong>null</strong>;

<strong>private</strong> SingletonTest() {
}

<strong>private</strong> <strong>static</strong> <strong>synchronized</strong> <strong>void</strong> syncInit() {
<strong>if</strong> (instance == <strong>null</strong>) {
instance = <strong>new</strong> SingletonTest();
}
}

<strong>public</strong> <strong>static</strong> SingletonTest getInstance() {
<strong>if</strong> (instance == <strong>null</strong>) {
syncInit();
}
<strong>return</strong> instance;
}
}
考虑性能的话，整个程序只需创建一次实例，所以性能也不会有什么影响。
<strong>补充：</strong><strong>采用"影子实例"的办法为单例对象的属性同步更新</strong>
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SingletonTest {

<strong>private</strong> <strong>static</strong> SingletonTest instance = <strong>null</strong>;
<strong>private</strong> Vector properties = <strong>null</strong>;

<strong>public</strong> Vector getProperties() {
<strong>return</strong> properties;
}

<strong>private</strong> SingletonTest() {
}

<strong>private</strong> <strong>static</strong> <strong>synchronized</strong> <strong>void</strong> syncInit() {
<strong>if</strong> (instance == <strong>null</strong>) {
instance = <strong>new</strong> SingletonTest();
}
}

<strong>public</strong> <strong>static</strong> SingletonTest getInstance() {
<strong>if</strong> (instance == <strong>null</strong>) {
syncInit();
}
<strong>return</strong> instance;
}

<strong>public</strong> <strong>void</strong> updateProperties() {
SingletonTest shadow = <strong>new</strong> SingletonTest();
properties = shadow.getProperties();
}
}
通过单例模式的学习告诉我们：
1、单例模式理解起来简单，但是具体实现起来还是有一定的难度。
2、synchronized关键字锁定的是对象，在用的时候，一定要在恰当的地方使用（注意需要使用锁的对象和过程，可能有的时候并不是整个对象及整个过程都需要锁）。
到这儿，单例模式基本已经讲完了，结尾处，笔者突然想到另一个问题，就是采用类的静态方法，实现单例模式的效果，也是可行的，此处二者有什么不同？
首先，静态类不能实现接口。（从类的角度说是可以的，但是那样就破坏了静态了。因为接口中不允许有static修饰的方法，所以即使实现了也是非静态的）
其次，单例可以被延迟初始化，静态类一般在第一次加载是初始化。之所以延迟加载，是因为有些类比较庞大，所以延迟加载有助于提升性能。
再次，单例类可以被继承，他的方法可以被覆写。但是静态类内部方法都是static，无法被覆写。
最后一点，单例类比较灵活，毕竟从实现上只是一个普通的Java类，只要满足单例的基本需求，你可以在里面随心所欲的实现一些其它功能，但是静态类不行。从上面这些概括中，基本可以看出二者的区别，但是，从另一方面讲，我们上面最后实现的那个单例模式，内部就是用一个静态类来实现的，所以，二者有很大的关联，只是我们考虑问题的层面不同罢了。两种思想的结合，才能造就出完美的解决方案，就像HashMap采用数组+链表来实现一样，其实生活中很多事情都是这样，单用不同的方法来处理问题，总是有优点也有缺点，最完美的方法是，结合各个方法的优点，才能最好的解决问题！
<strong>4、建造者模式（Builder）</strong>
工厂类模式提供的是创建单个类的模式，而建造者模式则是将各种产品集中起来进行管理，用来创建复合对象，所谓复合对象就是指某个类具有不同的属性，其实建造者模式就是前面抽象工厂模式和最后的Test结合起来得到的。我们看一下代码：
还和前面一样，一个Sender接口，两个实现类MailSender和SmsSender。最后，建造者类如下：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Builder {

<strong>private</strong> List list = <strong>new</strong> ArrayList();

<strong>public</strong> <strong>void</strong> produceMailSender(<strong>int</strong> count){
<strong>for</strong>(<strong>int</strong> i=0; ilist.add(<strong>new</strong> MailSender());
}
}

<strong>public</strong> <strong>void</strong> produceSmsSender(<strong>int</strong> count){
<strong>for</strong>(<strong>int</strong> i=0; ilist.add(<strong>new</strong> SmsSender());
}
}
}
测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Builder builder = <strong>new</strong> Builder();
builder.produceMailSender(10);
}
}
从这点看出，建造者模式将很多功能集成到一个类里，这个类可以创造出比较复杂的东西。所以与工程模式的区别就是：工厂模式关注的是创建单个产品，而建造者模式则关注创建符合对象，多个部分。因此，是选择工厂模式还是建造者模式，依实际情况而定。
<strong>5、原型模式（Prototype）</strong>
原型模式虽然是创建型的模式，但是与工程模式没有关系，从名字即可看出，该模式的思想就是将一个对象作为原型，对其进行复制、克隆，产生一个和原对象类似的新对象。本小结会通过对象的复制，进行讲解。在Java中，复制对象是通过clone()实现的，先创建一个原型类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Prototype <strong>implements</strong> Cloneable {

<strong>public</strong> Object clone() <strong>throws</strong> CloneNotSupportedException {
Prototype proto = (Prototype) <strong>super</strong>.clone();
<strong>return</strong> proto;
}
}
很简单，一个原型类，只需要实现Cloneable接口，覆写clone方法，此处clone方法可以改成任意的名称，因为Cloneable接口是个空接口，你可以任意定义实现类的方法名，如cloneA或者cloneB，因为此处的重点是super.clone()这句话，super.clone()调用的是Object的clone()方法，而在Object类中，clone()是native的，具体怎么实现，我会在另一篇文章中，关于解读Java中本地方法的调用，此处不再深究。在这儿，我将结合对象的浅复制和深复制来说一下，首先需要了解对象深、浅复制的概念：
浅复制：将一个对象复制后，基本数据类型的变量都会重新创建，而引用类型，指向的还是原对象所指向的。
深复制：将一个对象复制后，不论是基本数据类型还有引用类型，都是重新创建的。简单来说，就是深复制进行了完全彻底的复制，而浅复制不彻底。
此处，写一个深浅复制的例子：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Prototype <strong>implements</strong> Cloneable, Serializable {

<strong>private</strong> <strong>static</strong> <strong>final</strong> <strong>long</strong> serialVersionUID = 1L;
<strong>private</strong> String string;

<strong>private</strong> SerializableObject obj;

/* 浅复制 */
<strong>public</strong> Object clone() <strong>throws</strong> CloneNotSupportedException {
Prototype proto = (Prototype) <strong>super</strong>.clone();
<strong>return</strong> proto;
}

/* 深复制 */
<strong>public</strong> Object deepClone() <strong>throws</strong> IOException, ClassNotFoundException {

/* 写入当前对象的二进制流 */
ByteArrayOutputStream bos = <strong>new</strong> ByteArrayOutputStream();
ObjectOutputStream oos = <strong>new</strong> ObjectOutputStream(bos);
oos.writeObject(<strong>this</strong>);

/* 读出二进制流产生的新对象 */
ByteArrayInputStream bis = <strong>new</strong> ByteArrayInputStream(bos.toByteArray());
ObjectInputStream ois = <strong>new</strong> ObjectInputStream(bis);
<strong>return</strong> ois.readObject();
}

<strong>public</strong> String getString() {
<strong>return</strong> string;
}

<strong>public</strong> <strong>void</strong> setString(String string) {
<strong>this</strong>.string = string;
}

<strong>public</strong> SerializableObject getObj() {
<strong>return</strong> obj;
}

<strong>public</strong> <strong>void</strong> setObj(SerializableObject obj) {
<strong>this</strong>.obj = obj;
}

}

<strong>class</strong> SerializableObject <strong>implements</strong> Serializable {
<strong>private</strong> <strong>static</strong> <strong>final</strong> <strong>long</strong> serialVersionUID = 1L;
}

要实现深复制，需要采用流的形式读入当前对象的二进制输入，再写出二进制数据对应的对象。
我们接着讨论设计模式，上篇文章我讲完了5种创建型模式，这章开始，我将讲下7种结构型模式：适配器模式、装饰模式、代理模式、外观模式、桥接模式、组合模式、享元模式。其中对象的适配器模式是各种模式的起源，我们看下面的图：

适配器模式将某个类的接口转换成客户端期望的另一个接口表示，目的是消除由于接口不匹配所造成的类的兼容性问题。主要分为三类：类的适配器模式、对象的适配器模式、接口的适配器模式。首先，我们来看看<strong>类的适配器模式</strong>，先看类图：

核心思想就是：有一个Source类，拥有一个方法，待适配，目标接口时Targetable，通过Adapter类，将Source的功能扩展到Targetable里，看代码：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Source {

<strong>public</strong> <strong>void</strong> method1() {
System.out.println("this is original method!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Targetable {

/* 与原类中的方法相同 */
<strong>public</strong> <strong>void</strong> method1();

/* 新类的方法 */
<strong>public</strong> <strong>void</strong> method2();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Adapter <strong>extends</strong> Source <strong>implements</strong> Targetable {

@Override
<strong>public</strong> <strong>void</strong> method2() {
System.out.println("this is the targetable method!");
}
}
Adapter类继承Source类，实现Targetable接口，下面是测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> AdapterTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Targetable target = <strong>new</strong> Adapter();  接下来我们将要谈谈责任链模式，有多个对象，每个对象持有对下一个对象的引用，这样就会形成一条链，请求在这条链上传递，直到某一对象决定处理该请求。但是发出者并不清楚到底最终那个对象会处理该请求，所以，责任链模式可以实现，在隐瞒客户
target.method1();
target.method2();
}
}
输出：
this is original method! this is the targetable method!
这样Targetable接口的实现类就具有了Source类的功能。
<strong>对象的适配器模式</strong>
基本思路和类的适配器模式相同，只是将Adapter类作修改，这次不继承Source类，而是持有Source类的实例，以达到解决兼容性的问题。看图：

只需要修改Adapter类的源码即可：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Wrapper <strong>implements</strong> Targetable {

<strong>private</strong> Source source;

<strong>public</strong> Wrapper(Source source){
<strong>super</strong>();
<strong>this</strong>.source = source;
}
@Override
<strong>public</strong> <strong>void</strong> method2() {
System.out.println("this is the targetable method!");
}

@Override
<strong>public</strong> <strong>void</strong> method1() {
source.method1();
}
}
测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> AdapterTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Source source = <strong>new</strong> Source();
Targetable target = <strong>new</strong> Wrapper(source);
target.method1();
target.method2();
}
}
输出与第一种一样，只是适配的方法不同而已。
第三种适配器模式是<strong>接口的适配器模式</strong>，接口的适配器是这样的：有时我们写的一个接口中有多个抽象方法，当我们写该接口的实现类时，必须实现该接口的所有方法，这明显有时比较浪费，因为并不是所有的方法都是我们需要的，有时只需要某一些，此处为了解决这个问题，我们引入了接口的适配器模式，借助于一个抽象类，该抽象类实现了该接口，实现了所有的方法，而我们不和原始的接口打交道，只和该抽象类取得联系，所以我们写一个类，继承该抽象类，重写我们需要的方法就行。看一下类图：

这个很好理解，在实际开发中，我们也常会遇到这种接口中定义了太多的方法，以致于有时我们在一些实现类中并不是都需要。看代码：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sourceable {

<strong>public</strong> <strong>void</strong> method1();
<strong>public</strong> <strong>void</strong> method2();
}
抽象类Wrapper2：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> Wrapper2 <strong>implements</strong> Sourceable{

<strong>public</strong> <strong>void</strong> method1(){}
<strong>public</strong> <strong>void</strong> method2(){}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SourceSub1 <strong>extends</strong> Wrapper2 {
<strong>public</strong> <strong>void</strong> method1(){
System.out.println("the sourceable interface's first Sub1!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SourceSub2 <strong>extends</strong> Wrapper2 {
<strong>public</strong> <strong>void</strong> method2(){
System.out.println("the sourceable interface's second Sub2!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> WrapperTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Sourceable source1 = <strong>new</strong> SourceSub1();
Sourceable source2 = <strong>new</strong> SourceSub2();

source1.method1();
source1.method2();
source2.method1();
source2.method2();
}
}
测试输出：
the sourceable interface's first Sub1! the sourceable interface's second Sub2!
达到了我们的效果！
讲了这么多，总结一下三种适配器模式的应用场景：
类的适配器模式：当希望将<strong>一个类</strong>转换成满足<strong>另一个新接口</strong>的类时，可以使用类的适配器模式，创建一个新类，继承原有的类，实现新的接口即可。
对象的适配器模式：当希望将一个对象转换成满足另一个新接口的对象时，可以创建一个Wrapper类，持有原类的一个实例，在Wrapper类的方法中，调用实例的方法就行。
接口的适配器模式：当不希望实现一个接口中所有的方法时，可以创建一个抽象类Wrapper，实现所有方法，我们写别的类的时候，继承抽象类即可。
<strong>7、装饰模式（Decorator）</strong>
顾名思义，装饰模式就是给一个对象增加一些新的功能，而且是动态的，要求装饰对象和被装饰对象实现同一个接口，装饰对象持有被装饰对象的实例，关系图如下：

Source类是被装饰类，Decorator类是一个装饰类，可以为Source类动态的添加一些功能，代码如下：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sourceable {
<strong>public</strong> <strong>void</strong> method();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Source <strong>implements</strong> Sourceable {

@Override
<strong>public</strong> <strong>void</strong> method() {
System.out.println("the original method!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Decorator <strong>implements</strong> Sourceable {

<strong>private</strong> Sourceable source;

<strong>public</strong> Decorator(Sourceable source){
<strong>super</strong>();
<strong>this</strong>.source = source;
}
@Override
<strong>public</strong> <strong>void</strong> method() {
System.out.println("before decorator!");
source.method();
System.out.println("after decorator!");
}
}
测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> DecoratorTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Sourceable source = <strong>new</strong> Source();
Sourceable obj = <strong>new</strong> Decorator(source);
obj.method();
}
}
输出：
before decorator! the original method! after decorator!
装饰器模式的应用场景：
1、需要扩展一个类的功能。
2、动态的为一个对象增加功能，而且还能动态撤销。（继承不能做到这一点，继承的功能是静态的，不能动态增删。）
缺点：产生过多相似的对象，不易排错！
<strong>8、代理模式（Proxy）</strong>
其实每个模式名称就表明了该模式的作用，代理模式就是多一个代理类出来，替原对象进行一些操作，比如我们在租房子的时候回去找中介，为什么呢？因为你对该地区房屋的信息掌握的不够全面，希望找一个更熟悉的人去帮你做，此处的代理就是这个意思。再如我们有的时候打官司，我们需要请律师，因为律师在法律方面有专长，可以替我们进行操作，表达我们的想法。先来看看关系图：

根据上文的阐述，代理模式就比较容易的理解了，我们看下代码：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sourceable {
<strong>public</strong> <strong>void</strong> method();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Source <strong>implements</strong> Sourceable {

@Override
<strong>public</strong> <strong>void</strong> method() {
System.out.println("the original method!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Proxy <strong>implements</strong> Sourceable {

<strong>private</strong> Source source;
<strong>public</strong> Proxy(){
<strong>super</strong>();
<strong>this</strong>.source = <strong>new</strong> Source();
}
@Override
<strong>public</strong> <strong>void</strong> method() {
before();
source.method();
atfer();
}
<strong>private</strong> <strong>void</strong> atfer() {
System.out.println("after proxy!");
}
<strong>private</strong> <strong>void</strong> before() {
System.out.println("before proxy!");
}
}
测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> ProxyTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Sourceable source = <strong>new</strong> Proxy();
source.method();
}

}
输出：
before proxy! the original method! after proxy!
代理模式的应用场景：
如果已有的方法在使用的时候需要对原有的方法进行改进，此时有两种办法：
1、修改原有的方法来适应。这样违反了“对扩展开放，对修改关闭”的原则。
2、就是采用一个代理类调用原有的方法，且对产生的结果进行控制。这种方法就是代理模式。
使用代理模式，可以将功能划分的更加清晰，有助于后期维护！
<strong>9、外观模式（Facade）</strong>
外观模式是为了解决类与类之家的依赖关系的，像spring一样，可以将类和类之间的关系配置到配置文件中，而外观模式就是将他们的关系放在一个Facade类中，降低了类类之间的耦合度，该模式中没有涉及到接口，看下类图：（我们以一个计算机的启动过程为例）

我们先看下实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> CPU {

<strong>public</strong> <strong>void</strong> startup(){
System.out.println("cpu startup!");
}

<strong>public</strong> <strong>void</strong> shutdown(){
System.out.println("cpu shutdown!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Memory {

<strong>public</strong> <strong>void</strong> startup(){
System.out.println("memory startup!");
}

<strong>public</strong> <strong>void</strong> shutdown(){
System.out.println("memory shutdown!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Disk {

<strong>public</strong> <strong>void</strong> startup(){
System.out.println("disk startup!");
}

<strong>public</strong> <strong>void</strong> shutdown(){
System.out.println("disk shutdown!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Computer {
<strong>private</strong> CPU cpu;
<strong>private</strong> Memory memory;
<strong>private</strong> Disk disk;

<strong>public</strong> Computer(){
cpu = <strong>new</strong> CPU();
memory = <strong>new</strong> Memory();
disk = <strong>new</strong> Disk();
}

<strong>public</strong> <strong>void</strong> startup(){
System.out.println("start the computer!");
cpu.startup();
memory.startup();
disk.startup();
System.out.println("start computer finished!");
}

<strong>public</strong> <strong>void</strong> shutdown(){
System.out.println("begin to close the computer!");
cpu.shutdown();
memory.shutdown();
disk.shutdown();
System.out.println("computer closed!");
}
}
User类如下：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> User {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Computer computer = <strong>new</strong> Computer();
computer.startup();
computer.shutdown();
}
}
输出：
start the computer! cpu startup! memory startup! disk startup! start computer finished! begin to close the computer! cpu shutdown! memory shutdown! disk shutdown! computer closed!
如果我们没有Computer类，那么，CPU、Memory、Disk他们之间将会相互持有实例，产生关系，这样会造成严重的依赖，修改一个类，可能会带来其他类的修改，这不是我们想要看到的，有了Computer类，他们之间的关系被放在了Computer类里，这样就起到了解耦的作用，这，就是外观模式！
<strong>10、桥接模式（Bridge）</strong>
桥接模式就是把事物和其具体实现分开，使他们可以各自独立的变化。桥接的用意是：<strong>将抽象化与实现化解耦，使得二者可以独立变化</strong>，像我们常用的JDBC桥DriverManager一样，JDBC进行连接数据库的时候，在各个数据库之间进行切换，基本不需要动太多的代码，甚至丝毫不用动，原因就是JDBC提供统一接口，每个数据库提供各自的实现，用一个叫做数据库驱动的程序来桥接就行了。我们来看看关系图：

实现代码：
先定义接口：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Sourceable {
<strong>public</strong> <strong>void</strong> method();
}
分别定义两个实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SourceSub1 <strong>implements</strong> Sourceable {

@Override
<strong>public</strong> <strong>void</strong> method() {
System.out.println("this is the first sub!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> SourceSub2 <strong>implements</strong> Sourceable {

@Override
<strong>public</strong> <strong>void</strong> method() {
System.out.println("this is the second sub!");
}
}
定义一个桥，持有Sourceable的一个实例：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> Bridge {
<strong>private</strong> Sourceable source;

<strong>public</strong> <strong>void</strong> method(){
source.method();
}

<strong>public</strong> Sourceable getSource() {
<strong>return</strong> source;
}

<strong>public</strong> <strong>void</strong> setSource(Sourceable source) {
<strong>this</strong>.source = source;
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyBridge <strong>extends</strong> Bridge {
<strong>public</strong> <strong>void</strong> method(){
getSource().method();
}
}
测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> BridgeTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {

Bridge bridge = <strong>new</strong> MyBridge();

/*调用第一个对象*/
Sourceable source1 = <strong>new</strong> SourceSub1();
bridge.setSource(source1);
bridge.method();

/*调用第二个对象*/
Sourceable source2 = <strong>new</strong> SourceSub2();
bridge.setSource(source2);
bridge.method();
}
}
output：
this is the first sub! this is the second sub!
这样，就通过对Bridge类的调用，实现了对接口Sourceable的实现类SourceSub1和SourceSub2的调用。接下来我再画个图，大家就应该明白了，因为这个图是我们JDBC连接的原理，有数据库学习基础的，一结合就都懂了。

<strong>11、组合模式（Composite）</strong>
组合模式有时又叫<span style="text-decoration: underline;"><strong>部分-整体</strong></span>模式在处理类似树形结构的问题时比较方便，看看关系图：

直接来看代码：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> TreeNode {

<strong>private</strong> String name;
<strong>private</strong> TreeNode parent;
<strong>private</strong> Vector children = <strong>new</strong> Vector();

<strong>public</strong> TreeNode(String name){
<strong>this</strong>.name = name;
}

<strong>public</strong> String getName() {
<strong>return</strong> name;
}

<strong>public</strong> <strong>void</strong> setName(String name) {
<strong>this</strong>.name = name;
}

<strong>public</strong> TreeNode getParent() {
<strong>return</strong> parent;
}

<strong>public</strong> <strong>void</strong> setParent(TreeNode parent) {
<strong>this</strong>.parent = parent;
}

//添加孩子节点
<strong>public</strong> <strong>void</strong> add(TreeNode node){
children.add(node);
}

//删除孩子节点
<strong>public</strong> <strong>void</strong> remove(TreeNode node){
children.remove(node);
}

//取得孩子节点
<strong>public</strong> Enumeration getChildren(){
<strong>return</strong> children.elements();
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Tree {

TreeNode root = <strong>null</strong>;

<strong>public</strong> Tree(String name) {
root = <strong>new</strong> TreeNode(name);
}

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Tree tree = <strong>new</strong> Tree("A");
TreeNode nodeB = <strong>new</strong> TreeNode("B");
TreeNode nodeC = <strong>new</strong> TreeNode("C");

nodeB.add(nodeC);
tree.root.add(nodeB);
System.out.println("build the tree finished!");
}
}
使用场景：将多个对象组合在一起进行操作，常用于表示树形结构中，例如二叉树，数等。
<strong>12、享元模式（Flyweight）</strong>
享元模式的主要目的是实现对象的共享，即共享池，当系统中对象多的时候可以减少内存的开销，通常与工厂模式一起使用。

FlyWeightFactory负责创建和管理享元单元，当一个客户端请求时，工厂需要检查当前对象池中是否有符合条件的对象，如果有，就返回已经存在的对象，如果没有，则创建一个新对象，FlyWeight是超类。一提到共享池，我们很容易联想到Java里面的JDBC连接池，想想每个连接的特点，我们不难总结出：适用于作共享的一些个对象，他们有一些共有的属性，就拿数据库连接池来说，url、driverClassName、username、password及dbname，这些属性对于每个连接来说都是一样的，所以就适合用享元模式来处理，建一个工厂类，将上述类似属性作为内部数据，其它的作为外部数据，在方法调用时，当做参数传进来，这样就节省了空间，减少了实例的数量。
看个例子：

看下数据库连接池的代码：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> ConnectionPool {

<strong>private</strong> Vector pool;

/*公有属性*/
<strong>private</strong> String url = "jdbc:mysql://localhost:3306/test";
<strong>private</strong> String username = "root";
<strong>private</strong> String password = "root";
<strong>private</strong> String driverClassName = "com.mysql.jdbc.Driver";

<strong>private</strong> <strong>int</strong> poolSize = 100;
<strong>private</strong> <strong>static</strong> ConnectionPool instance = <strong>null</strong>;
Connection conn = <strong>null</strong>;

/*构造方法，做一些初始化工作*/
<strong>private</strong> ConnectionPool() {
pool = <strong>new</strong> Vector(poolSize);

<strong>for</strong> (<strong>int</strong> i = 0; i < poolSize; i++) {
<strong>try</strong> {
Class.forName(driverClassName);
conn = DriverManager.getConnection(url, username, password);
pool.add(conn);
} <strong>catch</strong> (ClassNotFoundException e) {
e.printStackTrace();
} <strong>catch</strong> (SQLException e) {
e.printStackTrace();
}
}
}

/* 返回连接到连接池 */
<strong>public</strong> <strong>synchronized</strong> <strong>void</strong> release() {
pool.add(conn);
}

/* 返回连接池中的一个数据库连接 */
<strong>public</strong> <strong>synchronized</strong> Connection getConnection() {
<strong>if</strong> (pool.size() > 0) {
Connection conn = pool.get(0);
pool.remove(conn);
<strong>return</strong> conn;
} <strong>else</strong> {
<strong>return</strong> <strong>null</strong>;
}
}
}

通过连接池的管理，实现了数据库连接的共享，不需要每一次都重新创建连接，节省了数据库重新创建的开销，提升了系统的性能！本章讲解了7种结构型模式，因为篇幅的问题，剩下的11种行为型模式，
本章是关于设计模式的最后一讲，会讲到第三种设计模式——行为型模式，共11种：策略模式、模板方法模式、观察者模式、迭代子模式、责任链模式、命令模式、备忘录模式、状态模式、访问者模式、中介者模式、解释器模式。这段时间一直在写关于设计模式的东西，终于写到一半了，写博文是个很费时间的东西，因为我得为读者负责，不论是图还是代码还是表述，都希望能尽量写清楚，以便读者理解，我想不论是我还是读者，都希望看到高质量的博文出来，从我本人出发，我会一直坚持下去，不断更新，源源动力来自于读者朋友们的不断支持，我会尽自己的努力，写好每一篇文章！希望大家能不断给出意见和建议，共同打造完美的博文！
<strong><em> </em></strong>
<strong> </strong>
先来张图，看看这11中模式的关系：
第一类：通过父类与子类的关系进行实现。第二类：两个类之间。第三类：类的状态。第四类：通过中间类

<strong>13、策略模式（strategy）</strong>
策略模式定义了一系列算法，并将每个算法封装起来，使他们可以相互替换，且算法的变化不会影响到使用算法的客户。需要设计一个接口，为一系列实现类提供统一的方法，多个实现类实现该接口，设计一个抽象类（可有可无，属于辅助类），提供辅助函数，关系图如下：

图中ICalculator提供同意的方法， AbstractCalculator是辅助类，提供辅助方法，接下来，依次实现下每个类：
首先统一接口：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> ICalculator {
<strong>public</strong> <strong>int</strong> calculate(String exp);
}
辅助类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> AbstractCalculator {

<strong>public</strong> <strong>int</strong>[] split(String exp,String opt){
String array[] = exp.split(opt);
<strong>int</strong> arrayInt[] = <strong>new</strong> <strong>int</strong>[2];
arrayInt[0] = Integer.parseInt(array[0]);
arrayInt[1] = Integer.parseInt(array[1]);
<strong>return</strong> arrayInt;
}
}
三个实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Plus <strong>extends</strong> AbstractCalculator <strong>implements</strong> ICalculator {

@Override
<strong>public</strong> <strong>int</strong> calculate(String exp) {
<strong>int</strong> arrayInt[] = split(exp,"\\+");
<strong>return</strong> arrayInt[0]+arrayInt[1];
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Minus <strong>extends</strong> AbstractCalculator <strong>implements</strong> ICalculator {

@Override
<strong>public</strong> <strong>int</strong> calculate(String exp) {
<strong>int</strong> arrayInt[] = split(exp,"-");
<strong>return</strong> arrayInt[0]-arrayInt[1];
}

}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Multiply <strong>extends</strong> AbstractCalculator <strong>implements</strong> ICalculator {

@Override
<strong>public</strong> <strong>int</strong> calculate(String exp) {
<strong>int</strong> arrayInt[] = split(exp,"\\*");
<strong>return</strong> arrayInt[0]*arrayInt[1];
}
}
简单的测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> StrategyTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
String exp = "2+8";
ICalculator cal = <strong>new</strong> Plus();
<strong>int</strong> result = cal.calculate(exp);
System.out.println(result);
}
}
输出：10
策略模式的决定权在用户，系统本身提供不同算法的实现，新增或者删除算法，对各种算法做封装。因此，策略模式多用在算法决策系统中，外部用户只需要决定用哪个算法即可。
<strong>14、模板方法模式（Template Method）</strong>
解释一下模板方法模式，就是指：一个抽象类中，有一个主方法，再定义1...n个方法，可以是抽象的，也可以是实际的方法，定义一个类，继承该抽象类，重写抽象方法，通过调用抽象类，实现对子类的调用，先看个关系图：

就是在AbstractCalculator类中定义一个主方法calculate，calculate()调用spilt()等，Plus和Minus分别继承AbstractCalculator类，通过对AbstractCalculator的调用实现对子类的调用，看下面的例子：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> AbstractCalculator {

/*主方法，实现对本类其它方法的调用*/
<strong>public</strong> <strong>final</strong> <strong>int</strong> calculate(String exp,String opt){
<strong>int</strong> array[] = split(exp,opt);
<strong>return</strong> calculate(array[0],array[1]);
}

/*被子类重写的方法*/
<strong>abstract</strong> <strong>public</strong> <strong>int</strong> calculate(<strong>int</strong> num1,<strong>int</strong> num2);

<strong>public</strong> <strong>int</strong>[] split(String exp,String opt){
String array[] = exp.split(opt);
<strong>int</strong> arrayInt[] = <strong>new</strong> <strong>int</strong>[2];
arrayInt[0] = Integer.parseInt(array[0]);
arrayInt[1] = Integer.parseInt(array[1]);
<strong>return</strong> arrayInt;
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Plus <strong>extends</strong> AbstractCalculator {

@Override
<strong>public</strong> <strong>int</strong> calculate(<strong>int</strong> num1,<strong>int</strong> num2) {
<strong>return</strong> num1 + num2;
}
}
测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> StrategyTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
String exp = "8+8";
AbstractCalculator cal = <strong>new</strong> Plus();
<strong>int</strong> result = cal.calculate(exp, "\\+");
System.out.println(result);
}
}
我跟踪下这个小程序的执行过程：首先将exp和"\\+"做参数，调用AbstractCalculator类里的calculate(String,String)方法，在calculate(String,String)里调用同类的split()，之后再调用calculate(int ,int)方法，从这个方法进入到子类中，执行完return num1 + num2后，将值返回到AbstractCalculator类，赋给result，打印出来。正好验证了我们开头的思路。
<strong>15、观察者模式（Observer）</strong>
包括这个模式在内的接下来的四个模式，都是类和类之间的关系，不涉及到继承，学的时候应该 记得归纳，记得本文最开始的那个图。观察者模式很好理解，类似于邮件订阅和RSS订阅，当我们浏览一些博客或wiki时，经常会看到RSS图标，就这的意思是，当你订阅了该文章，如果后续有更新，会及时通知你。其实，简单来讲就一句话：当一个对象变化时，其它依赖该对象的对象都会收到通知，并且随着变化！对象之间是一种一对多的关系。先来看看关系图：

我解释下这些类的作用：MySubject类就是我们的主对象，Observer1和Observer2是依赖于MySubject的对象，当MySubject变化时，Observer1和Observer2必然变化。AbstractSubject类中定义着需要监控的对象列表，可以对其进行修改：增加或删除被监控对象，且当MySubject变化时，负责通知在列表内存在的对象。我们看实现代码：
一个Observer接口：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Observer {
<strong>public</strong> <strong>void</strong> update();
}
两个实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Observer1 <strong>implements</strong> Observer {

@Override
<strong>public</strong> <strong>void</strong> update() {
System.out.println("observer1 has received!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Observer2 <strong>implements</strong> Observer {

@Override
<strong>public</strong> <strong>void</strong> update() {
System.out.println("observer2 has received!");
}

}
Subject接口及实现类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Subject {

/*增加观察者*/
<strong>public</strong> <strong>void</strong> add(Observer observer);

/*删除观察者*/
<strong>public</strong> <strong>void</strong> del(Observer observer);

/*通知所有的观察者*/
<strong>public</strong> <strong>void</strong> notifyObservers();

/*自身的操作*/
<strong>public</strong> <strong>void</strong> operation();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> AbstractSubject <strong>implements</strong> Subject {

<strong>private</strong> Vector vector = <strong>new</strong> Vector();
@Override
<strong>public</strong> <strong>void</strong> add(Observer observer) {
vector.add(observer);
}

@Override
<strong>public</strong> <strong>void</strong> del(Observer observer) {
vector.remove(observer);
}

@Override
<strong>public</strong> <strong>void</strong> notifyObservers() {
Enumeration enumo = vector.elements();
<strong>while</strong>(enumo.hasMoreElements()){
enumo.nextElement().update();
}
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MySubject <strong>extends</strong> AbstractSubject {

@Override
<strong>public</strong> <strong>void</strong> operation() {
System.out.println("update self!");
notifyObservers();
}

}
测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> ObserverTest {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Subject sub = <strong>new</strong> MySubject();
sub.add(<strong>new</strong> Observer1());
sub.add(<strong>new</strong> Observer2());

sub.operation();
}

}
输出：
update self! observer1 has received! observer2 has received!
这些东西，其实不难，只是有些抽象，不太容易整体理解，建议读者：<strong>根据关系图，新建项目，自己写代码（或者参考我的代码）,按照总体思路走一遍，这样才能体会它的思想，理解起来容易！</strong><span style="text-decoration: underline;"><strong> </strong></span>
<strong>16、迭代子模式（Iterator）</strong>
顾名思义，迭代器模式就是顺序访问聚集中的对象，一般来说，集合中非常常见，如果对集合类比较熟悉的话，理解本模式会十分轻松。这句话包含两层意思：一是需要遍历的对象，即聚集对象，二是迭代器对象，用于对聚集对象进行遍历访问。我们看下关系图：

这个思路和我们常用的一模一样，MyCollection中定义了集合的一些操作，MyIterator中定义了一系列迭代操作，且持有Collection实例，我们来看看实现代码：
两个接口：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Collection {

<strong>public</strong> Iterator iterator();

/*取得集合元素*/
<strong>public</strong> Object get(<strong>int</strong> i);

/*取得集合大小*/
<strong>public</strong> <strong>int</strong> size();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Iterator {
//前移
<strong>public</strong> Object previous();

//后移
<strong>public</strong> Object next();
<strong>public</strong> <strong>boolean</strong> hasNext();

//取得第一个元素
<strong>public</strong> Object first();
}
两个实现：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyCollection <strong>implements</strong> Collection {

<strong>public</strong> String string[] = {"A","B","C","D","E"};
@Override
<strong>public</strong> Iterator iterator() {
<strong>return</strong> <strong>new</strong> MyIterator(<strong>this</strong>);
}

@Override
<strong>public</strong> Object get(<strong>int</strong> i) {
<strong>return</strong> string[i];
}

@Override
<strong>public</strong> <strong>int</strong> size() {
<strong>return</strong> string.length;
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyIterator <strong>implements</strong> Iterator {

<strong>private</strong> Collection collection;
<strong>private</strong> <strong>int</strong> pos = -1;

<strong>public</strong> MyIterator(Collection collection){
<strong>this</strong>.collection = collection;
}

@Override
<strong>public</strong> Object previous() {
<strong>if</strong>(pos > 0){
pos--;
}
<strong>return</strong> collection.get(pos);
}

@Override
<strong>public</strong> Object next() {
<strong>if</strong>(pos
<collection.size()-1){
pos++;
}
<strong>return</strong> collection.get(pos);
}

@Override
<strong>public</strong> <strong>boolean</strong> hasNext() {
<strong>if</strong>(pos
<collection.size()-1){
<strong>return</strong> <strong>true</strong>;
}<strong>else</strong>{
<strong>return</strong> <strong>false</strong>;
}
}

@Override
<strong>public</strong> Object first() {
pos = 0;
<strong>return</strong> collection.get(pos);
}

}
测试类：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Collection collection = <strong>new</strong> MyCollection();
Iterator it = collection.iterator();

<strong>while</strong>(it.hasNext()){
System.out.println(it.next());
}
}
}
输出：A B C D E
此处我们貌似模拟了一个集合类的过程，感觉是不是很爽？其实JDK中各个类也都是这些基本的东西，加一些设计模式，再加一些优化放到一起的，只要我们把这些东西学会了，掌握好了，我们也可以写出自己的集合类，甚至框架！
<strong>17、责任链模式（Chain of Responsibility）</strong>接下来我们将要谈谈责任链模式，有多个对象，每个对象持有对下一个对象的引用，这样就会形成一条链，请求在这条链上传递，直到某一对象决定处理该请求。但是发出者并不清楚到底最终那个对象会处理该请求，所以，责任链模式可以实现，在隐瞒客户端的情况下，对系统进行动态的调整。先看看关系图：

Abstracthandler类提供了get和set方法，方便MyHandle类设置和修改引用对象，MyHandle类是核心，实例化后生成一系列相互持有的对象，构成一条链。
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Handler {
<strong>public</strong> <strong>void</strong> operator();
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> AbstractHandler {

<strong>private</strong> Handler handler;

<strong>public</strong> Handler getHandler() {
<strong>return</strong> handler;
}

<strong>public</strong> <strong>void</strong> setHandler(Handler handler) {
<strong>this</strong>.handler = handler;
}

}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyHandler <strong>extends</strong> AbstractHandler <strong>implements</strong> Handler {

<strong>private</strong> String name;

<strong>public</strong> MyHandler(String name) {
<strong>this</strong>.name = name;
}

@Override
<strong>public</strong> <strong>void</strong> operator() {
System.out.println(name+"deal!");
<strong>if</strong>(getHandler()!=<strong>null</strong>){
getHandler().operator();
}
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
MyHandler h1 = <strong>new</strong> MyHandler("h1");
MyHandler h2 = <strong>new</strong> MyHandler("h2");
MyHandler h3 = <strong>new</strong> MyHandler("h3");

h1.setHandler(h2);
h2.setHandler(h3);

h1.operator();
}
}
输出：
h1deal! h2deal! h3deal!
此处强调一点就是，链接上的请求可以是一条链，可以是一个树，还可以是一个环，模式本身不约束这个，需要我们自己去实现，同时，在一个时刻，命令只允许由一个对象传给另一个对象，而不允许传给多个对象。
<strong> 18、命令模式（Command）</strong>
命令模式很好理解，举个例子，司令员下令让士兵去干件事情，从整个事情的角度来考虑，司令员的作用是，发出口令，口令经过传递，传到了士兵耳朵里，士兵去执行。这个过程好在，三者相互解耦，任何一方都不用去依赖其他人，只需要做好自己的事儿就行，司令员要的是结果，不会去关注到底士兵是怎么实现的。我们看看关系图：

Invoker是调用者（司令员），Receiver是被调用者（士兵），MyCommand是命令，实现了Command接口，持有接收对象，看实现代码：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Command {
<strong>public</strong> <strong>void</strong> exe();
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyCommand <strong>implements</strong> Command {

<strong>private</strong> Receiver receiver;

<strong>public</strong> MyCommand(Receiver receiver) {
<strong>this</strong>.receiver = receiver;
}

@Override
<strong>public</strong> <strong>void</strong> exe() {
receiver.action();
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Receiver {
<strong>public</strong> <strong>void</strong> action(){
System.out.println("command received!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Invoker {

<strong>private</strong> Command command;

<strong>public</strong> Invoker(Command command) {
<strong>this</strong>.command = command;
}

<strong>public</strong> <strong>void</strong> action(){
command.exe();
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Receiver receiver = <strong>new</strong> Receiver();
Command cmd = <strong>new</strong> MyCommand(receiver);
Invoker invoker = <strong>new</strong> Invoker(cmd);
invoker.action();
}
}
输出：command received!
这个很哈理解，命令模式的目的就是达到命令的发出者和执行者之间解耦，实现请求和执行分开，熟悉Struts的同学应该知道，Struts其实就是一种将请求和呈现分离的技术，其中必然涉及命令模式的思想！
其实每个设计模式都是很重要的一种思想，看上去很熟，其实是因为我们在学到的东西中都有涉及，尽管有时我们并不知道，其实在Java本身的设计之中处处都有体现，像AWT、JDBC、集合类、IO管道或者是Web框架，里面设计模式无处不在。因为我们篇幅有限，很难讲每一个设计模式都讲的很详细，不过我会尽我所能，尽量在有限的空间和篇幅内，把意思写清楚了，更好让大家明白。本章不出意外的话，应该是设计模式最后一讲了，首先还是上一下上篇开头的那个图：

本章讲讲第三类和第四类。
<strong>19、备忘录模式（Memento）</strong>
主要目的是保存一个对象的某个状态，以便在适当的时候恢复对象，个人觉得叫备份模式更形象些，通俗的讲下：假设有原始类A，A中有各种属性，A可以决定需要备份的属性，备忘录类B是用来存储A的一些内部状态，类C呢，就是一个用来存储备忘录的，且只能存储，不能修改等操作。做个图来分析一下：

Original类是原始类，里面有需要保存的属性value及创建一个备忘录类，用来保存value值。Memento类是备忘录类，Storage类是存储备忘录的类，持有Memento类的实例，该模式很好理解。直接看源码：
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Original {

<strong>private</strong> String value;

<strong>public</strong> String getValue() {
<strong>return</strong> value;
}

<strong>public</strong> <strong>void</strong> setValue(String value) {
<strong>this</strong>.value = value;
}

<strong>public</strong> Original(String value) {
<strong>this</strong>.value = value;
}

<strong>public</strong> Memento createMemento(){
<strong>return</strong> <strong>new</strong> Memento(value);
}

<strong>public</strong> <strong>void</strong> restoreMemento(Memento memento){
<strong>this</strong>.value = memento.getValue();
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Memento {

<strong>private</strong> String value;

<strong>public</strong> Memento(String value) {
<strong>this</strong>.value = value;
}

<strong>public</strong> String getValue() {
<strong>return</strong> value;
}

<strong>public</strong> <strong>void</strong> setValue(String value) {
<strong>this</strong>.value = value;
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Storage {

<strong>private</strong> Memento memento;

<strong>public</strong> Storage(Memento memento) {
<strong>this</strong>.memento = memento;
}

<strong>public</strong> Memento getMemento() {
<strong>return</strong> memento;
}

<strong>public</strong> <strong>void</strong> setMemento(Memento memento) {
<strong>this</strong>.memento = memento;
}
}
测试类：
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {

// 创建原始类
Original origi = <strong>new</strong> Original("egg");

// 创建备忘录
Storage storage = <strong>new</strong> Storage(origi.createMemento());

// 修改原始类的状态
System.out.println("初始化状态为：" + origi.getValue());
origi.setValue("niu");
System.out.println("修改后的状态为：" + origi.getValue());

// 回复原始类的状态
origi.restoreMemento(storage.getMemento());
System.out.println("恢复后的状态为：" + origi.getValue());
}
}
输出：
初始化状态为：egg 修改后的状态为：niu 恢复后的状态为：egg
简单描述下：新建原始类时，value被初始化为egg，后经过修改，将value的值置为niu，最后倒数第二行进行恢复状态，结果成功恢复了。其实我觉得这个模式叫“备份-恢复”模式最形象。
<strong>20、状态模式（State）</strong>
核心思想就是：当对象的状态改变时，同时改变其行为，很好理解！就拿QQ来说，有几种状态，在线、隐身、忙碌等，每个状态对应不同的操作，而且你的好友也能看到你的状态，所以，状态模式就两点：1、可以通过改变状态来获得不同的行为。2、你的好友能同时看到你的变化。看图：

State类是个状态类，Context类可以实现切换，我们来看看代码：

<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>package</strong> com.xtfggef.dp.state;

/**
* 状态类的核心类
* 2012-12-1
* @author erqing
*
*/
<strong>public</strong> <strong>class</strong> State {

<strong>private</strong> String value;

<strong>public</strong> String getValue() {
<strong>return</strong> value;
}

<strong>public</strong> <strong>void</strong> setValue(String value) {
<strong>this</strong>.value = value;
}

<strong>public</strong> <strong>void</strong> method1(){
System.out.println("execute the first opt!");
}

<strong>public</strong> <strong>void</strong> method2(){
System.out.println("execute the second opt!");
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>package</strong> com.xtfggef.dp.state;

/**
* 状态模式的切换类   2012-12-1
* @author erqing
*
*/
<strong>public</strong> <strong>class</strong> Context {

<strong>private</strong> State state;

<strong>public</strong> Context(State state) {
<strong>this</strong>.state = state;
}

<strong>public</strong> State getState() {
<strong>return</strong> state;
}

<strong>public</strong> <strong>void</strong> setState(State state) {
<strong>this</strong>.state = state;
}

<strong>public</strong> <strong>void</strong> method() {
<strong>if</strong> (state.getValue().equals("state1")) {
state.method1();
} <strong>else</strong> <strong>if</strong> (state.getValue().equals("state2")) {
state.method2();
}
}
}
测试类：

<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {

State state = <strong>new</strong> State();
Context context = <strong>new</strong> Context(state);

//设置第一种状态
state.setValue("state1");
context.method();

//设置第二种状态
state.setValue("state2");
context.method();
}
}
输出：

execute the first opt! execute the second opt!
根据这个特性，状态模式在日常开发中用的挺多的，尤其是做网站的时候，我们有时希望根据对象的某一属性，区别开他们的一些功能，比如说简单的权限控制等。<strong>21、访问者模式（Visitor）</strong>
访问者模式把数据结构和作用于结构上的操作解耦合，使得操作集合可相对自由地演化。访问者模式适用于数据结构相对稳定算法又易变化的系统。因为访问者模式使得算法操作增加变得容易。若系统数据结构对象易于变化，经常有新的数据对象增加进来，则不适合使用访问者模式。访问者模式的优点是增加操作很容易，因为增加操作意味着增加新的访问者。访问者模式将有关行为集中到一个访问者对象中，其改变不影响系统数据结构。其缺点就是增加新的数据结构很困难。—— From 百科
简单来说，访问者模式就是一种分离对象数据结构与行为的方法，通过这种分离，可达到为一个被访问者动态添加新的操作而无需做其它的修改的效果。简单关系图：

来看看原码：一个Visitor类，存放要访问的对象，

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Visitor {
<strong>public</strong> <strong>void</strong> visit(Subject sub);
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyVisitor <strong>implements</strong> Visitor {

@Override
<strong>public</strong> <strong>void</strong> visit(Subject sub) {
System.out.println("visit the subject："+sub.getSubject());
}
}
Subject类，accept方法，接受将要访问它的对象，getSubject()获取将要被访问的属性，
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Subject {
<strong>public</strong> <strong>void</strong> accept(Visitor visitor);
<strong>public</strong> String getSubject();
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MySubject <strong>implements</strong> Subject {

@Override
<strong>public</strong> <strong>void</strong> accept(Visitor visitor) {
visitor.visit(<strong>this</strong>);
}

@Override
<strong>public</strong> String getSubject() {
<strong>return</strong> "love";
}
}
测试：

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {

Visitor visitor = <strong>new</strong> MyVisitor();
Subject sub = <strong>new</strong> MySubject();
sub.accept(visitor);
}
}
输出：visit the subject：love

该模式适用场景：如果我们想为一个现有的类增加新功能，不得不考虑几个事情：1、新功能会不会与现有功能出现兼容性问题？2、以后会不会再需要添加？3、如果类不允许修改代码怎么办？面对这些问题，最好的解决方法就是使用访问者模式，访问者模式适用于数据结构相对稳定的系统，把数据结构和算法解耦，<strong>22、中介者模式（Mediator）</strong>
中介者模式也是用来降低类类之间的耦合的，因为如果类类之间有依赖关系的话，不利于功能的拓展和维护，因为只要修改一个对象，其它关联的对象都得进行修改。如果使用中介者模式，只需关心和Mediator类的关系，具体类类之间的关系及调度交给Mediator就行，这有点像spring容器的作用。先看看图：

User类统一接口，User1和User2分别是不同的对象，二者之间有关联，如果不采用中介者模式，则需要二者相互持有引用，这样二者的耦合度很高，为了解耦，引入了Mediator类，提供统一接口，MyMediator为其实现类，里面持有User1和User2的实例，用来实现对User1和User2的控制。这样User1和User2两个对象相互独立，他们只需要保持好和Mediator之间的关系就行，剩下的全由MyMediator类来维护！基本实现：

<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Mediator {
<strong>public</strong> <strong>void</strong> createMediator();
<strong>public</strong> <strong>void</strong> workAll();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> MyMediator <strong>implements</strong> Mediator {

<strong>private</strong> User user1;
<strong>private</strong> User user2;

<strong>public</strong> User getUser1() {
<strong>return</strong> user1;
}

<strong>public</strong> User getUser2() {
<strong>return</strong> user2;
}

@Override
<strong>public</strong> <strong>void</strong> createMediator() {
user1 = <strong>new</strong> User1(<strong>this</strong>);
user2 = <strong>new</strong> User2(<strong>this</strong>);
}

@Override
<strong>public</strong> <strong>void</strong> workAll() {
user1.work();
user2.work();
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>abstract</strong> <strong>class</strong> User {

<strong>private</strong> Mediator mediator;

<strong>public</strong> Mediator getMediator(){
<strong>return</strong> mediator;
}

<strong>public</strong> User(Mediator mediator) {
<strong>this</strong>.mediator = mediator;
}

<strong>public</strong> <strong>abstract</strong> <strong>void</strong> work();
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> User1 <strong>extends</strong> User {

<strong>public</strong> User1(Mediator mediator){
<strong>super</strong>(mediator);
}

@Override
<strong>public</strong> <strong>void</strong> work() {
System.out.println("user1 exe!");
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> User2 <strong>extends</strong> User {

<strong>public</strong> User2(Mediator mediator){
<strong>super</strong>(mediator);
}

@Override
<strong>public</strong> <strong>void</strong> work() {
System.out.println("user2 exe!");
}
}
测试类：

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {
Mediator mediator = <strong>new</strong> MyMediator();
mediator.createMediator();
mediator.workAll();
}
}
输出：

user1 exe! user2 exe! <strong>23、解释器模式（Interpreter）</strong> 解释器模式是我们暂时的最后一讲，一般主要应用在OOP开发中的编译器的开发中，所以适用面比较窄。

Context类是一个上下文环境类，Plus和Minus分别是用来计算的实现，代码如下：

<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>interface</strong> Expression {
<strong>public</strong> <strong>int</strong> interpret(Context context);
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Plus <strong>implements</strong> Expression {

@Override
<strong>public</strong> <strong>int</strong> interpret(Context context) {
<strong>return</strong> context.getNum1()+context.getNum2();
}
}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Minus <strong>implements</strong> Expression {

@Override
<strong>public</strong> <strong>int</strong> interpret(Context context) {
<strong>return</strong> context.getNum1()-context.getNum2();
}
}
<strong></strong>

[java][/java]


<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Context {

<strong>private</strong> <strong>int</strong> num1;
<strong>private</strong> <strong>int</strong> num2;

<strong>public</strong> Context(<strong>int</strong> num1, <strong>int</strong> num2) {
<strong>this</strong>.num1 = num1;
<strong>this</strong>.num2 = num2;
}

<strong>public</strong> <strong>int</strong> getNum1() {
<strong>return</strong> num1;
}
<strong>public</strong> <strong>void</strong> setNum1(<strong>int</strong> num1) {
<strong>this</strong>.num1 = num1;
}
<strong>public</strong> <strong>int</strong> getNum2() {
<strong>return</strong> num2;
}
<strong>public</strong> <strong>void</strong> setNum2(<strong>int</strong> num2) {
<strong>this</strong>.num2 = num2;
}

}
<strong></strong>
[java][/java]

<strong></strong> <span style="text-decoration: underline;">view plaincopy</span>
<strong>public</strong> <strong>class</strong> Test {

<strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {

// 计算9+2-8的值
<strong>int</strong> result = <strong>new</strong> Minus().interpret((<strong>new</strong> Context(<strong>new</strong> Plus()
.interpret(<strong>new</strong> Context(9, 2)), 8)));
System.out.println(result);
}
}
最后输出正确的结果：3。

基本就这样，解释器模式用来做各种各样的解释器，如正则表达式等的解释器等等！
设计模式基本就这么大概讲完了，总体感觉有点简略，的确，这么点儿篇幅，不足以对整个23种设计模式做全面的阐述，此处读者可将它作为一个理论基础去学习，通过这四篇博文，先基本有个概念，虽然我讲的有些简单，但基本都能说明问题及他们的特点，如果对哪一个感兴趣，可以继续深入研究！同时我也会不断更新，尽量补全遗漏、修正不足，欢迎广大读者及时提出好的建议，我们一起学习！项目中涉及到的代码，已经放到了我的资源里：http://download.<span style="text-decoration: underline;">csdn.net/detail/zhangerqing/4835830（因为我不喜欢不劳而获，所以没有免积分，只设置了5个，如果有人实在没积分又急要，那么联系我吧，我给你发过去）。</span></td>
</tr>
</tbody>
</table>
50.谈谈你对框架的理解，设计框架的时候你是怎么考虑的，重构项目的时候你都遵循什么原则。
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top"><strong>1.</strong><strong>框架不要为应用做过多的假设</strong>
关于框架为应用做过多的假设，
一个非常具体的现象就是，
框架越俎代庖，
把本来是应
用要做的事情揽过来自己做。
这是一种典型的吃力不讨好的做法。
框架越俎代庖，
也许会使
得某一个具体应用的开发变得简单，
却会给其它更多想使用该框架的应用增加了本没有必要
的束缚和负担。
<strong>2.</strong><strong>使用接口，保证框架提供的所有重要实现都是可以被替换的</strong>
框架终究不是应用，
所以框架无法考虑所有应用的具体情况，
保证所有重要的组件的实
现都是可以被替换的，
这一点非常重要，
它使得应用可以根据当前的实际情况来替换掉框架
提供的部分组件的默认实现。
使用接口来定义框架中各个组件及组件间的联系，
将提高框架
的可复用性。
<strong>3.</strong><strong>框架应当简洁、一致、且目标集中</strong>
框架应当简洁，
不要包含那些对框架目标来说无关紧要的东西，
保证框架中的每个组件
的存在都是为了支持框架目标的实现。包含过多无谓的元素（类、接口、枚举等）
，会使框
架变得难以理解，
尝试将这些对于框架核心目标不太重要的元素转移到类库中，
可以使得框
架更清晰、目标更集中。
<strong>4.</strong><strong>提供一个常用的骨架，但是不要固定骨架的结构，使骨架也是可以组装的</strong>
比如说，
如果是针对某种业务处理的框架，
那么框架不应该只提供一套不可变更的业务
处理流程，而是应该将处理流程
“单步”
化，使得各个步骤是可以重新组装的，如此一来，应
用便可以根据实际情况来改变框架默认的处理流程。
这种框架的可定制化能力可以极大地提
高框架的可复用性。
<strong>5.</strong><strong>不断地重构框架</strong>
如果说设计和实现一个高质量的框架有什么秘诀？答案只有一个，重构、不断地重构。
重构框架的实现代码、
甚至重构框架的设计。
重构的驱动力源于几个方面，
比如对要解决的
本质问题有了更清晰准备的认识，在使用框架的时候发现某些组件职责不明确、难以使用，
框架的层次结构不够清晰等。</td>
</tr>
</tbody>
</table>
51.LRU算法
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">假设 序列为 4 3 4 2 3 1 4 2
物理块有3个 则
首轮 4调入内存 4
次轮 3调入内存 3 4
之后 4调入内存 4 3
之后 2调入内存 2 4 3
之后 3调入内存 3 2 4
之后 1调入内存 1 3 2（因为最少使用的是4，所以丢弃4）
之后 4调入内存 4 1 3（原理同上）
最后 2调入内存 2 4 1
在指定内存中如果超过内存剔除最近最少用的。</td>
</tr>
</tbody>
</table>
51.自定义控件的生命周期
<table width="625" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">onFinishInflate() 当View中所有的子控件均被映射成xml后触发
onMeasure( int ,  int ) 确定所有子元素的大小
onLayout( boolean ,  int ,  int ,  int ,  int ) 当View分配所有的子元素的大小和位置时触发
onSizeChanged( int ,  int ,  int ,  int ) 当view的大小发生变化时触发
onDraw(Canvas) view渲染内容的细节
onKeyDown( int , KeyEvent) 有按键按下后触发
onKeyUp( int , KeyEvent) 有按键按下后弹起时触发
onTrackballEvent(MotionEvent) 轨迹球事件
onTouchEvent(MotionEvent) 触屏事件
onFocusChanged( boolean ,  int , Rect) 当View获取或失去焦点时触发
onWindowFocusChanged( boolean ) 当窗口包含的view获取或失去焦点时触发
onAttachedToWindow() 当view被附着到一个窗口时触发
onDetachedFromWindow() 当view离开附着的窗口时触发，Android123提示该方法和  onAttachedToWindow() 是相反的。
onWindowVisibilityChanged( int ) 当窗口中包含的可见的view发生变化时触发</td>
</tr>
</tbody>
</table>
</div>
<div data-bd-bind="1426037475493"></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>322</wp:post_id>
		<wp:post_date>2015-03-11 09:36:14</wp:post_date>
		<wp:post_date_gmt>2015-03-11 01:36:14</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>322</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="android%e9%9d%a2%e8%af%95"><![CDATA[Android面试]]></category>
		<category domain="category" nicename="%e9%9d%a2%e8%af%95"><![CDATA[面试]]></category>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707528]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>忆游开发流程</title>
		<link>http://1.duoinfo.sinaapp.com/?p=326</link>
		<pubDate>Wed, 11 Mar 2015 02:27:54 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=326</guid>
		<description></description>
		<content:encoded><![CDATA[2015-03-11：

新浪微博Oauth认证完成；

遇到的问题：Fragment频繁的切换导致频繁的创建和释放，怎么破？（特别是ViewPager+Fragment这种场景）；

<code>想让<code>Fragment</code>中的onCreateOptionsMenu生效必须先调用<code>setHasOptionsMenu</code>方法；</code>

Json中getString和optString的区别。（optString会在得不到你想要的值时候返回空字符串”“，而getString会抛出异常。）]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>326</wp:post_id>
		<wp:post_date>2015-03-11 10:27:54</wp:post_date>
		<wp:post_date_gmt>2015-03-11 02:27:54</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%bf%86%e6%b8%b8%e5%bc%80%e5%8f%91%e6%b5%81%e7%a8%8b</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%bf%86%e6%b8%b8"><![CDATA[忆游]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707529]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Supporting Different Screens</title>
		<link>http://1.duoinfo.sinaapp.com/?p=328</link>
		<pubDate>Fri, 13 Mar 2015 05:54:48 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=328</guid>
		<description></description>
		<content:encoded><![CDATA[Android categorizes device screens using two general properties: <span style="color: #0000ff;">size and density</span>. You should expect that your app will be installed on devices with screens that range in both size and density. As such, you should include some alternative resources that optimize your app’s appearance for different screen sizes and densities.
<ul>
	<li>There are four generalized sizes:<span style="color: #0000ff;"> small, normal, large, xlarge</span></li>
	<li>And four generalized densities: <span style="color: #0000ff;">low (ldpi), medium (mdpi), high (hdpi), extra high (xhdpi)</span></li>
</ul>
To declare different layouts and bitmaps you'd like to use for different screens, you must place these alternative resources in separate directories, similar to how you do for different language strings.

Also be aware that the screens orientation (landscape or portrait) is considered a variation of screen size, so many apps should revise the layout to optimize the user experience in each orientation.
<h2 id="create-layouts">Create Different Layouts</h2>

<hr />

To optimize your user experience on different screen sizes, you should create a unique layout XML file for each screen size you want to support. Each layout should be saved into the appropriate resources directory, named with a <code>-&lt;screen_size&gt;</code> suffix. For example, a unique layout for large screens should be saved under <code>res/layout-large/</code>.

<strong>Note:</strong> Android automatically scales your layout in order to properly fit the screen. Thus, your layouts for different screen sizes don't need to worry about the absolute size of UI elements but instead focus on the layout structure that affects the user experience (such as the size or position of important views relative to sibling views).

For example, this project includes a default layout and an alternative layout for <em>large</em> screens:
<pre>MyProject/
    res/
        layout/
            main.xml
        layout-large/
            main.xml</pre>
The file names must be exactly the same, but their contents are different in order to provide an optimized UI for the corresponding screen size.

Simply reference the layout file in your app as usual:

[java]@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.main);
}[/java]

The system loads the layout file from the appropriate layout directory based on screen size of the device on which your app is running. More information about how Android selects the appropriate resource is available in the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/resources/providing-resources.html#BestMatch">Providing Resources</a> guide.

As another example, here's a project with an alternative layout for landscape orientation:
<pre>MyProject/
    res/
        layout/
            main.xml
        layout-land/
            main.xml</pre>
By default, the <code>layout/main.xml</code> file is used for portrait orientation.

If you want to provide a special layout for landscape, including while on large screens, then you need to use both the <code>large</code> and <code>land</code> qualifier:
<pre>MyProject/
    res/
        layout/              # default (portrait)
            main.xml
        layout-land/         # landscape
            main.xml
        layout-large/        # large (portrait)
            main.xml
        layout-large-land/   # large landscape
            main.xml</pre>
<strong>Note:</strong> Android 3.2 and above supports an advanced method of defining screen sizes that allows you to specify resources for screen sizes based on the minimum width and height in terms of density-independent pixels. This lesson does not cover this new technique. For more information, read <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/multiscreen/index.html">Designing for Multiple Screens</a>.
<h2 id="create-bitmaps">Create Different Bitmaps</h2>

<hr />

You should always provide bitmap resources that are properly scaled to each of the generalized density buckets: low, medium, high and extra-high density. This helps you achieve good graphical quality and performance on all screen densities.

To generate these images, you should start with your raw resource in vector format and generate the images for each density using the following size scale:
<ul>
	<li>xhdpi: 2.0</li>
	<li>hdpi: 1.5</li>
	<li>mdpi: 1.0 (baseline)</li>
	<li>ldpi: 0.75</li>
</ul>
This means that if you generate a 200x200 image for xhdpi devices, you should generate the same resource in 150x150 for hdpi, 100x100 for mdpi, and 75x75 for ldpi devices.

Then, place the files in the appropriate drawable resource directory:
<pre>MyProject/
    res/
        drawable-xhdpi/
            awesomeimage.png
        drawable-hdpi/
            awesomeimage.png
        drawable-mdpi/
            awesomeimage.png
        drawable-ldpi/
            awesomeimage.png</pre>
Any time you reference <code>@drawable/awesomeimage</code>, the system selects the appropriate bitmap based on the screen's density.

<strong>Note:</strong> Low-density (ldpi) resources aren’t always necessary. When you provide hdpi assets, the system scales them down by one half to properly fit ldpi screens.

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>328</wp:post_id>
		<wp:post_date>2015-03-13 13:54:48</wp:post_date>
		<wp:post_date_gmt>2015-03-13 05:54:48</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>supporting-different-screens</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707530]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Starting an Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=330</link>
		<pubDate>Fri, 13 Mar 2015 06:33:09 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=330</guid>
		<description></description>
		<content:encoded><![CDATA[Unlike other programming paradigms in which apps are launched with a <code>main()</code> method, the Android system initiates code in an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> instance by invoking specific callback methods that correspond to specific stages of its lifecycle. There is a sequence of callback methods that start up an activity and a sequence of callback methods that tear down an activity.

This lesson provides an overview of the most important lifecycle methods and shows you how to handle the first lifecycle callback that creates a new instance of your activity.
<h2 id="lifecycle-states">Understand the Lifecycle Callbacks</h2>

<hr />

During the life of an activity, the system calls a core set of lifecycle methods in a sequence similar to a step pyramid. That is, each stage of the activity lifecycle is a separate step on the pyramid. As the system creates a new activity instance, each callback method moves the activity state one step toward the top. The top of the pyramid is the point at which the activity is running in the foreground and the user can interact with it.

As the user begins to leave the activity, the system calls other methods that move the activity state back down the pyramid in order to dismantle the activity. In some cases, the activity will move only part way down the pyramid and wait (such as when the user switches to another app), from which point the activity can move back to the top (if the user returns to the activity) and resume where the user left off.

<img src="http://img.blog.csdn.net/20150313141734627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle.png" alt="" />

<strong>Figure 1.</strong> A simplified illustration of the Activity lifecycle, expressed as a step pyramid. This shows how, for every callback used to take the activity a step toward the Resumed state at the top, there's a callback method that takes the activity a step down. The activity can also return to the resumed state from the Paused and Stopped state.

Depending on the complexity of your activity, you probably don't need to implement all the lifecycle methods. However, it's important that you understand each one and implement those that ensure your app behaves the way users expect. Implementing your activity lifecycle methods properly ensures your app behaves well in several ways, including that it:
<ul>
	<li><span style="color: #000080;">Does not crash if the user receives a phone call or switches to another app while using your app.</span></li>
	<li><span style="color: #000080;">Does not consume valuable system resources when the user is not actively using it.</span></li>
	<li><span style="color: #000080;">Does not lose the user's progress if they leave your app and return to it at a later time.</span></li>
	<li><span style="color: #000080;">Does not crash or lose the user's progress when the screen rotates between landscape and portrait orientation.</span></li>
</ul>
<div><span style="color: #000080;">总结：上面说的四个我们开发的时候还是经常遇到的。</span></div>
As you'll learn in the following lessons, there are several situations in which an activity transitions between different states that are illustrated in figure 1. However, only three of these states can be static. That is, the activity can exist in one of only three states for an extended period of time:

<dl><dt><span style="color: #000080;">Resumed</span></dt><dd>In this state, the activity is in the foreground and the user can interact with it. (Also sometimes referred to as the "running" state.)</dd><dt><span style="color: #000080;">Paused</span></dt><dd>In this state, the activity is partially obscured by another activity—the other activity that's in the foreground is semi-transparent or doesn't cover the entire screen. The paused activity does not receive user input and cannot execute any code.</dd><dd>总结：比如有一个样式为dialog的Activity覆盖到当前的Activity，那么当前的Activity则进入到pause这种状态</dd><dt><span style="color: #000080;">Stopped</span></dt><dd>In this state, the activity is completely hidden and not visible to the user; it is considered to be in the background. While stopped, the activity instance and all its state information such as member variables is retained, but it cannot execute any code.</dd></dl>The other states (Created and Started) are transient and the system quickly moves from them to the next state by calling the next lifecycle callback method. That is, after the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>, it quickly calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code>, which is quickly followed by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code>.

That's it for the basic activity lifecycle. Now you'll start learning about some of the specific lifecycle behaviors.
<h2 id="launching-activity">Specify Your App's Launcher Activity</h2>

<hr />

When the user selects your app icon from the Home screen, the system calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method for the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> in your app that you've declared to be the "launcher" (or "main") activity. This is the activity that serves as the main entry point to your app's user interface.

You can define which activity to use as the main activity in the Android manifest file, <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-intro.html"><code>AndroidManifest.xml</code></a>, which is at the root of your project directory.

The main activity for your app must be declared in the manifest with an <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/intent-filter-element.html"><code>&lt;intent-filter&gt;</code></a> that includes the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_MAIN">MAIN</a></code>action and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_LAUNCHER">LAUNCHER</a></code> category. For example:

[html]&lt;activity android:name=&quot;.MainActivity&quot; android:label=&quot;@string/app_name&quot;&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;[/html]

<strong>Note:</strong> When you create a new Android project with the Android SDK tools, the default project files include an<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> class that's declared in the manifest with this filter.

If either the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_MAIN">MAIN</a></code> action or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_LAUNCHER">LAUNCHER</a></code> category are not declared for one of your activities, then your app icon will not appear in the Home screen's list of apps.
<h2 id="Create">Create a New Instance</h2>

<hr />

Most apps include several different activities that allow the user to perform different actions. Whether an activity is the main activity that's created when the user clicks your app icon or a different activity that your app starts in response to a user action, the system creates every new instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> by calling its <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method.

You must implement the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method to perform basic application startup logic that should happen only once for the entire life of the activity. For example, your implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> should define the user interface and possibly instantiate some class-scope variables.

For example, the following example of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method shows some code that performs some fundamental setup for the activity, such as declaring the user interface (defined in an XML layout file), defining member variables, and configuring some of the UI.

[java]TextView mTextView; // Member variable for text view in the layout

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);

// Set the user interface layout for this Activity
// The layout file is defined in the project res/layout/main_activity.xml file
setContentView(R.layout.main_activity);

// Initialize member TextView so we can manipulate it later
mTextView = (TextView) findViewById(R.id.text_message);

// Make sure we're running on Honeycomb or higher to use ActionBar APIs
if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) {
// For the main activity, make sure the app icon in the action bar
// does not behave as a button
ActionBar actionBar = getActionBar();
actionBar.setHomeButtonEnabled(false);
}
}[/java]

<strong>Caution:</strong> Using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Build.VERSION.html#SDK_INT">SDK_INT</a></code> to prevent older systems from executing new APIs works in this way on Android 2.0 (API level 5) and higher only. Older versions will encounter a runtime exception.

Once the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> finishes execution, the system calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> methods in quick succession. Your activity never resides in the Created or Started states. Technically, the activity becomes visible to the user when <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> is called, but <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> quickly follows and the activity remains in the Resumed state until something occurs to change that, such as when a phone call is received, the user navigates to another activity, or the device screen turns off.

In the other lessons that follow, you'll see how the other start up methods, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code>, are useful during your activity's lifecycle when used to resume the activity from the Paused or Stopped states.

<strong>Note:</strong> The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method includes a parameter called <code>savedInstanceState</code> that's discussed in the latter lesson about <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/activity-lifecycle/recreating.html">Recreating an Activity</a>.

<img src="http://img.blog.csdn.net/20150313142916178?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-create.png" alt="" />

<strong>Figure 2.</strong> Another illustration of the activity lifecycle structure with an emphasis on the three main callbacks that the system calls in sequence when creating a new instance of the activity: <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code>, and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code>. Once this sequence of callbacks complete, the activity reaches the Resumed state where users can interact with the activity until they switch to a different activity.

&nbsp;
<h2 id="Destroy">Destroy the Activity</h2>

<hr />

While the activity's first lifecycle callback is <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>, its very last callback is <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code>. The system calls this method on your activity as the final signal that your activity instance is being completely removed from the system memory.

Most apps don't need to implement this method because local class references are destroyed with the activity and your activity should perform most cleanup during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code>. However, if your activity includes background threads that you created during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> or other long-running resources that could potentially leak memory if not properly closed, you should kill them during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code>.

[java]@Override
public void onDestroy() {
super.onDestroy();  // Always call the superclass

// Stop method tracing that the activity started during onCreate()
android.os.Debug.stopMethodTracing();
}[/java]

<strong>Note:</strong> The system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code> after it has already called <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> in all situations except one: <span style="color: #000080;"><strong>when you call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish()"><span style="color: #000080;">finish()</span></a></code> from within the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)"><span style="color: #000080;">onCreate()</span></a></code> method. In some cases, such as when your activity operates as a temporary decision maker to launch another activity, you might call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish()"><span style="color: #000080;">finish()</span></a></code> from within<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)"><span style="color: #000080;">onCreate()</span></a></code> to destroy the activity. In this case, the system immediately calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()"><span style="color: #000080;">onDestroy()</span></a></code> without calling any of the other lifecycle methods.</strong></span>

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>330</wp:post_id>
		<wp:post_date>2015-03-13 14:33:09</wp:post_date>
		<wp:post_date_gmt>2015-03-13 06:33:09</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>starting-an-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f"><![CDATA[Activity生命周期]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707531]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>7</wp:comment_id>
			<wp:comment_author><![CDATA[ActivityLifeCycle官方demo解析 | 陈福多]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=343</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.229</wp:comment_author_IP>
			<wp:comment_date>2015-03-14 09:55:53</wp:comment_date>
			<wp:comment_date_gmt>2015-03-14 01:55:53</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] http://1.duoinfo.sinaapp.com/?p=330 [...]]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>Pausing and Resuming an Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=332</link>
		<pubDate>Fri, 13 Mar 2015 06:43:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=332</guid>
		<description></description>
		<content:encoded><![CDATA[During normal app use, the foreground activity is sometimes obstructed by other visual components that cause the activity to<em>pause</em>. For example, when a semi-transparent activity opens (such as one in the style of a dialog), the previous activity pauses. As long as the activity is still partially visible but currently not the activity in focus, it remains paused.

However, once the activity is fully-obstructed and not visible, it<em>stops</em> (which is discussed in the next lesson).

As your activity enters the paused state, the system calls the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> method on your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>, which allows you to stop ongoing actions that should not continue while paused (such as a video) or persist any information that should be permanently saved in case the user continues to leave your app. If the user returns to your activity from the paused state, the system resumes it and calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> method.

<strong>Note:</strong> When your activity receives a call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code>, it may be an indication that the activity will be paused for a moment and the user may return focus to your activity. However, it's usually the first indication that the user is leaving your activity.

<img src="http://img.blog.csdn.net/20150313143824456?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-paused.png" alt="" />

<strong>Figure 1.</strong> When a semi-transparent activity obscures your activity, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> and the activity waits in the Paused state (1). If the user returns to the activity while it's still paused, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> (2).
<h2 id="Pause">Pause Your Activity</h2>

<hr />

When the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> for your activity, it technically means your activity is still partially visible, but most often is an indication that the user is leaving the activity and it will soon enter the Stopped state. You should usually use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> callback to:
<ul>
	<li><span style="color: #0000ff;">Stop animations or other ongoing actions that could consume CPU.</span></li>
	<li><span style="color: #0000ff;">Commit unsaved changes, but only if users expect such changes to be permanently saved when they leave (such as a draft email).</span></li>
	<li><span style="color: #0000ff;">Release system resources, such as broadcast receivers, handles to sensors (like GPS), or any resources that may affect battery life while your activity is paused and the user does not need them.</span></li>
</ul>
For example, if your application uses the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/hardware/Camera.html">Camera</a></code>, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> method is a good place to release it.

[java]@Override
public void onPause() {
super.onPause();  // Always call the superclass method first

// Release the Camera because we don't need it when paused
// and other activities might need to use it.
if (mCamera != null) {
mCamera.release()
mCamera = null;
}
}[/java]

Generally, you should <strong>not</strong> use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> to store user changes (such as personal information entered into a form) to permanent storage. The only time you should persist user changes to permanent storage within <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> is when you're certain users expect the changes to be auto-saved (such as when drafting an email). However, you should avoid performing CPU-intensive work during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code>, such as writing to a database, because it can slow the visible transition to the next activity (you should instead perform heavy-load shutdown operations during<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code>).

You should keep the amount of operations done in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> method relatively simple in order to allow for a speedy transition to the user's next destination if your activity is actually being stopped.

<strong>Note:</strong> When your activity is paused, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> instance is kept resident in memory and is recalled when the activity resumes. You don’t need to re-initialize components that were created during any of the callback methods leading up to the Resumed state.
<h2 id="Resume">Resume Your Activity</h2>

<hr />

When the user resumes your activity from the Paused state, the system calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> method.

Be aware that the system calls this method every time your activity comes into the foreground, including when it's created for the first time. As such, you should implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> to initialize components that you release during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> and perform any other initializations that must occur each time the activity enters the Resumed state (such as begin animations and initialize components only used while the activity has user focus).

The following example of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> is the counterpart to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> example above, so it initializes the camera that's released when the activity pauses.

[java]@Override
public void onResume() {
super.onResume();  // Always call the superclass method first

// Get the Camera instance as the activity achieves full user focus
if (mCamera == null) {
initializeCamera(); // Local method to handle camera init
}
}[/java]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>332</wp:post_id>
		<wp:post_date>2015-03-13 14:43:32</wp:post_date>
		<wp:post_date_gmt>2015-03-13 06:43:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>pausing-and-resuming-an-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f"><![CDATA[Activity生命周期]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707532]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>8</wp:comment_id>
			<wp:comment_author><![CDATA[ActivityLifeCycle官方demo解析 | 陈福多]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=343</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.217</wp:comment_author_IP>
			<wp:comment_date>2015-03-14 09:56:55</wp:comment_date>
			<wp:comment_date_gmt>2015-03-14 01:56:55</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] http://1.duoinfo.sinaapp.com/?p=332 [...]]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>Stopping and Restarting an Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=335</link>
		<pubDate>Fri, 13 Mar 2015 07:18:53 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=335</guid>
		<description></description>
		<content:encoded><![CDATA[Properly stopping and restarting your activity is an important process in the activity lifecycle that ensures your users perceive that your app is always alive and doesn't lose their progress. There are a few of key scenarios in which your activity is stopped and restarted:
<ul>
	<li><span style="color: #3366ff;">The user opens the Recent Apps window and switches from your app to another app. The activity in your app that's currently in the foreground is stopped. If the user returns to your app from the Home screen launcher icon or the Recent Apps window, the activity restarts.</span></li>
	<li><span style="color: #3366ff;">The user performs an action in your app that starts a new activity. The current activity is stopped when the second activity is created. If the user then presses the <em>Back</em> button, the first activity is restarted.</span></li>
	<li><span style="color: #3366ff;">The user receives a phone call while using your app on his or her phone.</span></li>
</ul>
The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> class provides two lifecycle methods, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> and<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code>, which allow you to specifically handle how your activity handles being stopped and restarted. Unlike the paused state, which identifies a partial UI obstruction, the stopped state guarantees that the UI is no longer visible and the user's focus is in a separate activity (or an entirely separate app).

<strong>Note:</strong> Because the system retains your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> instance in system memory when it is stopped, it's possible that you don't need to implement the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code> (or even <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> methods at all. For most activities that are relatively simple, the activity will stop and restart just fine and you might only need to use<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> to pause ongoing actions and disconnect from system resources.

<img src="http://img.blog.csdn.net/20150313150859528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-stopped.png" alt="" />

<strong>Figure 1.</strong> When the user leaves your activity, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> to stop the activity (1). If the user returns while the activity is stopped, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code> (2), quickly followed by <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> (3) and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onResume()">onResume()</a></code> (4). Notice that no matter what scenario causes the activity to stop, the system always calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> before calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code>.
<h2 id="Stop">Stop Your Activity</h2>

<hr />

When your activity receives a call to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> method, it's no longer visible and should release almost all resources that aren't needed while the user is not using it. Once your activity is stopped, the system might destroy the instance if it needs to recover system memory. In extreme cases, the system might simply kill your app process without calling the activity's final <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code> callback, so it's important you use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> to release resources that might leak memory.

Although the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> method is called before <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code>, you should use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> to perform larger, more CPU intensive shut-down operations, such as writing information to a database.

For example, here's an implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> that saves the contents of a draft note to persistent storage:

[java]@Override
protected void onStop() {
super.onStop();  // Always call the superclass method first

// Save the note's current draft, because the activity is stopping
// and we want to be sure the current note progress isn't lost.
ContentValues values = new ContentValues();
values.put(NotePad.Notes.COLUMN_NAME_NOTE, getCurrentNoteText());
values.put(NotePad.Notes.COLUMN_NAME_TITLE, getCurrentNoteTitle());

getContentResolver().update(
mUri,    // The URI for the note to update.
values,  // The map of column names and new values to apply to them.
null,    // No SELECT criteria are used.
null     // No WHERE columns are used.
);
}[/java]

When your activity is stopped, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> object is kept resident in memory and is recalled when the activity resumes. You don’t need to re-initialize components that were created during any of the callback methods leading up to the Resumed state. The system also keeps track of the current state for each <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code> in the layout, so if the user entered text into an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html">EditText</a></code> widget, that content is retained so you don't need to save and restore it.

<strong>Note:</strong> Even if the system destroys your activity while it's stopped, it still retains the state of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code> objects (such as text in an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html">EditText</a></code>) in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> (a blob of key-value pairs) and restores them if the user navigates back to the same instance of the activity (the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/activity-lifecycle/recreating.html">next lesson</a> talks more about using a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> to save other state data in case your activity is destroyed and recreated).
<h2 id="Start">Start/Restart Your Activity</h2>

<hr />

When your activity comes back to the foreground from the stopped state, it receives a call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code>. The system also calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> method, which happens every time your activity becomes visible (whether being restarted or created for the first time). The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code> method, however, is called only when the activity resumes from the stopped state, so you can use it to perform special restoration work that might be necessary only if the activity was previously stopped, but not destroyed.

It's uncommon that an app needs to use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestart()">onRestart()</a></code> to restore the activity's state, so there aren't any guidelines for this method that apply to the general population of apps. However, because your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> method should essentially clean up all your activity's resources, you'll need to re-instantiate them when the activity restarts. Yet, you also need to instantiate them when your activity is created for the first time (when there's no existing instance of the activity). For this reason, you should usually use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> callback method as the counterpart to the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code> method, because the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> both when it creates your activity and when it restarts the activity from the stopped state.

For example, because the user might have been away from your app for a long time before coming back it, the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> method is a good place to verify that required system features are enabled:

[java]@Override
protected void onStart() {
super.onStart();  // Always call the superclass method first

// The activity is either being restarted or started for the first time
// so this is where we should make sure that GPS is enabled
LocationManager locationManager =
(LocationManager) getSystemService(Context.LOCATION_SERVICE);
boolean gpsEnabled = locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER);

if (!gpsEnabled) {
// Create a dialog here that requests the user to enable GPS, and use an intent
// with the android.provider.Settings.ACTION_LOCATION_SOURCE_SETTINGS action
// to take the user to the Settings screen to enable GPS when they click &quot;OK&quot;
}
}

@Override
protected void onRestart() {
super.onRestart();  // Always call the superclass method first

// Activity being restarted from stopped state
}[/java]

When the system destroys your activity, it calls the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code> method for your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>. Because you should generally have released most of your resources with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStop()">onStop()</a></code>, by the time you receive a call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onDestroy()">onDestroy()</a></code>, there's not much that most apps need to do. This method is your last chance to clean out resources that could lead to a memory leak, so you should be sure that additional threads are destroyed and other long-running actions like method tracing are also stopped.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>335</wp:post_id>
		<wp:post_date>2015-03-13 15:18:53</wp:post_date>
		<wp:post_date_gmt>2015-03-13 07:18:53</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>stopping-and-restarting-an-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f"><![CDATA[Activity生命周期]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707533]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Recreating an Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=337</link>
		<pubDate>Fri, 13 Mar 2015 07:29:08 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=337</guid>
		<description></description>
		<content:encoded><![CDATA[There are a few scenarios in which your activity is destroyed due to normal app behavior, such as when the user presses the <em>Back</em>button or your activity signals its own destruction by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish()">finish()</a></code>. The system may also destroy your activity if it's currently stopped and hasn't been used in a long time or the foreground activity requires more resources so the system must shut down background processes to recover memory.

When your activity is destroyed because the user presses <em>Back</em> or the activity finishes itself, the system's concept of that <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>instance is gone forever because the behavior indicates the activity is no longer needed. However, if the system destroys the activity due to system constraints (rather than normal app behavior), then although the actual <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> instance is gone, the system remembers that it existed such that if the user navigates back to it, the system creates a new instance of the activity using a set of saved data that describes the state of the activity when it was destroyed. The saved data that the system uses to restore the previous state is called the "instance state" and is a collection of key-value pairs stored in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> object.

<span style="color: #0000ff;"><strong>Caution:</strong> Your activity will be destroyed and recreated each time the user rotates the screen. When the screen changes orientation, the system destroys and recreates the foreground activity because the screen configuration has changed and your activity might need to load alternative resources (such as the layout).</span>

横竖屏切换带来生命周期的重建（为什么需要重建，比如需要加载新的layout）

By default, the system uses the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> instance state to save information about each <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html">View</a></code> object in your activity layout (such as the text value entered into an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html">EditText</a></code> object). So, if your activity instance is destroyed and recreated, the state of the layout is restored to its previous state with no code required by you. However, your activity might have more state information that you'd like to restore, such as member variables that track the user's progress in the activity.

<span style="color: #0000ff;"><strong>Note:</strong> In order for the Android system to restore the state of the views in your activity, <strong>each view must have a unique ID</strong>, supplied by the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html#attr_android:id"><span style="color: #0000ff;"><code>android:id</code></span></a> attribute.</span>

Bundle（A mapping from String values to various Parcelable types.）

To save additional data about the activity state, you must override the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> callback method. The system calls this method when the user is leaving your activity and passes it the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> object that will be saved in the event that your activity is destroyed unexpectedly. If the system must recreate the activity instance later, it passes the same <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> object to both the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> methods.

<img src="http://img.blog.csdn.net/20150313152602094?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/basic-lifecycle-savestate.png" alt="" />

<strong>Figure 2.</strong> As the system begins to stop your activity, it calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> (1) so you can specify additional state data you'd like to save in case the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> instance must be recreated. If the activity is destroyed and the same instance must be recreated, the system passes the state data defined at (1) to both the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method (2) and the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code> method (3).
<h2 id="SaveState">Save Your Activity State</h2>

<hr />

As your activity begins to stop, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> so your activity can save state information with a collection of key-value pairs. The default implementation of this method saves information about the state of the activity's view hierarchy, such as the text in an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html">EditText</a></code> widget or the scroll position of a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>.

To save additional state information for your activity, you must implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> and add key-value pairs to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> object. For example:

[java]static final String STATE_SCORE = &quot;playerScore&quot;;
static final String STATE_LEVEL = &quot;playerLevel&quot;;
...

@Override
public void onSaveInstanceState(Bundle savedInstanceState) {
// Save the user's current game state
savedInstanceState.putInt(STATE_SCORE, mCurrentScore);
savedInstanceState.putInt(STATE_LEVEL, mCurrentLevel);

// Always call the superclass so it can save the view hierarchy state
super.onSaveInstanceState(savedInstanceState);
}[/java]

<strong>Caution:</strong> Always call the superclass implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> so the default implementation can save the state of the view hierarchy.
<h2 id="RestoreState">Restore Your Activity State</h2>

<hr />

When your activity is recreated after it was previously destroyed, you can recover your saved state from the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> that the system passes your activity. Both the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code> callback methods receive the same <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> that contains the instance state information.

Because the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method is called whether the system is creating a new instance of your activity or recreating a previous one, you must check whether the state <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> is null before you attempt to read it. If it is null, then the system is creating a new instance of the activity, instead of restoring a previous one that was destroyed.

For example, here's how you can restore some state data in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>:

[java]@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState); // Always call the superclass first

// Check whether we're recreating a previously destroyed instance
if (savedInstanceState != null) {
// Restore value of members from saved state
mCurrentScore = savedInstanceState.getInt(STATE_SCORE);
mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL);
} else {
// Probably initialize members with default values for a new instance
}
...
}[/java]

Instead of restoring the state during <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> you may choose to implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code>, which the system calls after the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code> method. The system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code> only if there is a saved state to restore, so you do not need to check whether the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Bundle.html">Bundle</a></code> is null:

[java]public void onRestoreInstanceState(Bundle savedInstanceState) {
// Always call the superclass so it can restore the view hierarchy
super.onRestoreInstanceState(savedInstanceState);

// Restore state members from saved instance
mCurrentScore = savedInstanceState.getInt(STATE_SCORE);
mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL);
}[/java]

<strong>Caution:</strong> Always call the superclass implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState()</a></code> so the default implementation can restore the state of the view hierarchy.

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>337</wp:post_id>
		<wp:post_date>2015-03-13 15:29:08</wp:post_date>
		<wp:post_date_gmt>2015-03-13 07:29:08</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>recreating-an-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="post_tag" nicename="activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f"><![CDATA[Activity生命周期]]></category>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707534]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>LeanCloud即时通讯源码分析</title>
		<link>http://1.duoinfo.sinaapp.com/?p=339</link>
		<pubDate>Fri, 13 Mar 2015 07:45:35 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=339</guid>
		<description></description>
		<content:encoded><![CDATA[1.隐藏键盘

[java]

public static void hideSoftInputView(Activity activity) {
 if (activity.getWindow().getAttributes().softInputMode !=
 WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN) {
 InputMethodManager manager = (InputMethodManager) activity.getSystemService(Context.INPUT_METHOD_SERVICE);
 View currentFocus = activity.getCurrentFocus();
 if (currentFocus != null) {
 manager.hideSoftInputFromWindow(currentFocus.getWindowToken(),
 InputMethodManager.HIDE_NOT_ALWAYS);
 }
 }
 }[/java]

2.应用启动后SplashActivity执行，SplashActivity继承自BaseEntryActivity，该基类Activity通过BroadcastReceiver来管理Activity的创建和消亡。
BaseEntryActivity继承自BaseActivity，BaseActivity继承自FragmentActivity；通过Handler发送消息做出跳转，如果用户已经存在，则跳转到MainActivity，否则跳到LoginActivity；
3.登录---LoginActivity，登录的时候使用AsyncTask执行，这里使用的类继承自AsyncTask：
[java]&lt;span style=&quot;font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px;&quot;&gt;public abstract class NetAsyncTask extends AsyncTask&lt;Void, Void, Void&gt; {&lt;/span&gt;&lt;/pre&gt;
ProgressDialog dialog;
 protected Context ctx;
 boolean openDialog = true;
 Exception exception;

protected NetAsyncTask(Context ctx) {
 this.ctx = ctx;
 }

protected NetAsyncTask(Context ctx, boolean openDialog) {
 this.ctx = ctx;
 this.openDialog = openDialog;
 }

public NetAsyncTask setOpenDialog(boolean openDialog) {
 this.openDialog = openDialog;
 return this;
 }

public ProgressDialog getDialog() {
 return dialog;
 }

@Override
 protected void onPreExecute() {
 super.onPreExecute();
 if (openDialog) {
 dialog = Utils.showSpinnerDialog((Activity) ctx);
 }
 }

@Override
 protected Void doInBackground(Void... params) {
 try {
 doInBack();
 } catch (Exception e) {
 e.printStackTrace();
 exception = e;
 }
 return null;
 }

@Override
 protected void onPostExecute(Void aVoid) {
 super.onPostExecute(aVoid);
 if (openDialog) {
 if (dialog.isShowing()) {
 dialog.dismiss();
 }
 }
 onPost(exception);
 }

protected abstract void doInBack() throws Exception;

protected abstract void onPost(Exception e);
}[/java]

ProgressDialog的两个工具类方法： [java]
public static ProgressDialog showSpinnerDialog(Activity activity) {
 //activity = modifyDialogContext(activity);

ProgressDialog dialog = new ProgressDialog(activity);
 dialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);
 dialog.setCancelable(true);
 dialog.setMessage(App.ctx.getString(R.string.hardLoading));
 if (activity.isFinishing() == false) {
 dialog.show();
 }
 return dialog;
 }

public static ProgressDialog showHorizontalDialog(Activity activity) {
 //activity = modifyDialogContext(activity);
 ProgressDialog dialog = new ProgressDialog(activity);
 dialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
 dialog.setCancelable(true);
 if (activity.isFinishing() == false) {
 dialog.show();
 }
 return dialog;
}[/java]

另外存储用户偏好设置这里就不说了。在LoginActivity会做这样的判断，如果没有账户，那么进入注册界面，如果有账号和密码，那么点击登录，直接进入主界面。

3.注册RegisterActivity继承自BaseEntryActivity，注册成功进入主界面，否则弹出土司提示原因，注册操作在子线程中进行。

4.MainActivity继承自BaseActivity，MainActivity这种框架我们还是经常可以看到的：

<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAAFtCAYAAABsuwTlAAAc70lEQVR4Ae1cV2xc1RbdKY4Tx+m94vRG8hJIAiShCyGEqD8gxAdFgGhfiCYkBAgkQPADKBFCAoQQSFQBQlFAJEogoaQ5hfSQ4pJupzt2it9ZJ1y/8dgOdjxjlvdbRxpNuzOz11p3nb3PPtduM3v27GrTEANioEUYaJ/8yiOPPJI81L0YEANZYCAkN2ubhe/VV4oBMVAPA9XV1TJcPbzoJTGQNQZqSsqs/YK+WAw0g4E2bdrY9OnT7fbbb7cZM2ZY9+7d7cyZM7Z+/Xr79ttv7YsvvrCqqqoGf+Hjjz+2MWPGxPc3btxod999d4PHZvsNZDhD0+TvxgmaJ7qJA4pzoF27dtXBZNXFxcXVx48fD+dq3XHy5Mnq/fv3V7/66qvVPXr0qBX3G2+8Ub1169b42WDQatwqKiria3ivOed6mASqcUv/joZeT4576623qpXhAhsaXAwgqy1YsMBmzZpleNzQaN++vfXq1cuefvppu//+++3qq6+2tWvXxsPz8vJs2LBhtT6am5sbX8N76QPf9dprr1mHDh1q3nrhhRfswIEDNc9xzJ133mk333xzfB1NkDVr1sT3L774YnvooYesa9euMet+9dVXMRPXfDg8QGZW0ySVET2mYCDkMnv77bcN940dX375pZWUlDT28DrHDRw40B544AELWdD27t0bb6dPn6513A033GBvvvmm/fTTTxYysH300UfWs2dP69atm3322WdWWVlpv/32m82ZM8dmzpxZ67N4EjKyKcPVoUUvMDDw+eef2/jx4w1Z5p/GDz/8YM8//7yVl5f/06ENvt+/f/+4FnzxxRdjJoLxMAoKCuz111+3p556ym655ZZotnfffddGjBhhixcvtnHjxlmXLl2sY8eO9tJLL9m+ffvs+uuvt9tuu81+/vnnWr+HtaYyXC1K9ISJAZzoCxcuPGdIJ06csMceeyxmpHMe+A9vwnCdO3eOGaqwsNCeeeYZQwmJrLVz585oRpSvSRY9fPiw4da7d+9Y1iKOpPwsKiqyPn361PlFHCPD1aFFL7AwgCxz77332ubNm+sNCWuiu+66q8H36/1QAy9i7Ye1INZnr7zyij377LM2depU27Vrlz355JNWWlpaaz2Jchc3rDHT15nJ6+k/BTwyXDorek7FwLZt2+zxxx+3Q4cO1YoLJzUy4DfffFPr9fN9glLwww8/NPzed999Z7t377ZJkybFr8NvYaAkROMFIycnJ96QAWOp2LZtzIh4D00ZvJ4+ZLh0RvSckoF58+bFTBe2B2riQ1Pl5ZdfrtMJrDmgiQ8efPDB2ATBegzdTTRCUBrCYFOmTIn3q1evjnuB+fn5cX2JEjRsPcTOKLqT06ZNi00UHI+yNH3IcOmM6DktA19//bU999xzMb7vv//e0Nw4duxYxuLFBjrWcWiEoOM4f/58W7RoUdw0nzt3ro0dOzZmQHQulyxZYu+995598MEHMSNiQ/3TTz+NhkWjBNn4k08+qRMbsp66lHVo0QusDLzzzjvxxA8b11ZWVnbOMNG2T0rB9APbhvIvfezYsSN2F9F9RCbavn17vF+3bl280gVrObT10YEcOXKkHTlyJB6D1zCeeOIJQ3woJ5H10ktgHIPSU4YDExqtgoFTp07Zo48+aun7Y/UFjyyVbIKnvw8T1TdgkhUrVtR6C7+JLmUyDh48aMuWLUue1twje23YsKHmeX0PtA9XHyt6jZqBxpgNALA5jRvTQOw1Ge6ee+5hik2xiAF3DKATWmO4999/3x1AARIDTAzcdNNN/zNc+uYdU6CKRQx4YABNnLrtGg/IhEEMkDIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGZDhSIVRWD4ZkOF86ipUpAzIcKTCKCyfDMhwPnUVKlIGZDhSYRSWTwZkOJ+6ChUpAzIcqTAKyycDMpxPXYWKlAEZjlQYheWTARnOp65CRcqADEcqjMLyyYAM51NXoSJlQIYjFUZh+WRAhvOpq1CRMiDDkQqjsHwyIMP51FWoSBmQ4UiFUVg+GZDhfOoqVKQMyHCkwigsnwzIcD51FSpSBmQ4UmEUlk8GZDifugoVKQMyHKkwCssnAzKcT12FipQBGY5UGIXlkwEZzqeuQkXKgAxHKozC8smADOdTV6EiZUCGIxVGYflkQIbzqatQkTIgw5EKo7B8MiDD+dRVqEgZkOFIhVFYPhmQ4XzqKlSkDMhwpMIoLJ8MyHA+dRUqUgZkOFJhFJZPBmQ4n7oKFSkDMhypMArLJwMynE9dhYqUARmOVBiF5ZMBGc6nrkJFyoAMRyqMwvLJgAznU1ehImVAhiMVRmH5ZECG86mrUJEyIMORCqOwfDIgw/nUVahIGWifxLXk11+Th7oXA2IgSwzUGC6/c36WfkJfKwbEQMJAjeEmTZqYvKZ7MSAGssSA1nBZIlZfKwbqY0CGq48VvSYGssRATUmZpe+PX3vmzBmrrKy0w4cPx3s8z83NtS5dulinTp2sXbt22fz5jH13eXm57dmz57y+r3PnzjZ48GBr06bNeX2+pT8EjY4dO2aHDh2yU6dOWYcOHax79+5RL2AAF8CE11vbADbgwvnYtm1b69GjR8TSEtpk1XAQ6q+//rKioqIoTCIQgB08eNC2bdtmFRUV1rNnTxs7dmwUk1m8H3/80fr162fdunVrUpinT5+2BQsW2H333RcnmiZ9uIUPrq6ujnqVlJTEkxATYvv27e348eNxsjlx4kTk4Pfff7devXrZNddcE99v4TDP++dOnjxpS5cujZM8Jnzg3b59ezwHJ0yYcN7f29gPZs1wyASrVq2yPn362MyZM+OJlj6DACxORgDGCQnTFRQUxFmnsQBa8riOHTvatGnTLC8vr8k/i0kHeJkHTsY1a9ZEA02dOtVycnJqhYv4jx49at99950dOHDA9u/fHzP2VVddVefYWh8kerJx40br2rWrwVzJ+YhzcOHChXEi6d27d1ajzYrhduzYYZs3b7bLLrsslo0NIQBgzJ4jR460Cy64wJYvXx4z3+TJk2lNByybNm2K+K644oqIr6qqqkEzAWP6idsQH//m6zjpMEEig6eWvqhS8B50QumPzIfqJBl79+6NJkRZxj5QSiL2KVOm1JgNMQMXJvvS0lJrdYbDzAezzZo1y5ARGjtwUiJ7rFixIn5+zJgxjf1oix+3bNmyaLrhw4fbuHHj7Ndw0QBK4/oGSrJLL720vreoXsMkmbrOxJobE8uRI0fiyQnToZTGpIjHWPtgosSkiozRGkZSYaB/kD6AbefOnekvZ/x5RjMcZpDCwkK7+OKLm2S2BBVmmokTJ9qSJUviLIsTgHFccskl1r9/fxs0aFAM78orr2QMs9ExoZTctWuXTZ8+PZoLZsOkMnTo0DihILthQvnqq6+iATGJYHIcP358q8jeqUQkZWTqa3iM1xNDpr+XyecZNRzqe4jRnPICWRElDUqVYcOGZRJrxr5rxIgRhpuXAd3QuEpK39WrVxsqjNTyCmsfdCYx0aCU7tu3b62yrDVxgSUAJpHUga7l+azNU7+jMY8zug+HRTQ6V80dEB/fxTqKi4tjFk7KSGT2c91YcSRx7d69u0Y3YEInMtERJSUMuHLlSrvooovs1ltvjeu8hjJF8p2M96igUDUhm6cOZDZ00zGZZHvUtnkzfw0LbNT2zR0gBusE1rFo0aK4zkQmxxrul19+iSdpffEiY6NUYx4oIZP9NBgOa7LEUFjHoWpBVw9lJF7Hem/gwIExIyLrYTSnqmlJbkaNGmWLFy+Oy4Gkx4COOs43dNSzPTJqOOxroBRs7sCeD+v6DdguvPDCeLIlMyKaIg3V/zhBk1Ktubxk6/OY4DBZYiBWGDAZyHRJeQ8syOTY4hgwYEA8pKysLJq1tRgO59WQIUNilkuWLGiWYELJRLJIeGvoPqOGgzhr166NJ18yQzb0w+d6Ha1nbBOwjkmTJhluyUiyQ/K8td2jhEfpiDUbTkhcYQLToZsHHdA8SU5GlPrIeMkkgoyYutZjx44JAzGnrtdwrmKST8robGJofv2XEh1OPJD/559/przatIfYCwEhLQG+aZH972iUURs2bDB09zyM1DUzjIVOMbZnkPVwMiZmw0mJLR/sWSXZDg2X/Hz+P+3CBALN5s2bF3ElHWboh24rSuf58+fH7J1k+2xom9EMhwCxaY2rRnD1SOrM2JjgsYe3bt06Q9s9vYvUmM+31DFz586NAt1xxx1xDYfLnFLLsNQ4kCWw0co8sJaBqdA8QZmMSRMnHbZnsJ5DNkiug0U5nZT7W7Zsid1NlKSMA2U+JkecU9AH2fqqq66qcwkh8Fx77bXx+kqUl+vXr48TPiaWBGum8GXccJj5ZsyYEa9XA1jUxv9UcqFNC6Bbt26NZsNakHlgwxsze5KFIcy51nDMkwd4hmaY5bGHCu5xksF4aCJgEkTFgfUOMiGOxcDruGFyZByoPlBpod0/evTomjXnuWLF5jeyOxphSBiYSGFS6J3gPtfnG/Nexg2HH8WMiSsQcFUC1mMQC10gtJuTzhBmHJCBWRX3uBIds099VwE0BkhLHoMmSerVI029mLklY23sb2Fdhg4eLu/CBAJzIXNhvy11YA0EzXDhObYJknIz9RiGxygRERuueGpqBsYEiatoUKHBdCiZcclbJkZWDIfAABYmQ0mC2QZXaGOmTGYKkABzYRbFJmvqIjYTwLLxHVjDoCWOyaEpA+UZ875iggWlJCZElFTYlyoIF5JjMoFmMBowJJeAne/VRMlvZfsekziydlPNlhoXKjOs9VCp0Rtu3759USR0vLAAx+yJdmwyIGJyS15jv0fWxswObE0ZKDdxgraG7I3ZHH8pgHY/tgOAF/FjAsVEgyUCys5k4mwKDy15LCYO7Jc2t5xHJQY+MjWykuGQCXB1AsoUrM8uv/zymlIyU4H/G9+Deh437wNmwvo0WaO2Rrwod3FjG1kxHMrD6667jg1rs+NBWRVL5XCP1gEepw8ccyqU0h3S/pYMx506hT9z4ezopePQ8+wwkBXDpYaKE7Cysipku9p/qnPy5KmweVr757HWwZ9o5qRdWJr6fS35eM/effbnug2xy5qX18lyQ00/ePDAcJXCHhs4oF9cn27fsTPU+IfsyNEj8f2cnA7BiKHrN25Mne7sshUr7dLpmStPMskFysbIfxAA659u3bpG3bp0ObvHVlZ+0KqDliiL48Z4qFwwuoQStEePpq1pMxl3U7/r7PlYGTAcj+caSkZs4ncKJWjXrtnvjtedopuK4BzHA9yqNWttReGquJ5LPXT9ho2GExq3ZSsKbcHCX2zlqjV2+NDh1MP+1cc4mWJ51bNHECQ3Nn+2bd9hW7b+FQx2LMY2aOCA0PjpFbPdpIkTQumca+PGjq5jNhx89O/P/KugGvjx8oOH7K9t262svMzK8Aemoaxct35juAKjIp6YWNP9tnS5HTl21DYH/MnYuHlL8rBV3B8oKw/n5J/hnFwd4z1y5KhVhO554eo1LXL9btYMV1Fxwv5YtsK6hS7l8IILbPFvf4ST9GgEidl01Mizf96Ck3rcmNGhm9TWLpr8n9CO5vnLYZgNWxnl4QTELDhkyCA7dPCwTZs6xbr+vVdYHmZ+TBg57XNs2fKVobFwtqtX39kXZ1WkcMJRWrrLikt228rCtVZcXBK2dApjxsMEg/J5WNAQWaBf6Cqje4fJI9niIYTTYEjomEM7nIO4nA36lQUT9gkd2kPhnwple9Su6TL0a7v37A1XYmyxLl3zA6ij8dY5rOtWrFxlQwYPilsAW7ZuszGjR8ZZFdli//6yaNDOoXRDpmAZEAaZGrPgmSAM7svKDlpFpxOWH8otdOzGjBppB0MZNi6UkRUhIyz8eYldMeuyWl3JffsPhEwR9rDClekD+mdmTyeTHE0YPzboEa4u+W2p4XFS7sNkGMgKyHIlJWf/tKUylJTsncr6+EFJjOUNtgswYeAcrag4+9cSmDSzPbJiOGStCyeMiyn6ZFiXYQBgTs7Q2DTADIPMgdlmbMhuuEctPXkSrsLPSkjnzSMmCsRbeaIyzu5Y5yBT9esX/gAzfOv+cLXF3rBN0D3sV/2xNGx/hMw9aNAA276jKE4o+GHsR27ctNlmXnZpuN9iffv0btb+0HmDOccHYZ7iktKIJX9HXshiuVYSrmv9T5j8BgzoH++R6YFtV5g0MJHW1zQ6x09QvIWlwbFj7eLEuSckhsEhAWCJsDNk9YKCoVmPMSslJaqm0t17bFtoKKwNTQek7J1FxVa6a7edOX2mFqiiABTrPKx9cL/lr2213v83n5SFDU9kNKxv0EQ4Hsrk4cMLrLKqsqYJ1DP8TVxubsc4cWAbpGuYMatCk2jY3+LBoIVhbQqT9e7V07Dmw3O8zjQOIHuFsnLGpdPjBJiX1zFsC/SME0sSJ7L3jp1FNmrE8Gg46HlhyIataWBSQbWRHy5fw1q7S37nsN+4z4ZdMMTa1dN1zjS2rBguv3NenN2RuS6aPDGWKMhgPUM3C2ucZBQVlcTr8UYMHxa7d7jHvh3L6Ne3j1179RWGuA4cOLsRjJMNQi1dttIOhzUAFttjRo2I2QGZrG9Y47QPWXr3nn1WFfD/suT32M1E5kMWKQjC4uoNlJ3ghGGgCtm0aWvIYmf/zg8l/voNZ//wNJkYlq8sDLEPjZd8bQlXoVwwNPxT2xD8ybDVUZr2F9QMmBqKATqMHT0qTvDI0GvXrY/r89yQ0XeFJJHt0Wb27NlxGf/www9n9LeWh/Xa7gDgbBOkTWyZ44rz6dMuims4ZL1dIaVjC6A4XG/ZMWSJinAC9g0dv4kTxmc0luZ+GbLcyaqT4aLevJpS8ESItWNYD2CNByPtD4YEFmRCvIaB+/q2RPAeSmo0H1jKMsS6YeOmuIc4YlhBXN8UF5fGjuXEsDxI4kRJjBIb2Q8VCbLC6LCGTbYPgI15QKfVYT2KyaNDh5xoNuBZHhpf48ePCUkhe027G2+80bJmuPpIx2yJtVzqYhvdTGwGowuIjFj194ld3+f1mhhozQzAcC3aoajvurbUDXGYDjcNMeCVgays4bySJVxioLkMyHDNZVCfFwNNYKCmpJwzZ06txT42e3E7u66qiot8/D1bckOHDR1FvI/uHI7FSBoGTYhBh4qB/xsGmpzhUhseYAnPk9v/DWsCKgbOk4H/AqXmM2+pCXksAAAAAElFTkSuQmCC" alt="" />

[xml]

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
 android:id=&quot;@+id/mainLayout&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;&gt;

&lt;LinearLayout
 android:id=&quot;@+id/main_bottom&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;52dp&quot;
 android:layout_alignParentBottom=&quot;true&quot;
 android:background=&quot;@drawable/top_bar&quot;
 android:gravity=&quot;center_vertical&quot;
 android:orientation=&quot;horizontal&quot;&gt;

&lt;RelativeLayout
 android:layout_width=&quot;0dp&quot;
 android:layout_height=&quot;match_parent&quot;
 android:layout_weight=&quot;1&quot;&gt;

&lt;Button
 android:id=&quot;@+id/btn_message&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;
 android:drawableTop=&quot;@drawable/tabbar_chat&quot;
 android:onClick=&quot;onTabSelect&quot;
 android:paddingBottom=&quot;2dip&quot;
 android:paddingTop=&quot;7dip&quot;
 android:scaleType=&quot;matrix&quot;
 android:text=&quot;@string/messages&quot;
 android:background=&quot;@null&quot;
 android:textColor=&quot;@drawable/tab_textcolor&quot;
 android:textSize=&quot;12sp&quot; /&gt;

&lt;ImageView
 android:id=&quot;@+id/iv_recent_tips&quot;
 android:layout_width=&quot;wrap_content&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:layout_alignParentRight=&quot;true&quot;
 android:layout_alignParentTop=&quot;true&quot;
 android:layout_marginRight=&quot;30dp&quot;
 android:layout_marginTop=&quot;3dp&quot;
 android:background=&quot;@drawable/msg_tips&quot;
 android:contentDescription=&quot;@string/action_settings&quot;
 android:gravity=&quot;center&quot;
 android:textColor=&quot;@android:color/white&quot;
 android:textSize=&quot;12sp&quot;
 android:visibility=&quot;gone&quot; /&gt;
 &lt;/RelativeLayout&gt;

&lt;RelativeLayout
 android:layout_width=&quot;0dp&quot;
 android:layout_height=&quot;match_parent&quot;
 android:layout_weight=&quot;1&quot;&gt;

&lt;Button
 android:id=&quot;@+id/btn_contact&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;
 android:drawableTop=&quot;@drawable/tabbar_contacts&quot;
 android:onClick=&quot;onTabSelect&quot;
 android:paddingBottom=&quot;2dip&quot;
 android:background=&quot;@null&quot;
 android:paddingTop=&quot;7dip&quot;
 android:scaleType=&quot;matrix&quot;
 android:text=&quot;@string/contact&quot;
 android:textColor=&quot;@drawable/tab_textcolor&quot;
 android:textSize=&quot;12sp&quot; /&gt;

&lt;ImageView
 android:id=&quot;@+id/iv_contact_tips&quot;
 android:layout_width=&quot;wrap_content&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:layout_alignParentRight=&quot;true&quot;
 android:layout_alignParentTop=&quot;true&quot;
 android:layout_marginRight=&quot;30dp&quot;
 android:layout_marginTop=&quot;7dp&quot;
 android:background=&quot;@drawable/msg_tips&quot;
 android:contentDescription=&quot;@string/action_settings&quot;
 android:gravity=&quot;center&quot;
 android:textColor=&quot;@android:color/white&quot;
 android:textSize=&quot;12sp&quot;
 android:visibility=&quot;gone&quot; /&gt;
 &lt;/RelativeLayout&gt;

&lt;Button
 android:id=&quot;@+id/btn_discover&quot;
 android:layout_width=&quot;0dp&quot;
 android:layout_height=&quot;match_parent&quot;
 android:layout_weight=&quot;1&quot;
 android:drawableTop=&quot;@drawable/tabbar_discover&quot;
 android:onClick=&quot;onTabSelect&quot;
 android:paddingBottom=&quot;2dip&quot;
 android:paddingTop=&quot;7dip&quot;
 android:background=&quot;@null&quot;
 android:scaleType=&quot;matrix&quot;
 android:text=&quot;@string/discover&quot;
 android:textColor=&quot;@drawable/tab_textcolor&quot;
 android:textSize=&quot;12sp&quot; /&gt;

&lt;Button
 android:id=&quot;@+id/btn_my_space&quot;
 android:layout_width=&quot;0dp&quot;
 android:layout_height=&quot;match_parent&quot;
 android:layout_weight=&quot;1&quot;
 android:drawableTop=&quot;@drawable/tabbar_me&quot;
 android:onClick=&quot;onTabSelect&quot;
 android:paddingBottom=&quot;2dip&quot;
 android:paddingTop=&quot;7dip&quot;
 android:background=&quot;@null&quot;
 android:scaleType=&quot;matrix&quot;
 android:text=&quot;@string/me&quot;
 android:textColor=&quot;@drawable/tab_textcolor&quot;
 android:textSize=&quot;12sp&quot; /&gt;
 &lt;/LinearLayout&gt;

&lt;RelativeLayout
 android:id=&quot;@+id/fragment_container&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;
 android:layout_above=&quot;@id/main_bottom&quot; /&gt;

&lt;/RelativeLayout&gt;[/xml]

这里对performClick做一下说明：

//==========================================
<h2><span style="color: #008080;">Android performClick无效，UI线程理解</span></h2>
<div>
<div id="cnblogs_post_body">
<h2>原因</h2>
开发过程中遇到button.performClick()无效，原因是<span style="color: #008080;">View.performClick()需要再UI线程中</span>调用才会有效执行。

响应系统调用的方法(比如报告用户动作的onKeyDown()或一个生命周期回调方法)永远在界面线程中进程，所以onCreate里面调用button的performClick没问题，
而通过code直接调用相当于是代码执行，并不会触发android的UI线程。
<h2>什么是UI线程，以下来自官网翻译</h2>
当一个应用被启动，系统创建一个执行线程，叫做"main"。这个线程是十分重要的，因为它主管向用户界面控件派发事件。其中包含绘图事件。它也是你的应用与界面工具包（android.widget和 android.view包中的组件）交互的地方。于是main线程也被称为界面线程。

系统不会为每个组件的实例分别创建线程。所有运行于一个进程的组件都在界面线程中被实例化，并且系统对每个组件的调用都在这个线程中派发。因此，响应系统调用的方法(比如报告用户动作的onKeyDown()或一个生命周期回调方法)永远在界面线程中进程。

例如，当用户触摸屏幕上的一个按钮时，你的应用的界面线程把触摸事件派发给控件，然后控件设置它的按下状态再向事件队列发出一个自己界面变得无效的请求，界面线程从队列中取出这个请求并通知这个控件重绘它自己。

<a href="http://wiki.eoeandroid.com/Processes_and_Threads">http://wiki.eoeandroid.com/Processes_and_Threads</a>
<h2>解决方法，最简单的方式</h2>
<div id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:016fd860-da71-48c6-a1ac-3f86fcb93afa">
<div id="highlighter_847346"><span style="font-size: medium;"><span style="font-size: medium;"><span style="line-height: normal;">[java]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;View.post(new Runnable(){
@Override
public void run() {
button.performClick();
}
});[/java]

</div>
</div>
View.post(Runnable)方法。在post(Runnable action)方法里，View获得当前线程（即UI线程）的Handler，然后将action对象post到Handler里。在Handler里，它将传递过来的action对象包装成一个Message（Message的callback为action），然后将其投入UI线程的消息循环中。在Handler再次处理该Message时，有一条分支（未解释的那条）就是为它所设，直接调用runnable的run方法。而此时，已经路由到UI线程里，因此，我们可以毫无顾虑的来更新UI。
<div id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:12aedada-258e-42f7-b44b-0c328c5172cc">
<div id="highlighter_571445"><span style="font-size: medium;"><span style="font-size: medium;"><span style="line-height: normal;">[java]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Activity.runOnUiThread(new Runnable() {
@Override
public void run() {
button.performClick();
}
});[/java]

</div>
</div>
Activity.runOnUiThread(Runnable)把更新ui的代码创建在Runnable中，然后在需要更新ui时，把这个Runnable对象传给Activity.runOnUiThread(Runnable)。 这样Runnable对像就能在ui程序中被调用。如果当前线程是UI线程,那么行动是立即执行。如果当前线程不是UI线程,操作是发布到事件队列的UI线程
<h2>android提供了几种常用的方式，用于实现后台线程与UI线程的交互</h2>
<ul>
	<li>1. handler</li>
	<li>2. Activity.runOnUIThread(Runnable)</li>
	<li>3. View.Post(Runnable)</li>
	<li>4. View.PostDelayed(Runnabe,long)</li>
	<li>5. AsyncTask</li>
</ul>
</div>
</div>
//==========================================

其中MainActivity通过FragmentManager开启事务区管理会话，联系人，发现，我这四个Fragment。

5.会话的Fragment

这里每个布局的title新建了一个类进行统一的管理。该类继承自LinearLayout。通过LayoutInflater去加载布局。这样大大简化了代码的重用。

会话界面的ListView使用了开源库XlistView，

&nbsp;

&nbsp;

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>339</wp:post_id>
		<wp:post_date>2015-03-13 15:45:35</wp:post_date>
		<wp:post_date_gmt>2015-03-13 07:45:35</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>leancloud%e5%8d%b3%e6%97%b6%e9%80%9a%e8%ae%af%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="leancloud"><![CDATA[leancloud]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707535]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>ActivityLifeCycle官方demo解析</title>
		<link>http://1.duoinfo.sinaapp.com/?p=343</link>
		<pubDate>Sat, 14 Mar 2015 01:55:51 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=343</guid>
		<description></description>
		<content:encoded><![CDATA[<h1>1.关于Activity的生命周期的几篇文章：</h1>
<a href="http://1.duoinfo.sinaapp.com/?p=330" target="_blank">http://1.duoinfo.sinaapp.com/?p=330</a>

<a href="http://1.duoinfo.sinaapp.com/?p=332" target="_blank">http://1.duoinfo.sinaapp.com/?p=332</a>

<a href="http://1.duoinfo.sinaapp.com/?p=335" target="_blank">http://1.duoinfo.sinaapp.com/?p=335</a>

<a href="http://1.duoinfo.sinaapp.com/?p=337" target="_blank">http://1.duoinfo.sinaapp.com/?p=337</a>

training课程给的图是这样的：

<img src="http://img.blog.csdn.net/20150313150859528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<h1>2.运行官方的程序</h1>
<div><img src="http://img.blog.csdn.net/20150314092349820?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div></div>
<div></div>
<div><img src="http://img.blog.csdn.net/20150314092531146?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div></div>
<div></div>
<div><img src="http://img.blog.csdn.net/20150314092427010?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div><img src="http://img.blog.csdn.net/20150314092608696?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div></div>
<div>看到这个demo含有四个Activity，最后一个Activity的样式文件为dialog。并且在下面用TextView显示了每个Activity的状态。</div>
<div></div>
<div>运行程序进入AActivity，此时的状态如下：</div>
<div><img src="http://img.blog.csdn.net/20150314092720687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div>AActivity进入到onResume方法。分别执行了onCreate---&gt;onStart---&gt;onResume方法。点击Start B按钮，此时的状态如下：
<img src="http://img.blog.csdn.net/20150314092854946?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></div>
<div></div>
<div></div>
<div></div>
看到AActivity进入到onStop方法中，而BActivity则进入到onResume方法中。相应的执行顺序：AActivity接着上面的onResume方法执行了onPause方法，接着BActivity执行了：onCreate---&gt;onStart---&gt;onResume进入到Resumed状态，然后A到了onStop状态，此时点击Start C按钮：我们看到AActivity和BActivity分别进入到Stopped状态，CActivity进入到Resumed状态，同样执行顺序和上面的类似，不再说明，如下图：

<img src="http://img.blog.csdn.net/20150314093545101?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

此时，点击Dialog按钮：

我们看到CActivity进入到Paused状态，说明：在Paused状态下，Activity是可以是半透明的，而不一定完全不可视，点击close关闭Dialog，CActivity进入到Resumed状态，此时点击Finish C:我们看到CActivity执行了onPause---&gt;onDestory进入到Destroyed方法。

<img src="http://img.blog.csdn.net/20150314093830689?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

点击Finish B，和上面的一样的流程，在AActivity的界面上，我们按下小房子，然后再进入：

<img src="http://img.blog.csdn.net/20150314094201920?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

此时我们分析的就差不多了，旋转屏幕同样会带来生命周期的变化。

3.分析源码：

AActivity:
<pre></pre>
[java]package com.dystu.activitylifecycle;

import android.content.Intent;
import android.support.v7.app.ActionBarActivity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.TextView;

import com.dystu.activitylifecycle.utils.StatusTracker;
import com.dystu.activitylifecycle.utils.Utils;

public class AActivity extends ActionBarActivity {

 private String mActivityName;
 private TextView mStatusView;
 private TextView mStatusAllView;
 private StatusTracker mStatusTracker = StatusTracker.getInstance();

 @Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_a);
 mActivityName = getString(R.string.activity_a);
 mStatusView = (TextView)findViewById(R.id.status_view_a);
 mStatusAllView = (TextView)findViewById(R.id.status_view_all_a);
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_create));
 Utils.printStatus(mStatusView, mStatusAllView);
 }

 @Override
 protected void onStart() {
 super.onStart();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_start));
 Utils.printStatus(mStatusView, mStatusAllView);
 }

 @Override
 protected void onRestart() {
 super.onRestart();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_restart));
 Utils.printStatus(mStatusView, mStatusAllView);
 }

 @Override
 protected void onResume() {
 super.onResume();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_resume));
 Utils.printStatus(mStatusView, mStatusAllView);
 }

 @Override
 protected void onPause() {
 super.onPause();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_pause));
 Utils.printStatus(mStatusView, mStatusAllView);
 }

 @Override
 protected void onStop() {
 super.onStop();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_stop));
 }

 @Override
 protected void onDestroy() {
 super.onDestroy();
 mStatusTracker.setStatus(mActivityName, getString(R.string.on_destroy));
 mStatusTracker.clear();
 }

 public void startDialog(View v) {
 Intent intent = new Intent(AActivity.this, DialogActivity.class);
 startActivity(intent);
 }

 public void startActivityB(View v) {
 Intent intent = new Intent(AActivity.this, BActivity.class);
 startActivity(intent);
 }

 public void startActivityC(View v) {
 Intent intent = new Intent(AActivity.this, CActivity.class);
 startActivity(intent);
 }

 public void finishActivityA(View v) {
 AActivity.this.finish();
 }

 @Override
 public boolean onCreateOptionsMenu(Menu menu) {
 // Inflate the menu; this adds items to the action bar if it is present.
 getMenuInflater().inflate(R.menu.menu_a, menu);
 return true;
 }

 @Override
 public boolean onOptionsItemSelected(MenuItem item) {
 // Handle action bar item clicks here. The action bar will
 // automatically handle clicks on the Home/Up button, so long
 // as you specify a parent activity in AndroidManifest.xml.
 int id = item.getItemId();

 //noinspection SimplifiableIfStatement
 if (id == R.id.action_settings) {
 return true;
 }

 return super.onOptionsItemSelected(item);
 }
}[/java]
<pre></pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>343</wp:post_id>
		<wp:post_date>2015-03-14 09:55:51</wp:post_date>
		<wp:post_date_gmt>2015-03-14 01:55:51</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>activitylifecycle%e5%ae%98%e6%96%b9demo%e8%a7%a3%e6%9e%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707536]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Creating a Fragment</title>
		<link>http://1.duoinfo.sinaapp.com/?p=347</link>
		<pubDate>Sat, 14 Mar 2015 02:04:12 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=347</guid>
		<description></description>
		<content:encoded><![CDATA[You can think of a fragment as a modular section of an activity, which has its own lifecycle, receives its own input events, and which you can add or remove while the activity is running (sort of like a "sub activity" that you can reuse in different activities). This lesson shows how to extend the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> class using the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/index.html">Support Library</a> so your app remains compatible with devices running system versions as low as Android 1.6.

<strong>Note:</strong> If you decide that the minimum API level your app requires is 11 or higher, you don't need to use the Support Library and can instead use the framework's built in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> class and related APIs. Just be aware that this lesson is focused on using the APIs from the Support Library, which use a specific package signature and sometimes slightly different API names than the versions included in the platform.

Before you begin this lesson, you must set up your Android project to use the Support Library. If you have not used the Support Library before, set up your project to use the <strong>v4</strong> library by following the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/setup.html">Support Library Setup</a> document. However, you can also include the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/actionbar.html">action bar</a> in your activities by instead using the <strong>v7 appcompat</strong> library, which is compatible with Android 2.1 (API level 7) and also includes the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> APIs.
<h2 id="Create">Create a Fragment Class</h2>

<hr />

To create a fragment, extend the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> class, then override key lifecycle methods to insert your app logic, similar to the way you would with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> class.

One difference when creating a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> is that you must use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html#onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)">onCreateView()</a></code> callback to define the layout. In fact, this is the only callback you need in order to get a fragment running. For example, here's a simple fragment that specifies its own layout:

[java]import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.ViewGroup;

public class ArticleFragment extends Fragment {
@Override
public View onCreateView(LayoutInflater inflater, ViewGroup container,
Bundle savedInstanceState) {
// Inflate the layout for this fragment
return inflater.inflate(R.layout.article_view, container, false);
}
}[/java]

Just like an activity, a fragment should implement other lifecycle callbacks that allow you to manage its state as it is added or removed from the activity and as the activity transitions between its lifecycle states. For instance, when the activity's <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onPause()">onPause()</a></code> method is called, any fragments in the activity also receive a call to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html#onPause()">onPause()</a></code>.

More information about the fragment lifecycle and callback methods is available in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/components/fragments.html">Fragments</a>developer guide.
<h2 id="AddInLayout">Add a Fragment to an Activity using XML</h2>

<hr />

While fragments are reusable, modular UI components, each instance of a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> class must be associated with a parent <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html">FragmentActivity</a></code>. You can achieve this association by defining each fragment within your activity layout XML file.

<strong>Note:</strong> <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html">FragmentActivity</a></code> is a special activity provided in the Support Library to handle fragments on system versions older than API level 11. If the lowest system version you support is API level 11 or higher, then you can use a regular <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code>.

Here is an example layout file that adds two fragments to an activity when the device screen is considered "large" (specified by the <code>large</code> qualifier in the directory name).

res/layout-large/news_articles.xml

[xml]&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
android:orientation=&quot;horizontal&quot;
android:layout_width=&quot;fill_parent&quot;
android:layout_height=&quot;fill_parent&quot;&gt;

&lt;fragment android:name=&quot;com.example.android.fragments.HeadlinesFragment&quot;
android:id=&quot;@+id/headlines_fragment&quot;
android:layout_weight=&quot;1&quot;
android:layout_width=&quot;0dp&quot;
android:layout_height=&quot;match_parent&quot; /&gt;

&lt;fragment android:name=&quot;com.example.android.fragments.ArticleFragment&quot;
android:id=&quot;@+id/article_fragment&quot;
android:layout_weight=&quot;2&quot;
android:layout_width=&quot;0dp&quot;
android:layout_height=&quot;match_parent&quot; /&gt;

&lt;/LinearLayout&gt;[/xml]

<strong>Tip:</strong> For more about creating layouts for different screen sizes, read <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/multiscreen/screensizes.html">Supporting Different Screen Sizes</a>.

Then apply the layout to your activity:

[java]import android.os.Bundle;
import android.support.v4.app.FragmentActivity;

public class MainActivity extends FragmentActivity {
@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.news_articles);
}
}[/java]

If you're using the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/features.html#v7-appcompat">v7 appcompat library</a>, your activity should instead extend <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v7/app/ActionBarActivity.html">ActionBarActivity</a></code>, which is a subclass of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html">FragmentActivity</a></code> (for more information, read <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/actionbar/index.html">Adding the Action Bar</a>).

<strong>Note:</strong> When you add a fragment to an activity layout by defining the fragment in the layout XML file, you <em>cannot</em> remove the fragment at runtime. If you plan to swap your fragments in and out during user interaction, you must add the fragment to the activity when the activity first starts, as shown in the next lesson.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>347</wp:post_id>
		<wp:post_date>2015-03-14 10:04:12</wp:post_date>
		<wp:post_date_gmt>2015-03-14 02:04:12</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>creating-a-fragment</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707537]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Building a Flexible UI</title>
		<link>http://1.duoinfo.sinaapp.com/?p=350</link>
		<pubDate>Sat, 14 Mar 2015 02:17:26 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=350</guid>
		<description></description>
		<content:encoded><![CDATA[When designing your application to support a wide range of screen sizes, you can reuse your fragments in different layout configurations to optimize the user experience based on the available screen space.

For example, on a handset device it might be appropriate to display just one fragment at a time for a single-pane user interface. Conversely, you may want to set fragments side-by-side on a tablet which has a wider screen size to display more information to the user.

<img src="http://img.blog.csdn.net/20150314100933136?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

<img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/fragments-screen-mock.png" alt="" />

<strong>Figure 1.</strong> Two fragments, displayed in different configurations for the same activity on different screen sizes. On a large screen, both fragments fit side by side, but on a handset device, only one fragment fits at a time so the fragments must replace each other as the user navigates.

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code> class provides methods that allow you to add, remove, and replace fragments to an activity at runtime in order to create a dynamic experience.
<h2 id="AddAtRuntime">Add a Fragment to an Activity at Runtime</h2>

<hr />

Rather than defining the fragments for an activity in the layout file—as shown in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/fragments/creating.html">previous lesson</a> with the <code>&lt;fragment&gt;</code> element—you can add a fragment to the activity during the activity runtime. This is necessary if you plan to change fragments during the life of the activity.

To perform a transaction such as add or remove a fragment, you must use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code> to create a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html">FragmentTransaction</a></code>, which provides APIs to add, remove, replace, and perform other fragment transactions.

If your activity allows the fragments to be removed and replaced, you should add the initial fragment(s) to the activity during the activity's <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method.

如果Activity允许Fragments移除和替换等等操作，你需要在onCreate中做初始化。

<span style="color: #3366ff;">An important rule when dealing with fragments—especially when adding fragments at runtime—is that your activity layout must include a container <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/View.html"><span style="color: #3366ff;">View</span></a></code> in which you can insert the fragment.</span>

Activity的布局需要包含一个View，这个View是用来插入Fragment的。

The following layout is an alternative to the layout shown in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/fragments/creating.html">previous lesson</a> that shows only one fragment at a time. In order to replace one fragment with another, the activity's layout includes an empty <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/FrameLayout.html">FrameLayout</a></code> that acts as the fragment container.

这里使用FrameLayout来扮演这个View container。

Notice that the filename is the same as the layout file in the previous lesson, but the layout directory does <em>not</em> have the <code>large</code> qualifier, so this layout is used when the device screen is smaller than <em>large</em> because the screen does not fit both fragments at the same time.

<code>res/layout/news_articles.xml:</code>

[xml]&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
android:id=&quot;@+id/fragment_container&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot; /&gt;[/xml]

Inside your activity, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentActivity.html#getSupportFragmentManager()">getSupportFragmentManager()</a></code> to get a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html">FragmentManager</a></code> using the Support Library APIs. Then call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html#beginTransaction()">beginTransaction()</a></code> to create a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html">FragmentTransaction</a></code> and call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#add(android.support.v4.app.Fragment, java.lang.String)">add()</a></code> to add a fragment.

You can perform multiple fragment transaction for the activity using the same <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html">FragmentTransaction</a></code>. When you're ready to make the changes, you must call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#commit()">commit()</a></code>.

For example, here's how to add a fragment to the previous layout:

[java]import android.os.Bundle;
import android.support.v4.app.FragmentActivity;

public class MainActivity extends FragmentActivity {
@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.news_articles);

// Check that the activity is using the layout version with
// the fragment_container FrameLayout
if (findViewById(R.id.fragment_container) != null) {

&lt;span style=&quot;color: #3366ff;&quot;&gt;  // However, if we're being restored from a previous state,&lt;/span&gt;
&lt;span style=&quot;color: #3366ff;&quot;&gt;            // then we don't need to do anything and should return or else&lt;/span&gt;
&lt;span style=&quot;color: #3366ff;&quot;&gt;            // we could end up with overlapping fragments.&lt;/span&gt;
if (savedInstanceState != null) {
return;
}

// Create a new Fragment to be placed in the activity layout
HeadlinesFragment firstFragment = new HeadlinesFragment();

// In case this activity was started with special instructions from an
// Intent, pass the Intent's extras to the fragment as arguments
           //通信了
firstFragment.setArguments(getIntent().getExtras());

// Add the fragment to the 'fragment_container' FrameLayout
getSupportFragmentManager().beginTransaction()
.add(R.id.fragment_container, firstFragment).commit();
}
}
}[/java]

Because the fragment has been added to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/FrameLayout.html">FrameLayout</a></code> container at runtime—instead of defining it in the activity's layout with a <code>&lt;fragment&gt;</code> element—the activity can remove the fragment and replace it with a different one.
<h2 id="Replace">Replace One Fragment with Another</h2>

<hr />

The procedure to replace a fragment is similar to adding one, but requires the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#replace(int, android.support.v4.app.Fragment)">replace()</a></code> method instead of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#add(android.support.v4.app.Fragment, java.lang.String)">add()</a></code>.

Keep in mind that when you perform fragment transactions, such as replace or remove one, it's often appropriate to allow the user to navigate backward and "undo" the change. To allow the user to navigate backward through the fragment transactions,<span style="color: #0000ff;"> you must call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#addToBackStack(java.lang.String)"><span style="color: #0000ff;">addToBackStack()</span></a></code> before you commit the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html"><span style="color: #0000ff;">FragmentTransaction</span></a></code>.</span>

<strong>Note:</strong> When you remove or replace a fragment and add the transaction to the back stack, the fragment that is removed is stopped (not destroyed). If the user navigates back to restore the fragment, it restarts. If you <em>do not</em> add the transaction to the back stack, then the fragment is destroyed when removed or replaced.

Example of replacing one fragment with another:

[java]// Create fragment and give it an argument specifying the article it should show
ArticleFragment newFragment = new ArticleFragment();
Bundle args = new Bundle();
args.putInt(ArticleFragment.ARG_POSITION, position);
newFragment.setArguments(args);

FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();

// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack so the user can navigate back
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);

// Commit the transaction
transaction.commit();[/java]

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> method takes an optional string parameter that specifies a unique name for the transaction. The name isn't needed unless you plan to perform advanced fragment operations using the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.BackStackEntry.html">FragmentManager.BackStackEntry</a></code> APIs.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>350</wp:post_id>
		<wp:post_date>2015-03-14 10:17:26</wp:post_date>
		<wp:post_date_gmt>2015-03-14 02:17:26</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>building-a-flexible-ui</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707538]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Communicating with Other Fragments</title>
		<link>http://1.duoinfo.sinaapp.com/?p=353</link>
		<pubDate>Sat, 14 Mar 2015 02:30:24 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=353</guid>
		<description></description>
		<content:encoded><![CDATA[In order to reuse the Fragment UI components, you should build each as a completely self-contained, modular component that defines its own layout and behavior. Once you have defined these reusable Fragments, <span style="color: #0000ff;">you can associate them with an Activity and connect them with the application logic to realize the overall composite UI.</span>

Often you will want one Fragment to communicate with another, for example to change the content based on a user event. <span style="color: #0000ff;">All Fragment-to-Fragment communication is done through the associated Activity. Two Fragments should never communicate directly.</span>

所有的Fragment之间的通信均是通过与之相联系的Activity，任意的两个Fragments之间不应该之间通信。
<h2 id="DefineInterface">Define an Interface</h2>

<hr />

To allow a Fragment to communicate up to its Activity, <span style="color: #0000ff;">you can define an interface in the Fragment class and implement it within the Activity.</span> （在Fragment内部创建一个接口，然后在Activity中实现）<span style="color: #0000ff;">The Fragment captures the interface implementation during its onAttach() lifecycle method and can then call the Interface methods in order to communicate with the Activity.（在Fragment生命周期的onAttach方法中，他可以查看到这个接口的实现，然后就可以调用这个接口的方法去和Activity通信）</span>

Here is an example of Fragment to Activity communication:

[java]public class HeadlinesFragment extends ListFragment {
OnHeadlineSelectedListener mCallback;

// Container Activity must implement this interface
public interface OnHeadlineSelectedListener {
public void onArticleSelected(int position);
}

@Override
public void onAttach(Activity activity) {
super.onAttach(activity);

// This makes sure that the container activity has implemented
// the callback interface. If not, it throws an exception
try {
mCallback = (OnHeadlineSelectedListener) activity;
} catch (ClassCastException e) {
throw new ClassCastException(activity.toString()
+ &quot; must implement OnHeadlineSelectedListener&quot;);
}
}

...
}[/java]

Now the fragment can deliver messages to the activity by calling the <code>onArticleSelected()</code> method (or other methods in the interface) using the <code>mCallback</code> instance of the <code>OnHeadlineSelectedListener</code>interface.

For example, the following method in the fragment is called when the user clicks on a list item. The fragment uses the callback interface to deliver the event to the parent activity.

[java]@Override
public void onListItemClick(ListView l, View v, int position, long id) {
// Send the event to the host activity
mCallback.onArticleSelected(position);
}[/java]
<h2 id="Implement">Implement the Interface</h2>

<hr />

In order to receive event callbacks from the fragment, the activity that hosts it must implement the interface defined in the fragment class.

For example, the following activity implements the interface from the above example.

[java]public static class MainActivity extends Activity
implements HeadlinesFragment.OnHeadlineSelectedListener{
...

public void onArticleSelected(int position) {
// The user selected the headline of an article from the HeadlinesFragment
// Do something here to display that article
}
}[/java]
<h2 id="Deliver">Deliver a Message to a Fragment</h2>

<hr />

The host activity can deliver messages to a fragment by capturing the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/Fragment.html">Fragment</a></code> instance with<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/FragmentManager.html#findFragmentById(int)">findFragmentById()</a></code>, then directly call the fragment's public methods.

For instance, imagine that the activity shown above may contain another fragment that's used to display the item specified by the data returned in the above callback method. In this case, the activity can pass the information received in the callback method to the other fragment that will display the item:

[java]public static class MainActivity extends Activity
implements HeadlinesFragment.OnHeadlineSelectedListener{
...

public void onArticleSelected(int position) {
// The user selected the headline of an article from the HeadlinesFragment
// Do something here to display that article

ArticleFragment articleFrag = (ArticleFragment)
getSupportFragmentManager().findFragmentById(R.id.article_fragment);

if (articleFrag != null) {
// If article frag is available, we're in two-pane layout...

// Call a method in the ArticleFragment to update its content
articleFrag.updateArticleView(position);
} else {
// Otherwise, we're in the one-pane layout and must swap frags...

// Create fragment and give it an argument for the selected article
ArticleFragment newFragment = new ArticleFragment();
Bundle args = new Bundle();
args.putInt(ArticleFragment.ARG_POSITION, position);
newFragment.setArguments(args);

FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();

// Replace whatever is in the fragment_container view with this fragment,
// and add the transaction to the back stack so the user can navigate back
transaction.replace(R.id.fragment_container, newFragment);
transaction.addToBackStack(null);

// Commit the transaction
transaction.commit();
}
}
}[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>353</wp:post_id>
		<wp:post_date>2015-03-14 10:30:24</wp:post_date>
		<wp:post_date_gmt>2015-03-14 02:30:24</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>communicating-with-other-fragments</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="fragment"><![CDATA[Fragment]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707539]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>长度为n的数组循环左移i位</title>
		<link>http://1.duoinfo.sinaapp.com/?p=356</link>
		<pubDate>Sat, 14 Mar 2015 03:09:46 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=356</guid>
		<description></description>
		<content:encoded><![CDATA[代码如下：
<pre></pre>
[c]#include &lt;iostream&gt;
 #include &lt;cstdlib&gt;
#include &lt;cstdio&gt;

using namespace std;

void Reserse(char pArray[], int start, int end)
 {
 int i = start;
 int j = end;
 int temp = 0;
 while (i&lt;j)
 {
 temp = pArray[i];
 pArray[i] = pArray[j];
 pArray[j] = temp;
 i++;
 j--;
 }
 }
 void show(char pArray[],int len)
 {
 for (int i = 0; i &lt; len;i++)
 {
 printf(&quot;%c&quot;, pArray[i]);
 }
 }

void main()
 {
 char pArray[] = {'a','b','c','d','e','f','g'};
 int len = sizeof(pArray)/sizeof(char);
 cout &lt;&lt; len &lt;&lt; endl;
 show(pArray, len);
 cout &lt;&lt; &quot;\n&quot; &lt;&lt; endl;
 int i = 3;
 Reserse(pArray, 0, i - 1);
 Reserse(pArray, i, len - 1);
 Reserse(pArray, 0, len - 1);
 show(pArray, len);
 getchar();
 }[/c]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>356</wp:post_id>
		<wp:post_date>2015-03-14 11:09:46</wp:post_date>
		<wp:post_date_gmt>2015-03-14 03:09:46</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%95%bf%e5%ba%a6%e4%b8%ban%e7%9a%84%e6%95%b0%e7%bb%84%e5%be%aa%e7%8e%af%e5%b7%a6%e7%a7%bbi%e4%bd%8d</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95"><![CDATA[数据结构和算法]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707540]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>数组和链表的区别</title>
		<link>http://1.duoinfo.sinaapp.com/?p=361</link>
		<pubDate>Sat, 14 Mar 2015 03:13:22 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=361</guid>
		<description></description>
		<content:encoded><![CDATA[<ul>
	<li>
<div>数组是将元素在内存中连续存放，由于每个元素占用内存相同，可以通过下标迅速访问数组中任何元素。但是如果要在数组中增加一个元素，需要移动大量元素，在内存中空出一个元素的空间，然后将要增加的元素放在其中。同样的道理，如果想删除一个元素，同样需要移动大量元素去填掉被移动的元素。如果应用需要快速访问数据，很少或不插入和删除元素，就应该用数组。</div></li>
	<li>
<div>链表恰好相反，链表中的元素在内存中不是顺序存储的，而是通过存在元素中的指针联系到一起。比如：上一个元素有个指针指到下一个元素，以此类推，直到最后一个元素。如果要访问链表中一个元素，需要从第一个元素开始，一直找到需要的元素位置。但是增加和删除一个元素对于链表数据结构就非常简单了，只要修改元素中的指针就可以了。如果应用需要经常插入和删除元素你就需要用链表数据结构了。</div></li>
</ul>
<strong>*C++语言中可以用数组处理一组数据类型相同的数据，但不允许动态定义数组的大小，即在使用数组之前必须确定数组的大小。而在实际应用中，用户使用数组之前有时无法准确确定数组的大小，只能将数组定义成足够大小，这样数组中有些空间可能不被使用，从而造成内存空间的浪费。</strong><strong>链表是一种常见的数据组织形式，它采用动态分配内存的形式实现。需要时可以用new分配内存空间，不需要时用delete将已分配的空间释放，不会造成内存空间的浪费。</strong>
(1) 从逻辑结构角度来看
a, 数组必须事先定义固定的长度（元素个数），不能适应数据动态地增减的情况。当数据增加时，可能超出原先定义的元素个数；当数据减少时，造成内存浪费。
b,链表动态地进行存储分配，可以适应数据动态地增减的情况，且可以方便地插入、删除数据项。（数组中插入、删除数据项时，需要移动其它数据项）
(2)从内存存储角度来看
a,(静态)数组从栈中分配空间, 对于程序员方便快速,但自由度小。
b, 链表从堆中分配空间, 自由度大但申请管理比较麻烦.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>361</wp:post_id>
		<wp:post_date>2015-03-14 11:13:22</wp:post_date>
		<wp:post_date_gmt>2015-03-14 03:13:22</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e6%95%b0%e7%bb%84%e5%92%8c%e9%93%be%e8%a1%a8%e7%9a%84%e5%8c%ba%e5%88%ab</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95"><![CDATA[数据结构和算法]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707541]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>顺序表的插入和删除</title>
		<link>http://1.duoinfo.sinaapp.com/?p=363</link>
		<pubDate>Sat, 14 Mar 2015 07:09:15 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=363</guid>
		<description></description>
		<content:encoded><![CDATA[插入需要移动n-i+1次，而且是从最后一个开始移动的，所以，在for循环里面，从最后开始，同时程序需要注意边界条件；

删除操作需要移动n-i次，同时也需要注意边界条件，不过不需要从最后开始移动元素了。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>363</wp:post_id>
		<wp:post_date>2015-03-14 15:09:15</wp:post_date>
		<wp:post_date_gmt>2015-03-14 07:09:15</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%a1%ba%e5%ba%8f%e8%a1%a8%e7%9a%84%e6%8f%92%e5%85%a5%e5%92%8c%e5%88%a0%e9%99%a4</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95"><![CDATA[数据结构和算法]]></category>
		<category domain="post_tag" nicename="%e9%93%be%e8%a1%a8"><![CDATA[链表]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707542]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>单链表的插入和删除</title>
		<link>http://1.duoinfo.sinaapp.com/?p=366</link>
		<pubDate>Sat, 14 Mar 2015 07:54:56 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=366</guid>
		<description></description>
		<content:encoded><![CDATA[插入：

申请一个节点s:

s = new Node;

数据域为x;

s-&gt;data = x;

其指针域为前一个指针的指针域：

s-&gt;next = p-&gt;next;

前一个指针的指针域指向当前的节点：

p-&gt;next = s;

时间复杂度为：O（n）

删除操作：

删除操作是将单链表的第i个节点删除，因为单链表中节点a（i）的存储地址在其前驱节点a（i-1）的指针域中，所以必须首先找到a（i-1）的存储地址p，然后令p的next域指向a（i）的后继节点。

//暂存被删除的节点

q = p-&gt;next;x = q-&gt;data;

//摘链

p-&gt;next = q-&gt;next;

delete q;

时间复杂度为：O（n）

&nbsp;

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>366</wp:post_id>
		<wp:post_date>2015-03-14 15:54:56</wp:post_date>
		<wp:post_date_gmt>2015-03-14 07:54:56</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%8d%95%e9%93%be%e8%a1%a8%e7%9a%84%e6%8f%92%e5%85%a5%e5%92%8c%e5%88%a0%e9%99%a4</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95"><![CDATA[数据结构和算法]]></category>
		<category domain="post_tag" nicename="%e9%93%be%e8%a1%a8"><![CDATA[链表]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707543]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>轻松搞定面试中的链表题目</title>
		<link>http://1.duoinfo.sinaapp.com/?p=369</link>
		<pubDate>Sat, 14 Mar 2015 08:03:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=369</guid>
		<description></description>
		<content:encoded><![CDATA[链表结点声明如下：

[c]struct ListNode
{
int m_nKey;
ListNode * m_pNext;

};[/c]

<strong>题目列表：</strong>

1. 求单链表中结点的个数
2. 将单链表反转
3. 查找单链表中的倒数第K个结点（k &gt; 0）
4. 查找单链表的中间结点
5. 从尾到头打印单链表
6. 已知两个单链表pHead1 和pHead2 各自有序，把它们合并成一个链表依然有序
7. 判断一个单链表中是否有环
8. 判断两个单链表是否相交
9. 求两个单链表相交的第一个节点
10. 已知一个单链表中存在环，求进入环中的第一个节点
11. 给出一单链表头指针pHead和一节点指针pToBeDeleted，O(1)时间复杂度删除节点pToBeDeleted

<strong>
详细解答</strong>

<strong><a name="topic1"></a>1. 求单链表中结点的个数</strong>

这是最最基本的了，应该能够迅速写出正确的代码，注意检查链表是否为空。时间复杂度为O（n）。参考代码如下：

// 求单链表中结点的个数
[c]unsigned int GetListLength(ListNode * pHead)
{
 if(pHead == NULL)
 return 0;

unsigned int nLength = 0;
 ListNode * pCurrent = pHead;
 while(pCurrent != NULL)
 {
 nLength++;
 pCurrent = pCurrent-&gt;m_pNext;
 }
 return nLength;
}[/c]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>369</wp:post_id>
		<wp:post_date>2015-03-14 16:03:52</wp:post_date>
		<wp:post_date_gmt>2015-03-14 08:03:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e8%bd%bb%e6%9d%be%e6%90%9e%e5%ae%9a%e9%9d%a2%e8%af%95%e4%b8%ad%e7%9a%84%e9%93%be%e8%a1%a8%e9%a2%98%e7%9b%ae</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95"><![CDATA[数据结构和算法]]></category>
		<category domain="post_tag" nicename="%e9%93%be%e8%a1%a8"><![CDATA[链表]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707544]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Saving Key-Value Sets</title>
		<link>http://1.duoinfo.sinaapp.com/?p=374</link>
		<pubDate>Mon, 16 Mar 2015 02:07:49 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=374</guid>
		<description></description>
		<content:encoded><![CDATA[If you have a relatively small collection of key-values that you'd like to save, you should use the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code> APIs. A <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code> object points to a file containing key-value pairs and provides simple methods to read and write them. Each <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code>file is managed by the framework and can be private or shared.

This class shows you how to use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code> APIs to store and retrieve simple values.

<strong>Note:</strong> The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code> APIs are only for reading and writing key-value pairs and you should not confuse them with the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/preference/Preference.html">Preference</a></code> APIs, which help you build a user interface for your app settings (although they use<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code> as their implementation to save the app settings). For information about using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/preference/Preference.html">Preference</a></code> APIs, see the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/settings.html">Settings</a> guide.
<h2 id="GetSharedPreferences">Get a Handle to a SharedPreferences</h2>

<hr />

You can create a new shared preference file or access an existing one by calling one of two methods:
<ul>
	<li><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getSharedPreferences(java.lang.String, int)">getSharedPreferences()</a></code> — Use this if you need multiple shared preference files identified by name, which you specify with the first parameter. You can call this from any <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html">Context</a></code> in your app.</li>
	<li><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#getPreferences(int)">getPreferences()</a></code> — Use this from an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> if you need to use only one shared preference file for the activity. Because this retrieves a default shared preference file that belongs to the activity, you don't need to supply a name.</li>
</ul>
For example, the following code is executed inside a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code>. It accesses the shared preferences file that's identified by the resource string <code>R.string.preference_file_key</code> and opens it using the private mode so the file is accessible by only your app.

[java]Context context = getActivity();
SharedPreferences sharedPref = context.getSharedPreferences(
getString(R.string.preference_file_key), Context.MODE_PRIVATE);[/java]

When naming your shared preference files, you should use a name that's uniquely identifiable to your app, such as <code>"com.example.myapp.PREFERENCE_FILE_KEY"</code>

Alternatively, if you need just one shared preference file for your activity, you can use the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#getPreferences(int)">getPreferences()</a></code> method:

[java]SharedPreferences sharedPref = getActivity().getPreferences(Context.MODE_PRIVATE);[/java]

<strong>Caution:</strong> If you create a shared preferences file with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#MODE_WORLD_READABLE">MODE_WORLD_READABLE</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#MODE_WORLD_WRITEABLE">MODE_WORLD_WRITEABLE</a></code>, then any other apps that know the file identifier can access your data.
<h2 id="WriteSharedPreference">Write to Shared Preferences</h2>

<hr />

To write to a shared preferences file, create a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.Editor.html">SharedPreferences.Editor</a></code> by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html#edit()">edit()</a></code> on your<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a></code>.

Pass the keys and values you want to write with methods such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.Editor.html#putInt(java.lang.String, int)">putInt()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.Editor.html#putString(java.lang.String, java.lang.String)">putString()</a></code>. Then call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.Editor.html#commit()">commit()</a></code> to save the changes. For example:

[java]SharedPreferences sharedPref = getActivity().getPreferences(Context.MODE_PRIVATE);
SharedPreferences.Editor editor = sharedPref.edit();
editor.putInt(getString(R.string.saved_high_score), newHighScore);
editor.commit();[/java]
<h2 id="ReadSharedPreference">Read from Shared Preferences</h2>

<hr />

To retrieve values from a shared preferences file, call methods such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html#getInt(java.lang.String, int)">getInt()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/SharedPreferences.html#getString(java.lang.String, java.lang.String)">getString()</a></code>, providing the key for the value you want, and optionally a default value to return if the key isn't present. For example:

[java]SharedPreferences sharedPref = getActivity().getPreferences(Context.MODE_PRIVATE);
int defaultValue = getResources().getInteger(R.string.saved_high_score_default);
long highScore = sharedPref.getInt(getString(R.string.saved_high_score), defaultValue);[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>374</wp:post_id>
		<wp:post_date>2015-03-16 10:07:49</wp:post_date>
		<wp:post_date_gmt>2015-03-16 02:07:49</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>saving-key-value-sets</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707545]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Saving Files</title>
		<link>http://1.duoinfo.sinaapp.com/?p=376</link>
		<pubDate>Mon, 16 Mar 2015 02:12:33 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=376</guid>
		<description></description>
		<content:encoded><![CDATA[Android uses a file system that's similar to disk-based file systems on other platforms. This lesson describes how to work with the Android file system to read and write files with the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> APIs.

A <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> object is suited to reading or writing large amounts of data in start-to-finish order without skipping around. For example, it's good for image files or anything exchanged over a network.

This lesson shows how to perform basic file-related tasks in your app. The lesson assumes that you are familiar with the basics of the Linux file system and the standard file input/output APIs in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/package-summary.html">java.io</a></code>.
<h2 id="InternalVsExternalStorage">Choose Internal or External Storage</h2>

<hr />

All Android devices have two file storage areas: "internal" and "external" storage. These names come from the early days of Android, when most devices offered built-in non-volatile memory (internal storage), plus a removable storage medium such as a micro SD card (external storage). Some devices divide the permanent storage space into "internal" and "external" partitions, so even without a removable storage medium, there are always two storage spaces and the API behavior is the same whether the external storage is removable or not. The following lists summarize the facts about each storage space.
<div>

<strong>Internal storage:</strong>
<ul>
	<li>It's always available.</li>
	<li>Files saved here are accessible by only your app by default.</li>
	<li>When the user uninstalls your app, the system removes all your app's files from internal storage.</li>
</ul>
Internal storage is best when you want to be sure that neither the user nor other apps can access your files.

</div>
<div>

<strong>External storage:</strong>
<ul>
	<li>It's not always available, because the user can mount the external storage as USB storage and in some cases remove it from the device.</li>
	<li>It's world-readable, so files saved here may be read outside of your control.</li>
	<li>When the user uninstalls your app, the system removes your app's files from here only if you save them in the directory from <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code>.</li>
</ul>
External storage is the best place for files that don't require access restrictions and for files that you want to share with other apps or allow the user to access with a computer.

</div>
<strong>Tip:</strong> Although apps are installed onto the internal storage by default, you can specify the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-element.html#install"><code>android:installLocation</code></a> attribute in your manifest so your app may be installed on external storage. Users appreciate this option when the APK size is very large and they have an external storage space that's larger than the internal storage. For more information, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/data/install-location.html">App Install Location</a>.
<h2 id="GetWritePermission">Obtain Permissions for External Storage</h2>

<hr />

To write to the external storage, you must request the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE">WRITE_EXTERNAL_STORAGE</a></code> permission in your<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-intro.html">manifest file</a>:

[xml]&lt;manifest ...&gt;
&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;
...
&lt;/manifest&gt;[/xml]
<div>

<strong>Caution:</strong> Currently, all apps have the ability to read the external storage without a special permission. However, this will change in a future release. If your app needs to read the external storage (but not write to it), then you will need to declare the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a></code> permission. To ensure that your app continues to work as expected, you should declare this permission now, before the change takes effect.

[xml]&lt;manifest ...&gt;
&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;
...
&lt;/manifest&gt;[/xml]

However, if your app uses the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE">WRITE_EXTERNAL_STORAGE</a></code> permission, then it implicitly has permission to read the external storage as well.

</div>
You don’t need any permissions to save files on the internal storage. Your application always has permission to read and write files in its internal storage directory.
<h2 id="WriteInternalStorage">Save a File on Internal Storage</h2>

<hr />

When saving a file to internal storage, you can acquire the appropriate directory as a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> by calling one of two methods:

<dl><dt><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getFilesDir()">getFilesDir()</a></code></dt><dd>Returns a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> representing an internal directory for your app.</dd><dt><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getCacheDir()">getCacheDir()</a></code></dt><dd>Returns a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> representing an internal directory for your app's temporary cache files. Be sure to delete each file once it is no longer needed and implement a reasonable size limit for the amount of memory you use at any given time, such as 1MB. If the system begins running low on storage, it may delete your cache files without warning.</dd></dl>To create a new file in one of these directories, you can use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#File(java.io.File, java.lang.String)">File()</a></code> constructor, passing the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> provided by one of the above methods that specifies your internal storage directory. For example:

[java]File file = new File(context.getFilesDir(), filename);[/java]

Alternatively, you can call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#openFileOutput(java.lang.String, int)">openFileOutput()</a></code> to get a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/FileOutputStream.html">FileOutputStream</a></code> that writes to a file in your internal directory. For example, here's how to write some text to a file:

[java]String filename = &quot;myfile&quot;;
String string = &quot;Hello world!&quot;;
FileOutputStream outputStream;

try {
outputStream = openFileOutput(filename, Context.MODE_PRIVATE);
outputStream.write(string.getBytes());
outputStream.close();
} catch (Exception e) {
e.printStackTrace();
}[/java]

Or, if you need to cache some files, you should instead use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#createTempFile(java.lang.String, java.lang.String)">createTempFile()</a></code>. For example, the following method extracts the file name from a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/net/URL.html">URL</a></code> and creates a file with that name in your app's internal cache directory:

[java]public File getTempFile(Context context, String url) {
File file;
try {
String fileName = Uri.parse(url).getLastPathSegment();
file = File.createTempFile(fileName, null, context.getCacheDir());
catch (IOException e) {
// Error while creating file
}
return file;
}[/java]

<strong>Note:</strong> Your app's internal storage directory is specified by your app's package name in a special location of the Android file system. Technically, another app can read your internal files if you set the file mode to be readable. However, the other app would also need to know your app package name and file names. Other apps cannot browse your internal directories and do not have read or write access unless you explicitly set the files to be readable or writable. So as long as you use<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#MODE_PRIVATE">MODE_PRIVATE</a></code> for your files on the internal storage, they are never accessible to other apps.
<h2 id="WriteExternalStorage">Save a File on External Storage</h2>

<hr />

Because the external storage may be unavailable—such as when the user has mounted the storage to a PC or has removed the SD card that provides the external storage—you should always verify that the volume is available before accessing it. You can query the external storage state by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStorageState()">getExternalStorageState()</a></code>. If the returned state is equal to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#MEDIA_MOUNTED">MEDIA_MOUNTED</a></code>, then you can read and write your files. For example, the following methods are useful to determine the storage availability:

[java]/* Checks if external storage is available for read and write */
public boolean isExternalStorageWritable() {
String state = Environment.getExternalStorageState();
if (Environment.MEDIA_MOUNTED.equals(state)) {
return true;
}
return false;
}

/* Checks if external storage is available to at least read */
public boolean isExternalStorageReadable() {
String state = Environment.getExternalStorageState();
if (Environment.MEDIA_MOUNTED.equals(state) ||
Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
return true;
}
return false;
}[/java]

Although the external storage is modifiable by the user and other apps, there are two categories of files you might save here:

<dl><dt>Public files</dt><dd>Files that should be freely available to other apps and to the user. When the user uninstalls your app, these files should remain available to the user.For example, photos captured by your app or other downloaded files.

</dd><dt>Private files</dt><dd>Files that rightfully belong to your app and should be deleted when the user uninstalls your app. Although these files are technically accessible by the user and other apps because they are on the external storage, they are files that realistically don't provide value to the user outside your app. When the user uninstalls your app, the system deletes all files in your app's external private directory.For example, additional resources downloaded by your app or temporary media files.

</dd></dl>If you want to save public files on the external storage, use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String)">getExternalStoragePublicDirectory()</a></code>method to get a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html">File</a></code> representing the appropriate directory on the external storage. The method takes an argument specifying the type of file you want to save so that they can be logically organized with other public files, such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_MUSIC">DIRECTORY_MUSIC</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_PICTURES">DIRECTORY_PICTURES</a></code>. For example:

[java]public File getAlbumStorageDir(String albumName) {
// Get the directory for the user's public pictures directory.
File file = new File(Environment.getExternalStoragePublicDirectory(
Environment.DIRECTORY_PICTURES), albumName);
if (!file.mkdirs()) {
Log.e(LOG_TAG, &quot;Directory not created&quot;);
}
return file;
}[/java]

If you want to save files that are private to your app, you can acquire the appropriate directory by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code> and passing it a name indicating the type of directory you'd like. Each directory created this way is added to a parent directory that encapsulates all your app's external storage files, which the system deletes when the user uninstalls your app.

For example, here's a method you can use to create a directory for an individual photo album:

[java]public File getAlbumStorageDir(Context context, String albumName) {
// Get the directory for the app's private pictures directory.
File file = new File(context.getExternalFilesDir(
Environment.DIRECTORY_PICTURES), albumName);
if (!file.mkdirs()) {
Log.e(LOG_TAG, &quot;Directory not created&quot;);
}
return file;
}[/java]

If none of the pre-defined sub-directory names suit your files, you can instead call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code> and pass <code>null</code>. This returns the root directory for your app's private directory on the external storage.

Remember that <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code> creates a directory inside a directory that is deleted when the user uninstalls your app. If the files you're saving should remain available after the user uninstalls your app—such as when your app is a camera and the user will want to keep the photos—you should instead use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String)">getExternalStoragePublicDirectory()</a></code>.

Regardless of whether you use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String)">getExternalStoragePublicDirectory()</a></code> for files that are shared or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code> for files that are private to your app, it's important that you use directory names provided by API constants like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_PICTURES">DIRECTORY_PICTURES</a></code>. These directory names ensure that the files are treated properly by the system. For instance, files saved in <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/Environment.html#DIRECTORY_RINGTONES">DIRECTORY_RINGTONES</a></code> are categorized by the system media scanner as ringtones instead of music.
<h2 id="GetFreeSpace">Query Free Space</h2>

<hr />

If you know ahead of time how much data you're saving, you can find out whether sufficient space is available without causing an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/IOException.html">IOException</a></code> by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getFreeSpace()">getFreeSpace()</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getTotalSpace()">getTotalSpace()</a></code>. These methods provide the current available space and the total space in the storage volume, respectively. This information is also useful to avoid filling the storage volume above a certain threshold.

However, the system does not guarantee that you can write as many bytes as are indicated by<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#getFreeSpace()">getFreeSpace()</a></code>. If the number returned is a few MB more than the size of the data you want to save, or if the file system is less than 90% full, then it's probably safe to proceed. Otherwise, you probably shouldn't write to storage.

<strong>Note:</strong> You aren't required to check the amount of available space before you save your file. You can instead try writing the file right away, then catch an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/IOException.html">IOException</a></code> if one occurs. You may need to do this if you don't know exactly how much space you need. For example, if you change the file's encoding before you save it by converting a PNG image to JPEG, you won't know the file's size beforehand.
<h2 id="DeleteFile">Delete a File</h2>

<hr />

You should always delete files that you no longer need. The most straightforward way to delete a file is to have the opened file reference call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/io/File.html#delete()">delete()</a></code> on itself.

[java]myFile.delete();[/java]

If the file is saved on internal storage, you can also ask the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html">Context</a></code> to locate and delete a file by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#deleteFile(java.lang.String)">deleteFile()</a></code>:

[java]myContext.deleteFile(fileName);[/java]
<div>

<strong>Note:</strong> When the user uninstalls your app, the Android system deletes the following:
<ul>
	<li>All files you saved on internal storage</li>
	<li>All files you saved on external storage using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code>.</li>
</ul>
However, you should manually delete all cached files created with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getCacheDir()">getCacheDir()</a></code> on a regular basis and also regularly delete other files you no longer need.

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>376</wp:post_id>
		<wp:post_date>2015-03-16 10:12:33</wp:post_date>
		<wp:post_date_gmt>2015-03-16 02:12:33</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>saving-files</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707546]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Saving Data in SQL Databases</title>
		<link>http://1.duoinfo.sinaapp.com/?p=378</link>
		<pubDate>Mon, 16 Mar 2015 02:15:10 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=378</guid>
		<description></description>
		<content:encoded><![CDATA[Saving data to a database is ideal for repeating or structured data, such as contact information. This class assumes that you are familiar with SQL databases in general and helps you get started with SQLite databases on Android. The APIs you'll need to use a database on Android are available in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/package-summary.html">android.database.sqlite</a></code>package.
<h2 id="DefineContract">Define a Schema and Contract</h2>

<hr />

One of the main principles of SQL databases is the schema: a formal declaration of how the database is organized. The schema is reflected in the SQL statements that you use to create your database. You may find it helpful to create a companion class, known as a <em>contract</em>class, which explicitly specifies the layout of your schema in a systematic and self-documenting way.

A contract class is a container for constants that define names for URIs, tables, and columns. The contract class allows you to use the same constants across all the other classes in the same package. This lets you change a column name in one place and have it propagate throughout your code.

A good way to organize a contract class is to put definitions that are global to your whole database in the root level of the class. Then create an inner class for each table that enumerates its columns.

<strong>Note:</strong> By implementing the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/BaseColumns.html">BaseColumns</a></code> interface, your inner class can inherit a primary key field called <code>_ID</code> that some Android classes such as cursor adaptors will expect it to have. It's not required, but this can help your database work harmoniously with the Android framework.

For example, this snippet defines the table name and column names for a single table:

[java]public final class FeedReaderContract {
// To prevent someone from accidentally instantiating the contract class,
// give it an empty constructor.
public FeedReaderContract() {}

/* Inner class that defines the table contents */
public static abstract class FeedEntry implements BaseColumns {
public static final String TABLE_NAME = &quot;entry&quot;;
public static final String COLUMN_NAME_ENTRY_ID = &quot;entryid&quot;;
public static final String COLUMN_NAME_TITLE = &quot;title&quot;;
public static final String COLUMN_NAME_SUBTITLE = &quot;subtitle&quot;;
...
}
}[/java]
<h2 id="DbHelper">Create a Database Using a SQL Helper</h2>

<hr />

Once you have defined how your database looks, you should implement methods that create and maintain the database and tables. Here are some typical statements that create and delete a table:

[java]private static final String TEXT_TYPE = &quot; TEXT&quot;;
private static final String COMMA_SEP = &quot;,&quot;;
private static final String SQL_CREATE_ENTRIES =
&quot;CREATE TABLE &quot; + FeedEntry.TABLE_NAME + &quot; (&quot; +
FeedEntry._ID + &quot; INTEGER PRIMARY KEY,&quot; +
FeedEntry.COLUMN_NAME_ENTRY_ID + TEXT_TYPE + COMMA_SEP +
FeedEntry.COLUMN_NAME_TITLE + TEXT_TYPE + COMMA_SEP +
... // Any other options for the CREATE command
&quot; )&quot;;

private static final String SQL_DELETE_ENTRIES =
&quot;DROP TABLE IF EXISTS &quot; + FeedEntry.TABLE_NAME;[/java]

Just like files that you save on the device's <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/data/data-storage.html#filesInternal">internal storage</a>, Android stores your database in private disk space that's associated application. Your data is secure, because by default this area is not accessible to other applications.

A useful set of APIs is available in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html">SQLiteOpenHelper</a></code> class. When you use this class to obtain references to your database, the system performs the potentially long-running operations of creating and updating the database only when needed and <em>not during app startup</em>. All you need to do is call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#getWritableDatabase()">getWritableDatabase()</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#getReadableDatabase()">getReadableDatabase()</a></code>.

<strong>Note:</strong> Because they can be long-running, be sure that you call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#getWritableDatabase()">getWritableDatabase()</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#getReadableDatabase()">getReadableDatabase()</a></code> in a background thread, such as with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/os/AsyncTask.html">AsyncTask</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/IntentService.html">IntentService</a></code>.

To use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html">SQLiteOpenHelper</a></code>, create a subclass that overrides the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#onCreate(android.database.sqlite.SQLiteDatabase)">onCreate()</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#onUpgrade(android.database.sqlite.SQLiteDatabase, int, int)">onUpgrade()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#onOpen(android.database.sqlite.SQLiteDatabase)">onOpen()</a></code>callback methods. You may also want to implement <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html#onDowngrade(android.database.sqlite.SQLiteDatabase, int, int)">onDowngrade()</a></code>, but it's not required.

For example, here's an implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html">SQLiteOpenHelper</a></code> that uses some of the commands shown above:

[java]public class FeedReaderDbHelper extends SQLiteOpenHelper {
// If you change the database schema, you must increment the database version.
public static final int DATABASE_VERSION = 1;
public static final String DATABASE_NAME = &quot;FeedReader.db&quot;;

public FeedReaderDbHelper(Context context) {
super(context, DATABASE_NAME, null, DATABASE_VERSION);
}
public void onCreate(SQLiteDatabase db) {
db.execSQL(SQL_CREATE_ENTRIES);
}
public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
// This database is only a cache for online data, so its upgrade policy is
// to simply to discard the data and start over
db.execSQL(SQL_DELETE_ENTRIES);
onCreate(db);
}
public void onDowngrade(SQLiteDatabase db, int oldVersion, int newVersion) {
onUpgrade(db, oldVersion, newVersion);
}
}[/java]

To access your database, instantiate your subclass of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteOpenHelper.html">SQLiteOpenHelper</a></code>:

[java]FeedReaderDbHelper mDbHelper = new FeedReaderDbHelper(getContext());[/java]
<h2 id="WriteDbRow">Put Information into a Database</h2>

<hr />

Insert data into the database by passing a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/ContentValues.html">ContentValues</a></code> object to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#insert(java.lang.String, java.lang.String, android.content.ContentValues)">insert()</a></code> method:

[java]// Gets the data repository in write mode
SQLiteDatabase db = mDbHelper.getWritableDatabase();

// Create a new map of values, where column names are the keys
ContentValues values = new ContentValues();
values.put(FeedEntry.COLUMN_NAME_ENTRY_ID, id);
values.put(FeedEntry.COLUMN_NAME_TITLE, title);
values.put(FeedEntry.COLUMN_NAME_CONTENT, content);

// Insert the new row, returning the primary key value of the new row
long newRowId;
newRowId = db.insert(
FeedEntry.TABLE_NAME,
FeedEntry.COLUMN_NAME_NULLABLE,
values);[/java]

The first argument for <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#insert(java.lang.String, java.lang.String, android.content.ContentValues)">insert()</a></code> is simply the table name. The second argument provides the name of a column in which the framework can insert NULL in the event that the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/ContentValues.html">ContentValues</a></code> is empty (if you instead set this to <code>"null"</code>, then the framework will not insert a row when there are no values).
<h2 id="ReadDbRow">Read Information from a Database</h2>

<hr />

To read from a database, use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#query(boolean, java.lang.String, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String, java.lang.String, java.lang.String, java.lang.String)">query()</a></code> method, passing it your selection criteria and desired columns. The method combines elements of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#insert(java.lang.String, java.lang.String, android.content.ContentValues)">insert()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#update(java.lang.String, android.content.ContentValues, java.lang.String, java.lang.String[])">update()</a></code>, except the column list defines the data you want to fetch, rather than the data to insert. The results of the query are returned to you in a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html">Cursor</a></code> object.

[java]SQLiteDatabase db = mDbHelper.getReadableDatabase();

// Define a &lt;em&gt;projection&lt;/em&gt; that specifies which columns from the database
// you will actually use after this query.
String[] projection = {
FeedEntry._ID,
FeedEntry.COLUMN_NAME_TITLE,
FeedEntry.COLUMN_NAME_UPDATED,
...
};

// How you want the results sorted in the resulting Cursor
String sortOrder =
FeedEntry.COLUMN_NAME_UPDATED + &quot; DESC&quot;;

Cursor c = db.query(
FeedEntry.TABLE_NAME,  // The table to query
projection,                               // The columns to return
selection,                                // The columns for the WHERE clause
selectionArgs,                            // The values for the WHERE clause
null,                                     // don't group the rows
null,                                     // don't filter by row groups
sortOrder                                 // The sort order
);[/java]

To look at a row in the cursor, use one of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html">Cursor</a></code> move methods, which you must always call before you begin reading values. Generally, you should start by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html#moveToFirst()">moveToFirst()</a></code>, which places the "read position" on the first entry in the results. For each row, you can read a column's value by calling one of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html">Cursor</a></code> get methods, such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html#getString(int)">getString()</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html#getLong(int)">getLong()</a></code>. For each of the get methods, you must pass the index position of the column you desire, which you can get by calling<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html#getColumnIndex(java.lang.String)">getColumnIndex()</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/Cursor.html#getColumnIndexOrThrow(java.lang.String)">getColumnIndexOrThrow()</a></code>. For example:

[java]cursor.moveToFirst();
long itemId = cursor.getLong(
cursor.getColumnIndexOrThrow(FeedEntry._ID)
);[/java]
<h2 id="DeleteDbRow">Delete Information from a Database</h2>

<hr />

To delete rows from a table, you need to provide selection criteria that identify the rows. The database API provides a mechanism for creating selection criteria that protects against SQL injection. The mechanism divides the selection specification into a selection clause and selection arguments. The clause defines the columns to look at, and also allows you to combine column tests. The arguments are values to test against that are bound into the clause. Because the result isn't handled the same as a regular SQL statement, it is immune to SQL injection.

[java]// Define 'where' part of query.
String selection = FeedEntry.COLUMN_NAME_ENTRY_ID + &quot; LIKE ?&quot;;
// Specify arguments in placeholder order.
String[] selectionArgs = { String.valueOf(rowId) };
// Issue SQL statement.
db.delete(table_name, selection, selectionArgs);[/java]
<h2 id="UpdateDbRow">Update a Database</h2>

<hr />

When you need to modify a subset of your database values, use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#update(java.lang.String, android.content.ContentValues, java.lang.String, java.lang.String[])">update()</a></code> method.

Updating the table combines the content values syntax of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#insert(java.lang.String, java.lang.String, android.content.ContentValues)">insert()</a></code> with the <code>where</code> syntax of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/database/sqlite/SQLiteDatabase.html#delete(java.lang.String, java.lang.String, java.lang.String[])">delete()</a></code>.

[java]SQLiteDatabase db = mDbHelper.getReadableDatabase();

// New value for one column
ContentValues values = new ContentValues();
values.put(FeedEntry.COLUMN_NAME_TITLE, title);

// Which row to update, based on the ID
String selection = FeedEntry.COLUMN_NAME_ENTRY_ID + &quot; LIKE ?&quot;;
String[] selectionArgs = { String.valueOf(rowId) };

int count = db.update(
FeedReaderDbHelper.FeedEntry.TABLE_NAME,
values,
selection,
selectionArgs);[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>378</wp:post_id>
		<wp:post_date>2015-03-16 10:15:10</wp:post_date>
		<wp:post_date_gmt>2015-03-16 02:15:10</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>saving-data-in-sql-databases</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707547]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android-Universal-Image-Loader</title>
		<link>http://1.duoinfo.sinaapp.com/?p=381</link>
		<pubDate>Mon, 16 Mar 2015 07:59:58 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=381</guid>
		<description></description>
		<content:encoded><![CDATA[<h1>地址：</h1>
Android-Universal-Image-Loader的github地址是：

<a title="https://github.com/nostra13/Android-Universal-Image-Loader" href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank">https://github.com/nostra13/Android-Universal-Image-Loader</a>
<h1>简介：</h1>
Powerful and flexible library for loading, caching and displaying images on Android.

Android用来加载，缓存，展示图片的库。简称为UIL。

UIL aims to provide a powerful, flexible and highly customizable instrument for image loading, caching and displaying. It provides a lot of configuration options and good control over the image loading and caching process.
<h1>特征：</h1>
<ul>
	<li>Multithread image loading (async or sync)（多线程图片加载）</li>
	<li>Wide customization of ImageLoader's configuration (thread executors, downloader, decoder, memory and disk cache, display image options, etc.)（可以设置很多参数，自己定制）</li>
	<li>Many customization options for every display image call (stub images, caching switch, decoding options, Bitmap processing and displaying, etc.)</li>
	<li>Image caching in memory and/or on disk (device's file system or SD card)（缓存策略）</li>
	<li>Listening loading process (including downloading progress)（监听加载过程和下载过程）</li>
</ul>
<h1>使用：</h1>
<h2>1. Include library</h2>
<h3><strong>Manual:</strong></h3>
<ul>
	<li><a href="https://github.com/nostra13/Android-Universal-Image-Loader/raw/master/downloads/universal-image-loader-1.9.3.jar">Download JAR</a></li>
	<li>Put the JAR in the <strong>libs</strong> subfolder of your Android project</li>
</ul>
or
<h3><strong>Maven dependency:</strong></h3>
<div>
<pre>&lt;dependency&gt;
    &lt;groupId&gt;com.nostra13.universalimageloader&lt;/groupId&gt;
    &lt;artifactId&gt;universal-image-loader&lt;/artifactId&gt;
    &lt;version&gt;1.9.3&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
or
<h3><strong>Gradle dependency:</strong></h3>
<div>
<pre>compile 'com.nostra13.universalimageloader:universal-image-loader:1.9.3'</pre>
</div>
<h2>2. Android Manifest</h2>
<div>[xml]&lt;manifest&gt;
    &lt;!-- Include following permission if you load images from Internet --&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
    &lt;!-- Include following permission if you want to cache images on SD card --&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;
    ...
&lt;/manifest&gt;[/xml]

</div>
<h2>3. Application or Activity class (before the first usage of ImageLoader)</h2>
<div>[java]public class MyActivity extends Activity {
    @Override
    public void onCreate() {
        super.onCreate();

        // Create global configuration and initialize ImageLoader with this config
        ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(this)
            ...
            .build();
        ImageLoader.getInstance().init(config);
        ...
    }
}[/java]
<h1>配置：</h1>
在上面的代码中，<span style="font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;">ImageLoaderConfiguration的build中设置很多可选的参数，这些参数根据自己的需要来决定。</span>

ImageLoader <strong>Configuration (<code>ImageLoaderConfiguration</code>) is global</strong> for application. （这些配置是全局的，开发者只需要配置一次）You should set it once.

All options in Configuration builder are optional. Use only those you really want to customize.
<em>See default values for config options in <a href="https://github.com/nostra13/Android-Universal-Image-Loader/blob/master/library/src/com/nostra13/universalimageloader/core/ImageLoaderConfiguration.java#L199-599">Java docs for every option</a>.</em>

[java]// DON'T COPY THIS CODE TO YOUR PROJECT! This is just example of ALL options using.
// See the sample project how to use ImageLoader correctly.
File cacheDir = StorageUtils.getCacheDirectory(context);
ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(context)
        .memoryCacheExtraOptions(480, 800) // default = device screen dimensions
        .diskCacheExtraOptions(480, 800, null)
        .taskExecutor(...)
        .taskExecutorForCachedImages(...)
        .threadPoolSize(3) // default
        .threadPriority(Thread.NORM_PRIORITY - 2) // default
        .tasksProcessingOrder(QueueProcessingType.FIFO) // default
        .denyCacheImageMultipleSizesInMemory()
        .memoryCache(new LruMemoryCache(2 * 1024 * 1024))
        .memoryCacheSize(2 * 1024 * 1024)
        .memoryCacheSizePercentage(13) // default
        .diskCache(new UnlimitedDiscCache(cacheDir)) // default
        .diskCacheSize(50 * 1024 * 1024)
        .diskCacheFileCount(100)
        .diskCacheFileNameGenerator(new HashCodeFileNameGenerator()) // default
        .imageDownloader(new BaseImageDownloader(context)) // default
        .imageDecoder(new BaseImageDecoder()) // default
        .defaultDisplayImageOptions(DisplayImageOptions.createSimple()) // default
        .writeDebugLogs()
        .build();[/java]
<div></div>
<h1>注意的地方：</h1>
<ol>
	<li><span style="color: #0000ff;"><strong>Caching is NOT enabled by default.</strong> （默认情况下缓存是没有打开的）</span>If you want loaded images will be cached in memory and/or on disk then you should enable caching in DisplayImageOptions this way:
<div>[java]// Create default options which will be used for every
//  displayImage(...) call if no options will be passed to this method
DisplayImageOptions defaultOptions = new DisplayImageOptions.Builder()
        ...
        .cacheInMemory(true)
        .cacheOnDisk(true)
        ...
        .build();
ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(getApplicationContext())
        ...
        .defaultDisplayImageOptions(defaultOptions)
        ...
        .build();
ImageLoader.getInstance().init(config); // Do it on Application start&lt;/pre&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;pre&gt;// Then later, when you want to display image
ImageLoader.getInstance().displayImage(imageUrl, imageView); // Default options will be used[/java]

</div>
or this way:
<div>[java]DisplayImageOptions options = new DisplayImageOptions.Builder()
        ...
        .cacheInMemory(true)
        .cacheOnDisk(true)
        ...
        .build();
ImageLoader.getInstance().displayImage(imageUrl, imageView, options); // Incoming options will be used[/java]

</div></li>
	<li>If you enabled disk caching then UIL try to cache images on external storage (/sdcard/Android/data/[package_name]/cache). If external storage is not available then images are cached on device's filesystem. To provide caching on external storage (SD card) add following permission to AndroidManifest.xml:
<div>[xml]&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; android:maxSdkVersion=&quot;18&quot; /&gt;[/xml]

</div></li>
	<li>How UIL define Bitmap size needed for exact ImageView? It searches defined parameters:
<ul>
	<li>Get actual measured width and height of ImageView</li>
	<li>Get <code>android:layout_width</code> and <code>android:layout_height</code> parameters</li>
	<li>Get <code>android:maxWidth</code> and/or <code>android:maxHeight</code> parameters</li>
	<li>Get maximum width and/or height parameters from configuration (<code>memoryCacheExtraOptions(int, int)</code> option)</li>
	<li>Get width and/or height of device screen</li>
</ul>
So <strong>try to set</strong> <code>android:layout_width</code>|<code>android:layout_height</code> or<code>android:maxWidth</code>|<code>android:maxHeight</code> parameters for ImageView if you know approximate maximum size of it. It will help correctly compute Bitmap size needed for this view and <strong>save memory</strong>.</li>
	<li>If you often got <strong>OutOfMemoryError</strong> in your app using Universal Image Loader then:
<ul>
	<li>Disable caching in memory. If OOM is still occurs then it seems your app has a memory leak. Use MemoryAnalyzer to detect it. Otherwise try the following steps (all of them or several):</li>
	<li><span style="color: #0000ff;">Reduce thread pool size in configuration (<code>.threadPoolSize(...)</code>). 1 - 5 is recommended.</span></li>
	<li><span style="color: #0000ff;">Use <code>.bitmapConfig(Bitmap.Config.RGB_565)</code> in display options. Bitmaps in RGB_565 consume 2 times less memory than in ARGB_8888.</span></li>
	<li><span style="color: #0000ff;">Use <code>.imageScaleType(ImageScaleType.EXACTLY)</code></span></li>
	<li><span style="color: #0000ff;">Use <code>.diskCacheExtraOptions(480, 320, null)</code> in configuration</span></li>
</ul>
</li>
	<li>For memory cache configuration (<code>ImageLoaderConfiguration.memoryCache(...)</code>) you can use already prepared implementations.
<ul>
	<li>Cache using <strong>only strong</strong> references:
<ul>
	<li><code>LruMemoryCache</code> (Least recently used bitmap is deleted when cache size limit is exceeded) - <strong>Used by default</strong></li>
</ul>
</li>
	<li>Caches using <strong>weak and strong</strong> references:
<ul>
	<li><code>UsingFreqLimitedMemoryCache</code> (Least frequently used bitmap is deleted when cache size limit is exceeded)</li>
	<li><code>LRULimitedMemoryCache</code> (Least recently used bitmap is deleted when cache size limit is exceeded)</li>
	<li><code>FIFOLimitedMemoryCache</code> (FIFO rule is used for deletion when cache size limit is exceeded)</li>
	<li><code>LargestLimitedMemoryCache</code> (The largest bitmap is deleted when cache size limit is exceeded)</li>
	<li><code>LimitedAgeMemoryCache</code> (Decorator. Cached object is deleted when its age exceeds defined value)</li>
</ul>
</li>
	<li>Cache using <strong>only weak</strong> references:
<ul>
	<li><code>WeakMemoryCache</code> (Unlimited cache)</li>
</ul>
</li>
</ul>
</li>
	<li>For disk cache configuration (<code>ImageLoaderConfiguration.diskCache(...)</code>) you can use already prepared implementations:
<ul>
	<li><code>UnlimitedDiscCache</code> (The fastest cache, doesn't limit cache size) - <strong>Used by default</strong></li>
	<li><code>LruDiskCache</code> (Cache limited by total cache size and/or by file count. If cache size exceeds specified limit then least-recently used file will be deleted)</li>
	<li><code>LimitedAgeDiscCache</code> (Size-unlimited cache with limited files' lifetime. If age of cached file exceeds defined limit then it will be deleted from cache.)</li>
</ul>
<strong>NOTE:</strong> UnlimitedDiscCache is pretty faster than other limited disk cache implementations.</li>
	<li>To display bitmap (<code>DisplayImageOptions.displayer(...)</code>) you can use already prepared implementations:
<ul>
	<li><code>RoundedBitmapDisplayer</code> (Displays bitmap with rounded corners)</li>
	<li><code>FadeInBitmapDisplayer</code> (Displays image with "fade in" animation)</li>
</ul>
</li>
	<li>To avoid list (grid, ...) scrolling lags you can use <span style="color: #0000ff;"><code>PauseOnScrollListener</code></span>:
<div>
<pre>boolean pauseOnScroll = false; // or true
boolean pauseOnFling = true; // or false
PauseOnScrollListener listener = new PauseOnScrollListener(imageLoader, pauseOnScroll, pauseOnFling);
listView.setOnScrollListener(listener);</pre>
</div></li>
	<li>If you see in logs some strange supplement at the end of image URL (e.g.<code>http://anysite.com/images/image.png_230x460</code>) then it doesn't mean this URL is used in requests. This is just "URL + target size", also this is key for Bitmap in memory cache. This postfix (<code>_230x460</code>) is <strong>NOT used in requests</strong>.</li>
	<li>ImageLoader always keeps aspect ratio of images.</li>
</ol>
<div><img src="https://github.com/nostra13/Android-Universal-Image-Loader/raw/master/wiki/UIL_Flow.png" alt="Task Flow" /></div>
<pre></pre>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>381</wp:post_id>
		<wp:post_date>2015-03-16 15:59:58</wp:post_date>
		<wp:post_date_gmt>2015-03-16 07:59:58</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-universal-image-loader</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="post_tag" nicename="uil"><![CDATA[UIL]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707548]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Sending the User to Another App</title>
		<link>http://1.duoinfo.sinaapp.com/?p=384</link>
		<pubDate>Tue, 17 Mar 2015 00:47:15 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=384</guid>
		<description></description>
		<content:encoded><![CDATA[One of Android's most important features is an app's ability to send the user to another app based on an "action" it would like to perform. For example, if your app has the address of a business that you'd like to show on a map, you don't have to build an activity in your app that shows a map. Instead, you can create a request to view the address using an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>. The Android system then starts an app that's able to show the address on a map.

As explained in the first class, <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/basics/firstapp/index.html">Building Your First App</a>, you must use intents to navigate between activities in your own app. You generally do so with an <em>explicit intent</em>, which defines the exact class name of the component you want to start. However, when you want to have a separate app perform an action, such as "view a map," you must use an <em>implicit intent</em>.

This lesson shows you how to create an implicit intent for a particular action, and how to use it to start an activity that performs the action in another app.
<h2 id="Build">Build an Implicit Intent</h2>

<hr />

Implicit intents do not declare the class name of the component to start, but instead declare an action to perform. The action specifies the thing you want to do, such as <em>view</em>, <em>edit</em>, <em>send</em>, or <em>get</em> something. Intents often also include data associated with the action, such as the address you want to view, or the email message you want to send. Depending on the intent you want to create, the data might be a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code>, one of several other data types, or the intent might not need data at all.

If your data is a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code>, there's a simple <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#Intent(java.lang.String, android.net.Uri)">Intent()</a></code> constructor you can use define the action and data.

For example, here's how to create an intent to initiate a phone call using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> data to specify the telephone number:

[java]Uri number = Uri.parse(&quot;tel:5551234&quot;);
Intent callIntent = new Intent(Intent.ACTION_DIAL, number);[/java]

When your app invokes this intent by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>, the Phone app initiates a call to the given phone number.

Here are a couple other intents and their action and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> data pairs:
<ul>
	<li>View a map:[java]// Map point based on address
Uri location = Uri.parse(&quot;geo:0,0?q=1600+Amphitheatre+Parkway,+Mountain+View,+California&quot;);
// Or map point based on latitude/longitude
// Uri location = Uri.parse(&quot;geo:37.422219,-122.08364?z=14&quot;); // z param is zoom level
Intent mapIntent = new Intent(Intent.ACTION_VIEW, location);[/java]</li>
	<li>View a web page:[java]Uri webpage = Uri.parse(&quot;http://www.android.com&quot;);
Intent webIntent = new Intent(Intent.ACTION_VIEW, webpage);[/java]</li>
</ul>
Other kinds of implicit intents require "extra" data that provide different data types, such as a string. You can add one or more pieces of extra data using the various <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#putExtra(java.lang.String, java.lang.String)">putExtra()</a></code> methods.

By default, the system determines the appropriate MIME type required by an intent based on the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> data that's included. If you don't include a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> in the intent, you should usually use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#setType(java.lang.String)">setType()</a></code> to specify the type of data associated with the intent. Setting the MIME type further specifies which kinds of activities should receive the intent.

Here are some more intents that add extra data to specify the desired action:
<ul>
	<li>Send an email with an attachment:[java]Intent emailIntent = new Intent(Intent.ACTION_SEND);
// The intent does not have a URI, so declare the &quot;text/plain&quot; MIME type
emailIntent.setType(HTTP.PLAIN_TEXT_TYPE);
emailIntent.putExtra(Intent.EXTRA_EMAIL, new String[] {&quot;jon@example.com&quot;}); // recipients
emailIntent.putExtra(Intent.EXTRA_SUBJECT, &quot;Email subject&quot;);
emailIntent.putExtra(Intent.EXTRA_TEXT, &quot;Email message text&quot;);
emailIntent.putExtra(Intent.EXTRA_STREAM, Uri.parse(&quot;content://path/to/email/attachment&quot;));
// You can also attach multiple items by passing an ArrayList of Uris[/java]</li>
	<li>Create a calendar event:[java]Intent calendarIntent = new Intent(Intent.ACTION_INSERT, Events.CONTENT_URI);
Calendar beginTime = Calendar.getInstance().set(2012, 0, 19, 7, 30);
Calendar endTime = Calendar.getInstance().set(2012, 0, 19, 10, 30);
calendarIntent.putExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, beginTime.getTimeInMillis());
calendarIntent.putExtra(CalendarContract.EXTRA_EVENT_END_TIME, endTime.getTimeInMillis());
calendarIntent.putExtra(Events.TITLE, &quot;Ninja class&quot;);
calendarIntent.putExtra(Events.EVENT_LOCATION, &quot;Secret dojo&quot;);[/java]

<strong>Note:</strong> This intent for a calendar event is supported only with API level 14 and higher.</li>
</ul>
<strong>Note:</strong> It's important that you define your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> to be as specific as possible. For example, if you want to display an image using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent, you should specify a MIME type of <code>image/*</code>. This prevents apps that can "view" other types of data (like a map app) from being triggered by the intent.
<h2 id="Verify">Verify There is an App to Receive the Intent</h2>

<hr />

Although the Android platform guarantees that certain intents will resolve to one of the built-in apps (such as the Phone, Email, or Calendar app), you should always include a verification step before invoking an intent.

<strong>Caution:</strong> If you invoke an intent and there is no app available on the device that can handle the intent, your app will crash.

<span style="color: #000080;">To verify there is an activity available that can respond to the intent, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/pm/PackageManager.html#queryIntentActivities(android.content.Intent, int)"><span style="color: #000080;">queryIntentActivities()</span></a></code> to get a list of activities capable of handling your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html"><span style="color: #000080;">Intent</span></a></code>. If the returned <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/util/List.html"><span style="color: #000080;">List</span></a></code> is not empty, you can safely use the intent.</span> For example:

[java]PackageManager packageManager = &lt;code&gt;&lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getPackageManager()&quot;&gt;getPackageManager()&lt;/a&gt;&lt;/code&gt;;
List&lt;ResolveInfo&gt; activities = packageManager.queryIntentActivities(intent, 0);
boolean isIntentSafe = activities.size() &gt; 0;[/java]

If <code>isIntentSafe</code> is <code>true</code>, then at least one app will respond to the intent. If it is <code>false</code>, then there aren't any apps to handle the intent.

<strong>Note:</strong> You should perform this check when your activity first starts in case you need to disable the feature that uses the intent before the user attempts to use it. If you know of a specific app that can handle the intent, you can also provide a link for the user to download the app (see how to <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/distribute/tools/promote/linking.html">link to your product on Google Play</a>).
<h2 id="StartActivity">Start an Activity with the Intent</h2>

<hr />

<div><img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/intents-choice.png" alt="" /></div>
Once you have created your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> and set the extra info, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>to send it to the system. If the system identifies more than one activity that can handle the intent, it displays a dialog for the user to select which app to use, as shown in figure 1. If there is only one activity that handles the intent, the system immediately starts it.

[java]startActivity(intent);[/java]

Here's a complete example that shows how to create an intent to view a map, verify that an app exists to handle the intent, then start it:

[java]// Build the intent
Uri location = Uri.parse(&quot;geo:0,0?q=1600+Amphitheatre+Parkway,+Mountain+View,+California&quot;);
Intent mapIntent = new Intent(Intent.ACTION_VIEW, location);

// Verify it resolves
PackageManager packageManager = &lt;code&gt;&lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#getPackageManager()&quot;&gt;getPackageManager()&lt;/a&gt;&lt;/code&gt;;
List&lt;ResolveInfo&gt; activities = packageManager.queryIntentActivities(mapIntent, 0);
boolean isIntentSafe = activities.size() &gt; 0;

// Start an activity if it's safe
if (isIntentSafe) {
startActivity(mapIntent);
}[/java]
<h2 id="AppChooser">Show an App Chooser</h2>

<hr />

<div><img src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/basics/intent-chooser.png" alt="" />Notice that when you start an activity by passing your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code> and there is more than one app that responds to the intent, the user can select which app to use by default (by selecting a checkbox at the bottom of the dialog; see figure 1). This is nice when performing an action for which the user generally wants to use the same app every time, such as when opening a web page (users likely use just one web browser) or taking a photo (users likely prefer one camera).

</div>
However, if the action to be performed could be handled by multiple apps and the user might prefer a different app each time—such as a "share" action, for which users might have several apps through which they might share an item—you should explicitly show a chooser dialog as shown in figure 2. The chooser dialog forces the user to select which app to use for the action every time (the user cannot select a default app for the action).

<span style="color: #000080;">To show the chooser, create an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html"><span style="color: #000080;">Intent</span></a></code> using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)"><span style="color: #000080;">createChooser()</span></a></code> and pass it to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)"><span style="color: #000080;">startActivity()</span></a></code>.</span> For example:

[java]Intent intent = new Intent(Intent.ACTION_SEND);
...

// Always use string resources for UI text.
// This says something like &quot;Share this photo with&quot;
String title = getResources().getString(R.string.chooser_title);
// Create intent to show chooser
Intent chooser = Intent.createChooser(intent, title);

// Verify the intent will resolve to at least one activity
if (intent.resolveActivity(getPackageManager()) != null) {
startActivity(chooser);
}[/java]

This displays a dialog with a list of apps that respond to the intent passed to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)">createChooser()</a></code> method and uses the supplied text as the dialog title.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>384</wp:post_id>
		<wp:post_date>2015-03-17 08:47:15</wp:post_date>
		<wp:post_date_gmt>2015-03-17 00:47:15</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>sending-the-user-to-another-app</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707549]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title> Getting a Result from an Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=386</link>
		<pubDate>Tue, 17 Mar 2015 00:55:39 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=386</guid>
		<description></description>
		<content:encoded><![CDATA[Starting another activity doesn't have to be one-way. You can also start another activity and receive a result back. To receive a result, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> (instead of<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>).

For example, your app can start a camera app and receive the captured photo as a result. Or, you might start the People app in order for the user to select a contact and you'll receive the contact details as a result.

Of course, the activity that responds must be designed to return a result. When it does, it sends the result as another <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>object. Your activity receives it in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">onActivityResult()</a></code>callback.

<strong>Note:</strong> You can use explicit or implicit intents when you call<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>. When starting one of your own activities to receive a result, you should use an explicit intent to ensure that you receive the expected result.
<h2 id="StartActivity">Start the Activity</h2>

<hr />

There's nothing special about the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> object you use when starting an activity for a result, but you do need to pass an additional integer argument to the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> method.

The integer argument is a "request code" that identifies your request. When you receive the result <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>, the callback provides the same request code so that your app can properly identify the result and determine how to handle it.

For example, here's how to start an activity that allows the user to pick a contact:

[java]static final int PICK_CONTACT_REQUEST = 1;  // The request code
...
private void pickContact() {
Intent pickContactIntent = new Intent(Intent.ACTION_PICK, Uri.parse(&quot;content://contacts&quot;));
pickContactIntent.setType(Phone.CONTENT_TYPE); // Show user only contacts w/ phone numbers
startActivityForResult(pickContactIntent, PICK_CONTACT_REQUEST);
}[/java]
<h2 id="ReceiveResult">Receive the Result</h2>

<hr />

When the user is done with the subsequent activity and returns, the system calls your activity's<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">onActivityResult()</a></code> method. This method includes three arguments:
<ul>
	<li>The request code you passed to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>.</li>
	<li>A result code specified by the second activity. This is either <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#RESULT_OK">RESULT_OK</a></code> if the operation was successful or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#RESULT_CANCELED">RESULT_CANCELED</a></code> if the user backed out or the operation failed for some reason.</li>
	<li>An <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> that carries the result data.</li>
</ul>
For example, here's how you can handle the result for the "pick a contact" intent:

[java]@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
// Check which request we're responding to
if (requestCode == PICK_CONTACT_REQUEST) {
// Make sure the request was successful
if (resultCode == RESULT_OK) {
// The user picked a contact.
// The Intent's data Uri identifies which contact was selected.

// Do something with the contact here (bigger example below)
}
}
}[/java]

In this example, the result <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> returned by Android's Contacts or People app provides a content <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> that identifies the contact the user selected.

In order to successfully handle the result, you must understand what the format of the result <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> will be. Doing so is easy when the activity returning a result is one of your own activities. Apps included with the Android platform offer their own APIs that you can count on for specific result data. For instance, the People app (Contacts app on some older versions) always returns a result with the content URI that identifies the selected contact, and the Camera app returns a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/graphics/Bitmap.html">Bitmap</a></code> in the <code>"data"</code> extra (see the class about <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/camera/index.html">Capturing Photos</a>).
<h4>Bonus: Read the contact data</h4>
The code above showing how to get a result from the People app doesn't go into details about how to actually read the data from the result, because it requires more advanced discussion about <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/providers/content-providers.html">content providers</a>. However, if you're curious, here's some more code that shows how to query the result data to get the phone number from the selected contact:

[java]@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
// Check which request it is that we're responding to
if (requestCode == PICK_CONTACT_REQUEST) {
// Make sure the request was successful
if (resultCode == RESULT_OK) {
// Get the URI that points to the selected contact
Uri contactUri = data.getData();
// We only need the NUMBER column, because there will be only one row in the result
String[] projection = {Phone.NUMBER};

// Perform the query on the contact to get the NUMBER column
// We don't need a selection or sort order (there's only one result for the given URI)
// CAUTION: The query() method should be called from a separate thread to avoid blocking
// your app's UI thread. (For simplicity of the sample, this code doesn't do that.)
// Consider using &lt;code&gt;&lt;a href=&quot;file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/CursorLoader.html&quot;&gt;CursorLoader&lt;/a&gt;&lt;/code&gt; to perform the query.
Cursor cursor = getContentResolver()
.query(contactUri, projection, null, null, null);
cursor.moveToFirst();

// Retrieve the phone number from the NUMBER column
int column = cursor.getColumnIndex(Phone.NUMBER);
String number = cursor.getString(column);

// Do something with the phone number...
}
}
}[/java]

<strong>Note:</strong> Before Android 2.3 (API level 9), performing a query on the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/ContactsContract.Contacts.html">Contacts Provider</a></code> (like the one shown above) requires that your app declare the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#READ_CONTACTS">READ_CONTACTS</a></code> permission (see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/security/security.html">Security and Permissions</a>). However, beginning with Android 2.3, the Contacts/People app grants your app a temporary permission to read from the Contacts Provider when it returns you a result. The temporary permission applies only to the specific contact requested, so you cannot query a contact other than the one specified by the intent's <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code>, unless you do declare the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/Manifest.permission.html#READ_CONTACTS">READ_CONTACTS</a></code> permission.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>386</wp:post_id>
		<wp:post_date>2015-03-17 08:55:39</wp:post_date>
		<wp:post_date_gmt>2015-03-17 00:55:39</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>getting-a-result-from-an-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707550]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Allowing Other Apps to Start Your Activity</title>
		<link>http://1.duoinfo.sinaapp.com/?p=389</link>
		<pubDate>Tue, 17 Mar 2015 01:00:43 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=389</guid>
		<description></description>
		<content:encoded><![CDATA[The previous two lessons focused on one side of the story: starting another app's activity from your app. But if your app can perform an action that might be useful to another app, your app should be prepared to respond to action requests from other apps. For instance, if you build a social app that can share messages or photos with the user's friends, it's in your best interest to support the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> intent so users can initiate a "share" action from another app and launch your app to perform the action.

To allow other apps to start your activity, you need to add an<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/intent-filter-element.html"><code>&lt;intent-filter&gt;</code></a> element in your manifest file for the corresponding <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a> element.

When your app is installed on a device, the system identifies your intent filters and adds the information to an internal catalog of intents supported by all installed apps. When an app calls<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>, with an implicit intent, the system finds which activity (or activities) can respond to the intent.
<h2 id="AddIntentFilter">Add an Intent Filter</h2>

<hr />

In order to properly define which intents your activity can handle, each intent filter you add should be as specific as possible in terms of the type of action and data the activity accepts.

The system may send a given <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> to an activity if that activity has an intent filter fulfills the following criteria of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> object:

<dl><dt>Action</dt><dd>A string naming the action to perform. Usually one of the platform-defined values such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code>.Specify this in your intent filter with the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/action-element.html"><code>&lt;action&gt;</code></a> element. The value you specify in this element must be the full string name for the action, instead of the API constant (see the examples below).

</dd><dt>Data</dt><dd>A description of the data associated with the intent.Specify this in your intent filter with the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/data-element.html"><code>&lt;data&gt;</code></a> element. Using one or more attributes in this element, you can specify just the MIME type, just a URI prefix, just a URI scheme, or a combination of these and others that indicate the data type accepted.

<strong>Note:</strong> If you don't need to declare specifics about the data <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> (such as when your activity handles to other kind of "extra" data, instead of a URI), you should specify only the <code>android:mimeType</code> attribute to declare the type of data your activity handles, such as <code>text/plain</code> or <code>image/jpeg</code>.

</dd><dt>Category</dt><dd>Provides an additional way to characterize the activity handling the intent, usually related to the user gesture or location from which it's started. There are several different categories supported by the system, but most are rarely used. However, all implicit intents are defined with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_DEFAULT">CATEGORY_DEFAULT</a></code> by default.Specify this in your intent filter with the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/category-element.html"><code>&lt;category&gt;</code></a> element.

</dd></dl>In your intent filter, you can declare which criteria your activity accepts by declaring each of them with corresponding XML elements nested in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/intent-filter-element.html"><code>&lt;intent-filter&gt;</code></a> element.

For example, here's an activity with an intent filter that handles the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> intent when the data type is either text or an image:

[xml]&lt;activity android:name=&quot;ShareActivity&quot;&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SEND&quot;/&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
&lt;data android:mimeType=&quot;text/plain&quot;/&gt;
&lt;data android:mimeType=&quot;image/*&quot;/&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;[/xml]

Each incoming intent specifies only one action and one data type, but it's OK to declare multiple instances of the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/action-element.html"><code>&lt;action&gt;</code></a>, <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/category-element.html"><code>&lt;category&gt;</code></a>, and <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/data-element.html"><code>&lt;data&gt;</code></a> elements in each <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/intent-filter-element.html"><code>&lt;intent-filter&gt;</code></a>.

If any two pairs of action and data are mutually exclusive in their behaviors, you should create separate intent filters to specify which actions are acceptable when paired with which data types.

For example, suppose your activity handles both text and images for both the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SENDTO">ACTION_SENDTO</a></code>intents. In this case, you must define two separate intent filters for the two actions because a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SENDTO">ACTION_SENDTO</a></code>intent must use the data <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> to specify the recipient's address using the <code>send</code> or <code>sendto</code> URI scheme. For example:

[xml]&lt;activity android:name=&quot;ShareActivity&quot;&gt;
&lt;!-- filter for sending text; accepts SENDTO action with sms URI schemes --&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SENDTO&quot;/&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
&lt;data android:scheme=&quot;sms&quot; /&gt;
&lt;data android:scheme=&quot;smsto&quot; /&gt;
&lt;/intent-filter&gt;
&lt;!-- filter for sending text or images; accepts SEND action and text or image data --&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SEND&quot;/&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
&lt;data android:mimeType=&quot;image/*&quot;/&gt;
&lt;data android:mimeType=&quot;text/plain&quot;/&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;[/xml]

<strong>Note:</strong> In order to receive implicit intents, you must include the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_DEFAULT">CATEGORY_DEFAULT</a></code> category in the intent filter. The methods <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> treat all intents as if they declared the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#CATEGORY_DEFAULT">CATEGORY_DEFAULT</a></code> category. If you do not declare it in your intent filter, no implicit intents will resolve to your activity.

For more information about sending and receiving <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> intents that perform social sharing behaviors, see the lesson about <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/sharing/receive.html">Receiving Simple Data from Other Apps</a>.
<h2 id="HandleIntent">Handle the Intent in Your Activity</h2>

<hr />

In order to decide what action to take in your activity, you can read the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> that was used to start it.

As your activity starts, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#getIntent()">getIntent()</a></code> to retrieve the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> that started the activity. You can do so at any time during the lifecycle of the activity, but you should generally do so during early callbacks such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#onStart()">onStart()</a></code>.

For example:

[java]@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);

setContentView(R.layout.main);

// Get the intent that started this activity
Intent intent = getIntent();
Uri data = intent.getData();

// Figure out what to do based on the intent type
if (intent.getType().indexOf(&quot;image/&quot;) != -1) {
// Handle intents with image data ...
} else if (intent.getType().equals(&quot;text/plain&quot;)) {
// Handle intents with text ...
}
}[/java]
<h2 id="ReturnResult">Return a Result</h2>

<hr />

If you want to return a result to the activity that invoked yours, simply call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#setResult(int, android.content.Intent)">setResult()</a></code> to specify the result code and result <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>. When your operation is done and the user should return to the original activity, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#finish()">finish()</a></code> to close (and destroy) your activity. For example:

[java]// Create intent to deliver some kind of result data
Intent result = new Intent(&quot;com.example.RESULT_ACTION&quot;, Uri.parse(&quot;content://result_uri&quot;);
setResult(Activity.RESULT_OK, result);
finish();[/java]

You must always specify a result code with the result. Generally, it's either <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#RESULT_OK">RESULT_OK</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#RESULT_CANCELED">RESULT_CANCELED</a></code>. You can then provide additional data with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>, as necessary.

<strong>Note:</strong> The result is set to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#RESULT_CANCELED">RESULT_CANCELED</a></code> by default. So, if the user presses the <em>Back</em> button before completing the action and before you set the result, the original activity receives the "canceled" result.

If you simply need to return an integer that indicates one of several result options, you can set the result code to any value higher than 0. If you use the result code to deliver an integer and you have no need to include the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>, you can call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#setResult(int)">setResult()</a></code> and pass only a result code. For example:

[java]setResult(RESULT_COLOR_RED);
finish();[/java]

In this case, there might be only a handful of possible results, so the result code is a locally defined integer (greater than 0). This works well when you're returning a result to an activity in your own app, because the activity that receives the result can reference the public constant to determine the value of the result code.

<strong>Note:</strong> There's no need to check whether your activity was started with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>. Simply call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#setResult(int, android.content.Intent)">setResult()</a></code> if the intent that started your activity might expect a result. If the originating activity had called <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>, then the system delivers it the result you supply to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html#setResult(int, android.content.Intent)">setResult()</a></code>; otherwise, the result is ignored.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>389</wp:post_id>
		<wp:post_date>2015-03-17 09:00:43</wp:post_date>
		<wp:post_date_gmt>2015-03-17 01:00:43</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>allowing-other-apps-to-start-your-activity</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707551]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Sending Simple Data to Other Apps</title>
		<link>http://1.duoinfo.sinaapp.com/?p=392</link>
		<pubDate>Wed, 18 Mar 2015 00:25:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=392</guid>
		<description></description>
		<content:encoded><![CDATA[When you construct an intent, you must specify the action you want the intent to "trigger." Android defines several actions, including <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> which, as you can probably guess, indicates that the intent is sending data from one activity to another, even across process boundaries. To send data to another activity, all you need to do is specify the data and its type, the system will identify compatible receiving activities and display them to the user (if there are multiple options) or immediately start the activity (if there is only one option). Similarly, you can advertise the data types that your activities support receiving from other applications by specifying them in your manifest.

Sending and receiving data between applications with intents is most commonly used for social sharing of content. Intents allow users to share information quickly and easily, using their favorite applications.

<strong>Note:</strong> The best way to add a share action item to an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/ActionBar.html">ActionBar</a></code> is to use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>, which became available in API level 14. <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> is discussed in the lesson about <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/sharing/shareaction.html">Adding an Easy Share Action</a>.
<h2 id="send-text-content">Send Text Content</h2>

<hr />

<div><img id="figure1" src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/training/sharing/share-text-screenshot.png" alt="" />The most straightforward and common use of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> action is sending text content from one activity to another. For example, the built-in Browser app can share the URL of the currently-displayed page as text with any application. This is useful for sharing an article or website with friends via email or social networking. Here is the code to implement this type of sharing:</div>
[java]Intent sendIntent = new Intent();
sendIntent.setAction(Intent.ACTION_SEND);
sendIntent.putExtra(Intent.EXTRA_TEXT, &quot;This is my text to send.&quot;);
sendIntent.setType(&quot;text/plain&quot;);
startActivity(sendIntent);[/java]

If there's an installed application with a filter that matches <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code>and MIME type text/plain, the Android system will run it; if more than one application matches, the system displays a disambiguation dialog (a "chooser") that allows the user to choose an app.

However, if you call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)">Intent.createChooser()</a></code>, passing it your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> object, it returns a version of your intent that will <strong>always display the chooser</strong>. This has some advantages:
<ul>
	<li>Even if the user has previously selected a default action for this intent, the chooser will still be displayed.</li>
	<li>If no applications match, Android displays a system message.</li>
	<li>You can specify a title for the chooser dialog.</li>
</ul>
Here's the updated code:

[java]Intent sendIntent = new Intent();
sendIntent.setAction(Intent.ACTION_SEND);
sendIntent.putExtra(Intent.EXTRA_TEXT, &quot;This is my text to send.&quot;);
sendIntent.setType(&quot;text/plain&quot;);
startActivity(&lt;strong&gt;Intent.createChooser(sendIntent, getResources().getText(R.string.send_to))&lt;/strong&gt;);[/java]

The resulting dialog is shown in figure 1.

Optionally, you can set some standard extras for the intent: <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_EMAIL">EXTRA_EMAIL</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_CC">EXTRA_CC</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_BCC">EXTRA_BCC</a></code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_SUBJECT">EXTRA_SUBJECT</a></code>. If the receiving application is not designed to use them, it simply ignores them.

<strong>Note:</strong> Some e-mail applications, such as Gmail, expect a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/java/lang/String.html">String[]</a></code> for extras like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_EMAIL">EXTRA_EMAIL</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_CC">EXTRA_CC</a></code>, use<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#putExtra(java.lang.String, java.lang.String[])">putExtra(String, String[])</a></code> to add these to your intent.
<h2 id="send-binary-content">Send Binary Content</h2>

<hr />

Binary data is shared using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> action combined with setting the appropriate MIME type and placing the URI to the data in an extra named <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_STREAM">EXTRA_STREAM</a></code>. This is commonly used to share an image but can be used to share any type of binary content:

[java]Intent shareIntent = new Intent();
shareIntent.setAction(Intent.ACTION_SEND);
shareIntent.putExtra(Intent.EXTRA_STREAM, uriToImage);
shareIntent.setType(&quot;image/jpeg&quot;);
startActivity(Intent.createChooser(shareIntent, getResources().getText(R.string.send_to)));[/java]

Note the following:
<ul>
	<li>You can use a MIME type of <code>"*/*"</code>, but this will only match activities that are able to handle generic data streams.</li>
	<li>The receiving application needs permission to access the data the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code> points to. The recommended ways to do this are:
<ul>
	<li>Store the data in your own <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/ContentProvider.html">ContentProvider</a></code>, making sure that other apps have the correct permission to access your provider. The preferred mechanism for providing access is to use <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/security/permissions.html#uri">per-URI permissions</a> which are temporary and only grant access to the receiving application. An easy way to create a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/ContentProvider.html">ContentProvider</a></code>like this is to use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> helper class.</li>
	<li>Use the system <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/MediaStore.html">MediaStore</a></code>. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/MediaStore.html">MediaStore</a></code> is primarily aimed at video, audio and image MIME types, however beginning with Android 3.0 (API level 11) it can also store non-media types (see <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/MediaStore.Files.html">MediaStore.Files</a></code>for more info). Files can be inserted into the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/MediaStore.html">MediaStore</a></code> using <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/media/MediaScannerConnection.html#scanFile(android.content.Context, java.lang.String[], java.lang.String[], android.media.MediaScannerConnection.OnScanCompletedListener)">scanFile()</a></code> after which a <code>content://</code> style <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">Uri</a></code>suitable for sharing is passed to the provided <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/media/MediaScannerConnection.OnScanCompletedListener.html#onScanCompleted(java.lang.String, android.net.Uri)">onScanCompleted()</a></code> callback. Note that once added to the system <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/provider/MediaStore.html">MediaStore</a></code> the content is accessible to any app on the device.</li>
</ul>
</li>
</ul>
<h2 id="send-multiple-content">Send Multiple Pieces of Content</h2>

<hr />

To share multiple pieces of content, use the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">ACTION_SEND_MULTIPLE</a></code> action together with a list of URIs pointing to the content. The MIME type varies according to the mix of content you're sharing. For example, if you share 3 JPEG images, the type is still <code>"image/jpeg"</code>. For a mixture of image types, it should be <code>"image/*"</code> to match an activity that handles any type of image. You should only use <code>"*/*"</code> if you're sharing out a wide variety of types. As previously stated, it's up to the receiving application to parse and process your data. Here's an example:

[java]ArrayList&lt;Uri&gt; imageUris = new ArrayList&lt;Uri&gt;();
imageUris.add(imageUri1); // Add your image URIs here
imageUris.add(imageUri2);

Intent shareIntent = new Intent();
shareIntent.setAction(Intent.ACTION_SEND_MULTIPLE);
shareIntent.putParcelableArrayListExtra(Intent.EXTRA_STREAM, imageUris);
shareIntent.setType(&quot;image/*&quot;);
startActivity(Intent.createChooser(shareIntent, &quot;Share images to..&quot;));[/java]

As before, make sure the provided <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/net/Uri.html">URIs</a></code> point to data that a receiving application can access.

一个完整的例子：
<div>

[java]package com.dystu.interactingwithotherapp;

import android.content.ContentResolver;
import android.content.ContentValues;
import android.content.Intent;
import android.net.Uri;
import android.os.Environment;
import android.provider.MediaStore;
import android.support.v7.app.ActionBarActivity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;

import java.io.File;
import java.util.ArrayList;
import java.util.Date;
public class MainActivity2 extends ActionBarActivity {

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_main_activity2);
 }
 public void click(View view){
 Intent sendIntent = new Intent();
 sendIntent.setAction(Intent.ACTION_SEND);
 sendIntent.putExtra(Intent.EXTRA_TEXT, &quot;This is my text to send.&quot;);
 sendIntent.setType(&quot;text/plain&quot;);
 startActivity(Intent.createChooser(sendIntent, &quot;选择&quot;));

}

public void click2(View view){

Intent intent = new Intent();
 intent.setAction(Intent.ACTION_SEND);
 intent.putExtra(Intent.EXTRA_STREAM,getUriListForImages().get(0));
 intent.setType(&quot;image/jpeg&quot;);
 startActivity(Intent.createChooser(intent,&quot;哈哈哈&quot;));

}

public void click3(View view){
 ArrayList&lt;Uri&gt; imageUris = new ArrayList&lt;Uri&gt;();
 imageUris=getUriListForImages(); // Add your image URIs here

Intent shareIntent = new Intent();
 shareIntent.setAction(Intent.ACTION_SEND_MULTIPLE);
 shareIntent.putParcelableArrayListExtra(Intent.EXTRA_STREAM, imageUris);
 shareIntent.setType(&quot;image/*&quot;);
 startActivity(Intent.createChooser(shareIntent, &quot;Share images to..&quot;));
 }
 /**
 * 设置需要分享的照片放入Uri类型的集合里
 */
 private ArrayList&lt;Uri&gt; getUriListForImages() {
 ArrayList&lt;Uri&gt; myList = new ArrayList&lt;Uri&gt;();
 String imageDirectoryPath = Environment.getExternalStorageDirectory().getAbsolutePath()+ &quot;/DCIM/Camera/&quot;;
 File imageDirectory = new File(imageDirectoryPath);
 String[] fileList = imageDirectory.list();
 if(fileList.length != 0) {
 for(int i=0; i&lt;5; i++){
 try{
 ContentValues values = new ContentValues(7);
 values.put(MediaStore.Images.Media.TITLE, fileList[i]);
 values.put(MediaStore.Images.Media.DISPLAY_NAME, fileList[i]);
 values.put(MediaStore.Images.Media.DATE_TAKEN, new Date().getTime());
 values.put(MediaStore.Images.Media.MIME_TYPE, &quot;image/jpeg&quot;);
 values.put(MediaStore.Images.ImageColumns.BUCKET_ID, imageDirectoryPath.hashCode());
 values.put(MediaStore.Images.ImageColumns.BUCKET_DISPLAY_NAME, fileList[i]);
 values.put(&quot;_data&quot;, imageDirectoryPath + fileList[i]);
 ContentResolver contentResolver = getApplicationContext().getContentResolver();
 Uri uri = contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, values);
 myList.add(uri);
 } catch (Exception e) {
 e.printStackTrace();
 }
 }
 }
 return myList;
 }
 @Override
 public boolean onCreateOptionsMenu(Menu menu) {
 // Inflate the menu; this adds items to the action bar if it is present.
 getMenuInflater().inflate(R.menu.menu_main_activity2, menu);
 return true;
 }

@Override
 public boolean onOptionsItemSelected(MenuItem item) {
 // Handle action bar item clicks here. The action bar will
 // automatically handle clicks on the Home/Up button, so long
 // as you specify a parent activity in AndroidManifest.xml.
 int id = item.getItemId();

//noinspection SimplifiableIfStatement
 if (id == R.id.action_settings) {
 return true;
 }

return super.onOptionsItemSelected(item);
 }
}[/java]

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>392</wp:post_id>
		<wp:post_date>2015-03-18 08:25:52</wp:post_date>
		<wp:post_date_gmt>2015-03-18 00:25:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>sending-simple-data-to-other-apps</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707552]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Receiving Simple Data from Other Apps</title>
		<link>http://1.duoinfo.sinaapp.com/?p=395</link>
		<pubDate>Wed, 18 Mar 2015 00:35:00 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=395</guid>
		<description></description>
		<content:encoded><![CDATA[Just as your application can send data to other applications, so too can it easily receive data from applications. Think about how users interact with your application, and what data types you want to receive from other applications. For example, a social networking application would likely be interested in receiving text content, like an interesting web URL, from another app. The<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.plus">Google+ Android application</a> accepts both text <em>and</em> single or multiple images. With this app, a user can easily start a new Google+ post with photos from the Android Gallery app.
<h2 id="update-manifest">Update Your Manifest</h2>

<hr />

Intent filters inform the system what intents an application component is willing to accept. Similar to how you constructed an intent with action <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/sharing/send.html">Sending Simple Data to Other Apps</a> lesson, you create intent filters in order to be able to receive intents with this action. You define an intent filter in your manifest, using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/components/intents-filters.html#ifs">&lt;intent-filter&gt;</a></code> element. For example, if your application handles receiving text content, a single image of any type, or multiple images of any type, your manifest would look like:

[xml]&lt;activity android:name=&quot;.ui.MyActivity&quot; &gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SEND&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
&lt;data android:mimeType=&quot;image/*&quot; /&gt;
&lt;/intent-filter&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SEND&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
&lt;data android:mimeType=&quot;text/plain&quot; /&gt;
&lt;/intent-filter&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.SEND_MULTIPLE&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
&lt;data android:mimeType=&quot;image/*&quot; /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;[/xml]

<strong>Note:</strong> For more information on intent filters and intent resolution please read <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/components/intents-filters.html#ifs">Intents and Intent Filters</a>

When another application tries to share any of these things by constructing an intent and passing it to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Context.html#startActivity(android.content.Intent)">startActivity()</a></code>, your application will be listed as an option in the intent chooser. If the user selects your application, the corresponding activity (<code>.ui.MyActivity</code> in the example above) will be started. It is then up to you to handle the content appropriately within your code and UI.
<h2 id="handling-content">Handle the Incoming Content</h2>

<hr />

To handle the content delivered by an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>, start by calling <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#getIntent(java.lang.String)">getIntent()</a></code> to get <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> object. Once you have the object, you can examine its contents to determine what to do next. Keep in mind that if this activity can be started from other parts of the system, such as the launcher, then you will need to take this into consideration when examining the intent.

[java]void onCreate (Bundle savedInstanceState) {
...
// Get intent, action and MIME type
Intent intent = getIntent();
String action = intent.getAction();
String type = intent.getType();

if (Intent.ACTION_SEND.equals(action) &amp;&amp; type != null) {
if (&quot;text/plain&quot;.equals(type)) {
handleSendText(intent); // Handle text being sent
} else if (type.startsWith(&quot;image/&quot;)) {
handleSendImage(intent); // Handle single image being sent
}
} else if (Intent.ACTION_SEND_MULTIPLE.equals(action) &amp;&amp; type != null) {
if (type.startsWith(&quot;image/&quot;)) {
handleSendMultipleImages(intent); // Handle multiple images being sent
}
} else {
// Handle other intents, such as being started from the home screen
}
...
}

void handleSendText(Intent intent) {
String sharedText = intent.getStringExtra(Intent.EXTRA_TEXT);
if (sharedText != null) {
// Update UI to reflect text being shared
}
}

void handleSendImage(Intent intent) {
Uri imageUri = (Uri) intent.getParcelableExtra(Intent.EXTRA_STREAM);
if (imageUri != null) {
// Update UI to reflect image being shared
}
}

void handleSendMultipleImages(Intent intent) {
ArrayList&lt;Uri&gt; imageUris = intent.getParcelableArrayListExtra(Intent.EXTRA_STREAM);
if (imageUris != null) {
// Update UI to reflect multiple images being shared
}
}[/java]

<strong>Caution:</strong> Take extra care to check the incoming data, you never know what some other application may send you. For example, the wrong MIME type might be set, or the image being sent might be extremely large. Also, remember to process binary data in a separate thread rather than the main ("UI") thread.

Updating the UI can be as simple as populating an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/EditText.html">EditText</a></code>, or it can be more complicated like applying an interesting photo filter to an image. It's really specific to your application what happens next.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>395</wp:post_id>
		<wp:post_date>2015-03-18 08:35:00</wp:post_date>
		<wp:post_date_gmt>2015-03-18 00:35:00</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>receiving-simple-data-from-other-apps</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707553]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Adding an Easy Share Action</title>
		<link>http://1.duoinfo.sinaapp.com/?p=397</link>
		<pubDate>Wed, 18 Mar 2015 00:47:25 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=397</guid>
		<description></description>
		<content:encoded><![CDATA[Implementing an effective and user friendly share action in your<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/ActionBar.html">ActionBar</a></code> is made even easier with the introduction of<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ActionProvider.html">ActionProvider</a></code> in Android 4.0 (API Level 14). An <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/ActionProvider.html">ActionProvider</a></code>, once attached to a menu item in the action bar, handles both the appearance and behavior of that item. In the case of<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>, you provide a share intent and it does the rest.

<strong>Note: </strong> <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> is available starting with API Level 14 and higher.
<div><img id="figure1" src="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/images/ui/actionbar-shareaction.png" alt="" /></div>
<h2 id="update-menus">Update Menu Declarations</h2>

<hr />

To get started with <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProviders</a></code>, define the<code>android:actionProviderClass</code> attribute for the corresponding <code>&lt;item&gt;</code> in your<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/resources/menu-resource.html">menu resource</a> file:

[xml]&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
&lt;item
android:id=&quot;@+id/menu_item_share&quot;
android:showAsAction=&quot;ifRoom&quot;
android:title=&quot;Share&quot;
&lt;strong&gt;android:actionProviderClass=
&quot;android.widget.ShareActionProvider&quot;&lt;/strong&gt; /&gt;
...
&lt;/menu&gt;[/xml]

This delegates responsibility for the item's appearance and function to<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>. However, you will need to tell the provider what you would like to share.
<h2 id="set-share-intent">Set the Share Intent</h2>

<hr />

In order for <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> to function, you must provide it a share intent. This share intent should be the same as described in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/sharing/send.html">Sending Simple Data to Other Apps</a> lesson, with action <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> and additional data set via extras like <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_TEXT">EXTRA_TEXT</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html#EXTRA_STREAM">EXTRA_STREAM</a></code>. To assign a share intent, first find the corresponding <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/MenuItem.html">MenuItem</a></code>while inflating your menu resource in your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> or <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code>. Next, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/view/MenuItem.html#getActionProvider()">MenuItem.getActionProvider()</a></code> to retrieve an instance of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>. Use <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html#setShareIntent(android.content.Intent)">setShareIntent()</a></code> to update the share intent associated with that action item. Here's an example:

[java]private ShareActionProvider mShareActionProvider;
...

@Override
public boolean onCreateOptionsMenu(Menu menu) {
// Inflate menu resource file.
getMenuInflater().inflate(R.menu.share_menu, menu);

// Locate MenuItem with ShareActionProvider
MenuItem item = menu.findItem(R.id.menu_item_share);

// Fetch and store ShareActionProvider
mShareActionProvider = (ShareActionProvider) item.getActionProvider();

// Return true to display menu
return true;
}

// Call to update the share intent
private void setShareIntent(Intent shareIntent) {
if (mShareActionProvider != null) {
mShareActionProvider.setShareIntent(shareIntent);
}
}[/java]

You may only need to set the share intent once during the creation of your menus, or you may want to set it and then update it as the UI changes. For example, when you view photos full screen in the Gallery app, the sharing intent changes as you flip between photos.

For further discussion about the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> object, see the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/actionbar.html#ActionProvider">Action Bar</a> guide.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>397</wp:post_id>
		<wp:post_date>2015-03-18 08:47:25</wp:post_date>
		<wp:post_date_gmt>2015-03-18 00:47:25</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>adding-an-easy-share-action</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707554]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Sharing Files</title>
		<link>http://1.duoinfo.sinaapp.com/?p=400</link>
		<pubDate>Fri, 20 Mar 2015 00:17:55 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=400</guid>
		<description></description>
		<content:encoded><![CDATA[Apps often have a need to offer one or more of their files to another app. For example, an image gallery may want to offer files to image editors, or a file management app may want to allow users to copy and paste files between areas in external storage. One way a sending app can share a file is to respond to a request from the receiving app.

In all cases, the only secure way to offer a file from your app to another app is to send the receiving app the file's content URI and grant temporary access permissions to that URI. Content URIs with temporary URI access permissions are secure because they apply only to the app that receives the URI, and they expire automatically. The Android <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> component provides the method<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code> for generating a file's content URI.

If you want to share small amounts of text or numeric data between apps, you should send an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code> that contains the data. To learn how to send simple data with an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/content/Intent.html">Intent</a></code>, see the training class <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/training/sharing/index.html">Sharing Simple Data</a>.

This class explains how to securely share files from your app to another app using content URIs generated by the Android <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> component and temporary permissions that you grant to the receiving app for the content URI.]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>400</wp:post_id>
		<wp:post_date>2015-03-20 08:17:55</wp:post_date>
		<wp:post_date_gmt>2015-03-20 00:17:55</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>sharing-files</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707555]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Setting Up File Sharing</title>
		<link>http://1.duoinfo.sinaapp.com/?p=402</link>
		<pubDate>Fri, 20 Mar 2015 00:20:42 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=402</guid>
		<description></description>
		<content:encoded><![CDATA[To securely offer a file from your app to another app, you need to configure your app to offer a secure handle to the file, in the form of a content URI. The Android<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> component generates content URIs for files, based on specifications you provide in XML. This lesson shows you how to add the default implementation of<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to your app, and how to specify the files you want to offer to other apps.

<strong>Note:</strong> The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> class is part of the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/features.html#v4">v4 Support Library</a>. For information about including this library in your application, see <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/setup.html">Support Library Setup</a>.
<h2 id="DefineProvider">Specify the FileProvider</h2>

<hr />

Defining a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> for your app requires an entry in your manifest. This entry specifies the authority to use in generating content URIs, as well as the name of an XML file that specifies the directories your app can share.

The following snippet shows you how to add to your manifest the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> element that specifies the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> class, the authority, and the XML file name:

[xml]&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
package=&quot;com.example.myapp&quot;&gt;
&lt;application
...&gt;
&lt;provider
android:name=&quot;android.support.v4.content.FileProvider&quot;
android:authorities=&quot;com.example.myapp.fileprovider&quot;
android:grantUriPermissions=&quot;true&quot;
android:exported=&quot;false&quot;&gt;
&lt;meta-data
android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;
android:resource=&quot;@xml/filepaths&quot; /&gt;
&lt;/provider&gt;
...
&lt;/application&gt;
&lt;/manifest&gt;[/xml]

In this example, the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html#auth">android:authorities</a></code> <span style="color: #333399;">attribute specifies the URI authority that you want to use for content URIs generated by the </span><code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>. In the example, the authority is<code>com.example.myapp.fileprovider</code>. For your own app, specify an authority consisting of the app's<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/manifest-element.html#package">android:package</a></code> value with the string "fileprovider" appended to it. To learn more about the authority value, see the topic <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/providers/content-provider-basics.html#ContentURIs">Content URIs</a> and the documentation for the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html#auth">android:authorities</a></code>attribute.

The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></code> child element of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> points to an XML file that specifies the directories you want to share. The <code>android:resource</code> attribute is the path and name of the file, without the <code>.xml</code>extension.The contents of this file are described in the next section.
<h2 id="DefineMetaData">Specify Sharable Directories</h2>

<hr />

Once you have added the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to your app manifest, you need to specify the directories that contain the files you want to share. To specify the directories, start by creating the file<code>filepaths.xml</code> in the <code>res/xml/</code> subdirectory of your project. In this file, specify the directories by adding an XML element for each directory. The following snippet shows you an example of the contents of <code>res/xml/filepaths.xml</code>. The snippet also demonstrates how to share a subdirectory of the <code>files/</code>directory in your internal storage area:

[xml]&lt;paths&gt;
&lt;files-path path=&quot;images/&quot; name=&quot;myimages&quot; /&gt;
&lt;/paths&gt;[/xml]

In this example, the <code>&lt;files-path&gt;</code> tag shares directories within the <code>files/</code> directory of your app's internal storage. The <code>path</code> attribute shares the <code>images/</code> subdirectory of <code>files/</code>. The <code>name</code> attribute tells the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to add the path segment <code>myimages</code> to content URIs for files in the<code>files/images/</code> subdirectory.

The <code>&lt;paths&gt;</code> element can have multiple children, each specifying a different directory to share. In addition to the <code>&lt;files-path&gt;</code> element, you can use the <code>&lt;external-path&gt;</code> element to share directories in external storage, and the <code>&lt;cache-path&gt;</code> element to share directories in your internal cache directory. To learn more about the child elements that specify shared directories, see the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> reference documentation.

<strong>Note:</strong> The XML file is the only way you can specify the directories you want to share; you can't programmatically add a directory.

You now have a complete specification of a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> that generates content URIs for files in the<code>files/</code> directory of your app's internal storage or for files in subdirectories of <code>files/</code>. When your app generates a content URI for a file, it contains the authority specified in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code>element (<code>com.example.myapp.fileprovider</code>), the path <code>myimages/</code>, and the name of the file.

For example, if you define a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> according to the snippets in this lesson, and you request a content URI for the file <code>default_image.jpg</code>, <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> returns the following URI:

[java]content://com.example.myapp.fileprovider/myimages/default_image.jpg[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>402</wp:post_id>
		<wp:post_date>2015-03-20 08:20:42</wp:post_date>
		<wp:post_date_gmt>2015-03-20 00:20:42</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>setting-up-file-sharing</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707556]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>精华</title>
		<link>http://1.duoinfo.sinaapp.com/?p=405</link>
		<pubDate>Sat, 21 Mar 2015 07:21:04 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=405</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="color: #3366ff;">1.A techical guide to to improving the UI and UX Android apps：<a title="https://blog.stylingandroid.com/" href="https://blog.stylingandroid.com/" target="_blank">https://blog.stylingandroid.com/</a>  </span>

<span style="color: #3366ff;">2.</span><a title="http://cyrilmottier.com/" href="http://cyrilmottier.com/" target="_blank">http://cyrilmottier.com/</a>

<span style="color: #3366ff;">3.CodePath Android Cliffnotes ：</span><a title="http://guides.codepath.com/android" href="http://guides.codepath.com/android" target="_blank">http://guides.codepath.com/android</a>

<span style="color: #3366ff;">4.coding客户度开源：</span><a title="https://coding.net/app" href="https://coding.net/app" target="_blank">https://coding.net/app</a>

<span style="color: #3366ff;">5.指读开源作者：</span><a title="https://coding.net/u/youzi" href="https://coding.net/u/youzi" target="_blank">https://coding.net/u/youzi</a>

<span style="color: #00ccff;">6.一位台湾人的技术博客：</span><a title="http://blog.mosil.biz/" href="http://blog.mosil.biz/" target="_blank">http://blog.mosil.biz/</a>

<span style="color: #0000ff;">7.Android performance study</span> <a title="http://www.curious-creature.com/" href="http://www.curious-creature.com/" target="_blank">http://www.curious-creature.com/</a>

<span style="color: #000080;">8.源码解析的网站：</span>  <a title="http://codekk.com/open-source-project-analysis" href="http://codekk.com/open-source-project-analysis" target="_blank">http://codekk.com/open-source-project-analysis</a>

<span style="color: #0000ff;">9.介绍过Glide的国外blog：</span><a title="http://inthecheesefactory.com/blog" href="http://inthecheesefactory.com/blog" target="_blank">http://inthecheesefactory.com/blog</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>405</wp:post_id>
		<wp:post_date>2015-03-21 15:21:04</wp:post_date>
		<wp:post_date_gmt>2015-03-21 07:21:04</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e7%b2%be%e5%8d%8e</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e6%94%b6%e8%97%8f"><![CDATA[收藏]]></category>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707557]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Creating a Navigation Drawer</title>
		<link>http://1.duoinfo.sinaapp.com/?p=410</link>
		<pubDate>Mon, 23 Mar 2015 01:03:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=410</guid>
		<description></description>
		<content:encoded><![CDATA[The navigation drawer is a panel that displays the app’s main navigation options on the left edge of the screen. It is hidden most of the time, but is revealed when the user swipes a finger from the left edge of the screen or, while at the top level of the app, the user touches the app icon in the action bar.

This lesson describes how to implement a navigation drawer using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code> APIs available in the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/tools/support-library/index.html">Support Library</a>.
<div>

<strong>Navigation Drawer Design</strong>

Before you decide to use a navigation drawer in your app, you should understand the use cases and design principles defined in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/design/patterns/navigation-drawer.html">Navigation Drawer</a> design guide.

</div>
<h2 id="DrawerLayout">Create a Drawer Layout</h2>

<hr />

To add a navigation drawer, declare your user interface with a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code> object as the root view of your layout. Inside the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code>, add one view that contains the main content for the screen (your primary layout when the drawer is hidden) and another view that contains the contents of the navigation drawer.

For example, the following layout uses a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code> with two child views: a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/FrameLayout.html">FrameLayout</a></code> to contain the main content (populated by a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> at runtime), and a <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code> for the navigation drawer.

[xml]&lt;android.support.v4.widget.DrawerLayout
xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
android:id=&quot;@+id/drawer_layout&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;&gt;
&lt;!-- The main content view --&gt;
&lt;FrameLayout
android:id=&quot;@+id/content_frame&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot; /&gt;
&lt;!-- The navigation drawer --&gt;
&lt;ListView android:id=&quot;@+id/left_drawer&quot;
android:layout_width=&quot;240dp&quot;
android:layout_height=&quot;match_parent&quot;
android:layout_gravity=&quot;start&quot;
android:choiceMode=&quot;singleChoice&quot;
android:divider=&quot;@android:color/transparent&quot;
android:dividerHeight=&quot;0dp&quot;
android:background=&quot;#111&quot;/&gt;
&lt;/android.support.v4.widget.DrawerLayout&gt;[/xml]

This layout demonstrates some important layout characteristics:
<ul>
	<li>The main content view (the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/FrameLayout.html">FrameLayout</a></code> above) <strong>must be the first child</strong> in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code>because the XML order implies z-ordering and the drawer must be on top of the content.</li>
	<li>The main content view is set to match the parent view's width and height, because it represents the entire UI when the navigation drawer is hidden.</li>
	<li>The drawer view (the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>) <strong>must specify its horizontal gravity</strong> with the<code>android:layout_gravity</code> attribute. To support right-to-left (RTL) languages, specify the value with <code>"start"</code> instead of <code>"left"</code> (so the drawer appears on the right when the layout is RTL).</li>
	<li>The drawer view specifies its width in <code>dp</code> units and the height matches the parent view. The drawer width should be no more than 320dp so the user can always see a portion of the main content.</li>
</ul>
<h2 id="Init">Initialize the Drawer List</h2>

<hr />

In your activity, one of the first things to do is initialize the navigation drawer's list of items. How you do so depends on the content of your app, but a navigation drawer often consists of a<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ListView.html">ListView</a></code>, so the list should be populated by an <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/Adapter.html">Adapter</a></code> (such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/ArrayAdapter.html">ArrayAdapter</a></code> or<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/SimpleCursorAdapter.html">SimpleCursorAdapter</a></code>).

For example, here's how you can initialize the navigation list with a <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/resources/string-resource.html#StringArray">string array</a>:

[java]public class MainActivity extends Activity {
private String[] mPlanetTitles;
private DrawerLayout mDrawerLayout;
private ListView mDrawerList;
...

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);

mPlanetTitles = getResources().getStringArray(R.array.planets_array);
mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);
mDrawerList = (ListView) findViewById(R.id.left_drawer);

// Set the adapter for the list view
mDrawerList.setAdapter(new ArrayAdapter&lt;String&gt;(this,
R.layout.drawer_list_item, mPlanetTitles));
// Set the list's click listener
mDrawerList.setOnItemClickListener(new DrawerItemClickListener());

...
}
}[/java]

This code also calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.html#setOnItemClickListener(android.widget.AdapterView.OnItemClickListener)">setOnItemClickListener()</a></code> to receive click events in the navigation drawer's list. The next section shows how to implement this interface and change the content view when the user selects an item.
<h2 id="ListItemClicks">Handle Navigation Click Events</h2>

<hr />

When the user selects an item in the drawer's list, the system calls <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView&lt;?&gt;, android.view.View, int, long)">onItemClick()</a></code> on the<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.OnItemClickListener.html">OnItemClickListener</a></code> given to <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.html#setOnItemClickListener(android.widget.AdapterView.OnItemClickListener)">setOnItemClickListener()</a></code>.

What you do in the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView&lt;?&gt;, android.view.View, int, long)">onItemClick()</a></code> method depends on how you've implemented your <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/design/patterns/app-structure.html">app structure</a>. In the following example, selecting each item in the list inserts a different <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Fragment.html">Fragment</a></code> into the main content view (the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/widget/FrameLayout.html">FrameLayout</a></code> element identified by the <code>R.id.content_frame</code> ID):

[java]private class DrawerItemClickListener implements ListView.OnItemClickListener {
@Override
public void onItemClick(AdapterView parent, View view, int position, long id) {
selectItem(position);
}
}

/** Swaps fragments in the main content view */
private void selectItem(int position) {
// Create a new fragment and specify the planet to show based on position
Fragment fragment = new PlanetFragment();
Bundle args = new Bundle();
args.putInt(PlanetFragment.ARG_PLANET_NUMBER, position);
fragment.setArguments(args);

// Insert the fragment by replacing any existing fragment
FragmentManager fragmentManager = getFragmentManager();
fragmentManager.beginTransaction()
.replace(R.id.content_frame, fragment)
.commit();

// Highlight the selected item, update the title, and close the drawer
mDrawerList.setItemChecked(position, true);
setTitle(mPlanetTitles[position]);
mDrawerLayout.closeDrawer(mDrawerList);
}

@Override
public void setTitle(CharSequence title) {
mTitle = title;
getActionBar().setTitle(mTitle);
}[/java]
<h2 id="OpenClose">Listen for Open and Close Events</h2>

<hr />

To listen for drawer open and close events, call <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html#setDrawerListener(android.support.v4.widget.DrawerLayout.DrawerListener)">setDrawerListener()</a></code> on your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code> and pass it an implementation of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html">DrawerLayout.DrawerListener</a></code>. This interface provides callbacks for drawer events such as <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html#onDrawerOpened(android.view.View)">onDrawerOpened()</a></code> and <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html#onDrawerClosed(android.view.View)">onDrawerClosed()</a></code>.

However, rather than implementing the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html">DrawerLayout.DrawerListener</a></code>, if your activity includes the<a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/actionbar.html">action bar</a>, you can instead extend the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> class. The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code>implements <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html">DrawerLayout.DrawerListener</a></code> so you can still override those callbacks, but it also facilitates the proper interaction behavior between the action bar icon and the navigation drawer (discussed further in the next section).

As discussed in the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/design/patterns/navigation-drawer.html">Navigation Drawer</a> design guide, you should modify the contents of the action bar when the drawer is visible, such as to change the title and remove action items that are contextual to the main content. The following code shows how you can do so by overriding<code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.DrawerListener.html">DrawerLayout.DrawerListener</a></code> callback methods with an instance of the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> class:

[java]public class MainActivity extends Activity {
private DrawerLayout mDrawerLayout;
private ActionBarDrawerToggle mDrawerToggle;
private CharSequence mDrawerTitle;
private CharSequence mTitle;
...

@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);
...

mTitle = mDrawerTitle = getTitle();
mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);
mDrawerToggle = new ActionBarDrawerToggle(this, mDrawerLayout,
R.drawable.ic_drawer, R.string.drawer_open, R.string.drawer_close) {

/** Called when a drawer has settled in a completely closed state. */
public void onDrawerClosed(View view) {
super.onDrawerClosed(view);
getActionBar().setTitle(mTitle);
invalidateOptionsMenu(); // creates call to onPrepareOptionsMenu()
}

/** Called when a drawer has settled in a completely open state. */
public void onDrawerOpened(View drawerView) {
super.onDrawerOpened(drawerView);
getActionBar().setTitle(mDrawerTitle);
invalidateOptionsMenu(); // creates call to onPrepareOptionsMenu()
}
};

// Set the drawer toggle as the DrawerListener
mDrawerLayout.setDrawerListener(mDrawerToggle);
}

/* Called whenever we call invalidateOptionsMenu() */
@Override
public boolean onPrepareOptionsMenu(Menu menu) {
// If the nav drawer is open, hide action items related to the content view
boolean drawerOpen = mDrawerLayout.isDrawerOpen(mDrawerList);
menu.findItem(R.id.action_websearch).setVisible(!drawerOpen);
return super.onPrepareOptionsMenu(menu);
}
}[/java]

The next section describes the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> constructor arguments and the other steps required to set it up to handle interaction with the action bar icon.
<h2 id="ActionBarIcon">Open and Close with the App Icon</h2>

<hr />

Users can open and close the navigation drawer with a swipe gesture from or towards the left edge of the screen, but if you're using the <a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/guide/topics/ui/actionbar.html">action bar</a>, you should also allow users to open and close it by touching the app icon. And the app icon should also indicate the presence of the navigation drawer with a special icon. You can implement all this behavior by using the <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> shown in the previous section.

To make <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> work, create an instance of it with its constructor, which requires the following arguments:
<ul>
	<li>The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/app/Activity.html">Activity</a></code> hosting the drawer.</li>
	<li>The <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/widget/DrawerLayout.html">DrawerLayout</a></code>.</li>
	<li>A drawable resource to use as the drawer indicator.The standard navigation drawer icon is available in the <a href="http://developer.android.com/downloads/design/Android_Design_Icons_20130926.zip">Download the Action Bar Icon Pack</a>.</li>
	<li>A String resource to describe the "open drawer" action (for accessibility).</li>
	<li>A String resource to describe the "close drawer" action (for accessibility).</li>
</ul>
Then, whether or not you've created a subclass of <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> as your drawer listener, you need to call upon your <code><a href="file:///D:/Users/Administrator/AppData/Local/Android/sdk/docs/reference/android/support/v4/app/ActionBarDrawerToggle.html">ActionBarDrawerToggle</a></code> in a few places throughout your activity lifecycle:

[java]public class MainActivity extends Activity {
private DrawerLayout mDrawerLayout;
private ActionBarDrawerToggle mDrawerToggle;
...

public void onCreate(Bundle savedInstanceState) {
...

mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);
mDrawerToggle = new ActionBarDrawerToggle(
this,                  /* host Activity */
mDrawerLayout,         /* DrawerLayout object */
R.drawable.ic_drawer,  /* nav drawer icon to replace 'Up' caret */
R.string.drawer_open,  /* &quot;open drawer&quot; description */
R.string.drawer_close  /* &quot;close drawer&quot; description */
) {

/** Called when a drawer has settled in a completely closed state. */
public void onDrawerClosed(View view) {
super.onDrawerClosed(view);
getActionBar().setTitle(mTitle);
}

/** Called when a drawer has settled in a completely open state. */
public void onDrawerOpened(View drawerView) {
super.onDrawerOpened(drawerView);
getActionBar().setTitle(mDrawerTitle);
}
};

// Set the drawer toggle as the DrawerListener
mDrawerLayout.setDrawerListener(mDrawerToggle);

getActionBar().setDisplayHomeAsUpEnabled(true);
getActionBar().setHomeButtonEnabled(true);
}

@Override
protected void onPostCreate(Bundle savedInstanceState) {
super.onPostCreate(savedInstanceState);
// Sync the toggle state after onRestoreInstanceState has occurred.
mDrawerToggle.syncState();
}

@Override
public void onConfigurationChanged(Configuration newConfig) {
super.onConfigurationChanged(newConfig);
mDrawerToggle.onConfigurationChanged(newConfig);
}

@Override
public boolean onOptionsItemSelected(MenuItem item) {
// Pass the event to ActionBarDrawerToggle, if it returns
// true, then it has handled the app icon touch event
if (mDrawerToggle.onOptionsItemSelected(item)) {
return true;
}
// Handle your other action bar items...

return super.onOptionsItemSelected(item);
}

...
}[/java]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>410</wp:post_id>
		<wp:post_date>2015-03-23 09:03:32</wp:post_date>
		<wp:post_date_gmt>2015-03-23 01:03:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>creating-a-navigation-drawer</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="training%e6%96%87%e6%a1%a3"><![CDATA[Training文档]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707558]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Handler一定要在主线程实例化吗?new Handler()和new Handler(Looper.getMainLooper())的区别</title>
		<link>http://1.duoinfo.sinaapp.com/?p=413</link>
		<pubDate>Mon, 23 Mar 2015 01:15:31 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=413</guid>
		<description></description>
		<content:encoded><![CDATA[<span style="color: #333399;">Handler一定要在主线程实例化吗?new Handler()和new Handler(Looper.getMainLooper())的区别:</span>
如果你不带参数的实例化：Handler handler = new Handler();那么这个会默认用当前线程的looper
一般而言，如果你的Handler是要来刷新操作UI的，那么就需要在主线程下跑。
情况:
1.要刷新UI，<span style="color: #333399;">handler要用到主线程的looper</span>。那么在主线程 Handler handler = new Handler();，如果在其他线程，也要满足这个功能的话，要Handler handler = new Handler(Looper.getMainLooper());
2.不用刷新ui,只是处理消息。 当前线程如果是主线程的话，Handler handler = new Handler();不是主线程的话，Looper.prepare(); Handler handler = new Handler();Looper.loop();或者Handler handler = new Handler(Looper.getMainLooper());
若是实例化的时候用Looper.getMainLooper()就表示放到主UI线程去处理。
如果不是的话，因为只有UI线程默认Loop.prepare();Loop.loop();过，其他线程需要手动调用这两个，否则会报错。
<span style="color: #333399;">message.what,message.arg1,message.arg2,message.obj，他们在之间有什么区别呢？</span>

what就是一般用来区别消息的，比如你传进去的时候msg.what = 3;
然后处理的时候判断msg.what == 3是不是成立的，是的话，表示这个消息是干嘛干嘛的（自己能区别开）
至于arg1,arg2，其实也就是两个传递数据用的，两个int值，看你自己想要用它干嘛咯。如果你的数据只是简单的int值，那么用这两个，比较方便。
其实这里你还少说了个，setData(Bundle),上面两个arg是传递简单int的，这个是传递复杂数据的。
msg.obj呢，这个就是传递数据了，msg中能够携带对象，在handleMessage的时候，可以把这个数据取出来做处理了。不过呢，如果是同一个进程，最好用上面的setData就行了，这个一般是Messenger类来用来跨进程传递可序列化的对象的，这个比起上面的来，更消耗性能一些。

http://www.cnblogs.com/xpxpxp2046/archive/2012/04/13.html]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>413</wp:post_id>
		<wp:post_date>2015-03-23 09:15:31</wp:post_date>
		<wp:post_date_gmt>2015-03-23 01:15:31</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>handler%e4%b8%80%e5%ae%9a%e8%a6%81%e5%9c%a8%e4%b8%bb%e7%ba%bf%e7%a8%8b%e5%ae%9e%e4%be%8b%e5%8c%96%e5%90%97new-handler%e5%92%8cnew-handlerlooper-getmainlooper%e7%9a%84%e5%8c%ba%e5%88%ab</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="handler"><![CDATA[Handler]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_b119cf074bc865e964ab18f0edb5075a</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707559]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_c5c487b035aa8a494e2a5f537bdbbdd1</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>遇到的问题以及解决的方式</title>
		<link>http://1.duoinfo.sinaapp.com/?p=416</link>
		<pubDate>Tue, 24 Mar 2015 09:23:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=416</guid>
		<description></description>
		<content:encoded><![CDATA[1.SharedPreferences在Fragment中的初始化时机，这个就得把Activity和Fragment的生命周期结合在一起考虑了。（空指针）

解决：在onAttach()方法中初始化。

2.使用百度地图的sdk在x86的机器上会抛异常，大概是因为百度没有提供x86的.so文件，只在主进程初始化lbs

3.安装Android Studio出现的问题：
<pre>'tools.jar' seems to be not in Android Studio classpath.
Please ensure JAVA_HOME points to JDK rather than JRE.
这个问题花了我N多时间，（国内的技术网站太不靠谱了），最后在stackoverflow上找到了答案。
<a title="http://stackoverflow.com/questions/27528652/tools-jar-seems-to-be-not-in-android-studio-classpath-on-windows-8" href="http://stackoverflow.com/questions/27528652/tools-jar-seems-to-be-not-in-android-studio-classpath-on-windows-8" target="_blank">http://stackoverflow.com/questions/27528652/tools-jar-seems-to-be-not-in-android-studio-classpath-on-windows-8</a>
这个哥们说得好：</pre>
Hey guys I had this same problem and was able to fix it after wasting about 3 hours:

Just copy tools.jar from <code>%JAVA_HOME\lib</code> to <code>(Android Studio Root)\lib</code>

4.Android4.4从图库选择图片，获取图片路径并裁剪（<a title="https://github.com/leerduo/aFileChooser" href="https://github.com/leerduo/aFileChooser" target="_blank">https://github.com/leerduo/aFileChooser</a>）

<a title="http://1.duoinfo.sinaapp.com/?p=493" href="http://1.duoinfo.sinaapp.com/?p=493" target="_blank">http://1.duoinfo.sinaapp.com/?p=493</a>

5.Error:SDK location not found. Define location with sdk.dir in the local.properties file

stackoverflow上找到的答案。配置下ANDROID_HOME环境变量的值为SDK的路径即可。（不同环境不同）

<span style="color: #000080;">6.<span style="font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;">一个页面同时存在PhotoView与DrawerLayout，<strong>DrawerLayout组件抛出一个ArrayIndexOutOfBoundsException异常的shouldInterceptTouchEvent</strong></span></span>

解决：<a title="http://1.duoinfo.sinaapp.com/?p=506" href="http://1.duoinfo.sinaapp.com/?p=506" target="_blank">http://1.duoinfo.sinaapp.com/?p=506</a>
<pre></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; color: #000000; font-size: 14px; line-height: 26px; max-width: 80em; padding-left: 0.7em; background-color: #ffffff;">一个页面同时存在PhotoView与DrawerLayout，<span style="font-family: Arial, Helvetica, sans-serif; background-color: #f0f0f0;">DrawerLayout</span>组件抛出一个ArrayIndexOutOfBoundsException异常的shouldInterceptTouchEvent。请参阅下面的堆栈跟踪：</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; color: #000000; font-size: 14px; line-height: 26px; max-width: 80em; padding-left: 0.7em; background-color: #ffffff;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; color: #000000; font-size: 14px; line-height: 26px; max-width: 80em; padding-left: 0.7em; background-color: #ffffff;">03-19 15:32:36.720: E/AndroidRuntime(5284): FATAL EXCEPTION: main
03-19 15:32:36.720: E/AndroidRuntime(5284): java.lang.ArrayIndexOutOfBoundsException: length=1; index=1
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.support.v4.widget.ViewDragHelper.shouldInterceptTouchEvent(ViewDragHelper.java:1004)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.support.v4.widget.DrawerLayout.onInterceptTouchEvent(DrawerLayout.java:820)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1817)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): at com.android.internal.policy.impl.PhoneWindow$DecorView.superDispatchTouchEvent(PhoneWindow.java:1953)
03-19 15:32:36.720: E/AndroidRuntime(5284): at com.android.internal.policy.impl.PhoneWindow.superDispatchTouchEvent(PhoneWindow.java:1405)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.app.Activity.dispatchTouchEvent(Activity.java:2410)
03-19 15:32:36.720: E/AndroidRuntime(5284): at com.android.internal.policy.impl.PhoneWindow$DecorView.dispatchTouchEvent(PhoneWindow.java:1901)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.View.dispatchPointerEvent(View.java:7421)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl.deliverPointerEvent(ViewRootImpl.java:3220)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl.deliverInputEvent(ViewRootImpl.java:3165)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl.doProcessInputEvents(ViewRootImpl.java:4292)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl.enqueueInputEvent(ViewRootImpl.java:4271)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl$WindowInputEventReceiver.onInputEvent(ViewRootImpl.java:4363)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.InputEventReceiver.dispatchInputEvent(InputEventReceiver.java:179)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.InputEventReceiver.nativeConsumeBatchedInputEvents(Native Method)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.InputEventReceiver.consumeBatchedInputEvents(InputEventReceiver.java:171)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl.doConsumeBatchedInput(ViewRootImpl.java:4342)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.ViewRootImpl$ConsumeBatchedInputRunnable.run(ViewRootImpl.java:4382)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.Choreographer$CallbackRecord.run(Choreographer.java:749)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.Choreographer.doCallbacks(Choreographer.java:562)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.Choreographer.doFrame(Choreographer.java:530)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:735)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.os.Handler.handleCallback(Handler.java:725)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.os.Handler.dispatchMessage(Handler.java:92)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.os.Looper.loop(Looper.java:137)
03-19 15:32:36.720: E/AndroidRuntime(5284): at android.app.ActivityThread.main(ActivityThread.java:5039)
03-19 15:32:36.720: E/AndroidRuntime(5284): at java.lang.reflect.Method.invokeNative(Native Method)
03-19 15:32:36.720: E/AndroidRuntime(5284): at java.lang.reflect.Method.invoke(Method.java:511)
03-19 15:32:36.720: E/AndroidRuntime(5284): at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:793)
03-19 15:32:36.720: E/AndroidRuntime(5284): at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:560)
03-19 15:32:36.720: E/AndroidRuntime(5284): at dalvik.system.NativeStart.main(Native Method)</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; color: #000000; font-size: 14px; line-height: 26px; max-width: 80em; padding-left: 0.7em; background-color: #ffffff;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; color: #000000; font-size: 14px; line-height: 26px; max-width: 80em; padding-left: 0.7em; background-color: #ffffff;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">这是关于多点触摸的requestDisallowInterceptTouchEvent和DrawerLayout的innerViews问题。</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">因为当innerViews做requestDisallowInterceptTouchEvent（true），DrawerLayout的onInterceptTouchEvent将不会被调用。 
因此，在下面的情况下，它会抛出ArrayIndexOutOfBoundsException异常。</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">用户触摸屏幕（pointerId=0），并触发做requestDisallowInterceptTouchEvent（true）。 然后，用户将另一个手指（pointerId= 1）在屏幕上在那个时候</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">（当requestDisallowInterceptTouchEvent（true））。 如果用户抬起第一个手指（pointerId= 0），并且第二指（pointerId= 1）执行<span style="font-family: Arial, Helvetica, sans-serif;"><span style="background-color: #f0f0f0;">onInterceptTouchEvent</span></span><span style="font-family: Arial, Helvetica, sans-serif; background-color: #f0f0f0;"> ，</span><span style="font-family: Arial, Helvetica, sans-serif; background-color: #f0f0f0;">该DrawerLayout不会存储该指针信息（pointerId=1） </span>当DrawerLayout得到ACTION_MOVE事件，它希望得到的pointerId指针信息。 然而，DrawerLayout只有指针=0，mInitialMotionX的数组大小仍为1。</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">所以导致<span style="font-family: Arial, Helvetica, sans-serif; background-color: #f0f0f0;">ArrayIndexOutOfBoundsException异常</span></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;"><span style="font-family: Arial, Helvetica, sans-serif; background-color: #f0f0f0;">解决办法：</span></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;"></pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">public class HackyDrawerLayout extends DrawerLayout {

    public HackyDrawerLayout(Context context) {
        super(context);
    }

    public HackyDrawerLayout(Context context, AttributeSet attrs) {
        super(context, attrs);
    }

    public HackyDrawerLayout(Context context, AttributeSet attrs, int defStyle) {
        super(context, attrs, defStyle);
    }

    private boolean mIsDisallowIntercept = false;

    @Override
    public void requestDisallowInterceptTouchEvent(boolean disallowIntercept) {
        // keep the info about if the innerViews do requestDisallowInterceptTouchEvent
        mIsDisallowIntercept = disallowIntercept;
        super.requestDisallowInterceptTouchEvent(disallowIntercept);
    }

    @Override
    public boolean dispatchTouchEvent(MotionEvent ev) {
        // the incorrect array size will only happen in the multi-touch scenario.
        if (ev.getPointerCount() &gt; 1 &amp;&amp; mIsDisallowIntercept) {
            requestDisallowInterceptTouchEvent(false);
            boolean handled = super.dispatchTouchEvent(ev);
            requestDisallowInterceptTouchEvent(true);
            return handled;
        } else {
            return super.dispatchTouchEvent(ev);
        }
    }
}</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">7.ViewPager和PhotoView一起使用带来的问题</pre>
<pre style="white-space: pre-wrap; word-wrap: break-word; max-width: 80em; padding-left: 0.7em;">解决：<a title="http://1.duoinfo.sinaapp.com/?p=526" href="http://1.duoinfo.sinaapp.com/?p=526" target="_blank">http://1.duoinfo.sinaapp.com/?p=526</a></pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>416</wp:post_id>
		<wp:post_date>2015-03-24 17:23:32</wp:post_date>
		<wp:post_date_gmt>2015-03-24 09:23:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98%e4%bb%a5%e5%8f%8a%e8%a7%a3%e5%86%b3%e7%9a%84%e6%96%b9%e5%bc%8f</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="%e9%97%ae%e9%a2%98%e9%9b%86%e5%90%88"><![CDATA[问题集合]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707563]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android-Universal-Image-Loader demo分析</title>
		<link>http://1.duoinfo.sinaapp.com/?p=419</link>
		<pubDate>Tue, 24 Mar 2015 02:20:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=419</guid>
		<description></description>
		<content:encoded><![CDATA[Constants常量类提供了图片的URL地址和几个常量：

[java]public final class Constants {

public static final String[] IMAGES = new String[] {&quot;http://img.my.csdn.net/uploads/201407/26/1406383299_1976.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383291_6518.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383291_8239.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383290_9329.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383290_1042.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383275_3977.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383265_8550.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383264_3954.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383264_4787.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383264_8243.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383248_3693.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383243_5120.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383242_3127.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383242_9576.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383242_1721.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383219_5806.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383214_7794.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383213_4418.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383213_3557.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383210_8779.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383172_4577.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383166_3407.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383166_2224.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383166_7301.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383165_7197.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383150_8410.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383131_3736.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383130_5094.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383130_7393.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383129_8813.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383100_3554.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383093_7894.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383092_2432.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383092_3071.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383091_3119.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383059_6589.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383059_8814.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383059_2237.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383058_4330.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406383038_3602.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382942_3079.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382942_8125.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382942_4881.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382941_4559.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382941_3845.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382924_8955.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382923_2141.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382923_8437.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382922_6166.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382922_4843.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382905_5804.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382904_3362.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382904_2312.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382904_4960.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382900_2418.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382881_4490.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382881_5935.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382880_3865.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382880_4662.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382879_2553.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382862_5375.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382862_1748.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382861_7618.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382861_8606.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382861_8949.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382841_9821.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382840_6603.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382840_2405.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382840_6354.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382839_5779.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382810_7578.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382810_2436.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382809_3883.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382809_6269.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382808_4179.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382790_8326.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382789_7174.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382789_5170.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382789_4118.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382788_9532.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382767_3184.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382767_4772.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382766_4924.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382766_5762.jpg&quot;,
 &quot;http://img.my.csdn.net/uploads/201407/26/1406382765_7341.jpg&quot; };

private Constants() {
 }

public static class Config {
 public static final boolean DEVELOPER_MODE = false;
 }

 public static class Extra {
 public static final String FRAGMENT_INDEX = &quot;com.nostra13.example.universalimageloader.FRAGMENT_INDEX&quot;;
 public static final String IMAGE_POSITION = &quot;com.nostra13.example.universalimageloader.IMAGE_POSITION&quot;;
 }[/java]

UILApplication类提供了初始化UIL的操作，这部分不再述说，其中初始化的option根据自己项目的需要去定制。

程序运行，进入HomeActivity，首先程序从Assert目录拷贝了一张图片到SD卡，用来测试。接着是按钮的点击事件，将相应的Fragment的index传入做出跳转。在返回键的重写方法中，停止了ImageLoader.Menu按键的两个item点击事件分别是清除内存缓存和SD卡缓存。

[java]public class HomeActivity extends Activity {

private static final String TEST_FILE_NAME = &quot;Universal Image Loader @#&amp;=+-_.,!()~'%20.png&quot;;

@Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.ac_home);

File testImageOnSdCard = new File(&quot;/mnt/sdcard&quot;, TEST_FILE_NAME);
 if (!testImageOnSdCard.exists()) {
 copyTestImageToSdCard(testImageOnSdCard);
 }
 }

public void onImageListClick(View view) {
 Intent intent = new Intent(this, SimpleImageActivity.class);
 intent.putExtra(Constants.Extra.FRAGMENT_INDEX, ImageListFragment.INDEX);
 startActivity(intent);
 }

public void onImageGridClick(View view) {
 Intent intent = new Intent(this, SimpleImageActivity.class);
 intent.putExtra(Constants.Extra.FRAGMENT_INDEX, ImageGridFragment.INDEX);
 startActivity(intent);
 }

public void onImagePagerClick(View view) {
 Intent intent = new Intent(this, SimpleImageActivity.class);
 intent.putExtra(Constants.Extra.FRAGMENT_INDEX, ImagePagerFragment.INDEX);
 startActivity(intent);
 }

public void onImageGalleryClick(View view) {
 Intent intent = new Intent(this, SimpleImageActivity.class);
 intent.putExtra(Constants.Extra.FRAGMENT_INDEX, ImageGalleryFragment.INDEX);
 startActivity(intent);
 }

public void onFragmentsClick(View view) {
 Intent intent = new Intent(this, ComplexImageActivity.class);
 startActivity(intent);
 }

@Override
 public void onBackPressed() {
 ImageLoader.getInstance().stop();
 super.onBackPressed();
 }

@Override
 public boolean onCreateOptionsMenu(Menu menu) {
 getMenuInflater().inflate(R.menu.main_menu, menu);
 return true;
 }

@Override
 public boolean onOptionsItemSelected(MenuItem item) {
 switch (item.getItemId()) {
 case R.id.item_clear_memory_cache:
 ImageLoader.getInstance().clearMemoryCache();
 return true;
 case R.id.item_clear_disc_cache:
 ImageLoader.getInstance().clearDiskCache();
 return true;
 default:
 return false;
 }
 }

private void copyTestImageToSdCard(final File testImageOnSdCard) {
 new Thread(new Runnable() {
 @Override
 public void run() {
 try {
 InputStream is = getAssets().open(TEST_FILE_NAME);
 FileOutputStream fos = new FileOutputStream(testImageOnSdCard);
 byte[] buffer = new byte[8192];
 int read;
 try {
 while ((read = is.read(buffer)) != -1) {
 fos.write(buffer, 0, read);
 }
 } finally {
 fos.flush();
 fos.close();
 is.close();
 }
 } catch (IOException e) {
 L.w(&quot;Can't copy test image onto SD card&quot;);
 }
 }
 }).start();
 }
}[/java]

从HomeActivity进入到SimpleImageActivity，该类继承自FragmentActivity，提供管理Fragment（根据HomeActivity传进来的Index索引去管理）。

[java]public class SimpleImageActivity extends FragmentActivity {
 @Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

int frIndex = getIntent().getIntExtra(Constants.Extra.FRAGMENT_INDEX, 0);
 Fragment fr;
 String tag;
 int titleRes;
 switch (frIndex) {
 default:
 case ImageListFragment.INDEX:
 tag = ImageListFragment.class.getSimpleName();
 fr = getSupportFragmentManager().findFragmentByTag(tag);
 if (fr == null) {
 fr = new ImageListFragment();
 }
 titleRes = R.string.ac_name_image_list;
 break;
 case ImageGridFragment.INDEX:
 tag = ImageGridFragment.class.getSimpleName();
 fr = getSupportFragmentManager().findFragmentByTag(tag);
 if (fr == null) {
 fr = new ImageGridFragment();
 }
 titleRes = R.string.ac_name_image_grid;
 break;
 case ImagePagerFragment.INDEX:
 tag = ImagePagerFragment.class.getSimpleName();
 fr = getSupportFragmentManager().findFragmentByTag(tag);
 if (fr == null) {
 fr = new ImagePagerFragment();
 fr.setArguments(getIntent().getExtras());
 }
 titleRes = R.string.ac_name_image_pager;
 break;
 case ImageGalleryFragment.INDEX:
 tag = ImageGalleryFragment.class.getSimpleName();
 fr = getSupportFragmentManager().findFragmentByTag(tag);
 if (fr == null) {
 fr = new ImageGalleryFragment();
 }
 titleRes = R.string.ac_name_image_gallery;
 break;
 }

setTitle(titleRes);
 getSupportFragmentManager().beginTransaction().replace(android.R.id.content, fr, tag).commit();
 }
}[/java]

进入到ImageListFragment类，该类继承自：AbsListViewBaseFragment，AbsListViewBaseFragment继承自：BaseFragment，BaseFragment是一个抽象类，继承自Fragment，他的代码如下：

[java]public abstract class BaseFragment extends Fragment {
 @Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

//必须在这里使用
 setHasOptionsMenu(true);
 }

public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
 inflater.inflate(R.menu.main_menu, menu);
 }

@Override
 public boolean onOptionsItemSelected(MenuItem item) {
 switch (item.getItemId()) {
 case R.id.item_clear_memory_cache:
 ImageLoader.getInstance().clearMemoryCache();
 return true;
 case R.id.item_clear_disc_cache:
 ImageLoader.getInstance().clearDiskCache();
 return true;
 default:
 return false;
 }
 }
}[/java]

在这里主要做了setHasOptionsMenu这么一个方法，该方法需要在onCreate（）方法中设置。

AbsListViewBaseFragment也是抽象类，在该类中，主要处理Scroll和Fling的事件，是否在Scroll和Fling的时候停止加载图片：

[java]public abstract class AbsListViewBaseFragment extends BaseFragment {

protected static final String STATE_PAUSE_ON_SCROLL = &quot;STATE_PAUSE_ON_SCROLL&quot;;
 protected static final String STATE_PAUSE_ON_FLING = &quot;STATE_PAUSE_ON_FLING&quot;;

protected AbsListView listView;

protected boolean pauseOnScroll = false;
 protected boolean pauseOnFling = true;

@Override
 public void onResume() {
 super.onResume();
 applyScrollListener();
 }

@Override
 public void onPrepareOptionsMenu(Menu menu) {
 MenuItem pauseOnScrollItem = menu.findItem(R.id.item_pause_on_scroll);
 pauseOnScrollItem.setVisible(true);
 pauseOnScrollItem.setChecked(pauseOnScroll);

MenuItem pauseOnFlingItem = menu.findItem(R.id.item_pause_on_fling);
 pauseOnFlingItem.setVisible(true);
 pauseOnFlingItem.setChecked(pauseOnFling);
 }

@Override
 public boolean onOptionsItemSelected(MenuItem item) {
 switch (item.getItemId()) {
 case R.id.item_pause_on_scroll:
 pauseOnScroll = !pauseOnScroll;
 item.setChecked(pauseOnScroll);
 applyScrollListener();
 return true;
 case R.id.item_pause_on_fling:
 pauseOnFling = !pauseOnFling;
 item.setChecked(pauseOnFling);
 applyScrollListener();
 return true;
 default:
 return super.onOptionsItemSelected(item);
 }
 }

protected void startImagePagerActivity(int position) {
 Intent intent = new Intent(getActivity(), SimpleImageActivity.class);
 intent.putExtra(Constants.Extra.FRAGMENT_INDEX, ImagePagerFragment.INDEX);
 intent.putExtra(Constants.Extra.IMAGE_POSITION, position);
 startActivity(intent);
 }

private void applyScrollListener() {
 listView.setOnScrollListener(new PauseOnScrollListener(ImageLoader.getInstance(), pauseOnScroll, pauseOnFling));
 }
}[/java]

ImageListFragment的源码为：

[java]public class ImageListFragment extends AbsListViewBaseFragment {

public static final int INDEX = 0;

String[] imageUrls = Constants.IMAGES;

DisplayImageOptions options;

@Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

options = new DisplayImageOptions.Builder()
 .showImageOnLoading(R.drawable.ic_stub)
 .showImageForEmptyUri(R.drawable.ic_empty)
 .showImageOnFail(R.drawable.ic_error)
 .cacheInMemory(true)
 .cacheOnDisk(true)
 .considerExifParams(true)
 .displayer(new RoundedBitmapDisplayer(20))
 .build();
 }

@Override
 public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 View rootView = inflater.inflate(R.layout.fr_image_list, container, false);
 listView = (ListView) rootView.findViewById(android.R.id.list);
 ((ListView) listView).setAdapter(new ImageAdapter());
 listView.setOnItemClickListener(new OnItemClickListener() {
 @Override
 public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
 startImagePagerActivity(position);
 }
 });
 return rootView;
 }

@Override
 public void onDestroy() {
 super.onDestroy();
 AnimateFirstDisplayListener.displayedImages.clear();
 }

private static class ViewHolder {
 TextView text;
 ImageView image;
 }

class ImageAdapter extends BaseAdapter {

private LayoutInflater inflater;
 private ImageLoadingListener animateFirstListener = new AnimateFirstDisplayListener();

ImageAdapter() {
 inflater = LayoutInflater.from(getActivity());
 }

@Override
 public int getCount() {
 return imageUrls.length;
 }

@Override
 public Object getItem(int position) {
 return position;
 }

@Override
 public long getItemId(int position) {
 return position;
 }

@Override
 public View getView(final int position, View convertView, ViewGroup parent) {
 View view = convertView;
 final ViewHolder holder;
 if (convertView == null) {
 view = inflater.inflate(R.layout.item_list_image, parent, false);
 holder = new ViewHolder();
 holder.text = (TextView) view.findViewById(R.id.text);
 holder.image = (ImageView) view.findViewById(R.id.image);
 view.setTag(holder);
 } else {
 holder = (ViewHolder) view.getTag();
 }

holder.text.setText(&quot;Item &quot; + (position + 1));

ImageLoader.getInstance().displayImage(imageUrls[position], holder.image, options, animateFirstListener);

return view;
 }
 }

private static class AnimateFirstDisplayListener extends SimpleImageLoadingListener {

static final List&lt;String&gt; displayedImages = Collections.synchronizedList(new LinkedList&lt;String&gt;());

@Override
 public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) {
 if (loadedImage != null) {
 ImageView imageView = (ImageView) view;
 boolean firstDisplay = !displayedImages.contains(imageUri);
 if (firstDisplay) {
 FadeInBitmapDisplayer.animate(imageView, 500);
 displayedImages.add(imageUri);
 }
 }
 }
 }
}[/java]

ImageGridFragment的源码，此处留意下，图片显示的错乱他是如何解决的：

[java]public class ImageGridFragment extends AbsListViewBaseFragment {

public static final int INDEX = 1;

String[] imageUrls = Constants.IMAGES;

DisplayImageOptions options;

@Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

options = new DisplayImageOptions.Builder()
 .showImageOnLoading(R.drawable.ic_stub)
 .showImageForEmptyUri(R.drawable.ic_empty)
 .showImageOnFail(R.drawable.ic_error)
 .cacheInMemory(true)
 .cacheOnDisk(true)
 .considerExifParams(true)
 .bitmapConfig(Bitmap.Config.RGB_565)
 .build();
 }

@Override
 public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 View rootView = inflater.inflate(R.layout.fr_image_grid, container, false);
 listView = (GridView) rootView.findViewById(R.id.grid);
 ((GridView) listView).setAdapter(new ImageAdapter());
 listView.setOnItemClickListener(new OnItemClickListener() {
 @Override
 public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
 startImagePagerActivity(position);
 }
 });
 return rootView;
 }

public class ImageAdapter extends BaseAdapter {

private LayoutInflater inflater;

ImageAdapter() {
 inflater = LayoutInflater.from(getActivity());
 }

@Override
 public int getCount() {
 return imageUrls.length;
 }

@Override
 public Object getItem(int position) {
 return null;
 }

@Override
 public long getItemId(int position) {
 return position;
 }

@Override
 public View getView(int position, View convertView, ViewGroup parent) {
 final ViewHolder holder;
 View view = convertView;
 if (view == null) {
 view = inflater.inflate(R.layout.item_grid_image, parent, false);
 holder = new ViewHolder();
 assert view != null;
 holder.imageView = (ImageView) view.findViewById(R.id.image);
 holder.progressBar = (ProgressBar) view.findViewById(R.id.progress);
 view.setTag(holder);
 } else {
 holder = (ViewHolder) view.getTag();
 }

ImageLoader.getInstance()
 .displayImage(imageUrls[position], holder.imageView, options, new SimpleImageLoadingListener() {
 @Override
 public void onLoadingStarted(String imageUri, View view) {
 holder.progressBar.setProgress(0);
 holder.progressBar.setVisibility(View.VISIBLE);
 }

@Override
 public void onLoadingFailed(String imageUri, View view, FailReason failReason) {
 holder.progressBar.setVisibility(View.GONE);
 }

@Override
 public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) {
 holder.progressBar.setVisibility(View.GONE);
 }
 }, new ImageLoadingProgressListener() {
 @Override
 public void onProgressUpdate(String imageUri, View view, int current, int total) {
 holder.progressBar.setProgress(Math.round(100.0f * current / total));
 }
 });

return view;
 }
 }

static class ViewHolder {
 ImageView imageView;
 ProgressBar progressBar;
 }
}[/java]

ImagePagerFragment处理稍微复杂些：

[java]public class ImagePagerFragment extends BaseFragment {

public static final int INDEX = 2;

String[] imageUrls = Constants.IMAGES;

DisplayImageOptions options;

@Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

options = new DisplayImageOptions.Builder()
 .showImageForEmptyUri(R.drawable.ic_empty)
 .showImageOnFail(R.drawable.ic_error)
 .resetViewBeforeLoading(true)
 .cacheOnDisk(true)
 .imageScaleType(ImageScaleType.EXACTLY)
 .bitmapConfig(Bitmap.Config.RGB_565)
 .considerExifParams(true)
 .displayer(new FadeInBitmapDisplayer(300))
 .build();
 }

@Override
 public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 View rootView = inflater.inflate(R.layout.fr_image_pager, container, false);
 ViewPager pager = (ViewPager) rootView.findViewById(R.id.pager);
 pager.setAdapter(new ImageAdapter());
 pager.setCurrentItem(getArguments().getInt(Constants.Extra.IMAGE_POSITION, 0));
 return rootView;
 }

private class ImageAdapter extends PagerAdapter {

private LayoutInflater inflater;

ImageAdapter() {
 inflater = LayoutInflater.from(getActivity());
 }

@Override
 public void destroyItem(ViewGroup container, int position, Object object) {
 container.removeView((View) object);
 }

@Override
 public int getCount() {
 return imageUrls.length;
 }

@Override
 public Object instantiateItem(ViewGroup view, int position) {
 View imageLayout = inflater.inflate(R.layout.item_pager_image, view, false);
 assert imageLayout != null;
 ImageView imageView = (ImageView) imageLayout.findViewById(R.id.image);
 final ProgressBar spinner = (ProgressBar) imageLayout.findViewById(R.id.loading);

ImageLoader.getInstance().displayImage(imageUrls[position], imageView, options, new SimpleImageLoadingListener() {
 @Override
 public void onLoadingStarted(String imageUri, View view) {
 spinner.setVisibility(View.VISIBLE);
 }

@Override
 public void onLoadingFailed(String imageUri, View view, FailReason failReason) {
 String message = null;
 switch (failReason.getType()) {
 case IO_ERROR:
 message = &quot;Input/Output error&quot;;
 break;
 case DECODING_ERROR:
 message = &quot;Image can't be decoded&quot;;
 break;
 case NETWORK_DENIED:
 message = &quot;Downloads are denied&quot;;
 break;
 case OUT_OF_MEMORY:
 message = &quot;Out Of Memory error&quot;;
 break;
 case UNKNOWN:
 message = &quot;Unknown error&quot;;
 break;
 }
 Toast.makeText(getActivity(), message, Toast.LENGTH_SHORT).show();

spinner.setVisibility(View.GONE);
 }

@Override
 public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) {
 spinner.setVisibility(View.GONE);
 }
 });

view.addView(imageLayout, 0);
 return imageLayout;
 }

@Override
 public boolean isViewFromObject(View view, Object object) {
 return view.equals(object);
 }

@Override
 public void restoreState(Parcelable state, ClassLoader loader) {
 }

@Override
 public Parcelable saveState() {
 return null;
 }
 }
}[/java]

Gallery不做说明了。ListView和GridView混合模式参考源码。

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>419</wp:post_id>
		<wp:post_date>2015-03-24 10:20:52</wp:post_date>
		<wp:post_date_gmt>2015-03-24 02:20:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-universal-image-loader-demo%e5%88%86%e6%9e%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="post_tag" nicename="uil"><![CDATA[UIL]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707560]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>AndroidAnnotations框架</title>
		<link>http://1.duoinfo.sinaapp.com/?p=421</link>
		<pubDate>Tue, 24 Mar 2015 03:17:11 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=421</guid>
		<description></description>
		<content:encoded><![CDATA[开源的github地址：<a title="https://github.com/excilys/androidannotations" href="https://github.com/excilys/androidannotations" target="_blank">https://github.com/excilys/androidannotations</a>

<strong>AndroidAnnotations</strong> is an Open Source framework that <strong>speeds up</strong> Android development. It takes care of the <strong>plumbing</strong>, and lets you concentrate on what's really important. By <strong>simplifying</strong> your code, it facilitates its <strong>maintenance</strong>.
<h1>Goals</h1>
We want to facilitate the <strong>writing</strong> and the <strong>maintenance</strong> of Android applications.

We believe that simple code with <strong>clear intents</strong> is the best way to achieve those goals.

While we all enjoy developing Android applications, we often wonder: Why do we always need to write the same code over and over? Why are our apps harder and harder to maintain? <code>Context</code> and <code>Activity</code> <strong>god objects</strong>, complexity of juggling with <strong>threads</strong>, hard to discover API, loads of <strong>anonymous listener classes</strong>, tons of unneeded <strong>casts</strong>... can't we improve that?（提升开发效率）
<h1>How</h1>
Using <strong>Java annotations</strong>, developers can show their <strong>intent</strong> and let AndroidAnnotations generate the <strong>plumbing</strong> code at <strong>compile time</strong>.
<h1>Features</h1>
<ul>
	<li><strong>Dependency injection</strong>: inject views, extras, system services, resources, ...（注入）</li>
	<li><strong>Simplified threading model</strong>: annotate your methods so that they execute on the UI thread or on a background thread.（简化的线程模型）</li>
	<li><strong>Event binding</strong>: annotate methods to handle events on views, <strong>no more ugly anonymous listener classes</strong>!（事件绑定）</li>
	<li><strong>REST client</strong>: create a client interface, AndroidAnnotations generates the implementation.</li>
	<li><strong>No magic</strong>: As AndroidAnnotations generate subclasses at compile time, you can check the code to see how it works.</li>
	<li>AndroidAnnotations provide those good things and even more for <strong>less than 50kb</strong>, without any runtime <a href="https://github.com/excilys/androidannotations/wiki/FAQ#wiki-perf-impact">perf impact</a>!</li>
</ul>
Is your Android code easy to <strong>write</strong>, read, and <strong>maintain</strong>?

Look at that:
<div>[java]@EActivity(R.layout.translate) // Sets content view to R.layout.translate
public class TranslateActivity extends Activity {

    @ViewById // Injects R.id.textInput
    EditText textInput;

    @ViewById(R.id.myTextView) // Injects R.id.myTextView
    TextView result;

    @AnimationRes // Injects android.R.anim.fade_in
    Animation fadeIn;

    @Click // When R.id.doTranslate button is clicked 
    void doTranslate() {
         translateInBackground(textInput.getText().toString());
    }

    @Background // Executed in a background thread
    void translateInBackground(String textToTranslate) {
         String translatedText = callGoogleTranslate(textToTranslate);
         showResult(translatedText);
    }

    @UiThread // Executed in the ui thread
    void showResult(String translatedText) {
         result.setText(translatedText);
         result.startAnimation(fadeIn);
    }

    // [...]
}[/java]
<h1>原理：</h1>
<strong>AndroidAnnotations</strong> works in a very simple way. It automatically adds an extra compilation step that generates source code, using the standard <a href="http://download.oracle.com/javase/6/docs/technotes/guides/apt/index.html">Java Annotation Processing Tool</a>.

What source code ? For each enhanced class, for example each <code>@EActivity</code> annotated activity, a subclass of this activity is generated, with the same name plus an underscore appended at the end.（在类名的后面添加了一个下划线）

For instance, the following class:
<div>[java]package com.some.company;
@EActivity
public class MyActivity extends Activity {
  // ...
}[/java]

</div>
Will generate the following subclass, in the same package but in another source folder:
<div>[java]package com.some.company;
public final class MyActivity_ extends MyActivity {
  // ...
}[/java]

</div>
This subclass adds behavior to your activity by overriding some methods (for instance<code>onCreate()</code>), yet delegating the calls to super.

That is the reason why you must add <code>_</code> to your activity names in <code>AndroidManifest.xml</code>:
<div>[xml]&lt;activity android:name=&quot;.MyListActivity_&quot; /&gt;[/xml]

配置的时候，需要使用带下划线的。</pre>
<h2>Starting an annotated activity</h2>
In Android, you usually start an activity this way:
<div>[java]startActivity(this, MyListActivity.class);[/java]

</div>
However, with <strong>AndroidAnnotations</strong>, the real activity that must be started is<code>MyListActivity_</code>:
<div>[java]startActivity(this, MyListActivity_.class);[/java]

</div>
<h3>Intent Builder</h3>
<blockquote>Since AndroidAnnotations <strong>2.4</strong></blockquote>
We provide a static helper to let you start the generated activity:
<div>[java]// Starting the activity
MyListActivity_.intent(context).start();

// Building an intent from the activity
Intent intent = MyListActivity_.intent(context).get();

// You can provide flags
MyListActivity_.intent(context).flags(FLAG_ACTIVITY_CLEAR_TOP).start();

// You can even provide extras defined with @Extra in the activity
MyListActivity_.intent(context).myDateExtra(someDate).start();&lt;/pre&gt;
&lt;/div&gt;
&lt;blockquote&gt;
Since AndroidAnnotations &lt;strong&gt;2.7&lt;/strong&gt;&lt;/blockquote&gt;
You can also use the &lt;code&gt;startActivityForResult()&lt;/code&gt; equivalent:
&lt;div&gt;
&lt;pre&gt;MyListActivity_.intent(context).startForResult();[/java]

</div>
<h2>Starting an annotated Service</h2>

In Android, you usually start a service this way:

<div>[java]startService(this, MyService.class);[/java]

</div>

However, with <strong>AndroidAnnotations</strong>, the real Service that must be started is <code>MyService_</code>:

<div>[java]startService(this, MyService_.class);[/java]

</div>
<h3>Intent Builder</h3>
<blockquote>
Since AndroidAnnotations <strong>2.7</strong>
</blockquote>

We provide a static helper to let you start the generated service:

<div>[java]// Starting the service
MyService_.intent(context).start();

// Building an intent from the activity
Intent intent = MyService_.intent(context).build();

// You can provide flags
MyService_.intent(context).flags(Intent.FLAG_GRANT_READ_URI_PERMISSION).start();[/java]

详细的使用文档在这里：<a title="https://github.com/excilys/androidannotations/wiki/Cookbook" href="https://github.com/excilys/androidannotations/wiki/Cookbook" target="_blank">https://github.com/excilys/androidannotations/wiki/Cookbook</a></pre>
</div>
</div>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>421</wp:post_id>
		<wp:post_date>2015-03-24 11:17:11</wp:post_date>
		<wp:post_date_gmt>2015-03-24 03:17:11</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>androidannotations%e6%a1%86%e6%9e%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="post_tag" nicename="androidannotations%e6%a1%86%e6%9e%b6"><![CDATA[Annotations]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707561]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>AndroidAnnotations框架demo</title>
		<link>http://1.duoinfo.sinaapp.com/?p=425</link>
		<pubDate>Tue, 24 Mar 2015 03:39:34 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=425</guid>
		<description></description>
		<content:encoded><![CDATA[demo展示了 具体的用法：

程序运行，进入MyActivity：

[java]package org.androidannotations.helloworldeclipse;

import java.util.Date;
import java.util.concurrent.TimeUnit;

import org.androidannotations.annotations.Background;
import org.androidannotations.annotations.Click;
import org.androidannotations.annotations.EActivity;
import org.androidannotations.annotations.LongClick;
import org.androidannotations.annotations.SystemService;
import org.androidannotations.annotations.Touch;
import org.androidannotations.annotations.Transactional;
import org.androidannotations.annotations.UiThread;
import org.androidannotations.annotations.ViewById;
import org.androidannotations.annotations.res.BooleanRes;
import org.androidannotations.annotations.res.ColorRes;
import org.androidannotations.annotations.res.StringRes;

import android.app.Activity;
import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Intent;
import android.database.sqlite.SQLiteDatabase;
import android.os.Bundle;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

@EActivity(R.layout.my_activity)
public class MyActivity extends Activity {

@ViewById
 EditText myEditText;

@ViewById(R.id.myTextView)
 TextView textView;

@StringRes(R.string.hello)
 String helloFormat;

@ColorRes
 int androidColor;

@BooleanRes
 boolean someBoolean;

@SystemService
 NotificationManager notificationManager;

@SystemService
 WindowManager windowManager;

/**
 * AndroidAnnotations gracefully handles support for onBackPressed, whether you use ECLAIR (2.0), or pre ECLAIR android version.
 */
 public void onBackPressed() {
 Toast.makeText(this, &quot;Back key pressed!&quot;, Toast.LENGTH_SHORT).show();
 }

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 // windowManager should not be null
 windowManager.getDefaultDisplay();
 requestWindowFeature(Window.FEATURE_INDETERMINATE_PROGRESS);
 }

@Click
 void myButtonClicked() {
 String name = myEditText.getText().toString();
 setProgressBarIndeterminateVisibility(true);
 someBackgroundWork(name, 5);
 }

@Background
 void someBackgroundWork(String name, long timeToDoSomeLongComputation) {
 try {
 TimeUnit.SECONDS.sleep(timeToDoSomeLongComputation);
 } catch (InterruptedException e) {
 }

String message = String.format(helloFormat, name);

updateUi(message, androidColor);

showNotificationsDelayed();
 }

@UiThread
 void updateUi(String message, int color) {
 setProgressBarIndeterminateVisibility(false);
 textView.setText(message);
 textView.setTextColor(color);
 }

@UiThread(delay = 2000)
 void showNotificationsDelayed() {
 Notification notification = new Notification(R.drawable.icon, &quot;Hello !&quot;, 0);
 PendingIntent contentIntent = PendingIntent.getActivity(this, 0, new Intent(), 0);
 notification.setLatestEventInfo(getApplicationContext(), &quot;My notification&quot;, &quot;Hello World!&quot;, contentIntent);
 notificationManager.notify(1, notification);
 }

@LongClick
 void startExtraActivity() {
 Intent intent = ActivityWithExtra_.intent(this).myDate(new Date()).myMessage(&quot;hello !&quot;).get();
 intent.putExtra(ActivityWithExtra.MY_INT_EXTRA, 42);
 startActivity(intent);
 }

@Click
 void startListActivity(View v) {
 startActivity(new Intent(this, MyListActivity_.class));
 }

@Touch
 void myTextView(MotionEvent event) {
 Log.d(&quot;MyActivity&quot;, &quot;myTextView was touched!&quot;);
 }

@Transactional
 int transactionalMethod(SQLiteDatabase db, int someParam) {
 return 42;
 }

}[/java]

展示了各个用法，findViewById,setContentView，线程在后台运行，UI线程，事务等等用法。点击事件，触摸事件，资源,Intent的extras等等。

MyListActivity：展示了长按，选择，数组等等的用法。

[java]@EActivity
public class MyListActivity extends ListActivity {

@StringArrayRes
 String[] bestFoods;

private ListAdapter adapter;

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, bestFoods);
 setListAdapter(adapter);
 }

@ItemClick
 void listItemClicked(String food) {
 Toast.makeText(this, &quot;click: &quot; + food, Toast.LENGTH_SHORT).show();
 }

@ItemLongClick
 void listItemLongClicked(String food) {
 Toast.makeText(this, &quot;long click: &quot; + food, Toast.LENGTH_SHORT).show();
 }

@ItemSelect
 void listItemSelected(boolean somethingSelected, String food) {
 if (somethingSelected) {
 Toast.makeText(this, &quot;selected: &quot; + food, Toast.LENGTH_SHORT).show();
 } else {
 Toast.makeText(this, &quot;nothing selected&quot;, Toast.LENGTH_SHORT).show();
 }
 }

}[java]

ActivityWithExtra:

[java]@EActivity(R.layout.activity_with_extra)
public class ActivityWithExtra extends Activity {

public static final String MY_STRING_EXTRA = &quot;myStringExtra&quot;;
 public static final String MY_DATE_EXTRA = &quot;myDateExtra&quot;;
 public static final String MY_INT_EXTRA = &quot;myIntExtra&quot;;

@ViewById
 TextView extraTextView;

@Extra(MY_STRING_EXTRA)
 String myMessage;

@Extra(MY_DATE_EXTRA)
 Date myDate;

@Extra(&quot;unboundExtra&quot;)
 String unboundExtra = &quot;unboundExtraDefaultValue&quot;;

/**
 * The logs will output a classcast exception, but the program flow won't be interrupted
 */
 @Extra(MY_INT_EXTRA)
 String classCastExceptionExtra = &quot;classCastExceptionExtraDefaultValue&quot;;

@AfterViews
 protected void init() {
 extraTextView.setText(myMessage + &quot; &quot; + myDate + &quot; &quot; + unboundExtra + &quot; &quot; + classCastExceptionExtra);
 }

}[/java]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>425</wp:post_id>
		<wp:post_date>2015-03-24 11:39:34</wp:post_date>
		<wp:post_date_gmt>2015-03-24 03:39:34</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>androidannotations%e6%a1%86%e6%9e%b6demo</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="post_tag" nicename="androidannotations%e6%a1%86%e6%9e%b6"><![CDATA[Annotations]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707562]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>android-async-http框架</title>
		<link>http://1.duoinfo.sinaapp.com/?p=431</link>
		<pubDate>Wed, 25 Mar 2015 08:19:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=431</guid>
		<description></description>
		<content:encoded><![CDATA[github地址：<a title="https://github.com/loopj/android-async-http" href="https://github.com/loopj/android-async-http" target="_blank">https://github.com/loopj/android-async-http</a>
<h1>简介：</h1>
<pre>Android Asynchronous Http Client,A Callback-Based Http Client Library for Android.基于回调的Http Client库。</pre>
<h1>总览：</h1>
<pre>An asynchronous callback-based Http client for Android built on top of Apache’s <a href="http://hc.apache.org/httpcomponents-client-ga/">HttpClient</a> libraries. All requests are made outside of your app’s main UI thread, but any callback logic will be executed on the same thread as the callback was created using Android’s Handler message passing. You can also use it in Service or background thread, library will automatically recognize in which context is ran.
建立在Apache’s <a href="http://hc.apache.org/httpcomponents-client-ga/">HttpClient</a>的Library之上，他是基于回调的异步Http Client。所有的请求均在应用的主线程之外，任意回调事件的逻辑会和通过使用Android Handler传递消息创建的回调事件的同一个线程内执行。也可以在Service或者后台线程使用它。</pre>
<h1>特征：</h1>
<ul>
	<li>Make <strong>asynchronous</strong> HTTP requests, handle responses in <strong>anonymous callbacks（发起异步Http请求，在匿名的回调中处理请求）</strong></li>
	<li>HTTP requests happen <strong>outside the UI thread（请求在UI线程之外）</strong></li>
	<li>Requests use a <strong>threadpool</strong> to cap concurrent resource usage(请求使用一个线程池来处理并发资源的使用)</li>
	<li>GET/POST <strong>params builder</strong> (RequestParams)（参数）</li>
	<li><strong>Multipart file uploads</strong> with no additional third party libraries（多部分文件上传）</li>
	<li><strong>Streamed JSON uploads</strong> with no additional libraries（流式Json文件上传）</li>
	<li>Handling circular and relative redirects（处理圆形和相对重定向，不理解这句话的意思）</li>
	<li>Tiny size overhead to your application, only <strong>90kb</strong> for everything</li>
	<li>Automatic smart <strong>request retries</strong> optimized for spotty mobile connections（智能优化连接）</li>
	<li>Automatic <strong>gzip</strong> response decoding support for super-fast requests</li>
	<li>Binary protocol communication with <code>BinaryHttpResponseHandler</code></li>
	<li>Built-in response parsing into <strong>JSON</strong> with <code>JsonHttpResponseHandler</code></li>
	<li>Saving response directly into file with <code>FileAsyncHttpResponseHandler</code></li>
	<li><strong>Persistent cookie store</strong>, saves cookies into your app’s SharedPreferences（保存cookie信息到SharedPreferences）</li>
	<li>Integration with Jackson JSON, Gson or other JSON (de)serializing libraries with<code>BaseJsonHttpResponseHandler</code></li>
	<li>Support for SAX parser with <code>SaxAsyncHttpResponseHandler</code></li>
	<li>Support for languages and content encodings, not just UTF-8</li>
</ul>
<h1>用法：</h1>
Create a new <code>AsyncHttpClient</code> instance and make a request:

[java]AsyncHttpClient client = new AsyncHttpClient();

client.get(&quot;http://www.google.com&quot;, new AsyncHttpResponseHandler() {

@Override

public void onStart() {

// called before request is started

}

@Override

public void onSuccess(int statusCode, Header[] headers, byte[] response) {

// called when response HTTP status is &quot;200 OK&quot;

}

@Override

public void onFailure(int statusCode, Header[] headers, byte[] errorResponse, Throwable e) {

// called when response HTTP status is &quot;4XX&quot; (eg. 401, 403, 404)

}

@Override

public void onRetry(int retryNo) {

// called when request is retried

}

});[/java]

说明文档参见：<a title="http://loopj.com/android-async-http/" href="http://loopj.com/android-async-http/" target="_blank">http://loopj.com/android-async-http/</a>
<pre></pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>431</wp:post_id>
		<wp:post_date>2015-03-25 16:19:32</wp:post_date>
		<wp:post_date_gmt>2015-03-25 08:19:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-async-http%e6%a1%86%e6%9e%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707564]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Java安全通信：HTTPS与SSL</title>
		<link>http://1.duoinfo.sinaapp.com/?p=434</link>
		<pubDate>Thu, 26 Mar 2015 00:26:17 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=434</guid>
		<description></description>
		<content:encoded><![CDATA[1. HTTPS概念

1）简介

HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的<a href="http://baike.baidu.com/view/9472.htm" target="_blank">HTTP</a>通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。这个系统的最初研发由网景公司进行，提供了身份验证与加密<a href="http://baike.baidu.com/view/20429.htm" target="_blank">通讯</a>方法，现在它被广泛用于<a href="http://baike.baidu.com/view/7833.htm" target="_blank">万维网</a>上安全敏感的通讯，例如交易支付方面。

2）HTTPS和HTTP的区别

a. https协议需要到ca申请证书，一般免费证书很少，需要交费。

b. http是<a href="http://baike.baidu.com/view/468465.htm" target="_blank">超文本传输协议</a>，信息是明文传输；https 则是具有<a href="http://baike.baidu.com/view/421194.htm" target="_blank">安全性</a>的ssl加密传输协议。

c. http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

d. http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的<a href="http://baike.baidu.com/view/16603.htm" target="_blank">网络协议</a>，比http协议安全。

3）HTTPS的作用

它的主要作用可以分为两种：一种是建立一个<a href="http://baike.baidu.com/view/17249.htm" target="_blank">信息安全</a>通道，来保证数据传输的安全；另一种就是确认网站的真实性。

a． 一般意义上的https，就是服务器有一个证书。主要目的是保证服务器就是他声称的服务器，这个跟第一点一样；<a href="http://baike.baidu.com/view/1087294.htm" target="_blank">服务端</a>和客户端之间的所有<a href="http://baike.baidu.com/view/20429.htm" target="_blank">通讯</a>，都是加密的。

b. 具体讲，是客户端产生一个对称的<a href="http://baike.baidu.com/view/934.htm" target="_blank">密钥</a>，通过服务器的证书来交换密钥，即一般意义上的握手过程。

c. 接下来所有的信息往来就都是加密的。第三方即使截获，也没有任何意义，因为他没有密钥，当然篡改也就没有什么意义了。

d．少许对客户端有要求的情况下，会要求客户端也必须有一个证书。

这里客户端证书，其实就类似表示个人信息的时候，除了用户名/密码，还有一个CA 认证过的身份。因为个人证书一般来说是别人无法模拟的，所有这样能够更深的确认自己的身份。目前少数个人银行的专业版是这种做法，具体证书可能是拿U盘（即U盾）作为一个备份的载体。

2.SSL简介

1）简介

SSL (Secure Socket Layer)为Netscape所研发，用以保障在Internet上数据传输之安全，利用数据加密(Encryption)技术，可确保数据在网络上之传输过程中不会被截取及窃听。它已被广泛地用于Web浏览器与服务器之间的身份认证和加密数据传输。SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。

2）SSL提供的服务

a.认证用户和服务器，确保数据发送到正确的<a href="http://baike.baidu.com/view/285153.htm" target="_blank">客户机</a>和服务器

b.加密数据以防止数据中途被窃取

c.维护数据的完整性，确保数据在传输过程中不被改变。

3) SSL协议的握手过程

SSL 协议既用到了公钥加密技术又用到了对称加密技术，对称加密技术虽然比公钥加密技术的速度快，可是公钥加密技术提供了更好的身份认证技术。SSL 的握手协议非常有效的让客户和服务器之间完成相互之间的身份认证，其主要过程如下：

①客户端的浏览器向服务器传送客户端SSL 协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息。

②服务器向客户端传送SSL 协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书。

③客户利用服务器传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发行服务器证书的CA 是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开；如果合法性验证通过，将继续进行第四步。

④用户端随机产生一个用于后面通讯的“对称密码”，然后用服务器的公钥（服务器的公钥从步骤②中的服务器的证书中获得）对其加密，然后传给服务器。

⑤服务器用私钥解密“对称密码”(此处的公钥和私钥是相互关联的，公钥加密的数据只能用私钥解密，私钥只在服务器端保留。详细请参看： <a href="http://zh.wikipedia.org/wiki/RSA%E7%AE%97%E6%B3%95">http://zh.wikipedia.org/wiki/RSA%E7%AE%97%E6%B3%95</a>)，然后用其作为服务器和客户端的“通话密码”加解密通讯。同时在SSL 通讯过程中还要完成数据通讯的完整性，防止数据通讯中的任何变化。

⑥客户端向服务器端发出信息，指明后面的数据通讯将使用的步骤⑤中的主密码为对称密钥，同时通知服务器客户端的握手过程结束。

⑦服务器向客户端发出信息，指明后面的数据通讯将使用的步骤⑤中的主密码为对称密钥，同时通知客户端服务器端的握手过程结束。

⑧SSL 的握手部分结束，SSL 安全通道的数据通讯开始，客户和服务器开始使用相同的对称密钥进行数据通讯，同时进行通讯完整性的检验。

<img src="http://pic002.cnblogs.com/images/2012/267603/2012022815142423.gif" alt="" />
<div id="cnblogs_post_body">

3.配置服务器端证书

为了能实施SSL，一个web服务器对每个接受安全连接的外部接口(IP 地址)必须要有相应的证书(Certificate)。关于这个设计的理论是一个服务器必须提供某种合理的保证以证明这个服务器的主人就是你所认为的那个人。这个证书要陈述与这个网站相关联的公司，以及这个网站的所有者或系统管理员的一些基本联系信息。

这个证书由所有人以密码方式签字，其他人非常难伪造。对于进行电子商务(e-commerce)的网站，或其他身份认证至关重要的任何商业交易，认证书要向大家所熟知的认证权威(Certificate Authority (CA))如VeriSign或Thawte来购买。这样的证书可用电子技术证明属实。实际上，认证权威单位会担保它发出的认证书的真实性，如果你信任发出认证书的认证权威单位的话，你就可以相信这个认证书是有效的。

关于权威证书的申请，请参考：<a href="http://www.cnblogs.com/mikespook/archive/2004/12/22/80591.aspx">http://www.cnblogs.com/mikespook/archive/2004/12/22/80591.aspx</a>

在许多情况下，认证并不是真正使人担忧的事。系统管理员或许只想要保证被服务器传送和接收的数据是秘密的，不会被连接线上的偷窃者盗窃到。庆幸的是，Java提供相对简单的被称为keytool的命令行工具，可以简单地产生“自己签名”的证书。自己签名的证书只是用户产生的证书，没有正式在大家所熟知的认证权威那里注册过，因此不能确保它的真实性。但却能保证数据传输的安全性。

用Tomcat来配置SSL主要有下面这么两大步骤：

1)生成证书

a. 在命令行下执行：

%Java_home%\bin\keytool -genkey -alias tomcat -keyalg RSA

在此命令中，keytool是JDK自带的产生证书的工具。把RSA运算法则作为主要安全运算法则，这保证了与其它服务器和组件的兼容性。

这个命令会在用户的home directory产生一个叫做" .keystore " 的新文件。在执行后，你首先被要求出示keystore密码。Tomcat使用的默认密码是" changeit "(全都是小写字母)，如果你愿意，你可以指定你自己的密码。你还需要在server.xml配置文件里指定自己的密码，这在以后会有描述。

b .你会被要求出示关于这个认证书的一般性信息，如公司，联系人名称，等等。这些信息会显示给那些试图访问你程序里安全网页的用户，以确保这里提供的信息与他们期望的相对应。

c.你会被要求出示密钥(key)密码，也就是这个认证书所特有的密码(与其它的储存在同一个keystore文件里的认证书不同)。你必须在这里使用与keystore密码相同的密码。(目前，keytool会提示你按ENTER键会自动帮你做这些)。

如果一切顺利，你现在就拥有了一个可以被你的服务器使用的有认证书的keystore文件。

2) 配置tomcat

第二个大步骤是把secure socket配置在$CATALINA_HOME/conf/server.xml文件里。$CATALINA_HOME代表安装Tomcat的目录。一个例子是SSL连接器的元素被包括在和Tomcat一起安装的缺省server.xml文件里。它看起来象是这样：

$CATALINA_HOME/conf/server.xml
<div>
<div>[xml]&lt; -- Define a SSL Coyote HTTP/1.1 Connector on port 8443 --&gt;&lt;/span&gt;&lt;/div&gt;
&lt;pre&gt;
&lt; !--

&lt; Connector

port=&quot;8443&quot; minProcessors=&quot;5&quot; maxProcessors=&quot;75&quot;

enableLookups=&quot;true&quot; disableUploadTimeout=&quot;true&quot;

acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;;

clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot;/&gt;

--&gt;[/xml]

</div>
Connector元素本身，其默认形式是被注释掉的(commented out)，所以需要把它周围的注释标志删除掉。然后，可以根据需要客户化(自己设置)特定的属性。一般需要增加一下keystoreFile和keystorePass两个属性，指定你存放证书的路径（如：keystoreFile="C:/.keystore"）和刚才设置的密码（如：keystorePass="123456"）。关于其它各种选项的详细信息，可查阅Server Configuration Reference。

在完成这些配置更改后，必须象重新启动Tomcat，然后你就可以通过SSL访问Tomcat支持的任何web应用程序。只不过指令需要像下面这样：https://localhost:8443

4.客户端代码实现

在Java中要访问Https链接时，会用到一个关键类<strong>HttpsURLConnection</strong>；参见如下实现代码：
<div>[java]// 创建URL对象
        URL myURL = new URL(&quot;https://www.sun.com&quot;);

        // 创建HttpsURLConnection对象，并设置其SSLSocketFactory对象
        HttpsURLConnection httpsConn = (HttpsURLConnection) myURL.openConnection();

        // 取得该连接的输入流，以读取响应内容
        InputStreamReader insr = new InputStreamReader(httpsConn.getInputStream());

        // 读取服务器的响应内容并显示
        int respInt = insr.read();
        while (respInt != -1) {
            System.out.print((char) respInt);
            respInt = insr.read();
        }[/java]

</div>
在取得connection的时候和正常浏览器访问一样，仍然会<strong>验证服务端的证书是否被信任</strong>（权威机构发行或者被权威机构签名）；如果服务端证书不被信任，则默认的实现就会有问题，一般来说，用<strong>SunJSSE</strong>会抛如下异常信息：
<div>
<div>
<div id="highlighter_769069">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>
<div><code>javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building </code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<div id="highlighter_181934">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>
<div><code>failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
上面提到SunJSSE，JSSE（Java Secure Socket Extension）是实现Internet安全通信的一系列包的集合。它是一个SSL和TLS的纯Java实现，可以透明地提供数据加密、服务器认证、信息完整性等功能，可以使我们像使用普通的套接字一样使用JSSE建立的安全套接字。JSSE是一个开放的标准，不只是Sun公司才能实现一个SunJSSE，事实上其他公司有自己实现的JSSE，然后通过JCA就可以在JVM中使用。

关于JSSE的详细信息参考官网Reference：<a href="http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html</a>；
以及Java Security Guide：<a href="http://java.sun.com/j2se/1.5.0/docs/guide/security/">http://java.sun.com/j2se/1.5.0/docs/guide/security/</a>；

在深入了解JSSE之前，需要了解一个有关Java安全的概念：客户端的TrustStore文件。客户端的TrustStore文件中保存着被客户端所信任的服务器的证书信息。客户端在进行SSL连接时，JSSE将根据这个文件中的证书决定是否信任服务器端的证书。在SunJSSE中，有一个信任管理器类负责决定是否信任远端的证书，这个类有如下的处理规则：
1)若系统属性<strong>javax.net.sll.trustStore</strong>指定了TrustStore文件，那么信任管理器就去jre安装路径下的lib/security/目录中寻找并使用这个文件来检查证书。
2)若该系统属性没有指定TrustStore文件，它就会去jre安装路径下寻找默认的TrustStore文件，这个文件的相对路径为：lib/security/<strong>jssecacerts</strong>。
3)若jssecacerts不存在，但是cacerts存在（它随J2SDK一起发行，含有数量有限的可信任的基本证书），那么这个默认的TrustStore文件就是lib/security/<strong>cacerts</strong>。

那遇到这种情况，怎么处理呢？有以下两种方案：
1)按照以上信任管理器的规则，<strong>将服务端的公钥导入到jssecacerts</strong>，或者是在系统属性中设置要加载的trustStore文件的路径；证书导入可以用如下命令：keytool -import -file src_cer_file –keystore dest_cer_store；至于证书可以通过浏览器导出获得；
2)、实现自己的证书信任管理器类，比如<strong>MyX509TrustManager</strong>，该类必须实现X509TrustManager接口中的三个method；然后在HttpsURLConnection中加载自定义的类，可以参见如下两个代码片段，其一为自定义证书信任管理器，其二为connect时的代码：
<div>[java]package test;
import java.io.FileInputStream;
import java.security.KeyStore;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import javax.net.ssl.TrustManager;
import javax.net.ssl.TrustManagerFactory;
import javax.net.ssl.X509TrustManager;
public class MyX509TrustManager implements X509TrustManager {
    /*
     * The default X509TrustManager returned by SunX509.  We'll delegate
     * decisions to it, and fall back to the logic in this class if the
     * default X509TrustManager doesn't trust it.
     */
    X509TrustManager sunJSSEX509TrustManager;
    MyX509TrustManager() throws Exception {
        // create a &quot;default&quot; JSSE X509TrustManager.
        KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
        ks.load(new FileInputStream(&quot;trustedCerts&quot;),
            &quot;passphrase&quot;.toCharArray());
        TrustManagerFactory tmf =
        TrustManagerFactory.getInstance(&quot;SunX509&quot;, &quot;SunJSSE&quot;);
        tmf.init(ks);
        TrustManager tms [] = tmf.getTrustManagers();
        /*
         * Iterate over the returned trustmanagers, look
         * for an instance of X509TrustManager.  If found,
         * use that as our &quot;default&quot; trust manager.
         */
        for (int i = 0; i &lt; tms.length; i++) {
            if (tms[i] instanceof X509TrustManager) {
                sunJSSEX509TrustManager = (X509TrustManager) tms[i];
                return;
            }
        }
        /*
         * Find some other way to initialize, or else we have to fail the
         * constructor.
         */
        throw new Exception(&quot;Couldn't initialize&quot;);
    }
    /*
     * Delegate to the default trust manager.
     */
    public void checkClientTrusted(X509Certificate[] chain, String authType)
                throws CertificateException {
        try {
            sunJSSEX509TrustManager.checkClientTrusted(chain, authType);
        } catch (CertificateException excep) {
            // do any special handling here, or rethrow exception.
        }
    }
    /*
     * Delegate to the default trust manager.
     */
    public void checkServerTrusted(X509Certificate[] chain, String authType)
                throws CertificateException {
        try {
            sunJSSEX509TrustManager.checkServerTrusted(chain, authType);
        } catch (CertificateException excep) {
            /*
             * Possibly pop up a dialog box asking whether to trust the
             * cert chain.
             */
        }
    }
    /*
     * Merely pass this through.
     */
    public X509Certificate[] getAcceptedIssuers() {
        return sunJSSEX509TrustManager.getAcceptedIssuers();
    }
}
        // 创建SSLContext对象，并使用我们指定的信任管理器初始化
        TrustManager[] tm = { new MyX509TrustManager() };
        SSLContext sslContext = SSLContext.getInstance(&quot;SSL&quot;, &quot;SunJSSE&quot;);
        sslContext.init(null, tm, new java.security.SecureRandom());
        // 从上述SSLContext对象中得到SSLSocketFactory对象
        SSLSocketFactory ssf = sslContext.getSocketFactory();
        // 创建URL对象
        URL myURL = new URL(&quot;https://ebanks.gdb.com.cn/sperbank/perbankLogin.jsp&quot;);
        // 创建HttpsURLConnection对象，并设置其SSLSocketFactory对象
        HttpsURLConnection httpsConn = (HttpsURLConnection) myURL.openConnection();
        httpsConn.setSSLSocketFactory(ssf);
        // 取得该连接的输入流，以读取响应内容
        InputStreamReader insr = new InputStreamReader(httpsConn.getInputStream());
        // 读取服务器的响应内容并显示
        int respInt = insr.read();
        while (respInt != -1) {
            System.out.print((char) respInt);
            respInt = insr.read();
        }[/java]

</div>
对于以上两种实现方式，各有各的优点，第一种方式<strong>不会破坏JSSE的安全性</strong>，但是要手工导入证书，如果服务器很多，那每台服务器的JRE都必须做相同的操作；第二种方式<strong>灵活性更高</strong>，但是要小心实现，否则可能会留下安全隐患；

参考文献：

http://baike.baidu.com/view/14121.htm

http://zh.wikipedia.org/wiki/RSA%E7%AE%97%E6%B3%95

http://blog.csdn.net/sfdev/article/details/2957240

http://blog.csdn.net/cyberexp2008/article/details/6695691

</div>
<div></div>
<div id="blog_post_info_block"></div>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>434</wp:post_id>
		<wp:post_date>2015-03-26 08:26:17</wp:post_date>
		<wp:post_date_gmt>2015-03-26 00:26:17</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>java%e5%ae%89%e5%85%a8%e9%80%9a%e4%bf%a1%ef%bc%9ahttps%e4%b8%8essl</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<category domain="post_tag" nicename="java%e5%ae%89%e5%85%a8%e9%80%9a%e4%bf%a1"><![CDATA[Java安全通信]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_fbe5e771154aa2f7cd98f743de376233</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_5bef88c30366761de37a30cd9bc3f806</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_7156827ad86c899b01f85731a67c16d0</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_5e202c570e863d562e60474cce7bfb30</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707565]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_171b924b52849b2c2e6662b408c1bd46</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_31e2ddbcf4a09689286fd8d6ffd7e330</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_e5cbbd464cebbf7f564a2444154f40ca</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_oembed_d8f4a1ed963c5fbcf1796c7a12f5c41e</wp:meta_key>
			<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>SSL/TLS 协议详解</title>
		<link>http://1.duoinfo.sinaapp.com/?p=437</link>
		<pubDate>Thu, 26 Mar 2015 00:33:31 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=437</guid>
		<description></description>
		<content:encoded><![CDATA[SSL（Secure Sockets Layer，安全套接层），及其继任者 TLS（Transport Layer Security，传输层安全）是为网络通信提供安全及数据完整性的一种安全协议。TLS与SSL在<span style="color: #ff00ff;">传输层</span>对网络连接进行加密。

为Netscape所研发，用以保障在Internet上数据传输之安全，利用数据加密(Encryption)技术，可确保数据在网络上之传输过程中不会被截取及窃听。

SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层：
SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。
SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。

SSL协议提供的服务主要有：
1）认证用户和服务器，确保数据发送到正确的客户机和服务器；
2）加密数据以防止数据中途被窃取；
3）维护数据的完整性，确保数据在传输过程中不被改变。

&nbsp;

<strong>一、什么是SSL?</strong>

SSL或者Secure Socket Layer，是一种允许web浏览器和web服务器通过一个安全的连接进行交流的技术。这意味着将被发送的数据在一端被翻译成密码，传送出去，然后在另一端解开密码，再进行处理。这是一个双向的过程，也就是浏览器和服务器都需要在发送数据之前对它们进行加密。

SSL协定的另一个重要方面是认证(Authentication)。这就是说，在你开始试图通过一个安全连接与一个Web服务器交流的时候，这个服务器会要求你的浏览器出示一组证件，通过“鉴定”的方式来证明这就是你所声明的网站。在某些情况下，服务器还会要求你的web浏览器的认证书，证明你就是你所说的那个人。这就是所知的“客户认证”，尽管实际情况中，更多地用在商务-对-商务(B2B)交易，而不是对个人用户。大多数有SSL功能的web服务器不要求客户认证(Client Authentication)。

&nbsp;

<strong> 二、证书：Certificate</strong>

为了能实施SSL，一个web服务器对每个接受安全连接的外部接口(IP地址)必须要有相应的认证书(Certificate)。关于这个设计的理论是一个服务器必须提供某种合理的保证以证明这个服务器的主人就是你所认为的那个人，特别是在接收任何敏感信息之前要这样做。关于Certificates的更广泛的解释超过了这个文档资料的范围，就把一个认证书当作一个英特网地址的“数码驾驶执照”。这个认证书要陈述与这个网站相关联的公司，以及这个网站的所有者或系统管理员的一些基本联系信息。

这个"驾驶执照"由所有人以密码方式签字，其他人非常难伪造。对于进行电子商务 (e-commerce)的网站，或其他身份认证至关重要的任何商业交易，认证书要向大家所熟知的认证权威 (Certificate Authority (CA))如VeriSign或Thawte来购买。这样的认证书可用电子技术证明属实——实际上，认证权威单位会担保它发出的认证书的真实性，如果你信任发出认证书的认证权威单位的话，你就可以相信这个认证书是有效的。

从技术上说，SSL 证书（也称为数字证书）将身份与一对可用于加密和签名数字信息的电子密钥绑定。SSL 证书能够实现对某人自称有权使用特定密钥的声明的验证，有助于防止有人使用欺骗性密钥来模拟其他用户。当与加密配合使用时，SSL 证书可提供完整的安全解决方案，可以保证参与事务的一方或各方的身份。

SSL 证书是由受信任的第三方（称为证书颁发机构 (CA)）发放的。CA 的作用有些像护照办理处。CA 必须采取一些措施来确定要向其发放 ID 的人或组织的身份。一旦 CA 建立某个组织的身份后，就可以发出一个包含该组织的公钥的证书，并用 CA 的私钥对其签名。

通过使用 SSL 证书，您就能在自己的站点上开展验证身份的、加密的在线商务活动。访问您站点的用户将可以向站点提交信用卡号或其他个人信息，从而保证他们真心实意与您进行业务交易（并非是骗子），并且他们发送给您的信息不会被目标接收者以外的任何人截取或解密。您的 SSL 证书将包含下列信息：

您的组织的公用名称（如 www.bea.com）
<ul>
	<li>    其它标识性信息（如 IP 和物理地址）</li>
	<li>    您的公钥</li>
	<li>    公钥的到期日期</li>
	<li>    发出此 ID 的 CA 的名称（如 VeriSign）</li>
	<li>    一个唯一的序列号</li>
	<li>    VeriSign 的数字签名</li>
</ul>
&nbsp;

<strong> 三、证书格式</strong>

主要的证书类型有：
PEM
DER
PKCS#12

PEM
可以包括所有私钥（RSA 和 DSA）、公钥（RSA 和 DSA）和 (x509) 证书。它存储用 Base64 编码的 DER 格式数据，用 ascii 报头包围，因此适合系统之间的文本模式传输。

-----BEGIN CERTIFICATE-----
MIICJjCCAdCgAwIBAgIBITANBgkqhkiG9w0BAQQFADCBqTELMAkGA1UEBhMCVVMx
EzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBGcmFuY2lzY28xFTAT
BgNVBAoTDEJFQSBXZWJMb2dpYzERMA8GA1UECxMIU2VjdXJpdHkxIzAhBgNVBAMT
GkRlbW8gQ2VydGlmaWNhdGUgQXV0aG9yaXR5MR4wHAYJKoZIhvcNAQkBFg9zdXBw
b3J0QGJlYS5jb20wHhcNMDAwNTMwMjEzODAxWhcNMDQwNTEzMjEzODAxWjCBjDEL
MAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG
cmFuY2lzY28xFTATBgNVBAoTDEJFQSBXZWJMb2dpYzEZMBcGA1UEAxMQd2VibG9n
aWMuYmVhLmNvbTEeMBwGCSqGSIb3DQEJARYPc3VwcG9ydEBiZWEuY29tMFwwDQYJ
KoZIhvcNAQEBBQADSwAwSAJBALdsXEHqKHgs6zj0hU5sXMAUHzoT8kgWXmNkKHXH
79qbPh6EfdlriW9G/AbRF/pKrCQu7hhllAxREbqTuSlf2EMCAwEAATANBgkqhkiG
9w0BAQQFAANBACgmqflL5m5LNeJGpWx9aIoABCiuDcpw1fFyegsqGX7CBhffcruS
1p8h5vkHVbMu1frD1UgGnPlOO/K7Ig/KrsU=
-----END CERTIFICATE-----

DER
辨别编码规则 (DER) 可包含所有私钥、公钥和证书。它是大多数浏览器的缺省格式，并按 ASN1 DER 格式存储。它是无报头的 － PEM 是用文本报头包围的 DER。

PKCS#12
公钥加密标准 #12 (PKCS#12) 可包含所有私钥、公钥和证书。其以二进制格式存储，也称为 PFX 文件。

&nbsp;

<strong>四、加密算法</strong>

加密算法有俩大类，第一种是不基于KEY的，另一种是不基于KEY的。

基于KEY的，举个简单的例子，我要加密"fordesign"这么一串字符，就把每个字符都变成它的后一个字符，那么就是"gpseftjhm"了，这样的东西人家当然看不明白，接收方用相反的方法就可以得到原文。当然这只是个例子，现在应该没人用这么搞笑的加密算法了吧。

不基于KEY，好象一直用到了计算机出现。我记得古中国军事机密都是用这种方式加密的。打战的时候好象军队那些电报员也要带着密码本，也应该是用这种方式加密的。这种算法的安全性以保持算法的保密为前提。
这种加密算法的缺点太明显了，就是一旦你的加密算法给人家知道，就肯定挂。日本中途岛惨败好象就是密码给老米破了。设计一种算法是很麻烦的，一旦给人破了就没用了，这也忑浪费。

我们现在使用的加密算法一般是基于key的，也就是说在加密过程中需要一个key，用这个key来对明文进行加密。这样的算法即使一次被破，下次改个key，还可以继续用。key是一个什么东西呢？随便你，可以是一个随机产生的数字，或者一个单词，啥都行，只要你用的算法认为你选来做key的那玩意合法就行。

这样的算法最重要的是：其安全性取决于key，一般来说取决于key的长度。也就是说应该保证人家在知道这个算法而不知道key的情况下，破解也相当困难。其实现在常用的基于KEY的加密算法在网络上都可以找到。

基于key的加密算法又包括俩类：对称加密和不对称加密。

对称加密指的是双方使用完全相同的key， 最常见的是DES. DES3, RC4等。对称加密算法的原理很容易理解，通信一方用KEK加密明文，另一方收到之后用同样的KEY来解密就可以得到明文。

不对称加密指双方用不同的KEY加密和解密明文，通信双方都要有自己的公共密钥和私有密钥。
举个例子比较容易理解， 我们们假设通信双方分别是A、B。
A 拥有 KEY_A1、KEY_A2, 其中KEY_A1是A的私有密钥，KEY_A2是A的公共密钥。
B 拥有 KEY_B1、KEY_B2, 其中KEY_B1是B的私有密钥，KEY_B2是B的公共密钥。
公共密钥和私有密钥的特点是，经过其中任何一把加密过的明文，只能用另外一把才能够解开。也就是说经过KEY_A1加密过的明文，只有KEY_A2才能够解密，反之亦然。
通信过程如下：

A--------&gt;KEY_A2------------&gt;B
A&lt;--------KEY_B2&lt;------------A

这个过程叫做公共密钥交换，老外管这叫key exchange。
之后A和B就分别用对方的公共密钥加密，用自己的私有密钥解密。
一般公共密钥是要发布出去的，然后你通过自己的私有密钥加密明文，人家用你的公共密钥解密，如果能解开，那么说明你是加密人，这就是SSL使用的验证机制。

我如果要发给你，我就用你的公钥加密，这让只有你能用自己的私钥解密。如果我用自己的私钥加密，然后发布出去，这就不属于保密，而是属于认证，证明这条信息是我发的，而且我不能赖帐，因为私钥只有我自己知道。

常用的不对称加密一般有RSA、 DSA、 DH等。我们一般使用RSA。

&nbsp;

<strong>五、数字签名</strong>

数字签名也是不对称加密算法的一个重要应用，理解它对于理解SSL很重要的，放在这里一起介绍一下。

签名是什么大家都很熟悉吧？证明该东西是你写的，是你发布的，你就用签名搞定。看看那些重要文件都要头头签名。数字签名就是数字化的签名了。记得公用密钥和私有密钥的特征吗？只有你一个人有你自己的私有密钥。而你的公用密钥是其他人都知道的 了。那么你在写完一封邮件之后，用自己的私有密钥加密自己的名字，接收人用你的公共密钥解开一看，哦，是你发的。这就是你的数字签名过程了。

上面的解释是很简化的了，其实数字签名比这个复杂多了，但我们没有了解的必要，知道数字签名是这么一回事就可以了。

还有一种我们需要知道的加密算法，其实我不觉得那是加密算法 ，应该叫哈希算法，英文是message digest, 是用来把任何长度的一串明文以一定规则变成固定长度的一串字符串。它在SSL中的作用也很重要，以后会慢慢提及的。一般使用的是MD5、SHA、base64不是加密算法，但也是SSL经常使用的一种算法，它是编码方式，用来把asc码和二进制码转来转去的。

具体的加密解密过程我们不需要了解，因为SSL根本不关心。但了解加密算法的一些基本原理是必要的，否则很难理解SSL。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>437</wp:post_id>
		<wp:post_date>2015-03-26 08:33:31</wp:post_date>
		<wp:post_date_gmt>2015-03-26 00:33:31</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>ssltls-%e5%8d%8f%e8%ae%ae%e8%af%a6%e8%a7%a3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<category domain="post_tag" nicename="java%e5%ae%89%e5%85%a8%e9%80%9a%e4%bf%a1"><![CDATA[Java安全通信]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707566]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>BadgeView框架</title>
		<link>http://1.duoinfo.sinaapp.com/?p=440</link>
		<pubDate>Thu, 26 Mar 2015 01:50:30 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=440</guid>
		<description></description>
		<content:encoded><![CDATA[BadgeView的开源地址在：<a title="https://github.com/stefanjauker/BadgeView" href="https://github.com/stefanjauker/BadgeView" target="_blank">https://github.com/stefanjauker/BadgeView</a>

github上给的介绍很短，只说了他继承自TextView，以及使用的方法.

[java]BadgeView badge = new BadgeView(getActivity());
badge.setTargetView(myView);
badge.setBadgeCount(42);[/java]
通过github上提供的demo学习下这个自定义View的框架。</pre>
<img src="http://img.blog.csdn.net/20150326094101669?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

可以看到demo提供了各种各样的形状，样式，以及可见和不见，还有位置等。

<img src="http://img.blog.csdn.net/20150326094208468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbmZ1ZHVvX2xvdmVpdA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

demo还提供了ListView的这种效果。

第一幅图设置的：

[java]View backgroundDefaultView = layout.findViewById(R.id.backgroundDefault);
 backgroundDefaultBadge = new BadgeView(getActivity());
 backgroundDefaultBadge.setBadgeCount(42);
 backgroundDefaultBadge.setTargetView(backgroundDefaultView);

View backgroundDrawableView = layout.findViewById(R.id.backgroundDrawable);
 backgroundDrawableBadge = new BadgeView(getActivity());
 backgroundDrawableBadge.setBadgeCount(88);
 backgroundDrawableBadge.setBackgroundResource(R.drawable.badge_blue);
 backgroundDrawableBadge.setTargetView(backgroundDrawableView);

View backgroundShapeView = layout.findViewById(R.id.backgroundShape);
 backgroundShapeBadge = new BadgeView(getActivity());
 backgroundShapeBadge.setBadgeCount(47);
 backgroundShapeBadge.setBackground(12, Color.parseColor(&quot;#9b2eef&quot;));
 backgroundShapeBadge.setTargetView(backgroundShapeView);

View counterView = layout.findViewById(R.id.counter);
 counterView.setOnClickListener(this);
 counterBadge = new BadgeView(getActivity());
 counterBadge.setBadgeCount(-2);
 counterBadge.setTargetView(counterView);

View gravityView = layout.findViewById(R.id.gravity);
 gravityView.setOnClickListener(this);
 gravityBadge = new BadgeView(getActivity());
 gravityBadge.setBadgeGravity(Gravity.LEFT | Gravity.BOTTOM);
 gravityBadge.setBadgeCount(4);
 gravityBadge.setTargetView(gravityView);

View textStyleView = layout.findViewById(R.id.textStyle);
 textStyleView.setOnClickListener(this);
 textStyleBadge = new BadgeView(getActivity());
 textStyleBadge.setBadgeCount(18);
 textStyleBadge.setTargetView(textStyleView);
 textStyleBadge.setTypeface(Typeface.create(Typeface.SANS_SERIF, Typeface.ITALIC));
 textStyleBadge.setShadowLayer(2, -1, -1, Color.GREEN);

View visibilityView = layout.findViewById(R.id.visibility);
 visibilityView.setOnClickListener(this);
 visibilityBadgeView = new BadgeView(getActivity());
 visibilityBadgeView.setBadgeCount(1);
 visibilityBadgeView.setTargetView(visibilityView);[/java]

ListView的设置：

[java]@Override
 public View getView(int position, View convertView, ViewGroup parent) {
 ViewHolder holder;

if (convertView == null) {
 convertView = mInflater.inflate(R.layout.list_row_badge, null);
 holder = new ViewHolder();
 holder.text = (TextView) convertView.findViewById(android.R.id.text1);
 holder.badge = new BadgeView(mContext);
 holder.badge.setTargetView(holder.text);
 holder.badge.setBadgeGravity(Gravity.CENTER_VERTICAL | Gravity.RIGHT);
 holder.badge.setBadgeMargin(0, 0, 8, 0);
 convertView.setTag(holder);
 } else {
 holder = (ViewHolder) convertView.getTag();
 }

holder.text.setText(DATA[position]);
 holder.badge.setBadgeCount(DATA[position].length());

return convertView;
 }

static class ViewHolder {
 TextView text;
 BadgeView badge;
 }[/java]

看一下badgeview中常用的方法：

1. setTargetView(View) --&gt; 设置哪个控件显示数字提醒，参数就是一个view对象

2. setBadgeCount(int) --&gt; 设置提醒的数字

3. setBadgeGravity(Gravity) --&gt; 设置badgeview的显示位置

4. setBackgroundColor() --&gt; 设置badgeview的背景色，当然还可以设置背景图片

5. setBackgroundResource() --&gt; 设置背景图片

6. setTypeface() --&gt; 设置显示的字体

7. setShadowLayer() --&gt; 设置字体的阴影

他的源码：

[java]public class BadgeView extends TextView {

private boolean mHideOnNull = true;

public BadgeView(Context context) {
 this(context, null);
 }

public BadgeView(Context context, AttributeSet attrs) {
 this(context, attrs, android.R.attr.textViewStyle);
 }

public BadgeView(Context context, AttributeSet attrs, int defStyle) {
 super(context, attrs, defStyle);

init();
 }

private void init() {
 if (!(getLayoutParams() instanceof LayoutParams)) {
 LayoutParams layoutParams =
 new LayoutParams(
 android.view.ViewGroup.LayoutParams.WRAP_CONTENT,
 android.view.ViewGroup.LayoutParams.WRAP_CONTENT,
 Gravity.RIGHT | Gravity.TOP);
 setLayoutParams(layoutParams);
 }

// set default font
 setTextColor(Color.WHITE);
 setTypeface(Typeface.DEFAULT_BOLD);
 setTextSize(TypedValue.COMPLEX_UNIT_SP, 11);
 setPadding(dip2Px(5), dip2Px(1), dip2Px(5), dip2Px(1));

// set default background
 setBackground(9, Color.parseColor(&quot;#d3321b&quot;));

setGravity(Gravity.CENTER);

// default values
 setHideOnNull(true);
 setBadgeCount(0);
 }

@SuppressWarnings(&quot;deprecation&quot;)
 public void setBackground(int dipRadius, int badgeColor) {
 int radius = dip2Px(dipRadius);
 float[] radiusArray = new float[] { radius, radius, radius, radius, radius, radius, radius, radius };

RoundRectShape roundRect = new RoundRectShape(radiusArray, null, null);
 ShapeDrawable bgDrawable = new ShapeDrawable(roundRect);
 bgDrawable.getPaint().setColor(badgeColor);
 setBackgroundDrawable(bgDrawable);
 }

/**
 * @return Returns true if view is hidden on badge value 0 or null;
 */
 public boolean isHideOnNull() {
 return mHideOnNull;
 }

/**
 * @param hideOnNull the hideOnNull to set
 */
 public void setHideOnNull(boolean hideOnNull) {
 mHideOnNull = hideOnNull;
 setText(getText());
 }

/*
 * (non-Javadoc)
 *
 * @see android.widget.TextView#setText(java.lang.CharSequence, android.widget.TextView.BufferType)
 */
 @Override
 public void setText(CharSequence text, BufferType type) {
 if (isHideOnNull() &amp;&amp; (text == null || text.toString().equalsIgnoreCase(&quot;0&quot;))) {
 setVisibility(View.GONE);
 } else {
 setVisibility(View.VISIBLE);
 }
 super.setText(text, type);
 }

public void setBadgeCount(int count) {
 setText(String.valueOf(count));
 }

public Integer getBadgeCount() {
 if (getText() == null) {
 return null;
 }

String text = getText().toString();
 try {
 return Integer.parseInt(text);
 } catch (NumberFormatException e) {
 return null;
 }
 }

public void setBadgeGravity(int gravity) {
 FrameLayout.LayoutParams params = (LayoutParams) getLayoutParams();
 params.gravity = gravity;
 setLayoutParams(params);
 }

public int getBadgeGravity() {
 FrameLayout.LayoutParams params = (LayoutParams) getLayoutParams();
 return params.gravity;
 }

public void setBadgeMargin(int dipMargin) {
 setBadgeMargin(dipMargin, dipMargin, dipMargin, dipMargin);
 }

public void setBadgeMargin(int leftDipMargin, int topDipMargin, int rightDipMargin, int bottomDipMargin) {
 FrameLayout.LayoutParams params = (LayoutParams) getLayoutParams();
 params.leftMargin = dip2Px(leftDipMargin);
 params.topMargin = dip2Px(topDipMargin);
 params.rightMargin = dip2Px(rightDipMargin);
 params.bottomMargin = dip2Px(bottomDipMargin);
 setLayoutParams(params);
 }

public int[] getBadgeMargin() {
 FrameLayout.LayoutParams params = (LayoutParams) getLayoutParams();
 return new int[] { params.leftMargin, params.topMargin, params.rightMargin, params.bottomMargin };
 }

public void incrementBadgeCount(int increment) {
 Integer count = getBadgeCount();
 if (count == null) {
 setBadgeCount(increment);
 } else {
 setBadgeCount(increment + count);
 }
 }

public void decrementBadgeCount(int decrement) {
 incrementBadgeCount(-decrement);
 }

/*
 * Attach the BadgeView to the TabWidget
 *
 * @param target the TabWidget to attach the BadgeView
 *
 * @param tabIndex index of the tab
 */
 public void setTargetView(TabWidget target, int tabIndex) {
 View tabView = target.getChildTabViewAt(tabIndex);
 setTargetView(tabView);
 }

/*
 * Attach the BadgeView to the target view
 *
 * @param target the view to attach the BadgeView
 */
 public void setTargetView(View target) {
 if (getParent() != null) {
 ((ViewGroup) getParent()).removeView(this);
 }

if (target == null) {
 return;
 }

if (target.getParent() instanceof FrameLayout) {
 ((FrameLayout) target.getParent()).addView(this);

} else if (target.getParent() instanceof ViewGroup) {
 // use a new Framelayout container for adding badge
 ViewGroup parentContainer = (ViewGroup) target.getParent();
 int groupIndex = parentContainer.indexOfChild(target);
 parentContainer.removeView(target);

FrameLayout badgeContainer = new FrameLayout(getContext());
 ViewGroup.LayoutParams parentlayoutParams = target.getLayoutParams();

badgeContainer.setLayoutParams(parentlayoutParams);
 target.setLayoutParams(new ViewGroup.LayoutParams(
 ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));

parentContainer.addView(badgeContainer, groupIndex, parentlayoutParams);
 badgeContainer.addView(target);

badgeContainer.addView(this);
 } else if (target.getParent() == null) {
 Log.e(getClass().getSimpleName(), &quot;ParentView is needed&quot;);
 }

}

/*
 * converts dip to px
 */
 private int dip2Px(float dip) {
 return (int) (dip * getContext().getResources().getDisplayMetrics().density + 0.5f);
 }
}[/java]

&nbsp;

&nbsp;

&nbsp;
<pre></pre>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>440</wp:post_id>
		<wp:post_date>2015-03-26 09:50:30</wp:post_date>
		<wp:post_date_gmt>2015-03-26 01:50:30</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>badgeview%e6%a1%86%e6%9e%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<category domain="post_tag" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707567]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>QQ数字提示的粘连效果：DraggableFlagView与BezierDemo比较</title>
		<link>http://1.duoinfo.sinaapp.com/?p=443</link>
		<pubDate>Thu, 26 Mar 2015 01:56:04 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=443</guid>
		<description></description>
		<content:encoded><![CDATA[安卓版qq不知道什么时候起加入了一个很有意思的功能，在消息选项卡右上角显示未读提示，这个提示是可以拖拽的，拖拽距离越长就会拉的越细。

原以为很复杂，不过很快就有人实现了，目前实现这种效果的开源项目有两个都是中国人写的，分别是<a href="http://jcodecraeer.com/a/opensource/2015/0108/2281.html" target="_self">DraggableFlagView</a> 和 <a href="http://jcodecraeer.com/a/opensource/2015/0203/2406.html" target="_self">BezierDemo</a>。

BezierDemo

<img src="http://jcodecraeer.com/uploads/150203/1-150203151QD33.gif" alt="" data-url="/uploads/150203/1-150203151QD33.gif" />

DraggableFlagView

<img title="1425980642132666.gif" src="http://www.jcodecraeer.com/uploads/20150310/1425980642132666.gif" alt="draggableflagview.gif" width="301" height="522" />

这篇文章主要是讲解两者的区别。后面将会选择其中一个项目做源码分析，看看这种粘连效果到底是如何实现的。

注：文章见   <a title=" http://1.duoinfo.sinaapp.com/?p=444" href=" http://1.duoinfo.sinaapp.com/?p=444" target="_blank">http://1.duoinfo.sinaapp.com/?p=444</a>

BezierDemo和DraggableFlagView

BezierDemo基本上是完全实现了qq上的所有效果，更像一个山寨版。而DraggableFlagView则着重于探索这种效果的实现方式，并对效果进行了改进。

从源码上来说BezierDemo只求模仿qq的效果，不太注重代码的普适性和规范性，而DraggableFlagView则更加像一个可以重复利用的控件。

<strong>但是两者实现的核心思想是一致的，都是使用了贝赛尔曲线</strong>，如果你不知道贝塞尔曲线是什么，请看<a title=" http://1.duoinfo.sinaapp.com/?p=445" href=" http://1.duoinfo.sinaapp.com/?p=445" target="_blank"> http://1.duoinfo.sinaapp.com/?p=445</a>。

android中的path.quadTo()方法提供了绘制二阶贝塞尔曲线的方法。这两个项目都是用的quadTo来绘制的。

实际上贝塞尔曲线在代码模拟现实生活中平滑过度效果的时候会非常有用，因此学会了贝塞尔曲线的应用并勇敢尝试相当于打开了一片新的天地。BezierDemo作者的另一个项目<a href="http://jcodecraeer.com/a/opensource/2015/0305/2539.html" target="_self">SpringIndicator</a> 就是一个例子。
<div></div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>443</wp:post_id>
		<wp:post_date>2015-03-26 09:56:04</wp:post_date>
		<wp:post_date_gmt>2015-03-26 01:56:04</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>qq%e6%95%b0%e5%ad%97%e6%8f%90%e7%a4%ba%e7%9a%84%e7%b2%98%e8%bf%9e%e6%95%88%e6%9e%9c%ef%bc%9adraggableflagview%e4%b8%8ebezierdemo%e6%af%94%e8%be%83</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707568]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>BezierDemo源码解析-实现qq消息气泡拖拽消失的效果</title>
		<link>http://1.duoinfo.sinaapp.com/?p=444</link>
		<pubDate>Thu, 26 Mar 2015 02:29:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=444</guid>
		<description></description>
		<content:encoded><![CDATA[BezierDemo只有两个java文件

<img title="1425993302781672.png" src="http://jcodecraeer.com/uploads/20150310/1425993302781672.png" alt="QQ图片20150310211436.png" />

其中MainActivity.java是程序界面，而BezierView.java是实现了粘连拉伸效果的类。

MainActivity.java

[java]package github.chenupt.bezier;

import android.app.Activity;
import android.os.Bundle;


public class MainActivity extends Activity {

@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);
}


}[/java]

activity_main.xml

[xml]&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
xmlns:tools=&quot;http://schemas.android.com/tools&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;
android:orientation=&quot;vertical&quot;
tools:context=&quot;.MainActivity&quot;&gt;

&lt;github.chenupt.bezier.BezierView
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;
android:background=&quot;@android:color/transparent&quot; /&gt;
&lt;/LinearLayout&gt;[/xml]

这里有个疑问：为啥BezierView控件的layout_width和layout_height为match_parent。 这是因为这个代码很粗糙，哈哈。

好了，从上面的activity可以看出，所有的功能都是BezierView控件实现的，因此我们直接转向BezierView.java

先贴代码

[java]package github.chenupt.bezier;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Path;
import android.graphics.PorterDuff;
import android.graphics.Rect;
import android.graphics.drawable.AnimationDrawable;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.FrameLayout;
import android.widget.ImageView;

/**
* Created by chenupt@gmail.com on 11/20/14.
* Description : custom layout to draw bezier
*/
public class BezierView extends FrameLayout {

// 默认定点圆半径
public static final float DEFAULT_RADIUS = 20;

private Paint paint;
private Path path;

// 手势坐标
float x = 300;
float y = 300;

// 锚点坐标
float anchorX = 200;
float anchorY = 300;

// 起点坐标
float startX = 100;
float startY = 100;

// 定点圆半径
float radius = DEFAULT_RADIUS;

// 判断动画是否开始
boolean isAnimStart;
// 判断是否开始拖动
boolean isTouch;

ImageView exploredImageView;
ImageView tipImageView;

public BezierView(Context context) {
super(context);
init();
}

public BezierView(Context context, AttributeSet attrs) {
super(context, attrs);
init();
}

public BezierView(Context context, AttributeSet attrs, int defStyleAttr) {
super(context, attrs, defStyleAttr);
init();
}

private void init(){
path = new Path();

paint = new Paint();
paint.setAntiAlias(true);
paint.setStyle(Paint.Style.FILL_AND_STROKE);
paint.setStrokeWidth(2);
paint.setColor(Color.RED);

LayoutParams params = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
exploredImageView = new ImageView(getContext());
exploredImageView.setLayoutParams(params);
exploredImageView.setImageResource(R.drawable.tip_anim);
exploredImageView.setVisibility(View.INVISIBLE);

tipImageView = new ImageView(getContext());
tipImageView.setLayoutParams(params);
tipImageView.setImageResource(R.drawable.skin_tips_newmessage_ninetynine);

addView(tipImageView);
addView(exploredImageView);
}

@Override
protected void onLayout(boolean changed, int left, int top, int right, int bottom) {
exploredImageView.setX(startX - exploredImageView.getWidth()/2);
exploredImageView.setY(startY - exploredImageView.getHeight()/2);

tipImageView.setX(startX - tipImageView.getWidth()/2);
tipImageView.setY(startY - tipImageView.getHeight()/2);

super.onLayout(changed, left, top, right, bottom);
}



private void calculate(){
float distance = (float) Math.sqrt(Math.pow(y-startY, 2) + Math.pow(x-startX, 2));
radius = -distance/15+DEFAULT_RADIUS;

if(radius &lt; 9){
isAnimStart = true;

exploredImageView.setVisibility(View.VISIBLE);
exploredImageView.setImageResource(R.drawable.tip_anim);
((AnimationDrawable) exploredImageView.getDrawable()).stop();
((AnimationDrawable) exploredImageView.getDrawable()).start();

tipImageView.setVisibility(View.GONE);
}

// 根据角度算出四边形的四个点
float offsetX = (float) (radius*Math.sin(Math.atan((y - startY) / (x - startX))));
float offsetY = (float) (radius*Math.cos(Math.atan((y - startY) / (x - startX))));

float x1 = startX - offsetX;
float y1 = startY + offsetY;

float x2 = x - offsetX;
float y2 = y + offsetY;

float x3 = x + offsetX;
float y3 = y - offsetY;

float x4 = startX + offsetX;
float y4 = startY - offsetY;

path.reset();
path.moveTo(x1, y1);
path.quadTo(anchorX, anchorY, x2, y2);
path.lineTo(x3, y3);
path.quadTo(anchorX, anchorY, x4, y4);
path.lineTo(x1, y1);

// 更改图标的位置
tipImageView.setX(x - tipImageView.getWidth()/2);
tipImageView.setY(y - tipImageView.getHeight()/2);
}

@Override
protected void onDraw(Canvas canvas){
if(isAnimStart || !isTouch){
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
}else{
calculate();
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
canvas.drawPath(path, paint);
canvas.drawCircle(startX, startY, radius, paint);
canvas.drawCircle(x, y, radius, paint);
}
super.onDraw(canvas);
}



@Override
public boolean onTouchEvent(MotionEvent event) {
if(event.getAction() == MotionEvent.ACTION_DOWN){
// 判断触摸点是否在tipImageView中
Rect rect = new Rect();
int[] location = new int[2];
tipImageView.getDrawingRect(rect);
tipImageView.getLocationOnScreen(location);
rect.left = location[0];
rect.top = location[1];
rect.right = rect.right + location[0];
rect.bottom = rect.bottom + location[1];
if (rect.contains((int)event.getRawX(), (int)event.getRawY())){
isTouch = true;
}
}else if(event.getAction() == MotionEvent.ACTION_UP || event.getAction() == MotionEvent.ACTION_CANCEL){
isTouch = false;
tipImageView.setX(startX - tipImageView.getWidth()/2);
tipImageView.setY(startY - tipImageView.getHeight()/2);
}
invalidate();
if(isAnimStart){
return super.onTouchEvent(event);
}
anchorX =  (event.getX() + startX)/2;
anchorY =  (event.getY() + startY)/2;
x =  event.getX();
y =  event.getY();
return true;
}


}[/java]

该控件是一个自定义的FrameLayout，之所以不用自定义view，是为了能直接添加显示消息数目的图片。

关于成员变量的那部分注释已经比较清楚了，我直接看看

<strong>init()方法</strong>

在init方法中首先初始化了画笔paint，这个paint就是绘制粘连拉伸效果的。然后paint初始化代码下面为FrameLayout添加了两个图片：exploredImageView和tipImageView，exploredImageView是在拉断之后显示的气泡，而tipImageView是数字提示，这两个ImageView都只是为了辅助模仿qq，但不是我们要讨论的核心。

<strong>onLayout()方法</strong>

非重点，略。

<strong>calculate()方法</strong>

这是根据手指拖动位置计算各坐标的的方法，同时还在这里根据坐标点将path路径也定义了：

[java] path.reset();
path.moveTo(x1, y1);
path.quadTo(anchorX, anchorY, x2, y2);
path.lineTo(x3, y3);
path.quadTo(anchorX, anchorY, x4, y4);
path.lineTo(x1, y1);[/java]

<strong>onDraw()方法</strong>

[java]@Override
protected void onDraw(Canvas canvas){
if(isAnimStart || !isTouch){
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
}else{
calculate();
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
canvas.drawPath(path, paint);
canvas.drawCircle(startX, startY, radius, paint);
canvas.drawCircle(x, y, radius, paint);
}
super.onDraw(canvas);
}[/java]

这个方法调用了上面的<strong>calculate</strong>方法，然后根据计算出的值绘制path和圆圈。

<strong>onTouchEvent()方法</strong>

这个方法将根据触摸点的位置变化记录必要的位置信息，供<strong>calculate()方法</strong>计算，同时在必要的地方发送绘制请求。

<span style="font-size: 1.17em;">一步一步分解</span>

如果讲到这里就结束，你肯定不满意-“我还是没明白贝塞尔曲线是如何应用到里面的呢”。为了彻底明白我们将做几个分解代码的实验。

首先我们找到onDraw方法，

[java] @Override
protected void onDraw(Canvas canvas){
if(isAnimStart || !isTouch){
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
}else{
calculate();
canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);
canvas.drawPath(path, paint);
canvas.drawCircle(startX, startY, radius, paint);
canvas.drawCircle(x, y, radius, paint);
}
super.onDraw(canvas);
}[/java]

在
<div>
<div id="highlighter_624557">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>if</code><code>(isAnimStart || !isTouch){</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
中的代码是拉断之后的效果，不去管他。

主要看else中的代码

首先调用了<strong>calculate()方法</strong>，然后调用了
<div>
<div id="highlighter_526065">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code> </code><code>canvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.OVERLAY);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
这个去掉也无所谓。

接着绘制了一条带有贝塞尔曲线的封闭路径：
<div>
<div id="highlighter_905275">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code> </code><code>canvas.drawPath(path, paint);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
然后分别绘制了两端的圆圈。

&nbsp;

为了更直观的看出效果，我们将原本

// 默认定点圆半径
public static final float DEFAULT_RADIUS = 20;

改成

// 默认定点圆半径
public static final float DEFAULT_RADIUS = 150;

这样大点会更清楚的看到拉伸过程，而且拉很长也不会断，拉断的临界点是下面代码决定的：

<strong>calculate</strong>方法中

float distance = (float) Math.sqrt(Math.pow(y-startY, 2) + Math.pow(x-startX, 2));
radius = -distance/15+DEFAULT_RADIUS;

if(radius &lt; 9){
isAnimStart = true;

更改之后得到的效果如下：

<img title="1426007426115686.png" src="http://jcodecraeer.com/uploads/20150311/1426007426115686.png" alt="QQ图片20150311010955.png" />

你看我都拉了半边屏幕。

但是这样仍然难以看到曲线是如何绘制的，这是因为画笔paint的绘制类型是填充模式的，我们改成线条模式：

将init()方法改成

private void init(){
path = new Path();

paint = new Paint();
paint.setAntiAlias(true);
<strong>       paint.setStyle(Paint.Style.STROKE);</strong>
paint.setStrokeWidth(2);
paint.setColor(Color.RED);

......

这样我们就能看到线条是如何组合的了：

&nbsp;

<img title="1426007800396150.png" src="http://jcodecraeer.com/uploads/20150311/1426007800396150.png" alt="QQ图片20150311011548.png" />

可以看出的确是两个圆圈和一条封闭的路径组成的。那个数字图片有点碍眼，我们想办法去掉

&nbsp;

在calculate（）方法的适当位置加上
<div>
<div id="highlighter_208195">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code> </code><code>tipImageView.setVisibility(View.GONE);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
我是加在第三行左右，总之能保证会被执行就行。我不敢说加在这里最合适，我只是单纯的想去掉它而已。

下面是去掉之后来回拉伸的变换图：

<img title="1426008573409189.gif" src="http://jcodecraeer.com/uploads/20150311/1426008573409189.gif" alt="654444.gif" />

有点猥琐。。。。

现在我们将两个圆圈也去掉吧，这两个圆圈仅仅是根据两点之间距离的大小改变了下半径而已（第二个点也改变了圆点坐标）。贝塞尔曲线在中间那部分，让我们看看包含了贝塞尔曲线的path路径的真面目。

去掉圆圈只需将ondraw方法的相关代码注释掉：

<img title="1426008867227681.png" src="http://jcodecraeer.com/uploads/20150311/1426008867227681.png" alt="QQ图片20150311013309.png" />

下面是注释之后的效果：

<img title="1426009104115355.gif" src="http://jcodecraeer.com/uploads/20150311/1426009104115355.gif" alt="8487498.gif" />

这就是我们的path了。

回到构建这个path的代码，在calculate方法中：
<div>
<div id="highlighter_525066">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div></td>
<td>
<div>
<div><code>        </code><code>path.reset();</code></div>
<div><code>        </code><code>path.moveTo(x1, y1);</code></div>
<div><code>       </code></div>
<div><code>        </code><code>path.quadTo(anchorX, anchorY, x2, y2);</code></div>
<div><code>        </code><code>path.lineTo(x3, y3);</code></div>
<div><code>        </code><code>path.quadTo(anchorX, anchorY, x4, y4);</code></div>
<div><code>     </code></div>
<div><code>        </code><code>path.lineTo(x1, y1);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
其中lineTo方法是绘制直线，quadTo方法就是绘制贝塞尔曲线，准确的说，是绘制二阶贝塞尔曲线。为了能看出path的先后顺序，我们分别定义

(x1, y1)为A点

(x2, y2)为B点

(x3, y3)为C点

(x4, y4)为D点

(anchorX, anchorY)为X点，这是二阶贝塞尔曲线的控制点，这里有两条二阶贝塞尔曲线，都是同一个控制点。

同时在canvas中将这几个点的字母标注出来，具体的做法是调用canvas.drawText，修改具体的代码我就不发了。

<img title="1426045329118423.png" src="http://jcodecraeer.com/uploads/20150311/1426045329118423.png" alt="QQ图片20150311113952.png" />

每个点的显示位置有所偏差（尤其是X点），这是因为canvas.drawText的参数需要根据字符的大小做调整，我为了简便，没有去做，但是这些点你应该知道他们的实际位置，A，B，C，D很好辨认，但是X应该是在中间才对。

有了上面那幅图对于这段代码就好理解了
<div>
<div id="highlighter_386822">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div></td>
<td>
<div>
<div><code>        </code><code>path.moveTo(x1, y1);</code></div>
<div><code>       </code></div>
<div><code>        </code><code>path.quadTo(anchorX, anchorY, x2, y2);</code></div>
<div><code>        </code><code>path.lineTo(x3, y3);</code></div>
<div><code>        </code><code>path.quadTo(anchorX, anchorY, x4, y4);</code></div>
<div><code>     </code></div>
<div><code>        </code><code>path.lineTo(x1, y1);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
拉伸的粘连效果主要取决于quadTo绘制的两条贝塞尔曲线，这两条曲线以他们之间的中间位置为控制点，导致曲线以相同的弧度往内弯曲。当两端的圆圈距离越来越长，控制点的位置以及两条曲线的端点也跟着变化（需要根据距离计算端点和控制点的位置）就形成了橡皮筋的粘连效果。

&nbsp;
<h3>各坐标点的计算</h3>
那么现在的最后一个问题是如何寻找这些变化的点。

首先我们需要记录手指运动过程中，触摸点的变化情况，在demo中是使用（x,y）来代表这个触摸点，然后根据（startX，startY）（这个点是写死的）计算出控制点的坐标（anchorX，anchorY)

代码如下
<div>
<div id="highlighter_331059">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div>
<div>17</div>
<div>18</div>
<div>19</div>
<div>20</div>
<div>21</div>
<div>22</div>
<div>23</div>
<div>24</div>
<div>25</div>
<div>26</div>
<div>27</div>
<div>28</div>
<div>29</div>
<div>30</div></td>
<td>
<div>
<div><code>    </code><code>@Override</code></div>
<div><code>    </code><code>public boolean onTouchEvent(MotionEvent event) {</code></div>
<div><code>        </code><code>if</code><code>(event.getAction() == MotionEvent.ACTION_DOWN){</code></div>
<div><code>            </code><code>// 判断触摸点是否在tipImageView中</code></div>
<div><code>            </code><code>Rect rect = </code><code>new</code> <code>Rect();</code></div>
<div><code>            </code><code>int[] location = </code><code>new</code> <code>int[2];</code></div>
<div><code>            </code><code>tipImageView.getDrawingRect(rect);</code></div>
<div><code>            </code><code>tipImageView.getLocationOnScreen(location);</code></div>
<div><code>            </code><code>rect.left = location[0];</code></div>
<div><code>            </code><code>rect.top = location[1];</code></div>
<div><code>            </code><code>rect.right = rect.right + location[0];</code></div>
<div><code>            </code><code>rect.bottom = rect.bottom + location[1];</code></div>
<div><code>            </code><code>if</code> <code>(rect.contains((int)event.getRawX(), (int)event.getRawY())){</code></div>
<div><code>                </code><code>isTouch = </code><code>true</code><code>;</code></div>
<div><code>            </code><code>}</code></div>
<div><code>        </code><code>}</code><code>else</code> <code>if</code><code>(event.getAction() == MotionEvent.ACTION_UP || event.getAction() == MotionEvent.ACTION_CANCEL){</code></div>
<div><code>            </code><code>isTouch = </code><code>false</code><code>;</code></div>
<div><code>            </code><code>tipImageView.setX(startX - tipImageView.getWidth()/2);</code></div>
<div><code>            </code><code>tipImageView.setY(startY - tipImageView.getHeight()/2);</code></div>
<div><code>        </code><code>}</code></div>
<div><code>        </code><code>invalidate();</code></div>
<div><code>        </code><code>if</code><code>(isAnimStart){</code></div>
<div><code>            </code><code>return</code> <code>super</code><code>.onTouchEvent(event);</code></div>
<div><code>        </code><code>}</code></div>
<div><code>        </code><code>anchorX =  (event.getX() + startX)/2;</code></div>
<div><code>        </code><code>anchorY =  (event.getY() + startY)/2;</code></div>
<div><code>        </code><code>x =  event.getX();</code></div>
<div><code>        </code><code>y =  event.getY();</code></div>
<div><code>        </code><code>return</code> <code>true</code><code>;</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
&nbsp;

其中if和else代码块中的的代码和粘连效果无关，这些代码是关于气泡的ImageView显示与消失的。

主要就是下面的代码
<div>
<div id="highlighter_470157">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div></td>
<td>
<div>
<div><code>        </code><code>invalidate();</code></div>
<div><code>        </code><code>if</code><code>(isAnimStart){</code></div>
<div><code>            </code><code>return</code> <code>super</code><code>.onTouchEvent(event);</code></div>
<div><code>        </code><code>}</code></div>
<div><code>        </code><code>anchorX =  (event.getX() + startX)/2;</code></div>
<div><code>        </code><code>anchorY =  (event.getY() + startY)/2;</code></div>
<div><code>        </code><code>x =  event.getX();</code></div>
<div><code>        </code><code>y =  event.getY();</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
可以看出在onTouchEvent中，主要工作是记录，坐标点的计算还是在calculate（）方法里（不过这里也简单的计算了控制点的坐标（anchorX，anchorY)，其实这也可以放到calculate里面）。另外

invalidate()方法我觉得还是放在最后比较好。不过没什么大碍，也就是落后一个点而已，你根本感觉不到。

&nbsp;

而calculate()方法里面对坐标的计算也很简单，没几行代码，结合上面的几幅图应该很容易解出来。这里就不再赘述了。

&nbsp;

&nbsp;

其实整篇文章可以用一句话来概括：<strong>粘连效果的关键是由同一个控制点（中间点）“拖住”两条贝塞尔曲线。</strong>

最后做一点补充，为了将橡皮的效果做的更逼真，这个demo中还动态的改变了两端圆点的半径，当然这也会导致其他点也做相应的改变
<div>
<div id="highlighter_212846">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div></td>
<td>
<div>
<div><code>        </code><code>float distance = (float) Math.sqrt(Math.pow(y-startY, 2) + Math.pow(x-startX, 2));</code></div>
<div><code>        </code><code>radius = -distance/15+DEFAULT_RADIUS;</code></div>
<div><code>
</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>444</wp:post_id>
		<wp:post_date>2015-03-26 10:29:52</wp:post_date>
		<wp:post_date_gmt>2015-03-26 02:29:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>bezierdemo%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90-%e5%ae%9e%e7%8e%b0qq%e6%b6%88%e6%81%af%e6%b0%94%e6%b3%a1%e6%8b%96%e6%8b%bd%e6%b6%88%e5%a4%b1%e7%9a%84%e6%95%88%e6%9e%9c</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707570]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>9</wp:comment_id>
			<wp:comment_author><![CDATA[QQ数字提示的粘连效果：DraggableFlagView与BezierDemo比较 | 一个开发者]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=443</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.217</wp:comment_author_IP>
			<wp:comment_date>2015-03-26 09:56:08</wp:comment_date>
			<wp:comment_date_gmt>2015-03-26 01:56:08</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] 注：文章见   http://1.duoinfo.sinaapp.com/?p=444 [...]]]></wp:comment_content>
			<wp:comment_approved>0</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>用Path来绘制一些图形</title>
		<link>http://1.duoinfo.sinaapp.com/?p=445</link>
		<pubDate>Thu, 26 Mar 2015 02:29:48 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=445</guid>
		<description></description>
		<content:encoded><![CDATA[Path是android中用来封装几何学路径的一个类，因为Path在图形绘制上占的比重还是相当大的。你可以用它来绘制各种样式的几何图形，做图表什么的都可以。

&nbsp;

<strong>一、画线段</strong>

<strong>1.1 lineTo(float x, float y)</strong>

先来看一段代码：
<div>
<div id="highlighter_828546">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 连接路径到点[100,100]</code></div>
<div><code>        </code><code>mPath.lineTo(100, 100);</code></div>
<div><code>        </code><code>// 绘制路径</code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
&nbsp;

<img src="http://jcodecraeer.com/uploads/20150309/1425914447111577.jpg" alt="" width="348" height="118" />

效果就是将起始点和（100，100）进行连接。这里因为没有设置起始点，所以默认是canvas的左上角，而这里默认的canvas和屏幕重合，所以就成了这个样子。

当然我们可以考虑多次调用lineTo方法来绘制更复杂的图形：
<div>
<div id="highlighter_109522">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div>
<div>17</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>mPath.lineTo(300, 100);  </code></div>
<div><code>        </code><code>mPath.lineTo(400, 200);  </code></div>
<div><code>        </code><code>mPath.lineTo(200, 200); </code></div>
<div><code>        </code><code>// 绘制路径</code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
&nbsp;

<img src="http://jcodecraeer.com/uploads/20150309/1425914484652361.jpg" alt="" />

&nbsp;

<strong>1.2 moveTo(float x, float y)  </strong>

我们可以通过moveTo(float x, float y) 来移动起始的坐标点，比如：
<div>
<div id="highlighter_349810">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>//移动点至[300,300]  </code></div>
<div><code>        </code><code>mPath.moveTo(300, 300);  </code></div>
<div><code>        </code><code>// 连接路径到点[100,100]</code></div>
<div><code>        </code><code>mPath.lineTo(100, 100);</code></div>
<div><code>        </code><code>// 绘制路径</code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914508975831.jpg" alt="" width="386" height="203" />

&nbsp;

<strong>1.3 close()</strong>

<img src="http://jcodecraeer.com/uploads/20150309/1425914509149879.jpg" alt="" />

上面的例子我们构建了一个类似平行四边形的图像，如果此时我们想闭合该曲线让它变成一个形状该怎么做呢？聪明的你一定想到：
<div>
<div id="highlighter_67354">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>mPath.lineTo(100, 100)</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
&nbsp;

然而Path给我提供了更便捷的方法：
<div>
<div id="highlighter_826024">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>close()</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
在上面的例子添加close()后就会自动构建一条末点和起始点的线段：
<div>
<div id="highlighter_869209">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div>
<div>17</div>
<div>18</div>
<div>19</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>mPath.lineTo(300, 100);  </code></div>
<div><code>        </code><code>mPath.lineTo(400, 200);  </code></div>
<div><code>        </code><code>mPath.lineTo(200, 200); </code></div>
<div><code>        </code><code>// 闭合曲线</code></div>
<div><code>        </code><code>mPath.close();</code></div>
<div><code>        </code><code>// 绘制路径</code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914573115742.jpg" alt="" />

&nbsp;

<strong>二、画贝赛尔曲线</strong>

<strong>2.1 贝赛尔曲线</strong>

什么叫贝赛尔曲线？其实很简单，使用三个或多个点来确定的一条曲线，贝塞尔曲线在图形图像学中有相当重要的地位，Path中也提供了一些方法来给我们模拟低阶贝赛尔曲线。

贝塞尔曲线的定义也比较简单，你只需要一个起点、一个终点和至少零个控制点则可定义一个贝赛尔曲线，当控制点为零时，只有起点和终点，此时的曲线说白了就是一条线段，我们称之为一阶贝赛尔曲线。

PS：以下图片和公式均来自维基百科和互联网

<strong>一阶贝赛尔曲线：</strong>

<img src="http://img.blog.csdn.net/20141216154914760" alt="" />

其公式可概括为：

<img src="http://img.blog.csdn.net/20141216154951498?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWlnZXN0dWRpbw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

其中B(t)为时间为t时点的坐标，P0为起点、Pn为终点

贝塞尔曲线于1962年由法国数学家Pierre Bézier第一次研究使用并给出了详细的计算公式，So该曲线也是由其名字命名。Path中给出的quadTo方法属于

&nbsp;

<strong>二阶贝赛尔曲线：</strong>

<img src="http://img.blog.csdn.net/20141216155508803" alt="" />

二阶贝赛尔曲线的一个明显特征是其拥有一个控制点，大家可以这样想想贝赛尔曲线， 在一根两端固定橡皮筋上有一块磁铁，现在我们拿另一块磁铁去吸引橡皮筋上的磁铁，因为引力，橡皮筋会随着我们手上磁铁的移动而改变形状，又因为橡皮筋的张 力让束缚在橡皮筋上的磁铁不会轻易吸附到我们手上的磁铁，这时橡皮筋的状态就可以看成是一条贝塞尔曲线，而我们手中的磁铁就是一个控制点，通过这个控制点 我们“拉扯”橡皮筋的曲度。

二阶贝赛尔曲线的公式为：

<img src="http://img.blog.csdn.net/20141216155633823" alt="" />

同样的，Path中也提供了三阶贝塞尔曲线的方法cubicTo，按照上面我们的推论，三阶应该是有两个控制点才对对吧

&nbsp;

<strong>三阶贝赛尔曲线：</strong>

<img src="http://img.blog.csdn.net/20141216155707332" alt="" />

公式：

<img src="http://img.blog.csdn.net/20141216155716578" alt="" />

高阶贝赛尔曲线在Path中没有对应的方法，对我们来说三阶也足够了，不过大家可以了解下，难得我在墙外找到如此动感的贝赛尔曲线高清无码动图

&nbsp;

<strong>高阶贝塞尔曲线：</strong>

四阶：

<img src="http://img.blog.csdn.net/20141216155817984" alt="" />

五阶：

<img src="http://img.blog.csdn.net/20141216155848359" alt="" />

贝塞尔曲线通用公式：

<img src="http://img.blog.csdn.net/20141216155935687" alt="" />

&nbsp;

&nbsp;

<strong>2.2 quadTo(float x1, float y1, float x2, float y2)</strong>

上面说了一阶的就是一条线段，所以直接来看二阶。下面的方法可以让我们绘制“二阶”贝赛尔曲线。
<blockquote>quadTo(float x1, float y1, float x2, float y2)</blockquote>
<img src="http://img.blog.csdn.net/20141216155508803" alt="" />

解释：其中quadTo的前两个参数为控制点的坐标，后两个参数为终点坐标，至于起点默认是画布的左上角。这里的p0就是起点，(x1,y1)就是中点P1，(x2,y2)就是末端点P2。

&nbsp;

现在，我们使用它来绘制一条曲线：
<div>
<div id="highlighter_152239">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动起点至[100,100]  </code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>          </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>mPath.quadTo(200, 200, 300, 100); </code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
效果：

<img src="http://jcodecraeer.com/uploads/20150309/1425914641110010.jpg" alt="" /> 示意图： <img src="http://jcodecraeer.com/uploads/20150309/1425914641138953.jpg" alt="" width="365" height="209" />

&nbsp;

<strong>2.3 cubicTo(float x1, float y1, float x2, float y2, float x3, float y3)  </strong>

它可以绘制三阶贝赛尔曲线。

<img src="http://img.blog.csdn.net/20141216155707332" alt="" />

与quadTo类似，前四个参数表示两个控制点，最后两个参数表示终点。其实，(x1,y1)就是P1,(x2,y2)是P2，(x3,y3)是P3。

下面用代码来绘制一下：
<div>
<div id="highlighter_67935">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动起点至[100,100]  </code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>          </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>mPath.cubicTo(200, 200, 300, 0, 400, 100);  </code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914674944934.jpg" alt="" />  示意图： <img src="http://jcodecraeer.com/uploads/20150309/1425914674135623.jpg" alt="" />

&nbsp;

<strong>三、画弧线</strong>
<blockquote>arcTo (RectF oval, float startAngle, float sweepAngle)</blockquote>
是一个画弧线的方法，其实说白了就是从圆或椭圆上截取一部分而已。
<div>
<div id="highlighter_366243">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动起点至[100,100]  </code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>RectF oval = </code><code>new</code> <code>RectF(100, 100, 200, 200);  </code></div>
<div><code>        </code><code>mPath.arcTo(oval, 0, 90); </code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
上面的代码首先构建出一个矩形区域，这个区域内就是椭圆和园的区域，椭圆或园会内切于这个矩形区域。然后我们设置圆弧的其实角度和最终角度来截取圆弧。

<img src="http://jcodecraeer.com/uploads/20150309/1425914695125954.jpg" alt="" />

注意：使用Path生成的路径必定都是连贯的，虽然我们使用arcTo绘制的是一段弧但其最终都会与我们的起始点[100,100]连接。

如果你不想连怎么办？Path也提供了另一个重载方法：
<blockquote>arcTo (RectF oval, float startAngle, float sweepAngle, boolean forceMoveTo)</blockquote>
它会强制起点为绘制的起始点，而不是画布的左上角。我们来看看效果：
<div>
<div id="highlighter_349054">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动起点至[100,100]  </code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>RectF oval = </code><code>new</code> <code>RectF(100, 100, 200, 200);  </code></div>
<div><code>        </code><code>mPath.arcTo(oval, 0, 90,</code><code>true</code><code>); </code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914714106688.jpg" alt="" />

&nbsp;

<strong>四、rXXXTo方法</strong>

Path中除了上面介绍的几个XXXTo方法外还有一套rXXXTo方法：
<div>
<div id="highlighter_197744">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div></td>
<td>
<div>
<div><code>rCubicTo(float x1, float y1, float x2, float y2, float x3, float y3)  </code></div>
<div><code>rLineTo(float dx, float dy)  </code></div>
<div><code>rMoveTo(float dx, float dy)  </code></div>
<div><code>rQuadTo(float dx1, float dy1, float dx2, float dy2)</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
这一系列rXXXTo方法其实跟上面的那些XXXTo差不多的，唯一的不同是rXXXTo方法的参考坐标是相对的而XXXTo方法的参考坐标始终是参照画布原点坐标，什么意思呢？举个简单的例子：
<div>
<div id="highlighter_375632">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);  </code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动点至[100,100]  </code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);  </code></div>
<div><code>  </code></div>
<div><code>        </code><code>// 连接路径到点  </code></div>
<div><code>        </code><code>mPath.lineTo(200, 200); </code></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914749143424.jpg" alt="" />

这里的move和lineTo的坐标都是对于画布左上角(0,0)来说的，是一个绝对坐标。而我们换为mPath.rLineTo(200, 200); 后呢？

<img src="http://jcodecraeer.com/uploads/20150309/1425914749122877.jpg" alt="" />

是不是感觉线段长了很多，因为这里的(200,200)是相对于开始点(100,100)来说的，是相对坐标。如果换算成绝对坐标就是绘制一条(100,100)到(300,300)之间的线段。其实，这个前缀“r”也就是relative（相对）的简写！

&nbsp;

<strong>五、addXXX方法</strong>

XXXTo方法可以连接Path中的曲线而Path提供的另一系列addXXX方法则可以让我们直接往Path中添加一些曲线，比如
<blockquote>addArc(RectF oval, float startAngle, float sweepAngle)</blockquote>
它允许我们将一段弧形添加至Path，注意这里我用到了“添加”这个词汇，也就是说，通过addXXX方法添加到Path中的曲线是不会和上一次的曲线进行连接的：
<div>
<div id="highlighter_861911">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div>
<div>17</div>
<div>18</div>
<div>19</div>
<div>20</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);</code></div>
<div><code>        </code><code>mPaint.setStrokeWidth(5);</code></div>
<div></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动点至[100,100]</code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);</code></div>
<div></div>
<div><code>        </code><code>// 连接路径到点</code></div>
<div><code>        </code><code>mPath.lineTo(200, 200);</code></div>
<div><code>        </code><code>// 添加一条弧线到Path中</code></div>
<div><code>        </code><code>RectF oval = </code><code>new</code> <code>RectF(100, 100, 300, 400);</code></div>
<div><code>        </code><code>mPath.addArc(oval, 0, 90);</code></div>
<div></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914769128342.jpg" alt="" />

如图和代码所示，虽然我们先绘制了由[100,100]到[200,200]的线段，但是在我们往Path中添加了一条弧线后该弧线并没与线段连接。

除了addArc，Path还提供了一系列的add方法：
<div>
<div id="highlighter_748870">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div></td>
<td>
<div>
<div><code>addCircle(float x, float y, float radius, Path.Direction dir)  </code></div>
<div><code>addOval(float left, float top, float right, float bottom, Path.Direction dir)  </code></div>
<div><code>addRect(float left, float top, float right, float bottom, Path.Direction dir)  </code></div>
<div><code>addRoundRect(float left, float top, float right, float bottom, float rx, float ry, Path.Direction dir)</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
这些方法和addArc有很明显的区别，就是多了一个Path.Direction参数，其他呢都大同小异，除此之外不知道大家还发现没有，addArc是往Path中添加一段弧，说白了就是一条开放的曲线，而上述几种方法都是一个具体的图形，或者说是一条闭合的曲线，Path.Direction的意思就是标识这些闭合曲线的闭合方向。Path.Direction只有两个常量值CCW和CW分别表示逆时针方向闭合和顺时针方向闭合。

那什么叫闭合方向呢？光说大家一定会蒙，有学习激情的童鞋看到后肯定会马上敲代码试验一下两者的区别，可是不管你如何改，单独地在一条闭合曲线上你是看不出所谓闭合方向的区别的。为了弄懂它，我们在path上绘制一些文字来说明最后参数的意义：
<div>
<div id="highlighter_78527">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div>
<div>2</div>
<div>3</div>
<div>4</div>
<div>5</div>
<div>6</div>
<div>7</div>
<div>8</div>
<div>9</div>
<div>10</div>
<div>11</div>
<div>12</div>
<div>13</div>
<div>14</div>
<div>15</div>
<div>16</div>
<div>17</div>
<div>18</div>
<div>19</div>
<div>20</div>
<div>21</div></td>
<td>
<div>
<div><code>@Override</code></div>
<div><code>    </code><code>protected void onDraw(Canvas canvas) {</code></div>
<div><code>        </code><code>super</code><code>.onDraw(canvas);</code></div>
<div><code>        </code><code>mPaint.setColor(Color.RED);</code></div>
<div><code>        </code><code>mPaint.setStyle(Paint.Style.STROKE);</code></div>
<div></div>
<div><code>        </code><code>// 实例化路径</code></div>
<div><code>        </code><code>mPath = </code><code>new</code> <code>Path();</code></div>
<div><code>        </code><code>// 移动起点至[100,100]</code></div>
<div><code>        </code><code>mPath.moveTo(100, 100);</code></div>
<div></div>
<div><code>        </code><code>// 添加一条弧线到Path中  </code></div>
<div><code>        </code><code>RectF oval = </code><code>new</code> <code>RectF(100, 100, 300, 400);  </code></div>
<div><code>        </code><code>mPath.addOval(oval, Path.Direction.CW); </code></div>
<div></div>
<div><code>        </code><code>canvas.drawPath(mPath, mPaint);</code></div>
<div><code>        </code></div>
<div><code>        </code><code>mPaint.setTextSize(50);</code></div>
<div><code>        </code><code>// 绘制路径上的文字  </code></div>
<div><code>        </code><code>canvas.drawTextOnPath(</code><code>"123456789"</code><code>, mPath, 0, 0, mPaint); </code></div>
<div><code>    </code><code>}</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914809813730.jpg" alt="" />

如果我们换作：
<div>
<div id="highlighter_36349">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>
<div>1</div></td>
<td>
<div>
<div><code>mPath.addOval(oval, Path.Direction.CCW);</code></div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<img src="http://jcodecraeer.com/uploads/20150309/1425914846985901.jpg" alt="" />

绘制的文字全都沿着Path跑到闭合曲线的“内部”了。

&nbsp;

&nbsp;

转自 <a href="http://www.cnblogs.com/tianzhijiexian/p/4301113.html">http://www.cnblogs.com/tianzhijiexian/p/4301113.html</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>445</wp:post_id>
		<wp:post_date>2015-03-26 10:29:48</wp:post_date>
		<wp:post_date_gmt>2015-03-26 02:29:48</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e7%94%a8path%e6%9d%a5%e7%bb%98%e5%88%b6%e4%b8%80%e4%ba%9b%e5%9b%be%e5%bd%a2</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8e%a7%e4%bb%b6"><![CDATA[自定义控件]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707569]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>android：ToolBar详解</title>
		<link>http://1.duoinfo.sinaapp.com/?p=451</link>
		<pubDate>Fri, 27 Mar 2015 03:34:39 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=451</guid>
		<description></description>
		<content:encoded><![CDATA[来源 <a href="http://blog.mosil.biz/2014/10/android-toolbar/" target="_blank">http://blog.mosil.biz/2014/10/android-toolbar/</a>

这篇文章因为是台湾人写的，语言风格很别致。本文在原文的基础上做了一些微调（主要是繁体字的问题）。

今年(2014) 的 google i/o 发表令多数人为之一亮的 material design，而 google 也从「google i/o 2014」 开始，大家也陆陆续续地看到其更新的 android app 皆套用了这个设计介面。当然，这个设计介面著实让大家感到惊艳外，更让 android 开发者开始担心未来 app 的界面处理了。

不过，所幸有着之前 actionbar 的经验后，android 也很快地在 support library 里面提供了相对应的 api 给开发者使用，本篇就为各位介绍 – toolbar，这是用来取代过去 actionbar 的控件，而现在于 material design 中也对之有一个统一名称：app bar，在未来的 android app 中，就以 toolbar 这个元件来实作之。

<img title="Screenshot_2014-10-24-22-08-20-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162834651417.png" alt="" />
<h2>1. 概述</h2>
Android 3.0  Android 推了 ActionBar 这个控件，而到了2013 年 Google 开始大力地推动所谓的 android style，想要逐渐改善过去 android 纷乱的界面设计，希望让终端使用者尽可能在 android 手机有个一致的操作体验。ActionBar 过去最多人使用的两大套件就是 ActionBarSherlock 以及官方提供在 support library v 7 里的 AppCompat。

既然会有本篇跟各位介绍的 Toolbar，也意味着官方在某些程度上认为 ActionBar 限制了 android app 的开发与设计的弹性，而在 material design 也对之做了名称的定义：App bar。接下来将为各位分成几个阶段进行说明，如何在 android app 中用 toolbar 这个控件来做出一个基本的 app bar 喽。

本篇所使用到的程序请到 <a title="Android-Mosil-Sample-Toolbar" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar" target="_blank">Github</a> 取得。
<h2 id="basic">2. 基础套用</h2>
这个阶段从 toolbar_demo_checkpoint0 开始，分成下列三个部份：

风格 (style)
界面 (layout)
程序 (java)
<h3>2.1 风格(style)</h3>
风格要调整的地方有二

一在 res/values/styles.xml中

二在 /res/values-v21/styles.xml中

为了之后设定方便，我们先在 res/values/styles.xml 里增加一个名为 AppTheme.Base 的风格
<div>
<div id="highlighter_462521">[xml]&lt;style name=&quot;AppTheme.Base&quot; parent=&quot;Theme.AppCompat&quot;&gt;
 &lt;item name=&quot;windowActionBar&quot;&gt;false&lt;/item&gt;
 &lt;item name=&quot;android:windowNoTitle&quot;&gt;true&lt;/item&gt;
 &lt;/style&gt;[/xml]

</div>
</div>
因为此范例只使用 Toolbar，所以我们要将让原本的 ActionBar 隐藏起来，然后将原本 AppTheme 的 parent 属性 改为上面的AppTheme.Base，代码如下：
<div>
<div id="highlighter_641481">

[xml]&lt;resources&gt;

&lt;style name=&quot;AppTheme&quot; parent=&quot;AppTheme.Base&quot;&gt;&lt;/style&gt;
 &lt;style name=&quot;AppTheme.Base&quot; parent=&quot;Theme.AppCompat&quot;&gt;
 &lt;item name=&quot;windowActionBar&quot;&gt;false&lt;/item&gt;
 &lt;item name=&quot;android:windowNoTitle&quot;&gt;true&lt;/item&gt;
 &lt;/style&gt;

&lt;/resources&gt;[/xml]

</div>
</div>
再来调整Android 5.0的style：  /res/values-v21/styles.xml，也将其 parent 属性改为  AppTheme.Base：
<div>
<div id="highlighter_883727">

[xml]&lt;resources&gt;
 &lt;style name=&quot;AppTheme&quot; parent=&quot;AppTheme.Base&quot;&gt;
 &lt;/style&gt;

&lt;/resources&gt;[/xml]

</div>
</div>
<div></div>
<h3>2.2  界面(Layout)</h3>
在 activity_main.xml 里面添加 Toolbar 控件：
<div>
<div id="highlighter_670780">

[xml]&lt;android.support.v7.widget.Toolbar
 android:id=&quot;@+id/toolbar&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:minHeight=&quot;?attr/actionBarSize&quot;&gt;

&lt;/android.support.v7.widget.Toolbar&gt;[/xml]

</div>
</div>
请记得用 support v7 里的 toolbar，不然然只有 API Level 21 也就是 Android 5.0 以上的版本才能使用。

这里需注意，要将 RelatvieLayout 里的四个方向的padding 属性去掉，并记得将原本的 Hello World 设为 layout_below="@+id/toolbar" ，否则会看到像下面这样的错误画面。

<img title="Screenshot_2014-10-24-17-19-45-300x103.png" src="http://www.jcodecraeer.com/uploads/20141118/14162844682218.png" alt="" />
<h3>2.3 程序 (Java)</h3>
在 MainActivity.java 中加入 Toolbar 的声明：
<div>
<div id="highlighter_169691">

[java]Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
 setSupportActionBar(toolbar);[/java]

</div>
</div>
声明后，再将之用 setSupportActionBar 设定，Toolbar即能取代原本的 actionbar 了，此阶段完成画面如下：

<img title="Screenshot_2014-10-24-17-43-08-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162846136933.png" alt="" />

完整代码见：<a title="checok point 1" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar/tree/master/toolbar_demo_checkpoint1" target="_blank">toolbar_demo_checkpoint1</a>
<h2 id="color">3. 自定义颜色(Customization color)</h2>
这个阶段将从 <a title="checok point 1" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar/tree/master/toolbar_demo_checkpoint1" target="_blank">toolbar_demo_checkpoint1</a> 接着往下进行：

<img title="Toolbar-theme-and-background-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162849281137.png" alt="" />

上图是将本阶段要完成的结果画面做了标示，结合下面的描述希望大家能明白。
<ol>
	<li>colorPrimaryDark（状态栏底色）：在风格 (styles) 或是主题 (themes) 里进行设定。</li>
	<li>App bar 底色这个设定分为二，若你的 android app 仍是使用 actionbar ，则直接在风格 (styles) 或是主题 (themes) 里进行设定 colorPrimary 参数即可；
可若是采用 toolbar 的话，则要在界面 (layout) 里面设定 toolbar 控件的 background 属性。</li>
	<li>navigationBarColor（导航栏底色）：</li>
</ol>
仅能在 API v21 也就是 Android 5 以后的版本中使用， 因此要将之设定在 res/values-v21/styles.xml 里面。
<ol>
	<li>主视窗底色：windowBackground</li>
</ol>
也因此在这个阶段，我们需要设定的地方有三，一是 style中(res/values/styles.xml)
<div>
<div id="highlighter_708280">

[xml]&lt;resources&gt;

&lt;style name=&quot;AppTheme&quot; parent=&quot;AppTheme.Base&quot;&gt;&lt;/style&gt;
 &lt;style name=&quot;AppTheme.Base&quot; parent=&quot;Theme.AppCompat&quot;&gt;
 &lt;item name=&quot;windowActionBar&quot;&gt;false&lt;/item&gt;
 &lt;item name=&quot;android:windowNoTitle&quot;&gt;true&lt;/item&gt;
 &lt;!-- Actionbar color --&gt;
 &lt;item name=&quot;colorPrimary&quot;&gt;@color/accent_material_dark&lt;/item&gt;
 &lt;!--Status bar color--&gt;
 &lt;item name=&quot;colorPrimaryDark&quot;&gt;@color/accent_material_light&lt;/item&gt;
 &lt;!--Window color--&gt;
 &lt;item name=&quot;android:windowBackground&quot;&gt;@color/dim_foreground_material_dark&lt;/item&gt;
 &lt;/style&gt;

&lt;/resources&gt;[/xml]

</div>
</div>
再来是 v21 的style中 (res/values-v21/styles.xml)
<div>
<div id="highlighter_214078">

[xml]&lt;resources&gt;
 &lt;style name=&quot;AppTheme&quot; parent=&quot;AppTheme.Base&quot;&gt;
 &lt;item name=&quot;android:navigationBarColor&quot;&gt;@color/accent_material_light&lt;/item&gt;
 &lt;/style&gt;

&lt;/resources&gt;[/xml]

</div>
</div>
最后，就是为了本篇的主角 – Toolbar 的 background 进行设定。
<div>
<div id="highlighter_817315">

[xml]&lt;android.support.v7.widget.Toolbar
 android:id=&quot;@+id/toolbar&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:background=&quot;?attr/colorPrimary&quot;
 android:minHeight=&quot;?attr/actionBarSize&quot;&gt;

&lt;/android.support.v7.widget.Toolbar&gt;[/xml]

</div>
</div>
在本范例中，toolbar 是设定来在 activity_main.xml，对其设定 background 属性： android:background="?attr/colorPrimary" ，这样就可以使之延用 Actionbar 的颜色设定喽。

最后，再来看一下结果画面。

<img title="Toolbar-Component-Click-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162856831120.png" alt="" />

完整代码见： <a title="checok point 2" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar/tree/master/toolbar_demo_checkpoint2" target="_blank">toolbar_demo_checkpoint2</a>
<h2 id="component">4. 控件 (component)</h2>
本阶段将从 <a title="checok point 2" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar/tree/master/toolbar_demo_checkpoint2" target="_blank">toolbar_demo_checkpoint2</a> 接续，在还未于 &lt;android.support.v7.widget.Toolbar/&gt;  标签中，自行添加元件的 toolbar 有几个大家常用的元素可以使用，请先见下图：

<img title="Toolbar-Component-300x160.png" src="http://www.jcodecraeer.com/uploads/20141118/1416285884351.png" alt="" />

大抵来说，预设常用的几个元素就如图中所示，接着就依序来说明之：
<ol>
	<li>setNavigationIcon
即设定 up button 的图标，因为 Material 的介面，在 Toolbar这里的 up button样式也就有別于过去的 ActionBar 哦。</li>
</ol>
<ol>
	<li>setLogo
APP 的图标。</li>
	<li>setTitle
主标题。</li>
	<li>setSubtitle
副标题。</li>
	<li>setOnMenuItemClickListener
设定菜单各按鈕的动作。</li>
</ol>
先來看到菜单外的代码，在 MainActivity.java 中：

[java]Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
 setSupportActionBar(toolbar);
 // Menu item click 的監聽事件一樣要設定在 setSupportActionBar 才有作用
 toolbar.setOnMenuItemClickListener(onMenuItemClick);
 // App Logo
 toolbar.setLogo(R.mipmap.ic_launcher);
 // Title
 toolbar.setTitle(&quot;My Title&quot;);
 // Sub Title
 toolbar.setSubtitle(&quot;Sub title&quot;);

setSupportActionBar(toolbar);

// Navigation Icon 要設定在 setSupoortActionBar 才有作用
 // 否則會出現 back button
 toolbar.setNavigationIcon(R.mipmap.ab_android);[/java]

先来看到
<div></div>
这边要留意的是setNavigationIcon需要放在 setSupportActionBar之后才会生效。

菜单部分，需要先在res/menu/menu_main.xml左定义：

[xml]&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
 xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
 xmlns:tools=&quot;http://schemas.android.com/tools&quot;
 tools:context=&quot;.MainActivity&quot;&gt;

&lt;item android:id=&quot;@+id/action_edit&quot;
 android:title=&quot;编辑&quot;
 android:orderInCategory=&quot;80&quot;
 android:icon=&quot;@mipmap/ab_edit&quot;
 app:showAsAction=&quot;ifRoom&quot; /&gt;

&lt;item android:id=&quot;@+id/action_share&quot;
 android:title=&quot;分享&quot;
 android:orderInCategory=&quot;90&quot;
 android:icon=&quot;@mipmap/ab_share&quot;
 app:showAsAction=&quot;ifRoom&quot; /&gt;

&lt;item android:id=&quot;@+id/action_settings&quot;
 android:title=&quot;@string/action_settings&quot;
 android:orderInCategory=&quot;100&quot;
 app:showAsAction=&quot;never&quot;/&gt;
&lt;/menu&gt;[/xml]
<div></div>
再回到MainActivity.java 中加入OnMenuItemClickListener 的监听者：
<div></div>
[java]private Toolbar.OnMenuItemClickListener onMenuItemClick = new Toolbar.OnMenuItemClickListener() {
 @Override
 public boolean onMenuItemClick(MenuItem menuItem) {
 String msg = &quot;&quot;;
 switch (menuItem.getItemId()) {
 case R.id.action_edit:
 msg += &quot;Click edit&quot;;
 break;
 case R.id.action_share:
 msg += &quot;Click share&quot;;
 break;
 case R.id.action_settings:
 msg += &quot;Click setting&quot;;
 break;
 }

if(!msg.equals(&quot;&quot;)) {
 Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();
 }
 return true;
 }
 };[/java]

将onMenuItemClick监听者设置给toolbar
<div></div>
[java]setSupportActionBar(toolbar);
 // Menu item click 的監聽事件一樣要設定在 setSupportActionBar 才有作用
 toolbar.setOnMenuItemClickListener(onMenuItemClick);[/java]

和 setNavigationIcon 一样，需要將之设定在 setSupportActionBar 之后才有作用。执行上面的代码便会得到下面的界面。

<img title="Toolbar-Component-Click是-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162860447819.png" alt="" />

完完整程序见：<a title="checok point 3" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar/tree/master/toolbar_demo_checkpoint3" target="_blank">toolbar_demo_checkpoint3
</a>
<h2>5. 总结</h2>
在这样的架构设计下，ToolBar直接成了Layout中可以控制的东西，相对于过去的actionbar来说，设计与可操控性大幅提升。

本文上面的解释中用到的完成代码：toolbar demo check point 0 ~ 4，请到<a title="Android-Mosil-Sample-Toolbar" href="https://github.com/mosil/Android-Mosil-Sample-Toolbar" target="_blank">Github</a> 取得。

最后再附上一个界面上常用的属性说明图：

<img title="Component-Theme1-168x300.png" src="http://www.jcodecraeer.com/uploads/20141118/14162861629057.png" alt="" />

这里按照图中从上到下的顺序做个简单的说明：
<ul>
<ul>
	<li>colorPrimaryDark
<ul>
	<li>状态栏背景色。</li>
	<li>在 style 的属性中设置。</li>
</ul>
</li>
	<li>textColorPrimary
<ul>
	<li>App bar 上的标题与更多菜单中的文字颜色。</li>
	<li>在 style 的属性中设置。</li>
</ul>
</li>
	<li>App bar 的背景色
<ul>
	<li>Actionbar 的背景色设定在 style 中的 colorPrimary。</li>
	<li>Toolbar 的背景色在layout文件中设置background属性。</li>
</ul>
</li>
	<li>colorAccent
<ul>
	<li>各控制元件(如：check box、switch 或是 radoi) 被勾选 (checked) 或是选定 (selected) 的颜色。</li>
	<li>在 style 的属性中设置。</li>
</ul>
</li>
	<li>colorControlNormal
<ul>
	<li>各控制元件的预设颜色。</li>
	<li>在 style 的属性中设置</li>
</ul>
</li>
	<li>windowBackground
<ul>
	<li>App 的背景色。</li>
	<li>在 style 的属性中设置</li>
</ul>
</li>
	<li>navigationBarColor
<ul>
	<li>导航栏的背景色，但只能用在 API Level 21 (Android 5) 以上的版本</li>
	<li>在 style 的属性中设置</li>
</ul>
</li>
</ul>
</ul>
最后需要注意的是：使用material主题的时候，必须设定targetSdkVersion = 21，否则界面看起来是模糊的]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>451</wp:post_id>
		<wp:post_date>2015-03-27 11:34:39</wp:post_date>
		<wp:post_date_gmt>2015-03-27 03:34:39</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%ef%bc%9atoolbar%e8%af%a6%e8%a7%a3</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="material-design"><![CDATA[material design]]></category>
		<category domain="post_tag" nicename="material-design"><![CDATA[material design]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707571]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>十分钟设置android状态栏一体化开源工程推荐</title>
		<link>http://1.duoinfo.sinaapp.com/?p=460</link>
		<pubDate>Fri, 27 Mar 2015 06:31:03 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=460</guid>
		<description></description>
		<content:encoded><![CDATA[1、前言

在android kitkat 有一个新的特性可以设置手机状态栏的背景，让手机整个界面的风格保持一致，看起来非常清爽，在去年的google i/o上的android l默认就是这种风格。来现在看我们怎么加上这个酷黑狂拽掉渣天的功能怎么给我们的程序加上。来先看一下demo效果图。

<img src="http://img.blog.csdn.net/20140930231425609" alt="" />

2、关与kitkat

android 4.4 提供了一套能透明的系统ui样式给状态栏和导航栏，这样的话就不用向以前那样每天面对着黑乎乎的上下两条黑栏了，还可以调成跟activity 一样的样式，形成一个完整的主题。

3、设置方法

首先要打开activity的透明主题功能，可以把activity的主题设置继承*.TranslucentDecor 主题，然后设置android:windowTranslucentNavigation 或者android:windowTranslucentStatus的主题属性为true，又或者在activity的代码里面开启FLAG_TRANSLUCENT_NAVIGATION 或是 FLAG_TRANSLUCENT_STATUS的window窗口标识。由于透明主题不能在4.4以前的版本里面使用，所以系统样式跟以前没有区别，也就是看不到任何变化，这是一个兼容模式，这个模式可以兼容到api 10.

激活主题

[java]@Override
protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_main);
 // 创建状态栏的管理实例
 SystemBarTintManager tintManager = new SystemBarTintManager(this);
 // 激活状态栏设置
 tintManager.setStatusBarTintEnabled(true);
 // 激活导航栏设置
 tintManager.setNavigationBarTintEnabled(true);
}[/java]

设置状态栏颜色和图片

// 设置一个颜色给系统栏

[java]tintManager.setTintColor(Color.parseColor(&quot;#99000FF&quot;));
// 设置一个样式背景给导航栏
tintManager.setNavigationBarTintResource(R.drawable.my_tint);
// 设置一个状态栏资源
tintManager.setStatusBarTintDrawable(MyDrawable);[/java]

4、开源下载地址

<a title="https://github.com/hexiaochun/SystemBarTint" href="https://github.com/hexiaochun/SystemBarTint" target="_blank">https://github.com/hexiaochun/SystemBarTint</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>460</wp:post_id>
		<wp:post_date>2015-03-27 14:31:03</wp:post_date>
		<wp:post_date_gmt>2015-03-27 06:31:03</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%8d%81%e5%88%86%e9%92%9f%e8%ae%be%e7%bd%aeandroid%e7%8a%b6%e6%80%81%e6%a0%8f%e4%b8%80%e4%bd%93%e5%8c%96%e5%bc%80%e6%ba%90%e5%b7%a5%e7%a8%8b%e6%8e%a8%e8%8d%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707572]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android SwipeRefreshLayout教程</title>
		<link>http://1.duoinfo.sinaapp.com/?p=464</link>
		<pubDate>Fri, 27 Mar 2015 07:22:24 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=464</guid>
		<description></description>
		<content:encoded><![CDATA[SwipeRefreshLayout组件只接受一个子组件：即需要刷新的那个组件。它使用一个侦听机制来通知拥有该组件的监听器有刷新事件发生，换句话说我们的Activity必须实现通知的接口。该Activity负责处理事件刷新和刷新相应的视图。一旦监听者接收到该事件，就决定了刷新过程中应处理的地方。如果要展示一个“刷新动画”，它必须调用<code>setRefrshing（true）</code>，否则取消动画就调用<code>setRefreshing（false）</code>。

[xml]&lt;android.support.v4.widget.SwipeRefreshLayout
 xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
 android:id=&quot;@+id/swipe_container&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;&gt;

&lt;ListView
 android:id=&quot;@+id/listview&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:padding=&quot;16dp&quot; /&gt;

&lt;/android.support.v4.widget.SwipeRefreshLayout&gt;[/xml]

[java]package com.dy.ustc.swiperefreshlayout;

import android.app.Activity;
import android.os.Bundle;
import android.os.Handler;
import android.support.v4.widget.SwipeRefreshLayout;
import android.widget.ArrayAdapter;
import android.widget.ListView;

import java.util.ArrayList;


public class MainActivity extends Activity implements SwipeRefreshLayout.OnRefreshListener {

private SwipeRefreshLayout mSwipeLayout;
 private ListView mListView;
 private ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();

protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_main);

mListView = (ListView) findViewById(R.id.listview);
 mListView.setAdapter(new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1,
 getData()));

mSwipeLayout = (SwipeRefreshLayout) findViewById(R.id.swipe_container);
 mSwipeLayout.setOnRefreshListener(this);
 mSwipeLayout.setColorSchemeResources(android.R.color.holo_blue_bright,
 android.R.color.holo_green_light, android.R.color.holo_orange_light,
 android.R.color.holo_red_light);
 }

private ArrayList&lt;String&gt; getData() {
 list.add(&quot;Hello&quot;);
 list.add(&quot;This is stormzhang&quot;);
 list.add(&quot;An Android Developer&quot;);
 list.add(&quot;Love Open Source&quot;);
 list.add(&quot;My GitHub: stormzhang&quot;);
 list.add(&quot;weibo: googdev&quot;);
 return list;
 }

public void onRefresh() {
 new Handler().postDelayed(new Runnable() {
 @Override
 public void run() {
 mSwipeLayout.setRefreshing(false);
 }
 }, 5000);
 }
}[/java]

github上的例子：

<a title="https://github.com/leerduo/SwipeRefreshLayoutDemo" href="https://github.com/leerduo/SwipeRefreshLayoutDemo" target="_blank">https://github.com/leerduo/SwipeRefreshLayoutDemo</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>464</wp:post_id>
		<wp:post_date>2015-03-27 15:22:24</wp:post_date>
		<wp:post_date_gmt>2015-03-27 07:22:24</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-swiperefreshlayout%e6%95%99%e7%a8%8b</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="swiperefreshlayout"><![CDATA[SwipeRefreshLayout]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707573]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>LoaderManager使用详解（一）---没有Loader之前的世界</title>
		<link>http://1.duoinfo.sinaapp.com/?p=474</link>
		<pubDate>Fri, 27 Mar 2015 08:57:27 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=474</guid>
		<description></description>
		<content:encoded><![CDATA[<div>来源：</div>
<div><a href="http://www.androiddesignpatterns.com/2012/07/loaders-and-loadermanager-background.html" target="_blank">http://www.androiddesignpatterns.com/2012/07/loaders-and-loadermanager-background.html</a></div>
<div>感谢作者<a href="https://google.com/+AlexLockwood" target="_blank">Alex Lockwood</a>的努力，让我们看到如此精彩的文章。</div>
<h1><a name="t0"></a>第一部分 没有Loader之前的世界</h1>
<div></div>
<div>这一部分将对Loaders和LoaderManager做一个简短的介绍。第一节将在Android3.0之前如何载入数据，指出其缺陷。第二节讲述每个类的目的，以及它们异步载入数据的能力。</div>
<div>这篇文章是有关Loaders和LoaderManager一系列文章的开篇，该系列如下：</div>
<div></div>
<div>一：Loaders之前世界</div>
<div>二：<a href="http://blog.csdn.net/murphykwu/article/details/35287883" target="_blank">了解LoaderManager</a></div>
<div>三：<a href="http://blog.csdn.net/murphykwu/article/details/35288477" target="_blank">实现Loaders</a></div>
<div>四：<a href="http://blog.csdn.net/murphykwu/article/details/35288753" target="_blank">实例：AppListLoader</a></div>
<div></div>
<div>如果你对Loaders和LoaderManager完全不了解，在继续阅读之前，强烈建议你读一下<a href="http://developer.android.com/guide/components/loaders.html" target="_blank">Loaders向导</a>。</div>
<div></div>
<h1><a name="t1"></a>以前情况</h1>
<div>在Android3.0之前，很多应用程序响应性能方面有缺陷。UI切换之间的小故障、activity切换延迟、ANR问题。响应性能方面的故障大多数来源于此事实----大多数开发者在UI线程中执行了查询操作---用这种方式载入数据是最差的选择。</div>
<div></div>
<div>在<a href="http://developer.android.com/guide/practices/responsiveness.html" target="_blank">这篇文章</a>强调及时反馈的同时，Android3.0之前的APIs似乎并没有支持该特性。在Loaders之前，cursors主要通过两个Activity方法（现在已经过时deprecated）来进行管理和查询：</div>
<div></div>
<div>public void startManagingCursor(Cursor)</div>
<div>告诉activity根据自己的生命周期来管理cursor的生命周期。cursor会被自动deactivate()当活动stopped时。会自动close()当活动摧毁的时候。当活动stopped之后重新restarted，cursor会re-queried(requery())重新查询最新的数据。</div>
<div></div>
<div>public Cursor managedQuery(Uri, String, String, String, String)</div>
<div>该函数是对ContentResolver的query()方法的包装。除了执行query之外，在它返回之前还会将调用startManagingCursor(cursor)。也就是说将这个query的cursor放入了activity生命周期管理了。</div>
<div></div>
<div>用起来很方便的同时，上面的方法在UI线程中执行查询操作时，会导致严重的延迟问题。而且该“managed cursors”方式在activity配置变化（configuration changed，横竖屏切换、键盘弹出等）时，并不会保持数据。在这些情况下会重新requry()数据，但是实际上是没有必要、低效，而且会导致方向切换呆滞和卡顿。</div>
<div></div>
<h1><a name="t2"></a>Managed Cursors的问题</h1>
<div>让我们在一个简单的代码里面模拟managed cursors的问题。下面提供的代码是在一个ListActivity里面载入数据使用的是Android3.0之前的APIs。该活动从ContentProvider里面查询数据，并且管理返回的cursor。查询结果用SimpleCursorAdapter包装，并且显示在listview中。代码精炼如下：</div>
<div></div>
<div>
<div>
<div>
<div>

[java]public class SampleListActivity extends ListActivity {

private static final String[] PROJECTION = new String[] {&quot;_id&quot;, &quot;text_column&quot;};

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

// Performs a &quot;managed query&quot; to the ContentProvider. The Activity
 // will handle closing and requerying the cursor.
 //
 // WARNING!! This query (and any subsequent re-queries) will be
 // performed on the UI Thread!!
 Cursor cursor = managedQuery(
 CONTENT_URI, // The Uri constant in your ContentProvider class
 PROJECTION, // The columns to return for each data row
 null, // No where clause
 null, // No where clause
 null); // No sort order

String[] dataColumns = { &quot;text_column&quot; };
 int[] viewIDs = { R.id.text_view };

 // Create the backing adapter for the ListView.
 //
 // WARNING!! While not readily obvious, using this constructor will
 // tell the CursorAdapter to register a ContentObserver that will
 // monitor the underlying data source. As part of the monitoring
 // process, the ContentObserver will call requery() on the cursor
 // each time the data is updated. Since Cursor#requery() is performed
 // on the UI thread, this constructor should be avoided at all costs!
 SimpleCursorAdapter adapter = new SimpleCursorAdapter(
 this, // The Activity context
 R.layout.list_item, // Points to the XML for a list item
 cursor, // Cursor that contains the data to display
 dataColumns, // Bind the data in column &quot;text_column&quot;...
 viewIDs); // ...to the TextView with id &quot;R.id.text_view&quot;

// Sets the ListView's adapter to be the cursor adapter that was
 // just created.
 setListAdapter(adapter);
 }
}[/java]

</div>
</div>
</div>
上面的代码有3个问题。如果你读懂了上面讲的内容，那么开始两个问题不难读懂。</div>
<div></div>
<div>1. managedQuery在Ui线程中执行了一个查询操作，这将导致应用无响应，这种方法不应该再使用。</div>
<div>2. 通过查看Activity.java源码，可以知道managedQuery也顺便调用了startManagingCursor来管理查询到的数据。看起来很简便，因为我们不用考虑cursor后续的关闭、requery等。但是使用这种方式导致每次activity的状态从stopped返回时都需要重新查询数据，这通常会导致UI线程卡顿。让activity替我们管理cursor所冒的风险大于便捷性。</div>
<div>3. 32行的SimpleCursorAdapter构造方法过时了，不应该再使用。该构造方法问题是，当有改变时，将导致SimpleCursorAdapter自动查询。更具体来说，CursorAdapter会在数据上注册一个ContentObserver监听器，当监听的数据变化时会requery数据。我们应该使用标准的构造函数（如果你尝试使用CursorLoader来载入适配器数据，确保最后一个参数传入值为0）。如果你不能理解第三条，没有关系，这仅仅只是个小错误。</div>
<div></div>
<div>Android平板设备的发布，应该加强UI友好性（反应更快）。更大的设备，7~10寸的平板的应用更复杂、交互更多、有更多的界面布局。后续将介绍Fragment，fragment使应用更动态化，更多的事件驱动。一个简单的，单线程的方法来载入数据显然已经不再合适。所以这就是Loader和LoaderManager在Android3.0诞生的背景。</div>
<div></div>
<h1><a name="t3"></a>Android3.0，Loaders， LoaderManager</h1>
<div>在Honeycomb之前，很难管理cursors的操作，比如，在UI线程中正常同步，确保所有查询适时在后台线程中执行。Android3.0引入了Loader和LoaderManager类来简化该过程。可以通过使用ASL（Android Support Library），在Android1.6以上的系统实现这两个类。</div>
<div>新的Loader API是一个巨大的进步，是用户体验的巨大进步。Loaders确保所有的cursor操作是异步的，从而排除了UI线程中堵塞的可能性。而且，当通过LoaderManager来管理，Loaders还可以在activity实例中保持当前的cursor数据，也就是不需要重新查询（比如，当因为横竖屏切换需要重新启动activity时）。还有额外的好处，当数据改变时，Loaders可以很聪明的自动检测底层数据的更新和重新检索。</div>
<div></div>
<h1><a name="t4"></a>总结</h1>
<div>自从有了Honeycomb的Loaders以及其实现库，Android应用变得更好了。现在还使用startManagingCursor和managedQuery是非常不合适的，不仅仅将你的程序变慢，而且存在程序卡死的潜在地可能性。另一方面，Loaders可以通过将数据载入工作交给单独的后台进程，将明显的提高用户体验。</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>474</wp:post_id>
		<wp:post_date>2015-03-27 16:57:27</wp:post_date>
		<wp:post_date_gmt>2015-03-27 08:57:27</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>loadermanager%e4%bd%bf%e7%94%a8%e8%af%a6%e8%a7%a3%ef%bc%88%e4%b8%80%ef%bc%89-%e6%b2%a1%e6%9c%89loader%e4%b9%8b%e5%89%8d%e7%9a%84%e4%b8%96%e7%95%8c</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="loadermanager"><![CDATA[LoaderManager]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707574]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>了解LoaderManager</title>
		<link>http://1.duoinfo.sinaapp.com/?p=476</link>
		<pubDate>Fri, 27 Mar 2015 09:02:01 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=476</guid>
		<description></description>
		<content:encoded><![CDATA[<div><strong>了解LoaderManager</strong></div>
<div></div>
<div>这篇文章将介绍LoaderManager类，这是该系列的第二篇文章。</div>
<div>
<div>一：<a href="http://blog.csdn.net/murphykwu/article/details/35287303" target="_blank">Loaders之前世界</a></div>
<div>二：了解LoaderManager</div>
<div>三：<a href="http://blog.csdn.net/murphykwu/article/details/35288477" target="_blank">实现Loaders</a></div>
<div>四：<a href="http://blog.csdn.net/murphykwu/article/details/35288753" target="_blank">实例：AppListLoader</a></div>
</div>
<div></div>
<div>注意：</div>
<div>要了解这一LoaderManager这部分知识，要求对Loaders如何工作有基本了解。Loaders的实现将在下一篇文章中涵盖。现在你只需要将Loaders看成一个简单、字包含的对象。该对象特性包括：1.在一个单独线程载入数据；2.监测底层数据源，当探测到有改变时就更新或者重新查询。了解上面的Loader相关内容就足以了解本文内容了。下文所有的Loaders假设100%正确。</div>
<div></div>
<h1><a name="t0"></a><strong>LoaderManager是什么？</strong></h1>
<div></div>
<div>简单的理解是，LoaderManager用来负责管理与Activity或者Fragment联系起来的一个或多个Loaders对象。每个Activity或者Fragment都有唯一的一个LoaderManager实例，用来启动、停止、保持、重启、关闭它的Loaders。这些事件有时直接在客户端通过调用initLoader()/restartLoader()/destroyLoader()函数来实现。通常这些事件通过主要的Activity/Fragment声明周期事件来触发，而不是手动（当然也可以手动调用）。比如，当一个Activity关闭时（destroyed），改活动将指示它的LoaderManager来销毁并且关闭它的Loaders（当然也会销毁并关闭与这些Loaders关联的资源，比如Cursor）。</div>
<div>LoaderManager并不知道数据如何装载以及何时需要装载。相反地，LoaderManager只需要控制它的Loaders们开始、停止、重置他们的Load行为，在配置变换（比如横竖屏切换）时保持loaders们的状态，并提供一个简单的接口来获取load结果到客户端中。从上面的行为可以看到，LoaderManager是一个比现在过时的startManagingCursor方法更加智能和通用的方法。在Activity的声明周期状态轮转中，比较两种管理数据的方法，可以发现LoaderManager方法有下面几个方面更胜一筹：</div>
<div></div>
<div>1. startManagingCursor管理Cursors，而LoaderManager管理Loader&lt;D&gt;对象。Loader&lt;D&gt;是一个模板类，D是一个包含了需要载入数据的类。也就是说，数据源并不必须是Cursor，它可以是List、JSONArray。。。任何类。LoaderManager与它包含的数据内容解耦了，所以更加灵活。</div>
<div></div>
<div>2. 调用startManagingCursor会导致Activity在已经加入管理的Cursor上调用requery()方法。在第一篇文章中提到过，在UI线程执行requery()方法代价非常高。相反的是，Loader&lt;D&gt;的子类会异步载入（译者注：另外再开一个线程，就叫异步了。）数据，所以使用LoaderManager永远不会产生阻塞UI线程的情况。</div>
<div></div>
<div>3. startManagingCursor在配置变化（例如横竖屏切换）时，并不会保持Cursor的状态。麻烦的是，每次Activity由于配置变化（比如，简单的横竖屏切换），都会导致Cursor下回并且被重新查询。LoaderManager就智能多了，当配置变化时，它会保持它里面的Loader们的状态，所以并不需要重新查询数据。</div>
<div></div>
<div>4. LoaderManager提供无缝的数据监测。任何时候，当Loader的数据源改变，LoaderManager将会从对应的Loader上面接收到一个新的同步载入数据，并将更新数据返回给客户端（注意：仅当Loader被正确实现，LoaderManager才会接收到这些数据变化通知。我们将会在该系列的第三篇文章讨论自定义Loaders的实现）。</div>
<div></div>
<div>如果你觉得上面很难，我也并不会强调她。上面的内容最重要的是LoaderManager让你的生活更容易。LoaderManager为你初始化、管理、销毁Loaders，减少了代码复杂度和与Activity或者Fragment生命周期相关的bug。更多地，与LoaderManager交互需要实现三个简单的回调方法，我们在下一节将讨论LoaderManager.LoaderCallbacks&lt;D&gt;。</div>
<div></div>
<h1><a name="t1"></a>实现LoaderManager.LoaderCallbacks&lt;D&gt;接口</h1>
<div>LoaderManager.LoaderCallbacks&lt;D&gt;接口LoaderManager用来向客户返回数据的方式。每个Loader都有自己的回调对象供与LoaderManager进行交互。该回调对象在实现LoaderManager中地位很高，告诉LoaderManager如何实例化Loader(onCreateLoader)，以及当载入行为结束或者重启（onLoadFinished或者onLoadReset）之后执行什么操作。大多数情况，你需要把该接口实现为组件的一部分，比如说让你的Activity或者Fragment实现LoadManager.LoaderCallbacks&lt;D&gt;接口。</div>
<div>

[java]public class SampleActivity extends Activity implements LoaderManager.LoaderCallbacks&lt;D&gt; {

public Loader&lt;D&gt; onCreateLoader(int id, Bundle args) { ... }

public void onLoadFinished(Loader&lt;D&gt; loader, D data) { ... }

public void onLoaderReset(Loader&lt;D&gt; loader) { ... }

/* ... */
}[/java]
<div>一旦实现该接口，客户端将回调对象（本例中为“this”）作为LoaderManager的initLoader函数的第三个参数传输。</div>
<div>总的来说，实现回调接口非常直接明了。每个回调方法都有各自明确的与LoaderManager进行交互的目的：</div>
<div>1. onCreateLoader是一个工厂方法，用来返回一个新的Loader。LoaderManager将会在它第一次创建Loader的时候调用该方法。</div>
<div>2. onLoadFinished方法将在Loader创建完毕的时候自动调用。典型用法是，当载入数据完毕，客户端（译者注：调用它的Activity之类的）需要更新应用UI。客户端假设每次有新数据的时候，新数据都会返回到这个方法中。记住，检测数据源是Loader的工作，Loader也会执行实际的同步载入操作。一旦Loader载入数据完成，LoaderManager将会接受到这些载入数据，并且将将结果传给回调对象的onLoadFinished方法，这样客户端（比如Activity或者Fragment）就能使用该数据了。</div>
<div></div>
<div>3. 最后，当Loader们的数据被重置的时候将会调用onLoadReset。该方法让你可以从就的数据中移除不再有用的数据。</div>
<div></div>
<div>在下一节中，我们将讨论Android初学者们经常问到的问题：如何从过时的Managed Cursor转移到更强大的LoaderManager来？</div>
<div></div>
<h1><a name="t2"></a>从Managed Cursor转移到LoaderManager</h1>
<div>下面的代码跟上一篇文章的代码实现的功能类似。当然，不同就是改成使用LoaderManager来实现。CursorLoader确保所有的查询都是异步执行，这确保了我们不会阻塞UI线程。更进一步，LoaderManager在Activity全生命周期管理CursorLoader，当配置转换时保持它的数据。处理每次新数据在回调接口的onLoadFinished方法中的载入。这样Activity可以很自由的使用查询结果。</div>
<div>

[java]public class SampleListActivity extends ListActivity implements
 LoaderManager.LoaderCallbacks&lt;Cursor&gt; {

private static final String[] PROJECTION = new String[] { &quot;_id&quot;, &quot;text_column&quot; };

// The loader's unique id. Loader ids are specific to the Activity or
 // Fragment in which they reside.
 private static final int LOADER_ID = 1;

// The callbacks through which we will interact with the LoaderManager.
 private LoaderManager.LoaderCallbacks&lt;Cursor&gt; mCallbacks;

// The adapter that binds our data to the ListView
 private SimpleCursorAdapter mAdapter;

@Override
 public void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);

String[] dataColumns = { &quot;text_column&quot; };
 int[] viewIDs = { R.id.text_view };

// Initialize the adapter. Note that we pass a 'null' Cursor as the
 // third argument. We will pass the adapter a Cursor only when the
 // data has finished loading for the first time (i.e. when the
 // LoaderManager delivers the data to onLoadFinished). Also note
 // that we have passed the '0' flag as the last argument. This
 // prevents the adapter from registering a ContentObserver for the
 // Cursor (the CursorLoader will do this for us!).
 mAdapter = new SimpleCursorAdapter(this, R.layout.list_item,
 null, dataColumns, viewIDs, 0);

// Associate the (now empty) adapter with the ListView.
 setListAdapter(mAdapter);

// The Activity (which implements the LoaderCallbacks&lt;Cursor&gt;
 // interface) is the callbacks object through which we will interact
 // with the LoaderManager. The LoaderManager uses this object to
 // instantiate the Loader and to notify the client when data is made
 // available/unavailable.
 mCallbacks = this;

// Initialize the Loader with id '1' and callbacks 'mCallbacks'.
 // If the loader doesn't already exist, one is created. Otherwise,
 // the already created Loader is reused. In either case, the
 // LoaderManager will manage the Loader across the Activity/Fragment
 // lifecycle, will receive any new loads once they have completed,
 // and will report this new data back to the 'mCallbacks' object.
 LoaderManager lm = getLoaderManager();
 lm.initLoader(LOADER_ID, null, mCallbacks);
 }

@Override
 public Loader&lt;Cursor&gt; onCreateLoader(int id, Bundle args) {
 // Create a new CursorLoader with the following query parameters.
 return new CursorLoader(SampleListActivity.this, CONTENT_URI,
 PROJECTION, null, null, null);
 }

@Override
 public void onLoadFinished(Loader&lt;Cursor&gt; loader, Cursor cursor) {
 // A switch-case is useful when dealing with multiple Loaders/IDs
 switch (loader.getId()) {
 case LOADER_ID:
 // The asynchronous load is complete and the data
 // is now available for use. Only now can we associate
 // the queried Cursor with the SimpleCursorAdapter.
 mAdapter.swapCursor(cursor);
 break;
 }
 // The listview now displays the queried data.
 }

@Override
 public void onLoaderReset(Loader&lt;Cursor&gt; loader) {
 // For whatever reason, the Loader's data is now unavailable.
 // Remove any references to the old data by replacing it with
 // a null Cursor.
 mAdapter.swapCursor(null);
 }
}[/java]

</div>
<h1>总结</h1>
<div>正如其名LoaderManager，它负责在Activity或者Fragment的生命周期内管理Loader们。LoaderManager很简单，并且它的实现代码量通常很少。比较难的部分是实现Loaders，这个主题将在下一篇文章中讨论：实现Loaders(三)（超链接）</div>
</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>476</wp:post_id>
		<wp:post_date>2015-03-27 17:02:01</wp:post_date>
		<wp:post_date_gmt>2015-03-27 09:02:01</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e4%ba%86%e8%a7%a3loadermanager</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="loadermanager"><![CDATA[LoaderManager]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707575]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>10</wp:comment_id>
			<wp:comment_author><![CDATA[Eversleeping]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://t.qq.com/eversleeping6094</wp:comment_author_url>
			<wp:comment_author_IP>61.190.88.149</wp:comment_author_IP>
			<wp:comment_date>2015-03-27 17:08:57</wp:comment_date>
			<wp:comment_date_gmt>2015-03-27 09:08:57</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[最后会提供一个综合的例子]]></wp:comment_content>
			<wp:comment_approved>1</wp:comment_approved>
			<wp:comment_type></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>1</wp:comment_user_id>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_parent_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707456]]></wp:meta_value>
			</wp:commentmeta>
			<wp:commentmeta>
				<wp:meta_key>duoshuo_post_id</wp:meta_key>
				<wp:meta_value><![CDATA[1376650130626707465]]></wp:meta_value>
			</wp:commentmeta>
		</wp:comment>
	</item>
	<item>
		<title> LoaderManager使用详解（三）---实现Loaders</title>
		<link>http://1.duoinfo.sinaapp.com/?p=480</link>
		<pubDate>Fri, 27 Mar 2015 09:10:28 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=480</guid>
		<description></description>
		<content:encoded><![CDATA[<div>这篇文字将介绍Loader&lt;D&gt;类，并且介绍自定义Loader的实现。这是本系列的第三篇文章。</div>
<div></div>
<div>
<div>一：<a href="http://blog.csdn.net/murphykwu/article/details/35287303" target="_blank">Loaders之前世界</a></div>
<div>二：<a href="http://blog.csdn.net/murphykwu/article/details/35287883" target="_blank">了解LoaderManager</a></div>
<div>三：实现Loaders</div>
<div>四：<a href="http://blog.csdn.net/murphykwu/article/details/35288753" target="_blank">实例：AppListLoader</a></div>
</div>
<div></div>
<div>重中之重，如果你还没有读过前面两篇文章，我建议你在深入之前先读一读那两篇文章。先简短的总结一下这篇博客覆盖了什么内容。Loader之前的世界（第一篇）描述了Android3.0之前的数据载入方法和在UI主线程中执行的冗长的查询操作。这些UI非友好的API导致了应用响应变差。总总情况就是了解LoaderManager（第二篇）的写作动机。这篇文章介绍了LoaderManager类，并且讲到了它在异步载入数据中所扮演的角色。LoaderManager在Activity和Fragment的声明周期中管理Loaders，并且在配置变化时保持已载入的数据（译者注：避免了Activity重启导致数据重载入）。</div>
<div></div>
<h1><a name="t0"></a>Loader基础</h1>
<div></div>
<div>Loades负责在一个单独线程中执行查询，监控数据源改变，当探测到改变时将查询到的结果集发送到注册的监听器上（通常是LoaderManager）。下面这些特性使Loaders成为AndroidSDK中强大的工具：</div>
<div></div>
<div>1. 它封装了实际的数据载入。Activity/Fragment不再需要知道如何载入数据。实际上，Activity/Fragment将该任务委托给了Loader，它在后台执行查询要求并且将结果返回给Activity/Fragment。</div>
<div></div>
<div>2. 客户端不需要知道查询如何执行。Activity/Fragment不需要担心查询如何在独立的线程中执行，Loder会自动执行这些查询操作。这种方式不仅减少了代码复杂度同事也消除了线程相关bug的潜在可能。</div>
<div></div>
<div>3. 它是为安全的事件驱动方式。Loader检测底层数据，当检测到改变时，自动执行新的载入获取最新数据。这使得使用Loader变得容易，客户端可以相信Loader将会自己自动更新它的数据。Activity/Fragment所需要做的就是初始化Loader，并且对任何反馈回来的数据进行响应。除此之外，所有其他的事情都由Loader来解决。</div>
<div></div>
<div>Loaders是一个比较高级的话题，可能需要更多时间来使用它。在下一节中，我们会从分析它的四个定义的特性来开始。</div>
<div></div>
<h1><a name="t1"></a>Loader由什么组成？</h1>
<div></div>
<div>总共有四个特性最终决定了一个Loader的行为：</div>
<div></div>
<div>1. 执行异步载入的任务。为了确保在一个独立线程中执行载入操作，Loader的子类必须继承AsyncTaskLoader&lt;D&gt;而不是Loader&lt;D&gt;类。AsyncTaskLoader&lt;D&gt;是一个抽象Loader，它提供了一个AsyncTask来做它的执行操作。当定义子类时，通过实现抽象方法loadInBackground方法来实现异步task。该方法将在一个工作线程中执行数据加载操作。</div>
<div></div>
<div>2. 在一个注册监听器中接收载入完成返回的结果（见附注1）。对于每个Loader来说，LoaderManager注册一个OnLoadCompleteListener&lt;D&gt;，该对象将通过调用onLoadFinished(Loader&lt;D&gt; loader, D result)方法使Loader将结果传送给客户端。Loader通过调用Loader#deliverResult(D result)，将结果传递给已注册的监听器们。</div>
<div></div>
<div>3. 三种不同状态（见附注2）。任何Loader将处于三种状态之中，已启动、已停止、重启：</div>
<div>a. 处于已启动状态的Loader会执行载入操作，并在任何时间将结果传递到监听器中。已启动的Loader将会监听数据改变，当检测到改变时执行新的载入。一旦启动，Loader将一直处在已启动状态，一直到转换到已停止和重启。这是唯一一种onLoadFinished永远不会调用的状态。</div>
<div>b. 处于已停止状态的Loader将会继续监听数据改变，但是不会将结果返回给客户端。在已停止状态，Loader可能被启动或者重启。</div>
<div>c. 当Loader处于重启状态时，将不会执行新的载入操作，也不会发送新的结果集，也不会检测数据变化。当一个Loader进入重启状态，它必须解除对应的数据引用，方便垃圾回收（同样地，客户端必须确定，在Loader无效之后，移除了所有该数据的引用）。通常，重启Loader不会两次调用；然而，在某些情况下他们可能会启动，所以如果必要的话，它们必须能够适时重启。</div>
<div></div>
<div>4. 有一个观察者接受数据源改变的通知。Loader必须实现这些Observer其中之一（比如ContentObserver，BroadcastReceiver等），来检测底层数据源的改变。当检测到数据改变，观察者必须调用Loader#onContentChanged()。在该方法中执行两种不同操作：a. 如果Loader已经处于启动状态，就会执行一个新的载入操作; b. 设置一个flag标识数据源有改变，这样当Loader再次启动时，就知道应该重新载入数据了。</div>
<div></div>
<div>到目前为止，你应该基本知道了Loader如何工作了。如果没有的话，我建议你先放一放，稍后再重新读一遍（读一下<a href="http://developer.android.com/reference/android/content/Loader.html" target="_blank">这篇</a>文档，）。也就是说，让我们从实际代码入手，写写看。</div>
<div></div>
<h1><a name="t2"></a>实现Loader</h1>
<div></div>
<div>就如我之前陈述的那样，在实现自定义Loader的时候有很多需要注意。子类必须实现loadInBackground()方法，必须覆写onStartLoading(), onStoppLoading(),onReset(),onCanceled()和deliverResult(D results)来实现一个完整功能的Loader。覆写这些方法非常重要，LoaderManager将会在Activity/Fragment不同声明周期调用不同的方法。例如，当一个Activity第一次启动，它将会让LoaderManager在Activity#onStart()中启动它所拥有的每个Loaders。如果一个Loader没有启动，LoaderManager将会调用startLoading()方法，该方法将Loader进入已启动状态并且立即调用Loader的onStartLoading()方法。也就是说，LoaderManager在后台所做的大量工作都是基于Loader正确实现的基础上，所以不要小看实现这些方法的重要性。</div>
<div></div>
<div>下面的代码就是Loader典型实现的样板。SampleLoader查询结果为一个包含SampleItem对象的列表，并且将查询结果列表List&lt;SampleItem&gt;返回给客户端：</div>
<div>

[java]public class SampleLoader extends AsyncTaskLoader&lt;List&lt;SampleItem&gt;&gt; {

// We hold a reference to the Loader’s data here.
 private List&lt;SampleItem&gt; mData;

public SampleLoader(Context ctx) {
 // Loaders may be used across multiple Activitys (assuming they aren't
 // bound to the LoaderManager), so NEVER hold a reference to the context
 // directly. Doing so will cause you to leak an entire Activity's context.
 // The superclass constructor will store a reference to the Application
 // Context instead, and can be retrieved with a call to getContext().
 super(ctx);
 }

/****************************************************/
 /** (1) A task that performs the asynchronous load **/
 /****************************************************/

@Override
 public List&lt;SampleItem&gt; loadInBackground() {
 // This method is called on a background thread and should generate a
 // new set of data to be delivered back to the client.
 List&lt;SampleItem&gt; data = new ArrayList&lt;SampleItem&gt;();

// TODO: Perform the query here and add the results to 'data'.

return data;
 }

/********************************************************/
 /** (2) Deliver the results to the registered listener **/
 /********************************************************/

@Override
 public void deliverResult(List&lt;SampleItem&gt; data) {
 if (isReset()) {
 // The Loader has been reset; ignore the result and invalidate the data.
 releaseResources(data);
 return;
 }

// Hold a reference to the old data so it doesn't get garbage collected.
 // We must protect it until the new data has been delivered.
 List&lt;SampleItem&gt; oldData = mData;
 mData = data;

if (isStarted()) {
 // If the Loader is in a started state, deliver the results to the
 // client. The superclass method does this for us.
 super.deliverResult(data);
 }

// Invalidate the old data as we don't need it any more.
 if (oldData != null &amp;&amp; oldData != data) {
 releaseResources(oldData);
 }
 }

/*********************************************************/
 /** (3) Implement the Loader’s state-dependent behavior **/
 /*********************************************************/

@Override
 protected void onStartLoading() {
 if (mData != null) {
 // Deliver any previously loaded data immediately.
 deliverResult(mData);
 }

// Begin monitoring the underlying data source.
 if (mObserver == null) {
 mObserver = new SampleObserver();
 // TODO: register the observer
 }

if (takeContentChanged() || mData == null) {
 // When the observer detects a change, it should call onContentChanged()
 // on the Loader, which will cause the next call to takeContentChanged()
 // to return true. If this is ever the case (or if the current data is
 // null), we force a new load.
 forceLoad();
 }
 }

@Override
 protected void onStopLoading() {
 // The Loader is in a stopped state, so we should attempt to cancel the
 // current load (if there is one).
 cancelLoad();

// Note that we leave the observer as is. Loaders in a stopped state
 // should still monitor the data source for changes so that the Loader
 // will know to force a new load if it is ever started again.
 }

@Override
 protected void onReset() {
 // Ensure the loader has been stopped.
 onStopLoading();

// At this point we can release the resources associated with 'mData'.
 if (mData != null) {
 releaseResources(mData);
 mData = null;
 }

// The Loader is being reset, so we should stop monitoring for changes.
 if (mObserver != null) {
 // TODO: unregister the observer
 mObserver = null;
 }
 }

@Override
 public void onCanceled(List&lt;SampleItem&gt; data) {
 // Attempt to cancel the current asynchronous load.
 super.onCanceled(data);

// The load has been canceled, so we should release the resources
 // associated with 'data'.
 releaseResources(data);
 }

private void releaseResources(List&lt;SampleItem&gt; data) {
 // For a simple List, there is nothing to do. For something like a Cursor, we
 // would close it in this method. All resources associated with the Loader
 // should be released here.
 }

/*********************************************************************/
 /** (4) Observer which receives notifications when the data changes **/
 /*********************************************************************/

 // NOTE: Implementing an observer is outside the scope of this post (this example
 // uses a made-up &quot;SampleObserver&quot; to illustrate when/where the observer should
 // be initialized).

 // The observer could be anything so long as it is able to detect content changes
 // and report them to the loader with a call to onContentChanged(). For example,
 // if you were writing a Loader which loads a list of all installed applications
 // on the device, the observer could be a BroadcastReceiver that listens for the
 // ACTION_PACKAGE_ADDED intent, and calls onContentChanged() on the particular
 // Loader whenever the receiver detects that a new application has been installed.
 // Please don’t hesitate to leave a comment if you still find this confusing! :)
 private SampleObserver mObserver;
}[/java]

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>480</wp:post_id>
		<wp:post_date>2015-03-27 17:10:28</wp:post_date>
		<wp:post_date_gmt>2015-03-27 09:10:28</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>loadermanager%e4%bd%bf%e7%94%a8%e8%af%a6%e8%a7%a3%ef%bc%88%e4%b8%89%ef%bc%89-%e5%ae%9e%e7%8e%b0loaders</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="loadermanager"><![CDATA[LoaderManager]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707576]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>LoaderManager使用详解（四）---实例：AppListLoader</title>
		<link>http://1.duoinfo.sinaapp.com/?p=482</link>
		<pubDate>Fri, 27 Mar 2015 09:14:24 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=482</guid>
		<description></description>
		<content:encoded><![CDATA[提供的demo的地址为：<a title="https://github.com/alexjlockwood/AppListLoader" href="https://github.com/alexjlockwood/AppListLoader" target="_blank">https://github.com/alexjlockwood/AppListLoader</a>

Google提供的demo:

[java]package com.dy.ustc.demo;

import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.support.annotation.Nullable;
import android.support.v4.app.ListFragment;
import android.support.v4.app.LoaderManager;
import android.support.v4.content.CursorLoader;
import android.support.v4.content.Loader;
import android.support.v7.app.ActionBarActivity;
import android.text.TextUtils;
import android.view.ContextMenu;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.ListView;
import android.widget.SearchView;
import android.widget.SimpleCursorAdapter;
public class MainActivity extends ActionBarActivity {

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_main);
 if (savedInstanceState == null) {
 getSupportFragmentManager().beginTransaction()
 .add(R.id.container, new PlaceholderFragment())
 .commit();
 }
 }
 @Override
 public boolean onCreateOptionsMenu(Menu menu) {
 // Inflate the menu; this adds items to the action bar if it is present.
 getMenuInflater().inflate(R.menu.menu_main, menu);
 return true;
 }

@Override
 public boolean onOptionsItemSelected(MenuItem item) {
 // Handle action bar item clicks here. The action bar will
 // automatically handle clicks on the Home/Up button, so long
 // as you specify a parent activity in AndroidManifest.xml.
 int id = item.getItemId();

//noinspection SimplifiableIfStatement
 if (id == R.id.action_settings) {
 return true;
 }

return super.onOptionsItemSelected(item);
 }

/**
 * A placeholder fragment containing a simple view.
 */
 public static class PlaceholderFragment extends ListFragment
 implements SearchView.OnQueryTextListener, SearchView.OnCloseListener, LoaderManager.LoaderCallbacks&lt;Cursor&gt; {

public PlaceholderFragment() {
 }
 SimpleCursorAdapter mAdapter;

SearchView searchView;

String mCurFilter;

@Override
 public void onActivityCreated(@Nullable Bundle savedInstanceState) {
 super.onActivityCreated(savedInstanceState);
 setEmptyText(&quot;NO phone number&quot;);
 setHasOptionsMenu(true);
 mAdapter = new SimpleCursorAdapter(getActivity(),android.R.layout.simple_list_item_2,null,new String[]{ContactsContract.Contacts.DISPLAY_NAME,
 ContactsContract.Contacts.CONTACT_STATUS},new int[]{android.R.id.text1,android.R.id.text2});
 setListAdapter(mAdapter);
 setListShown(false);
 getLoaderManager().initLoader(0,null,this);
 }

public static class MySearchView extends SearchView{

public MySearchView(Context context) {
 super(context);
 }

@Override
 public void onActionViewCollapsed() {
 setQuery(&quot;&quot;,false);
 super.onActionViewCollapsed();
 }
 }

@Override
 public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {
 super.onCreateContextMenu(menu, v, menuInfo);
 MenuItem item = menu.add(&quot;search&quot;);
 item.setIcon(android.R.drawable.ic_menu_search);
 item.setShowAsAction(MenuItem.SHOW_AS_ACTION_ALWAYS);
 searchView = new MySearchView(getActivity());
 searchView.setOnQueryTextListener(this);
 searchView.setOnCloseListener(this);
 searchView.setIconifiedByDefault(true);
 item.setActionView(searchView);
 }

/* @Override
 public View onCreateView(LayoutInflater inflater, ViewGroup container,
 Bundle savedInstanceState) {
 View rootView = inflater.inflate(R.layout.fragment_main, container, false);
 return rootView;
 }*/

@Override
 public void onListItemClick(ListView l, View v, int position, long id) {
 super.onListItemClick(l, v, position, id);
 }

@Override
 public boolean onClose() {
 if (!TextUtils.isEmpty(searchView.getQuery())){
 searchView.setQuery(null,true);
 }
 return true;
 }

@Override
 public boolean onQueryTextSubmit(String query) {
 return true;
 }

@Override
 public boolean onQueryTextChange(String newText) {
 String newFilter = !TextUtils.isEmpty(newText) ? newText : null;
 if (mCurFilter == null &amp;&amp; newFilter == null){
 return true;
 }
 if (newFilter == null &amp;&amp; mCurFilter.equals(newFilter)){
 return true;
 }
 mCurFilter = newFilter;
 getLoaderManager().restartLoader(0,null,this);
 return true;
 }

static final String[] CONTACTS_SUMMARY_PROJECTION = new String[]{
 ContactsContract.Contacts._ID,
 ContactsContract.Contacts.DISPLAY_NAME,
 ContactsContract.Contacts.CONTACT_STATUS,
 ContactsContract.Contacts.CONTACT_PRESENCE,
 ContactsContract.Contacts.PHOTO_ID,
 ContactsContract.Contacts.LOOKUP_KEY
 };

@Override
 public Loader&lt;Cursor&gt; onCreateLoader(int i, Bundle bundle) {
 Uri baseUri;
 if (mCurFilter != null){
 baseUri = Uri.withAppendedPath(ContactsContract.Contacts.CONTENT_URI,Uri.encode(mCurFilter));
 }else{
 baseUri = ContactsContract.Contacts.CONTENT_URI;
 }
 String select = &quot;((&quot; + ContactsContract.Contacts.DISPLAY_NAME + &quot; NOTNULL) AND (&quot;
 + ContactsContract.Contacts.HAS_PHONE_NUMBER + &quot;=1) AND (&quot; + ContactsContract.Contacts.DISPLAY_NAME + &quot; != '' ))&quot;;

&amp;nbsp;

return new CursorLoader(getActivity(),baseUri,CONTACTS_SUMMARY_PROJECTION,
 select,null, ContactsContract.Contacts.DISPLAY_NAME + &quot; COLLATE LOCALIZED ASC&quot;);
 }

@Override
 public void onLoadFinished(Loader&lt;Cursor&gt; cursorLoader, Cursor cursor) {

mAdapter.swapCursor(cursor);
 if (isResumed()){
 setListShown(true);
 }else{
 setListShownNoAnimation(true);
 }

}

@Override
 public void onLoaderReset(Loader&lt;Cursor&gt; cursorLoader) {
 mAdapter.swapCursor(null);
 }
 }
}[/java]

&nbsp;

最后需要添加读取联系人的权限。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>482</wp:post_id>
		<wp:post_date>2015-03-27 17:14:24</wp:post_date>
		<wp:post_date_gmt>2015-03-27 09:14:24</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>loadermanager%e4%bd%bf%e7%94%a8%e8%af%a6%e8%a7%a3%ef%bc%88%e5%9b%9b%ef%bc%89-%e5%ae%9e%e4%be%8b%ef%bc%9aapplistloader</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="post_tag" nicename="loadermanager"><![CDATA[LoaderManager]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707577]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>复习20150330</title>
		<link>http://1.duoinfo.sinaapp.com/?p=486</link>
		<pubDate>Mon, 30 Mar 2015 08:32:34 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=486</guid>
		<description></description>
		<content:encoded><![CDATA[<strong>1.HttpURLConnection和HttpClient他们各自的优缺点是什么?</strong>
HttpUrlConnection 在 2.3 以前的版本是有 bug 的，所以之前的版本推荐使用 HttpClient，但是 google 现在已经不维护 HttpClient 了，5.1里面已经把 HttpClient 标过期。另外 HttpURLConnection 支持gzip压缩等，推荐首选它。
在 Froyo(2.2) 之前，HttpURLConnection 有个重大 Bug，调用 close() 函数会影响连接池，导致连接复用失效，所以在 Froyo 之前使用 HttpURLConnection 需要关闭 keepAlive。
另外在 Gingerbread(2.3) HttpURLConnection 默认开启了 gzip 压缩，提高了 HTTPS 的性能，Ice Cream Sandwich(4.0) HttpURLConnection 支持了请求结果缓存。
再加上 HttpURLConnection 本身 API 相对简单，所以对 Android 来说，在 2.3 之后建议使用 HttpURLConnection，之前建议使用 AndroidHttpClient。

<strong>2.Android开发中XML解析方式的比较 ，及优缺点？</strong>
DOM,SAX,Pull解析。
SAX解析器的优点是解析速度快，占用内存少；

DOM在内存中以树形结构存放，因此检索和更新效率会更高。但是对于特别大的文档，解析和加载整个文档将会很耗资源，不适合移动端；

PULL解析器的运行方式和SAX类似，都是基于事件的模式，PULL解析器小巧轻便，解析速度快，简单易用，非常适合在Android移动设备中使用，Android系统内部在解析各种XML时也是用PULL解析器。

<strong>3.请问平时开发过程中，你是如何做到多分辨率适配的？</strong>
1.根据不同分辨率建立不同的布局文件
2.根据分辨率不同建立不同分辨率的资源图片
3.在程序启动时，获取当前屏幕的分辨率和密度，在代码中进行适配
4.为不同分辨率的写不同的dimen文件。
5.其实还有就是多使用fragement

<strong>4. 谈谈你在工作中是怎样解决一个bug的?</strong>
1.看Log日志
2.Log解决不了就断点调试
3.如果debug不行
4.就在异常代码的附近Log.e(“error”,”1”);,2,3,4,5,6,7,8,9 每隔一行一个Log输出，看结果
5.找到问题，自行找思路。如果是技术瓶颈，就google之

<strong>5.声明ViewHolder内部类时，为什么建议使用static关键字?</strong>
其实这个是考静态内部类和非静态内部类的主要区别之一。非静态内部类会隐式持有外部类的引用，就像大家经常将自定义的adapter在Activity类里，然后在adapter类里面是可以随意调用外部activity的方法的。当你将内部类定义为static时，你就调用不了外部类的实例方法了，因为这时候静态内部类是不持有外部类的引用的。声明ViewHolder静态内部类，可以将ViewHolder和外部类解引用。大家会说一般ViewHolder都很简单，不定义为static也没事吧。确实如此，但是如果你将它定义为static的，说明你懂这些含义。万一有一天你在这个ViewHolder加入一些复杂逻辑，做了一些耗时工作，那么如果ViewHolder是非静态内部类的话，就很容易出现内存泄露。如果是静态的话，你就不能直接引用外部类，迫使你关注如何避免相互引用。 所以将 ViewHolder内部类 定义为静态的，是一种好习惯.
非静态内部类隐式持有外部类的强引用，只是可能会导致内存泄露，而一般情况下在使用viewhodler是不会导致内存泄露的，加static是一个比较好的习惯

<strong>6.如何在不失真的条件下显示一张超高清的图片或者长图?</strong>
1、通过计算BitmapFactory.Options 对象的inSamleSize 值 等比的压缩图片 。
2、使用WebView来加载该图片；
3、使用MapView或者TileView来显示图片（类似地图的机制）；

<strong>7. Android中有哪些方法实现定时和延时任务？它们的适用场景是什么？</strong>
倒计时类
用CountDownTimer

延迟类
CountDownTimer，可巧妙的将countDownInterval设成和millisInFuture一样，这样就只会调用一次onTick和一次onFinish
handler.sendMessageDelayed,可参考CountDownTimer的内部实现，简化一下，个人比较推荐这个
TimerTask，代码写起来比较乱
Thread.sleep，感觉这种不太好
使用Handler方法postDelay(runnable, delayTime)

定时类
参照延迟类的，自己计算好要延迟多少时间
handler.sendMessageAtTime
AlarmManager，适用于定时比较长远的时间，例如闹铃

<strong>8.谈谈你对StrongReference、WeakReference和SoftReference的认识</strong>
强引用（StrongReference）：就是在代码中普遍存在的，类似Object obj = new Object()这类的引用，只要强引用还存在，GC永远不会回收掉被引用的对象。
软引用（SoftReference）：用来描述一些还有用但非必须的对象。对于软引用关联着的对象，在系统将要发生内存溢出异常时，将会把这些对象列入回收范围之中进行第二次回收。如果这次回收还没有足够的内存，才会抛出内存溢出异常。在JDK 1.2之后，提供了SoftReference类来实习软引用。

弱引用（WeakReference）：也是用来描述非必须对象的，但是它的强度比软引用更弱一些，被弱引用关联的对象只能生存到了下一次GC发生之前。当GC工作时，无论当时内存是否足够，都会回收只被弱引用关联的对象。在JDK 1.2之后，提供了WeakReference类来实现弱引用。

虚引用（PhantomReference）：这个引用po主没有提到，不过也可以顺带了解一下。虚引用也称幽灵引用或者幻影引用，它是最弱的一种引用关系。一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。为一个对象设置虚引用的唯一目的就是在这个对象被GC回收是收到一个系统通知。在JDK 1.2之后提供了PhantomReference类来实现虚引用。

<strong>9.你应用中的网络层是怎么设计的？</strong>
1. android-async-http.
封装了下常用的方法,get post 上传 下载 ,所有的请求我都是用的同步请求.
具体的用法一般都是和业务逻辑在一起,而我的业务逻辑是用异步去处理的.
关于网络请求结果的缓存,我是单独处理的.并没有放在网络层.

2.在HttpUrlConnection基础上封装, 包括请求成功, 失败, 请求中, 网络问题等封装, 利用广播与UI交互
3.直接使用xUtils，afinal,okHttp，Volley等开源第三方框架；

Bitmap是android中经常使用的一个类，它代表了一个图片资源。
Bitmap消耗内存很严重，如果不注意优化代码，经常会出现OOM问题，优化方式通常有这么几种：
1. 使用缓存；
2. 压缩图片；
3. 及时回收；

<strong>10.谈谈你对Bitmap的理解, 什么时候应该手动调用bitmap.recycle()？</strong>
至于什么时候需要手动调用recycle，这就看具体场景了，原则是当我们不再使用Bitmao时，需要回收之。另外，我们需要注意，2.3之前Bitmap对象与像素数据是分开存放的，Bitmap对象存在java Heap中而像素数据存放在Native Memory中，这时很有必要调用recycle回收内存。但是2.3之后，Bitmap对象和像素数据都是存在Heap中，GC可以回收其内存。

<strong>11.ViewPager中加载Fragment的优化问题？如何做到微信那样切换界面时的延时加载？</strong>
利用fragment中的setUserVisibleHint这个方法可以来做到.

[codesyntax lang="java5"]
private boolean hasLoadedOnce = false; // your boolean field

@Override
public void setUserVisibleHint(boolean isVisibleToUser) {
    super.setUserVisibleHint(isVisibleToUser);

    if (this.isVisible()) {
        // we check that the fragment is becoming visible
        if (isVisibleToUser &amp;&amp; !hasLoadedOnce) {
                //do something
            }
        }
    }
}
[/codesyntax]</pre>
<strong>12什么是aar？aar和jar有什么区别？</strong>
“aar”包是 Android 的类库项目的二进制发行包。

文件扩展名是.aar，maven 项目类型应该也是aar，但文件本身是带有以下各项的 zip 文件：

/AndroidManifest.xml (mandatory)
/classes.jar (mandatory)
/res/ (mandatory)
/R.txt (mandatory)
/assets/ (optional)
/libs/*.jar (optional)
/jni//*.so (optional)
/proguard.txt (optional)
/lint.jar (optional)
这些条目是直接位于 zip 文件根目录的。
其中R.txt 文件是aapt带参数–output-text-symbols的输出结果。

jar打包不能包含资源文件，比如一些drawable文件、xml资源文件之类的,aar可以。

<strong>13.如何加密Url防止被黑？</strong>
加密到JNI里面还是会通过抓包工具抓取到.最后的方式就是进行HTTPS证书双向加密验证

<strong>14.Android fragment和activity的区别</strong>
你可以理解Fragment是一种特殊的View，负责一个模块或者一个特殊部分的展示。
大部分Fragment是依托于Activity存在的，由Activity的FragmentManager来管理
Fragment可以解决多Activity的问题，即将3.0之前的频繁Activity跳转改成一个Activity内Fragment的切换。
Fragment可以解决碎片化的问题。
fragment是android3.0新增的
fragment可以重用
fragment必须嵌套在activity中使用，它的生命周期受activity的影响。

<strong>15.Service和广播 BroadcastReceivre会不会出现ANR？</strong>
Service，广播 会出现ANR
服务, 广播都是主线程中, 既然是主线程 当然会anr 所以耗时操作还是必须另起线程
通俗的说超时时间：Activity 5秒, Broadcast 10秒, Server 20秒

<strong>16.你在平时开发中会使用到哪些设计模式，能谈谈这些设计模式的使用场景吗？</strong>
平时用的比较多有单例模式（在内存中仅实例化一个对象时使用），适配器模式（典型的就是ListView和GridView的适配器），建造者模式（AlertDialog.Builder）,观察者模式可能比较隐蔽，在Android源码中BaseAdapater的NotifyDataSetChanged的实现（？）
单例：DownloadManager]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>486</wp:post_id>
		<wp:post_date>2015-03-30 16:32:34</wp:post_date>
		<wp:post_date_gmt>2015-03-30 08:32:34</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%a4%8d%e4%b9%a020150330</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e9%9d%a2%e8%af%95"><![CDATA[面试]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707578]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title> Android 带清除功能的输入框控件ClearEditText</title>
		<link>http://1.duoinfo.sinaapp.com/?p=490</link>
		<pubDate>Tue, 31 Mar 2015 01:43:04 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=490</guid>
		<description></description>
		<content:encoded><![CDATA[在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备此功能，所以要想实现这一功能我们需要重写EditText，接下来就带大家来实现这一小小的功能

我们知道，我们可以为我们的输入框在上下左右设置图片，所以我们可以利用属性android:drawableRight设置我们的删除小图标，如图

<img src="http://img.blog.csdn.net/20130904164206781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlhYW5taW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />

我这里设置了左边和右边的图片，如果我们能为右边的图片设置监听，点击右边的图片清除输入框的内容并隐藏删除图标，这样子这个小功能就迎刃而解了，可是Android并没有给允许我们给右边小图标加监听的功能，这时候你是不是发现这条路走不通呢，其实不是，我们可能模拟点击事件，用输入框的的onTouchEvent()方法来模拟，

当我们触摸抬起（就是ACTION_UP的时候）的范围  大于输入框左侧到清除图标左侧的距离，小与输入框左侧到清除图片右侧的距离，我们则认为是点击清除图片，当然我这里没有考虑竖直方向，只要给清除小图标就上了监听，其他的就都好处理了，我先把代码贴上来，在讲解下

[java]package com.example.clearedittext;

import android.content.Context;
import android.graphics.drawable.Drawable;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.View;
import android.view.View.OnFocusChangeListener;
import android.view.animation.Animation;
import android.view.animation.CycleInterpolator;
import android.view.animation.TranslateAnimation;
import android.widget.EditText;

public class ClearEditText extends EditText implements
 OnFocusChangeListener, TextWatcher {
 /**
 * 删除按钮的引用
 */
 private Drawable mClearDrawable;
 /**
 * 控件是否有焦点
 */
 private boolean hasFoucs;

 public ClearEditText(Context context) {
 this(context, null);
 }

 public ClearEditText(Context context, AttributeSet attrs) {
 //这里构造方法也很重要，不加这个很多属性不能再XML里面定义
 this(context, attrs, android.R.attr.editTextStyle);
 }

 public ClearEditText(Context context, AttributeSet attrs, int defStyle) {
 super(context, attrs, defStyle);
 init();
 }


 private void init() {
 //获取EditText的DrawableRight,假如没有设置我们就使用默认的图片
 mClearDrawable = getCompoundDrawables()[2];
 if (mClearDrawable == null) {
// throw new NullPointerException(&quot;You can add drawableRight attribute in XML&quot;);
 mClearDrawable = getResources().getDrawable(R.drawable.delete_selector);
 }

 mClearDrawable.setBounds(0, 0, mClearDrawable.getIntrinsicWidth(), mClearDrawable.getIntrinsicHeight());
 //默认设置隐藏图标
 setClearIconVisible(false);
 //设置焦点改变的监听
 setOnFocusChangeListener(this);
 //设置输入框里面内容发生改变的监听
 addTextChangedListener(this);
 }


 /**
 * 因为我们不能直接给EditText设置点击事件，所以我们用记住我们按下的位置来模拟点击事件
 * 当我们按下的位置 在 EditText的宽度 - 图标到控件右边的间距 - 图标的宽度 和
 * EditText的宽度 - 图标到控件右边的间距之间我们就算点击了图标，竖直方向就没有考虑
 */
 @Override
 public boolean onTouchEvent(MotionEvent event) {
 if (event.getAction() == MotionEvent.ACTION_UP) {
 if (getCompoundDrawables()[2] != null) {

boolean touchable = event.getX() &gt; (getWidth() - getTotalPaddingRight())
 &amp;&amp; (event.getX() &lt; ((getWidth() - getPaddingRight())));

 if (touchable) {
 this.setText(&quot;&quot;);
 }
 }
 }

return super.onTouchEvent(event);
 }

 /**
 * 当ClearEditText焦点发生变化的时候，判断里面字符串长度设置清除图标的显示与隐藏
 */
 @Override
 public void onFocusChange(View v, boolean hasFocus) {
 this.hasFoucs = hasFocus;
 if (hasFocus) {
 setClearIconVisible(getText().length() &gt; 0);
 } else {
 setClearIconVisible(false);
 }
 }


 /**
 * 设置清除图标的显示与隐藏，调用setCompoundDrawables为EditText绘制上去
 * @param visible
 */
 protected void setClearIconVisible(boolean visible) {
 Drawable right = visible ? mClearDrawable : null;
 setCompoundDrawables(getCompoundDrawables()[0],
 getCompoundDrawables()[1], right, getCompoundDrawables()[3]);
 }


 /**
 * 当输入框里面内容发生变化的时候回调的方法
 */
 @Override
 public void onTextChanged(CharSequence s, int start, int count,
 int after) {
 if(hasFoucs){
 setClearIconVisible(s.length() &gt; 0);
 }
 }

 @Override
 public void beforeTextChanged(CharSequence s, int start, int count,
 int after) {

 }

 @Override
 public void afterTextChanged(Editable s) {

 }


 /**
 * 设置晃动动画
 */
 public void setShakeAnimation(){
 this.setAnimation(shakeAnimation(5));
 }


 /**
 * 晃动动画
 * @param counts 1秒钟晃动多少下
 * @return
 */
 public static Animation shakeAnimation(int counts){
 Animation translateAnimation = new TranslateAnimation(0, 10, 0, 0);
 translateAnimation.setInterpolator(new CycleInterpolator(counts));
 translateAnimation.setDuration(1000);
 return translateAnimation;
 }


}[/java]
<ul>
	<li>setClearIconVisible()方法，设置隐藏和显示清除图标的方法，我们这里不是调用setVisibility()方法，setVisibility()这个方法是针对View的，我们可以调用setCompoundDrawables(Drawable left, Drawable top, Drawable right, Drawable bottom)来设置上下左右的图标</li>
</ul>
<ul>
	<li>setOnFocusChangeListener(this) 为输入框设置焦点改变监听，如果输入框有焦点，我们判断输入框的值是否为空，为空就隐藏清除图标，否则就显示</li>
	<li>addTextChangedListener(this) 为输入框设置内容改变监听，其实很简单呢，当输入框里面的内容发生改变的时候，我们需要处理显示和隐藏清除小图标，里面的内容长度不为0我们就显示，否是就隐藏，但这个需要输入框有焦点我们才改变显示或者隐藏，为什么要需要焦点，比如我们一个登陆界面，我们保存了用户名和密码，在登陆界面onCreate()的时候，我们把我们保存的密码显示在用户名输入框和密码输入框里面，输入框里面内容发生改变，导致用户名输入框和密码输入框里面的清除小图标都显示了，这显然不是我们想要的效果，所以加了一个是否有焦点的判断</li>
	<li>setShakeAnimation()，这个方法是输入框左右抖动的方法，之前我在某个应用看到过类似的功能，当用户名错误，输入框就在哪里抖动，感觉挺好玩的，其实主要是用到一个移动动画，然后设置动画的变化率为正弦曲线</li>
</ul>
接下来我们来使用它，Activity的布局，两个我们自定义的输入框，一个按钮

[xml]&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
 xmlns:tools=&quot;http://schemas.android.com/tools&quot;
 android:layout_width=&quot;match_parent&quot;
 android:layout_height=&quot;match_parent&quot;
 android:background=&quot;#95CAE4&quot;&gt;
 &lt;com.example.clearedittext.ClearEditText
 android:id=&quot;@+id/username&quot;
 android:layout_marginTop=&quot;60dp&quot;
 android:layout_width=&quot;fill_parent&quot;
 android:background=&quot;@drawable/login_edittext_bg&quot;
 android:drawableLeft=&quot;@drawable/icon_user&quot;
 android:layout_marginLeft=&quot;10dip&quot;
 android:layout_marginRight=&quot;10dip&quot;
 android:singleLine=&quot;true&quot;
 android:drawableRight=&quot;@drawable/delete_selector&quot;
 android:hint=&quot;输入用户名&quot;
 android:layout_height=&quot;wrap_content&quot; &gt;

&lt;/com.example.clearedittext.ClearEditText&gt;

&lt;com.example.clearedittext.ClearEditText
 android:id=&quot;@+id/password&quot;
 android:layout_marginLeft=&quot;10dip&quot;
 android:layout_marginRight=&quot;10dip&quot;
 android:layout_marginTop=&quot;10dip&quot;
 android:drawableLeft=&quot;@drawable/account_icon&quot;
 android:hint=&quot;输入密码&quot;
 android:singleLine=&quot;true&quot;
 android:password=&quot;true&quot;
 android:drawableRight=&quot;@drawable/delete_selector&quot;
 android:layout_width=&quot;fill_parent&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:layout_below=&quot;@id/username&quot;
 android:background=&quot;@drawable/login_edittext_bg&quot; &gt;
 &lt;/com.example.clearedittext.ClearEditText&gt;

&lt;Button
 android:id=&quot;@+id/login&quot;
 android:layout_width=&quot;fill_parent&quot;
 android:layout_height=&quot;wrap_content&quot;
 android:layout_marginLeft=&quot;10dip&quot;
 android:layout_marginRight=&quot;10dip&quot;
 android:background=&quot;@drawable/login_button_bg&quot;
 android:textSize=&quot;18sp&quot;
 android:textColor=&quot;@android:color/white&quot;
 android:layout_below=&quot;@+id/password&quot;
 android:layout_marginTop=&quot;25dp&quot;
 android:text=&quot;登录&quot; /&gt;

&lt;/RelativeLayout&gt;[/xml]

然后就是界面代码的编写，主要是测试输入框左右晃动而已，比较简单

[java]package com.example.clearedittext;

import android.app.Activity;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.Toast;

public class MainActivity extends Activity {
 private Toast mToast;

@Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_main);

 final ClearEditText username = (ClearEditText) findViewById(R.id.username);
 final ClearEditText password = (ClearEditText) findViewById(R.id.password);

 ((Button) findViewById(R.id.login)).setOnClickListener(new OnClickListener() {

 @Override
 public void onClick(View v) {
 if(TextUtils.isEmpty(username.getText())){
 //设置晃动
 username.setShakeAnimation();
 //设置提示
 showToast(&quot;用户名不能为空&quot;);
 return;
 }

 if(TextUtils.isEmpty(password.getText())){
 password.setShakeAnimation();
 showToast(&quot;密码不能为空&quot;);
 return;
 }
 }
 });
 }

 /**
 * 显示Toast消息
 * @param msg
 */
 private void showToast(String msg){
 if(mToast == null){
 mToast = Toast.makeText(this, msg, Toast.LENGTH_SHORT);
 }else{
 mToast.setText(msg);
 }
 mToast.show();
 }
}[/java]

运行项目，如图，悲剧，没有动画效果，算了就这样子吧，你是不是也想把它加到你的项目当中去呢，赶紧吧！

&nbsp;

<img src="http://img.blog.csdn.net/20130904172657296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlhYW5taW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" width="240" height="400" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>490</wp:post_id>
		<wp:post_date>2015-03-31 09:43:04</wp:post_date>
		<wp:post_date_gmt>2015-03-31 01:43:04</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-%e5%b8%a6%e6%b8%85%e9%99%a4%e5%8a%9f%e8%83%bd%e7%9a%84%e8%be%93%e5%85%a5%e6%a1%86%e6%8e%a7%e4%bb%b6clearedittext</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707579]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[2]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Android 4.4从图库选择图片,获取图片路径并裁剪</title>
		<link>http://1.duoinfo.sinaapp.com/?p=493</link>
		<pubDate>Tue, 31 Mar 2015 06:57:07 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=493</guid>
		<description></description>
		<content:encoded><![CDATA[github上有关于这个案例的demo:<a title="https://github.com/leerduo/aFileChooser" href="https://github.com/leerduo/aFileChooser" target="_blank">https://github.com/leerduo/aFileChooser</a>

最近在做一个从图库选择图片或拍照,然后裁剪的功能.本来是没问题的,一直在用

[java]Intent intent=new Intent(Intent.ACTION_PICK, android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);[/java]

的方式来做,是调用系统图库来做,但是发现如果有图片是同步到google相册的话,图库里面能看到一个auto backup的目录,点进去选图片的话是无法获取到图片的路径的.因为那些图片根本就不存在于手机上.然后看到无论是百度贴吧,Instagram,或者还有些会选取图片做修改的app,都是用一个很漂亮的图片选择器(4.4以上,4.3的还是用系统旧的图库).

<img src="http://img.blog.csdn.net/20140305170527218?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGVtcGVyc2l0dQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />

<img src="http://img.blog.csdn.net/20140305170551687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGVtcGVyc2l0dQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" />

而这个图片选择器可以屏蔽掉那个auto backup的目录.所以就开始打算用这个图片选择器来选图片了.
这个方法就是

[java]Intent intent=new Intent(Intent.ACTION_GET_CONTENT);//ACTION_OPEN_DOCUMENT
intent.addCategory(Intent.CATEGORY_OPENABLE);
intent.setType(&quot;image/jpeg&quot;);
if(android.os.Build.VERSION.SDK_INT&gt;=android.os.Build.VERSION_CODES.KITKAT){
 startActivityForResult(intent, SELECT_PIC_KITKAT);
}else{
 startActivityForResult(intent, SELECT_PIC);
}[/java]

为什么要分开不同版本呢?其实在4.3或以下可以直接用ACTION_GET_CONTENT的,在4.4或以上,官方建议用ACTION_OPEN_DOCUMENT,但其实都不算太大区别,区别是他们返回的Uri,那个才叫大区别.这就是困扰了我一整天的问题所在了.

4.3或以下,选了图片之后,根据Uri来做处理,很多帖子都有了,我就不详细说了.主要是4.4,如果使用上面pick的原生方法来选图,返回的uri还是正常的,但如果用ACTION_GET_CONTENT的方法,返回的uri跟4.3是完全不一样的,4.3返回的是带文件路径的,而4.4返回的却是content://com.android.providers.media.documents/document/image:3951这样的,没有路径,只有图片编号的uri.这就导致接下来无法根据图片路径来裁剪的步骤了.

4.4得到的uri,需要以下方法来获取文件的路径

[java]public static String getPath(final Context context, final Uri uri) {

final boolean isKitKat = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT;

// DocumentProvider
 if (isKitKat &amp;&amp; DocumentsContract.isDocumentUri(context, uri)) {
 // ExternalStorageProvider
 if (isExternalStorageDocument(uri)) {
 final String docId = DocumentsContract.getDocumentId(uri);
 final String[] split = docId.split(&quot;:&quot;);
 final String type = split[0];

if (&quot;primary&quot;.equalsIgnoreCase(type)) {
 return Environment.getExternalStorageDirectory() + &quot;/&quot; + split[1];
 }

// TODO handle non-primary volumes
 }
 // DownloadsProvider
 else if (isDownloadsDocument(uri)) {

final String id = DocumentsContract.getDocumentId(uri);
 final Uri contentUri = ContentUris.withAppendedId(
 Uri.parse(&quot;content://downloads/public_downloads&quot;), Long.valueOf(id));

return getDataColumn(context, contentUri, null, null);
 }
 // MediaProvider
 else if (isMediaDocument(uri)) {
 final String docId = DocumentsContract.getDocumentId(uri);
 final String[] split = docId.split(&quot;:&quot;);
 final String type = split[0];

Uri contentUri = null;
 if (&quot;image&quot;.equals(type)) {
 contentUri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;
 } else if (&quot;video&quot;.equals(type)) {
 contentUri = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;
 } else if (&quot;audio&quot;.equals(type)) {
 contentUri = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;
 }

final String selection = &quot;_id=?&quot;;
 final String[] selectionArgs = new String[] {
 split[1]
 };

return getDataColumn(context, contentUri, selection, selectionArgs);
 }
 }
 // MediaStore (and general)
 else if (&quot;content&quot;.equalsIgnoreCase(uri.getScheme())) {

// Return the remote address
 if (isGooglePhotosUri(uri))
 return uri.getLastPathSegment();

return getDataColumn(context, uri, null, null);
 }
 // File
 else if (&quot;file&quot;.equalsIgnoreCase(uri.getScheme())) {
 return uri.getPath();
 }

return null;
}

/**
 * Get the value of the data column for this Uri. This is useful for
 * MediaStore Uris, and other file-based ContentProviders.
 *
 * @param context The context.
 * @param uri The Uri to query.
 * @param selection (Optional) Filter used in the query.
 * @param selectionArgs (Optional) Selection arguments used in the query.
 * @return The value of the _data column, which is typically a file path.
 */
public static String getDataColumn(Context context, Uri uri, String selection,
 String[] selectionArgs) {

Cursor cursor = null;
 final String column = &quot;_data&quot;;
 final String[] projection = {
 column
 };

try {
 cursor = context.getContentResolver().query(uri, projection, selection, selectionArgs,
 null);
 if (cursor != null &amp;&amp; cursor.moveToFirst()) {
 final int index = cursor.getColumnIndexOrThrow(column);
 return cursor.getString(index);
 }
 } finally {
 if (cursor != null)
 cursor.close();
 }
 return null;
}


/**
 * @param uri The Uri to check.
 * @return Whether the Uri authority is ExternalStorageProvider.
 */
public static boolean isExternalStorageDocument(Uri uri) {
 return &quot;com.android.externalstorage.documents&quot;.equals(uri.getAuthority());
}

/**
 * @param uri The Uri to check.
 * @return Whether the Uri authority is DownloadsProvider.
 */
public static boolean isDownloadsDocument(Uri uri) {
 return &quot;com.android.providers.downloads.documents&quot;.equals(uri.getAuthority());
}

/**
 * @param uri The Uri to check.
 * @return Whether the Uri authority is MediaProvider.
 */
public static boolean isMediaDocument(Uri uri) {
 return &quot;com.android.providers.media.documents&quot;.equals(uri.getAuthority());
}

/**
 * @param uri The Uri to check.
 * @return Whether the Uri authority is Google Photos.
 */
public static boolean isGooglePhotosUri(Uri uri) {
 return &quot;com.google.android.apps.photos.content&quot;.equals(uri.getAuthority());
}[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>493</wp:post_id>
		<wp:post_date>2015-03-31 14:57:07</wp:post_date>
		<wp:post_date_gmt>2015-03-31 06:57:07</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android-4-4%e4%bb%8e%e5%9b%be%e5%ba%93%e9%80%89%e6%8b%a9%e5%9b%be%e7%89%87%e8%8e%b7%e5%8f%96%e5%9b%be%e7%89%87%e8%b7%af%e5%be%84%e5%b9%b6%e8%a3%81%e5%89%aa</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707580]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>11</wp:comment_id>
			<wp:comment_author><![CDATA[遇到的问题以及解决的方式 | 一个开发者]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=416</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.217</wp:comment_author_IP>
			<wp:comment_date>2015-03-31 14:59:40</wp:comment_date>
			<wp:comment_date_gmt>2015-03-31 06:59:40</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] http://1.duoinfo.sinaapp.com/?p=493 [...]]]></wp:comment_content>
			<wp:comment_approved>0</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title> Android如何实现对系统自带对话框标题栏进行修改</title>
		<link>http://1.duoinfo.sinaapp.com/?p=497</link>
		<pubDate>Tue, 31 Mar 2015 09:17:18 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=497</guid>
		<description></description>
		<content:encoded><![CDATA[先上一张图

<img src="http://img.blog.csdn.net/20141127145216656?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdmluY2VudF9ibG9n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

可以看到，对话框的标题颜色是蓝色的，下面还有一根线也是蓝色的，在某些情况下，我们想改变程序的主题风格，颜色必须做修改，但又懒得去定制Dialog,下面的方法就诞生了：

[java]public final class CustomDialog {

private static void dialogTitleLineColor(Context context, Dialog dialog, int color) {
 String dividers[] = {
 &quot;android:id/titleDividerTop&quot;, &quot;android:id/titleDivider&quot;
 };

for (int i = 0; i &lt; dividers.length; ++i) {
 int divierId = context.getResources().getIdentifier(dividers[i], null, null);
 View divider = dialog.findViewById(divierId);
 if (divider != null) {
 divider.setBackgroundColor(color);
 }
 }
 }

public static void dialogTitleLineColor(Context context, Dialog dialog) {
 if (dialog != null) {
 dialogTitleLineColor(context, dialog, context.getResources().getColor(R.color.green));
 }
 }
}[/java]

此方法可以改变 对话框的标题颜色和标题下面的横线颜色，其中改变横线颜色已经被我注释掉。

&nbsp;

&nbsp;

举一反三，大家想改变系统控件的什么属性均可以通过，context获得资源id，然后得到该资源的实例，最后修改该实例的属性。修改后的效果如下

<img src="http://img.blog.csdn.net/20141127145831431?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdmluY2VudF9ibG9n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>497</wp:post_id>
		<wp:post_date>2015-03-31 17:17:18</wp:post_date>
		<wp:post_date_gmt>2015-03-31 09:17:18</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>android%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e5%af%b9%e7%b3%bb%e7%bb%9f%e8%87%aa%e5%b8%a6%e5%af%b9%e8%af%9d%e6%a1%86%e6%a0%87%e9%a2%98%e6%a0%8f%e8%bf%9b%e8%a1%8c%e4%bf%ae%e6%94%b9</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707581]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>使用PersistentCookieStore持久化cookie</title>
		<link>http://1.duoinfo.sinaapp.com/?p=500</link>
		<pubDate>Tue, 31 Mar 2015 09:30:30 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=500</guid>
		<description></description>
		<content:encoded><![CDATA[This library includes a <span style="color: #000080;"><code>PersistentCookieStore</code> </span>which is an implementation of the Apache <span style="color: #333399;">HttpClient <code>CookieStore</code></span> interface that automatically saves cookies to <span style="color: #333399;"><code>SharedPreferences</code> </span>storage on the Android device.

This is extremely useful if you want to use cookies to manage authentication sessions, since the user will remain logged in even after closing and re-opening your app.

First, create an instance of <code>AsyncHttpClient</code>:
<pre><code data-lang="java"></code>
[java]AsyncHttpClient myClient = new AsyncHttpClient();[/java]
<code data-lang="java">Now set this client’s cookie store to be a new instance of <code>PersistentCookieStore</code>, constructed with an activity or application context (usually <code>this</code> will suffice):</code>
[java]PersistentCookieStore myCookieStore = new PersistentCookieStore(this); 

myClient.setCookieStore(myCookieStore);[/java]


<code data-lang="java"></code>

Any cookies received from servers will now be stored in the persistent cookie store.

<pre><code data-lang="java"></code></pre>
To add your own cookies to the store, simply construct a new cookie and call <code>addCookie</code>:
<pre><code data-lang="java"></code>
[java]BasicClientCookie newCookie = new BasicClientCookie(&quot;cookiesare&quot;, &quot;awesome&quot;); 
newCookie.setVersion(1);
newCookie.setDomain(&quot;mydomain.com&quot;); 
newCookie.setPath(&quot;/&quot;); 
myCookieStore.addCookie(newCookie);[/java]

<code data-lang="java">
</code> <code data-lang="java">文档：<a title="https://github.com/loopj/android-async-http" href="https://github.com/loopj/android-async-http" target="_blank">https://github.com/loopj/android-async-http</a></code>

<a title="http://loopj.com/android-async-http/" href="http://loopj.com/android-async-http/" target="_blank">http://loopj.com/android-async-http/</a>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>500</wp:post_id>
		<wp:post_date>2015-03-31 17:30:30</wp:post_date>
		<wp:post_date_gmt>2015-03-31 09:30:30</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e4%bd%bf%e7%94%a8persistentcookiestore%e6%8c%81%e4%b9%85%e5%8c%96cookie</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707582]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>java.lang.ArrayIndexOutOfBoundsException: length=1; index=1</title>
		<link>http://1.duoinfo.sinaapp.com/?p=506</link>
		<pubDate>Wed, 01 Apr 2015 02:48:44 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=506</guid>
		<description></description>
		<content:encoded><![CDATA[<pre>一个页面同时存在PhotoView与DrawerLayout，DrawerLayout组件抛出一个ArrayIndexOutOfBoundsException异常的shouldInterceptTouchEvent。请参阅下面的堆栈跟踪：
[xml]03-19 15:32:36.720: E/AndroidRuntime(5284): FATAL EXCEPTION: main
03-19 15:32:36.720: E/AndroidRuntime(5284): java.lang.ArrayIndexOutOfBoundsException: length=1; index=1
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.support.v4.widget.ViewDragHelper.shouldInterceptTouchEvent(ViewDragHelper.java:1004)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.support.v4.widget.DrawerLayout.onInterceptTouchEvent(DrawerLayout.java:820)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1817)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:2174)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:1917)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at com.android.internal.policy.impl.PhoneWindow$DecorView.superDispatchTouchEvent(PhoneWindow.java:1953)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at com.android.internal.policy.impl.PhoneWindow.superDispatchTouchEvent(PhoneWindow.java:1405)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.app.Activity.dispatchTouchEvent(Activity.java:2410)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at com.android.internal.policy.impl.PhoneWindow$DecorView.dispatchTouchEvent(PhoneWindow.java:1901)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.View.dispatchPointerEvent(View.java:7421)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl.deliverPointerEvent(ViewRootImpl.java:3220)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl.deliverInputEvent(ViewRootImpl.java:3165)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl.doProcessInputEvents(ViewRootImpl.java:4292)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl.enqueueInputEvent(ViewRootImpl.java:4271)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl$WindowInputEventReceiver.onInputEvent(ViewRootImpl.java:4363)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.InputEventReceiver.dispatchInputEvent(InputEventReceiver.java:179)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.InputEventReceiver.nativeConsumeBatchedInputEvents(Native Method)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.InputEventReceiver.consumeBatchedInputEvents(InputEventReceiver.java:171)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl.doConsumeBatchedInput(ViewRootImpl.java:4342)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.ViewRootImpl$ConsumeBatchedInputRunnable.run(ViewRootImpl.java:4382)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.Choreographer$CallbackRecord.run(Choreographer.java:749)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.Choreographer.doCallbacks(Choreographer.java:562)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.Choreographer.doFrame(Choreographer.java:530)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:735)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.os.Handler.handleCallback(Handler.java:725)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.os.Handler.dispatchMessage(Handler.java:92)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.os.Looper.loop(Looper.java:137)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at android.app.ActivityThread.main(ActivityThread.java:5039)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at java.lang.reflect.Method.invokeNative(Native Method)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at java.lang.reflect.Method.invoke(Method.java:511)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:793)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:560)
03-19 15:32:36.720: E/AndroidRuntime(5284): 	at dalvik.system.NativeStart.main(Native Method)[/xml]
这是关于多点触摸的requestDisallowInterceptTouchEvent和DrawerLayout的innerViews问题。
因为当innerViews做requestDisallowInterceptTouchEvent（true），DrawerLayout的onInterceptTouchEvent将不会被调用。 
因此，在下面的情况下，它会抛出ArrayIndexOutOfBoundsException异常。

用户触摸屏幕（pointerId=0），并触发做requestDisallowInterceptTouchEvent（true）。 然后，用户将另一个手指（pointerId= 1）在屏幕上在那个时候
（当requestDisallowInterceptTouchEvent（true））。 如果用户抬起第一个手指（pointerId= 0），并且第二指（pointerId= 1）执行onInterceptTouchEvent ，该DrawerLayout不会存储该指针信息（pointerId=1） 当DrawerLayout得到ACTION_MOVE事件，它希望得到的pointerId指针信息。 然而，DrawerLayout只有指针=0，mInitialMotionX的数组大小仍为1。

所以导致ArrayIndexOutOfBoundsException异常

解决办法：

[java]public class HackyDrawerLayout extends DrawerLayout {

    public HackyDrawerLayout(Context context) {
        super(context);
    }

    public HackyDrawerLayout(Context context, AttributeSet attrs) {
        super(context, attrs);
    }

    public HackyDrawerLayout(Context context, AttributeSet attrs, int defStyle) {
        super(context, attrs, defStyle);
    }

    private boolean mIsDisallowIntercept = false;

    @Override
    public void requestDisallowInterceptTouchEvent(boolean disallowIntercept) {
        // keep the info about if the innerViews do requestDisallowInterceptTouchEvent
        mIsDisallowIntercept = disallowIntercept;
        super.requestDisallowInterceptTouchEvent(disallowIntercept);
    }

    @Override
    public boolean dispatchTouchEvent(MotionEvent ev) {
        // the incorrect array size will only happen in the multi-touch scenario.
        if (ev.getPointerCount() &gt; 1 &amp;&amp; mIsDisallowIntercept) {
            requestDisallowInterceptTouchEvent(false);
            boolean handled = super.dispatchTouchEvent(ev);
            requestDisallowInterceptTouchEvent(true);
            return handled;
        } else {
            return super.dispatchTouchEvent(ev);
        }
    }
}[/java]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>506</wp:post_id>
		<wp:post_date>2015-04-01 10:48:44</wp:post_date>
		<wp:post_date_gmt>2015-04-01 02:48:44</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>java-lang-arrayindexoutofboundsexception-length1-index1</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<category domain="category" nicename="%e9%97%ae%e9%a2%98%e9%9b%86%e5%90%88"><![CDATA[问题集合]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707583]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>12</wp:comment_id>
			<wp:comment_author><![CDATA[遇到的问题以及解决的方式 | 一个开发者]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=416</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.229</wp:comment_author_IP>
			<wp:comment_date>2015-04-01 11:00:59</wp:comment_date>
			<wp:comment_date_gmt>2015-04-01 03:00:59</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] 解决：http://1.duoinfo.sinaapp.com/?p=506 [...]]]></wp:comment_content>
			<wp:comment_approved>0</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>Volley 源码解析</title>
		<link>http://1.duoinfo.sinaapp.com/?p=510</link>
		<pubDate>Wed, 01 Apr 2015 03:38:12 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=510</guid>
		<description></description>
		<content:encoded><![CDATA[<h3 id="1-">1. 功能介绍</h3>
<h4 id="1-1-volley">1.1. Volley</h4>
Volley 是 Google 推出的 Android 异步网络请求框架和图片加载框架。在 Google I/O 2013 大会上发布。
<blockquote>名字由来：a burst or emission of many things or a large amount at once
发布演讲时候的配图
<img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/volley/image/volley.png" alt="Volley" data-bd-imgshare-binded="1" /></blockquote>
从名字由来和配图中无数急促的火箭可以看出 Volley 的特点：特别适合数据量小，通信频繁的网络操作。（个人认为 Android 应用中绝大多数的网络操作都属于这种类型）。
<h4 id="1-2-volley-">1.2 Volley 的主要特点</h4>
(1). 扩展性强。Volley 中大多是基于接口的设计，可配置性强。
(2). 一定程度符合 Http 规范，包括返回 ResponseCode(2xx、3xx、4xx、5xx）的处理，请求头的处理，缓存机制的支持等。并支持重试及优先级定义。
(3). 默认 Android2.3 及以上基于 HttpURLConnection，2.3 以下基于 HttpClient 实现，这两者的区别及优劣在<code>4.2.1 Volley</code>中具体介绍。
(4). 提供简便的图片加载工具。
<h3 id="2-">2. 总体设计</h3>
<h4 id="2-1-">2.1. 总体设计图</h4>
<img src="http://img.blog.csdn.net/20150401112601457?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZWVlZHVv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
上面是 Volley 的总体设计图，主要是通过两种<code>Dispatch Thread</code>不断从<code>RequestQueue</code>中取出请求，根据是否已缓存调用<code>Cache</code>或<code>Network</code>这两类数据获取接口之一，从内存缓存或是服务器取得请求的数据，然后交由<code>ResponseDelivery</code>去做结果分发及回调处理。
<h4 id="2-2-volley-">2.2. Volley 中的概念</h4>
简单介绍一些概念，在<code>详细设计</code>中会仔细介绍。
Volley 的调用比较简单，通过 newRequestQueue(…) 函数新建并启动一个请求队列<code>RequestQueue</code>后，只需要往这个<code>RequestQueue</code>不断 add Request 即可。

Volley：Volley 对外暴露的 API，通过 newRequestQueue(…) 函数新建并启动一个请求队列<code>RequestQueue</code>。

Request：表示一个请求的抽象类。<code>StringRequest</code>、<code>JsonRequest</code>、<code>ImageRequest</code> 都是它的子类，表示某种类型的请求。

RequestQueue：表示请求队列，里面包含一个<code>CacheDispatcher</code>(用于处理走缓存请求的调度线程)、<code>NetworkDispatcher</code>数组(用于处理走网络请求的调度线程)，一个<code>ResponseDelivery</code>(返回结果分发接口)，通过 start() 函数启动时会启动<code>CacheDispatcher</code>和<code>NetworkDispatchers</code>。

CacheDispatcher：一个线程，用于调度处理走缓存的请求。启动后会不断从缓存请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给<code>ResponseDelivery</code>去执行后续处理。当结果未缓存过、缓存失效或缓存需要刷新的情况下，该请求都需要重新进入<code>NetworkDispatcher</code>去调度处理。

NetworkDispatcher：一个线程，用于调度处理走网络的请求。启动后会不断从网络请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给<code>ResponseDelivery</code>去执行后续处理，并判断结果是否要进行缓存。

ResponseDelivery：返回结果分发接口，目前只有基于<code>ExecutorDelivery</code>的在入参 handler 对应线程内进行分发。

HttpStack：处理 Http 请求，返回请求结果。目前 Volley 中有基于 HttpURLConnection 的<code>HurlStack</code>和 基于 Apache HttpClient 的<code>HttpClientStack</code>。

Network：调用<code>HttpStack</code>处理请求，并将结果转换为可被<code>ResponseDelivery</code>处理的<code>NetworkResponse</code>。

Cache：缓存请求结果，Volley 默认使用的是基于 sdcard 的<code>DiskBasedCache</code>。<code>NetworkDispatcher</code>得到请求结果后判断是否需要存储在 Cache，<code>CacheDispatcher</code>会从 Cache 中取缓存结果。
<h3 id="3-">3. 流程图</h3>
Volley 请求流程图

<img src="http://img.blog.csdn.net/20150401113221910?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZWVlZHVv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />
<h3 id="4-">4. 详细设计</h3>
<h4 id="4-1-">4.1 类关系图</h4>
<img src="http://img.blog.csdn.net/20150401113407223?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZWVlZHVv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" />

这是 Volley 框架的主要类关系图
<blockquote>图中红色圈内的部分，组成了 Volley 框架的核心，围绕 RequestQueue 类，将各个功能点以组合的方式结合在了一起。各个功能点也都是以接口或者抽象类的形式提供。
红色圈外面的部分，在 Volley 源码中放在了toolbox包中，作为 Volley 为各个功能点提供的默认的具体实现。
通过类图我们看出， Volley 有着非常好的拓展性。通过各个功能点的接口，我们可以给出自定义的，更符合我们需求的具体实现。

多用组合，少用继承；针对接口编程，不针对具体实现编程。

优秀框架的设计，令人叫绝，受益良多。</blockquote>
<h3 id="4-2-">4.2 核心类功能介绍</h3>
<h4 id="4-2-1-volley-java">4.2.1 Volley.java</h4>
这个和 Volley 框架同名的类，其实是个工具类，作用是构建一个可用于添加网络请求的<code>RequestQueue</code>对象。
(1). 主要函数
Volley.java 有两个重载的静态方法。
<pre><code>[java]public static RequestQueue newRequestQueue(Context context) &lt;/code&gt;
&lt;code&gt;public static RequestQueue newRequestQueue(Context context, HttpStack stack) [/java]

</code></pre>
第一个方法的实现调用了第二个方法，传 HttpStack 参数为 null。
第二个方法中，如果 HttpStatck 参数为 null，则如果系统在 Gingerbread 及之后(即 API Level &gt;= 9)，采用基于 HttpURLConnection 的 HurlStack，如果小于 9，采用基于 HttpClient 的 HttpClientStack。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>510</wp:post_id>
		<wp:post_date>2015-04-01 11:38:12</wp:post_date>
		<wp:post_date_gmt>2015-04-01 03:38:12</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>volley-%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<category domain="category" nicename="android%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><![CDATA[Android源码分析]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707584]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Glide开源框架</title>
		<link>http://1.duoinfo.sinaapp.com/?p=515</link>
		<pubDate>Thu, 02 Apr 2015 01:13:25 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=515</guid>
		<description></description>
		<content:encoded><![CDATA[<h1>一、地址</h1>
github地址：<a title="https://github.com/bumptech/glide" href="https://github.com/bumptech/glide" target="_blank">https://github.com/bumptech/glide</a>

相关的下载地址：<a title="https://github.com/bumptech/glide/releases" href="https://github.com/bumptech/glide/releases" target="_blank">https://github.com/bumptech/glide/releases</a>
<h1>二、简介</h1>
<span style="color: #000080;">An image loading and caching library for Android focused on smooth scrolling---Glide是Android图片加载和缓存的开源库，专注于流畅的滑动。</span>

Glide is a fast and efficient open source media management and image loading framework for Android that <span style="color: #000080;">wraps media decoding, memory and disk caching, and resource pooling into a simple and easy to use interface.</span>

Glide supports fetching, decoding, and displaying video stills, images, and animated GIFs. Glide includes a flexible api that allows developers to plug in to almost any network stack. By default Glide uses a <span style="color: #000080;">custom HttpUrlConnection</span> based stack, but also includes utility libraries plug in to <span style="color: #000080;">Google's Volley project or Square's OkHttp library</span> instead.

Glide's primary focus is on making scrolling any kind of a list of images as smooth and fast as possible, but Glide is also effective for almost any case where you need to fetch, resize, and display a remote image.

<span style="color: #ff00ff;">下面的内容来自：<a title="http://inthecheesefactory.com/blog/get-to-know-glide-recommended-by-google/en" href="http://inthecheesefactory.com/blog/get-to-know-glide-recommended-by-google/en" target="_blank"><span style="color: #ff00ff;">http://inthecheesefactory.com/blog/get-to-know-glide-recommended-by-google/en</span></a></span>

In the passed Google Developer Summit Thailand, Google introduced us an Image Loader Library for Android developed by bumptech named <a href="https://github.com/bumptech/glide" target="_blank">Glide</a> as a library that recommended by Google. It has been used in many Google open source projects till now including Google I/O 2014 official application.

It succeeded in making me interested. I spent a whole night playing with it and decided to share  my experience in this blog post. As a begining,<span style="color: #ff00ff;"> I must say that it looks 90% similar to Picasso.</span> To be more precise, I think it is something like a Picasso-clone.

Anyway it is quite different in details. You will learn how.
<h1>三、Import to project</h1>
Both Picasso and Glide are on jcenter. You can simply import it to your project with dependency like this:
<h2>Picasso</h2>
[codesyntax lang="xml"]
<pre>dependencies {
    compile 'com.squareup.picasso:picasso:2.5.1'
}</pre>
[/codesyntax]
<h2>Glide</h2>
[codesyntax lang="xml"]
<pre>dependencies {
    compile 'com.github.bumptech.glide:glide:3.5.2'
    compile 'com.android.support:support-v4:22.0.0'
}</pre>
[/codesyntax]

Anyway Glide also needs Android Support Library v4, <span style="color: #ff00ff;">please don't forget to import <code>support-v4</code> to your project like above as well.</span> But it is not kind of a problem since Android Support Library v4 is basically needed in every single new-age Android project.
<div>
<h1><span style="color: #ff00ff;">四、Basic</span></h1>
As I said, it is very similar to Picasso. The way to load an image to ImageView with Glide is quite the same as Picasso.
<h2>Picasso</h2>
[codesyntax lang="java5"]
<pre>Picasso.with(context)
    .load("http://inthecheesefactory.com/uploads/source/glidepicasso/cover.jpg")
    .into(ivImg);</pre>
[/codesyntax]
<h2>Glide</h2>
[codesyntax lang="java5"]
<pre>Glide.with(context)
    .load("http://inthecheesefactory.com/uploads/source/glidepicasso/cover.jpg")
    .into(ivImg);</pre>
[/codesyntax]

</div>
<div>Although it looks quite the same but in details Glide is designed far better since <span style="color: #ff00ff;"><code>with</code></span> <span style="color: #0000ff;">doesn't accept only Context</span> <span style="color: #800080;">but also Activity and Fragment.</span> Context will be automatically extracted from those things you throw in.</div>
<div>

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/with.png" alt="with" />

And the brilliant benefit from passing Activity/Fragment to Glide is:<span style="color: #ff00ff;"> image loading would be integrated with Activity/Fragment's lifecycle</span> for example,<span style="color: #ff00ff;"> pause loading in Paused state and automatically resume on Resumed state.</span> So I encourage you to pass the Activity or Fragment to Glide not just a Context if possible.
<h1>五、Default Bitmap Format is RGB_565</h1>
Here is the result of image loading comparing to Picasso. (1920x1080 pixels image is loaded into 768x432 pixels ImageView)

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/firstload.jpg" alt="firstload" width="960" height="510" />

You can notice that image loaded by Glide has the worse quality compared to Picasso. Why? This is because <span style="color: #ff00ff;">Glide default Bitmap Format is set to <code>RGB_565</code> since it consumed just 50% memory footprint compared to <code>ARGB_8888</code>.</span>

Here is the memory consumption graphs between <span style="color: #ff00ff;">Picasso at ARGB8888 and Glide at RGB565. (Base application consumes around 8MB)</span>

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/ram1_1.png" alt="ram1_1" />

You don't have to do anything if you are ok with the image's quality already. But if think it is unacceptable or just not good enough for you, you can switch Bitmap Format to <code>ARGB_8888</code> by creating a new class which extended from <code>GlideModule</code> like this:

[codesyntax lang="java5"]
<pre>public class GlideConfiguration implements GlideModule {

    @Override
    public void applyOptions(Context context, GlideBuilder builder) {
        // Apply options to the builder here.
        builder.setDecodeFormat(DecodeFormat.PREFER_ARGB_8888);
    }

    @Override
    public void registerComponents(Context context, Glide glide) {
        // register ModelLoaders here.
    }
}</pre>
[/codesyntax]

And then define it as <code>meta-data</code> inside <code>AndroidManifest.xml</code>

[codesyntax lang="xml"]
<pre>&lt;meta-data android:name="com.inthecheesefactory.lab.glidepicasso.GlideConfiguration"
            android:value="GlideModule"/&gt;</pre>
[/codesyntax]

It looks far better now!

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/quality2.jpg" alt="quality2" width="960" height="510" />

Let's take a look at memory consumption graphs once again. It appears that although Glide consumes almost 2 times than previous but Picasso still consumes a lot memory footprint more than Glide.

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/ram2_1.png" alt="ram2_1" />

The reason is Picasso loads the full-size image (1920x1080 pixels) into the memory and let GPU does the real-time resizing when drawn. While <span style="color: #ff00ff;">Glide loads the exact ImageView-size (768x432 pixels) into the memory which is a best practice.</span> Anyway you can change the behavior of Picasso to do the same with <code>resize()</code> command:

[codesyntax lang="java5"]
<pre>Picasso.with(this)
    .load("http://nuuneoi.com/uploads/source/playstore/cover.jpg")
    .resize(768, 432)
    .into(ivImgPicasso);</pre>
[/codesyntax]

But the problem is you need to manually calculate the ImageView's size. Or if your ImageView has the exact size (not set to wrap_content), you can simply do like this.

[codesyntax lang="java5"]
<pre>Picasso.with(this)
    .load("http://nuuneoi.com/uploads/source/playstore/cover.jpg")
    .fit()
    .centerCrop()
    .into(ivImgPicasso);</pre>
[/codesyntax]

Memory consumption graphs are now finally almost the same !

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/memory3.png" alt="memory3" />

Although memory consumption are quite the same but I must say that Glide beats Picasso in term of functionality of this part<span style="color: #ff00ff;"> since it could calculate the ImageView size automatically in every single case.</span>
<h1>六、Image's quality in details</h1>
Here is the result when I tried to zoom an ImageView to the actual size.

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/quality3.png" alt="quality3" />

It is noticeable that image loaded by Glide has some hard pixels and is not as smooth as the Picasso one. And till now, I still couldn't find the straight way to change image resizing algorithm.

But if you ask me is it bad? I would say that it is not that noticeable in real use. Quality is acceptable but you just need to set Bitmap Format to ARGB_8888, that's all.
<h1>七、Disk Caching</h1>
Default disk caching concept of Picasso and Glide are quite different. From the experiment, the same Full HD image is loaded into ImageView with Picasso and Glide. When I checked the cache folder, it appears that <span style="color: #ff00ff;">Glide cached the ImageView-size (768x432 pixels) while Picasso cached the full-size one (1920x1080 pixels).</span>

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/cache.jpg" alt="cache" />

And yes, hard pixels described above is also there. In addition, if image is loaded in RGB565 mode, the cached image will be also in RGB565.

When I tried to adjust ImageView to the different sizes. The result is whatever the size is, Picasso will cache only single size of image, the full-size one. Glide acts differently, caches separate file for each size of ImageView. Although an image has already been loaded once but if you need to load another size the same image, <span style="color: #ff00ff;">it needs to be downloaded once again before be resized to the right resolution and then be cached.</span>

To be more clear, if there is an ImageView in the first page with 200x200 pixels dimension and there is the another one in the second page with 100x100 pixels that are needed to show the same image. You have to download the same image twice.

Anyway you could adjust its behavior by <span style="color: #ff00ff;">let Glide cache both the full-size image and the resized onewith this command.</span>

[codesyntax lang="java5"]
<pre>Glide.with(this)
     .load("http://nuuneoi.com/uploads/source/playstore/cover.jpg")
     .diskCacheStrategy(DiskCacheStrategy.ALL)
     .into(ivImgGlide);</pre>
[/codesyntax]

The next time image is requested to show on any ImageView, the full-size image would be loaded from cache, resized and then cached.

An advantage of the way Glide was designed is image could be <span style="color: #ff00ff;">loaded and showed very fast.</span> While the Picasso way causes some delay on loading <span style="color: #ff00ff;">since it needs to be resized first before is set to an ImageView even you add this command to make it showed immediately.</span>

[codesyntax lang="java5"]
<pre>//Picasso
.noFade();</pre>
[/codesyntax]

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/loading3.gif" alt="loading3" />

There is some trade off between Picasso's and Glide's way of disk caching. You can choose the way fit your app's requirement best.

For me, I prefer Glide to Picasso since it is far faster <span style="color: #ff00ff;">although it needs more space to cache the image.</span>
<h1>八、Features</h1>
You can do almost all the same things just like Picasso can do with the same style of coding for example,<strong> Image Resizing：</strong>

[codesyntax lang="java5"]
<pre>// Picasso
.resize(300, 200);

// Glide
.override(300, 200);</pre>
[/codesyntax]

<strong>Center Cropping：</strong>

[codesyntax lang="java5"]
<pre>// Picasso
.centerCrop();

// Glide
.centerCrop();</pre>
[/codesyntax]

<strong>Transforming：</strong>

[codesyntax lang="java5"]
<pre>// Picasso
.transform(new CircleTransform())

// Glide
.transform(new CircleTransform(context))</pre>
[/codesyntax]

<strong>Setting the Placeholder and Error image：</strong>

[codesyntax lang="java5"]
<pre>// Picasso
.placeholder(R.drawable.placeholder)
.error(R.drawable.imagenotfound)

// Glide
.placeholder(R.drawable.placeholder)
.error(R.drawable.imagenotfound)</pre>
[/codesyntax]

As I said, if you are familiar with Picasso, moving to Glide would be just like chewing a candy for you. =)
<h1>九、What that Glide has but Picasso doesn't</h1>
An ability to load GIF Animation to a simple ImageView might be the most interesting feature of Glide. And yes, <span style="color: #ff00ff;">you can't do that with Picasso.</span>

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/gifanimation2.gif" alt="gifanimation2" />

&nbsp;

And since Glide is designed to work perfectly with Activity/Fragment's lifecycle <span style="color: #ff00ff;">so the animation would be automatically paused and resumed along with Activity/Fragment's state.</span>

The way Glide caches is still be the same, resized first and then cached.

Anyway from an measurement I found that GIF Animation consumes quite a lot of memory. Please use it wisely.

Besides GIF Animation loading,<span style="color: #ff00ff;"> Glide is also able to decode any <em>local</em> video file to a still image.</span>

<strong><span style="color: #008000;">Another feature that might be useful is you can configure the way image appears with an Animator (R.animator) while Picasso could do only one animation, fading in.</span></strong>

The last one if you could generate a thumbnail file of an image you loaded with <code>thumbnail()</code>.

Actually there are some other features you can play with but most of them are not that important for general use for example, transcode an image into Byte Array, etc.

Configurations

You can adjust so many configurations for example, size and location of disk caching, maximum limit of memory caching, Bitmap Format and many more. You can read more about this at <a href="https://github.com/bumptech/glide/wiki/Configuration" target="_blank">Configuration</a> page.
<h1>10、Library's size</h1>
Picasso (v2.5.1)'s size is around 118KB while Glide (v3.5.2)'s is around 430KB.

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/librarysize.png" alt="librarysize" />

Anyway 312KB difference might not be that significant.

Method count of Picasso and Glide are at 840 and 2678 respectively.

<img src="http://inthecheesefactory.com/uploads/source/glidepicasso/methodcount.png" alt="methodcount" />

I must say 2678 is quite a lot for 65535 methods limit of Android DEX file. ProGuard is recommended to turn on if you choose Glide. (And you should turn it on anyway for production release).
<h1>11、Conclusion</h1>
Neither Glide nor Picasso is perfect. The way Glide loads an image to memory and do the caching is better than Picasso which let an image loaded far faster. In addition, it also helps preventing an app from popular OutOfMemoryError. GIF Animation loading is a killing feature provided by Glide. <span style="color: #008000;">Anyway Picasso decodes an image with better quality than Glide.</span>

Which one do I prefer? Although I use Picasso for such a very long time, I must admit that I now prefer Glide. But I would recommend you to change Bitmap Format to ARGB_8888 and let Glide cache both full-size image and resized one first. The rest would do your job great!

Resources

There are not so many online resources related to Glide. But here are what I found. Please take a look on links below.

- <a href="http://google-opensource.blogspot.com/2014/09/glide-30-media-management-library-for.html" target="_blank">Glide 3.0: a media management library for Android</a>

- <a href="https://github.com/bumptech/glide/wiki" target="_blank">Glide Wiki</a>

- <a href="http://pluu.github.io/android%20study/2015/01/15/android-glide-picasso/" target="_blank">Android Picasso vs Glide</a>

- <a href="http://vardhan-justlikethat.blogspot.com/2014/09/android-image-loading-libraries-picasso.html" target="_blank">Android: Image loading libraries Picasso vs Glide</a>

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>515</wp:post_id>
		<wp:post_date>2015-04-02 09:13:25</wp:post_date>
		<wp:post_date_gmt>2015-04-02 01:13:25</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>glide%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707585]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[4]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>Glide开源框架demo</title>
		<link>http://1.duoinfo.sinaapp.com/?p=522</link>
		<pubDate>Thu, 02 Apr 2015 06:49:37 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=522</guid>
		<description></description>
		<content:encoded><![CDATA[<div>&lt;pre class="prettyprint linenums" &gt;
<pre></pre>
&lt;/pre&gt;

&nbsp;

&lt;pre class="prettyprint linenums"&gt;

package com.dy.glidedemo;

import java.util.ArrayList;
import java.util.List;

import com.bumptech.glide.Glide;

import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.ImageView;
import android.widget.ListView;

public class MainActivity extends Activity {

private ListView list;

@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);
list = (ListView) findViewById(R.id.list);

Adapter adapter = new Adapter(this);

list.setAdapter(adapter);
}

class Adapter extends BaseAdapter{
public final String[] imageThumbUrls = new String[] {
"http://img.my.csdn.net/uploads/201407/26/1406383299_1976.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383291_6518.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383291_8239.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383290_9329.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383290_1042.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383275_3977.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383265_8550.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383264_3954.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383264_4787.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383264_8243.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383248_3693.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383243_5120.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383242_3127.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383242_9576.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383242_1721.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383219_5806.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383214_7794.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383213_4418.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383213_3557.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383210_8779.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383172_4577.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383166_3407.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383166_2224.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383166_7301.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383165_7197.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383150_8410.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383131_3736.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383130_5094.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383130_7393.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383129_8813.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383100_3554.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383093_7894.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383092_2432.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383092_3071.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383091_3119.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383059_6589.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383059_8814.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383059_2237.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383058_4330.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406383038_3602.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382942_3079.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382942_8125.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382942_4881.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382941_4559.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382941_3845.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382924_8955.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382923_2141.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382923_8437.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382922_6166.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382922_4843.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382905_5804.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382904_3362.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382904_2312.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382904_4960.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382900_2418.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382881_4490.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382881_5935.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382880_3865.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382880_4662.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382879_2553.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382862_5375.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382862_1748.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382861_7618.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382861_8606.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382861_8949.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382841_9821.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382840_6603.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382840_2405.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382840_6354.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382839_5779.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382810_7578.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382810_2436.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382809_3883.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382809_6269.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382808_4179.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382790_8326.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382789_7174.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382789_5170.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382789_4118.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382788_9532.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382767_3184.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382767_4772.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382766_4924.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382766_5762.jpg",
"http://img.my.csdn.net/uploads/201407/26/1406382765_7341.jpg"
};
private List&lt;String&gt; urls;

private Context context;

public Adapter(Context context) {
urls = new ArrayList&lt;String&gt;();
for (int i = 0; i &lt; imageThumbUrls.length; i++) {
urls.add(imageThumbUrls[i]);
}
this.context = context;
}

@Override
public int getCount() {
// TODO Auto-generated method stub
return urls.size();
}

@Override
public Object getItem(int position) {
// TODO Auto-generated method stub
return urls.get(position);
}

@Override
public long getItemId(int position) {
// TODO Auto-generated method stub
return position;
}

@Override
public View getView(int position, View recycled, ViewGroup parent) {
final ImageView myImageView;
if (recycled == null) {
myImageView = (ImageView) LayoutInflater.from(context).inflate(R.layout.item,
parent, false);
} else {
myImageView = (ImageView) recycled;
}

String url = urls.get(position);

Glide.with(context)
.load(url)
.centerCrop()
.placeholder(R.drawable.ic_launcher)
.crossFade()
.into(myImageView);

return myImageView;
}

}

}&lt;/pre&gt;

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>522</wp:post_id>
		<wp:post_date>2015-04-02 14:49:37</wp:post_date>
		<wp:post_date_gmt>2015-04-02 06:49:37</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>glide%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6demo</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="android%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6"><![CDATA[Android开源框架]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707586]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[4]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>ViewPager和PhotoView一起使用带来的问题</title>
		<link>http://1.duoinfo.sinaapp.com/?p=526</link>
		<pubDate>Thu, 02 Apr 2015 07:13:52 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=526</guid>
		<description></description>
		<content:encoded><![CDATA[ViewPager和PhotoView一起使用的问题：

在使用的时候会一直报一个错误：<a href="http://blog.csdn.net/yy958836746/article/details/21536969" rel="nofollow">java.lang.ArrayIndexOutOfBoundsException: length=1; index=1</a>

解决：

[codesyntax lang="java5"]
<pre>public class HackyViewPager extends ViewPager {

public HackyViewPager(Context context)
{
    super(context);
}

public HackyViewPager(Context context, AttributeSet attrs)
{
    super(context, attrs);
}
@Override
public boolean onInterceptTouchEvent(MotionEvent ev)
{
    try
    {
            return super.onInterceptTouchEvent(ev);
    }
    catch (IllegalArgumentException e)
    {
    }
    catch (ArrayIndexOutOfBoundsException e)
    {

    }
    return false;
}
}</pre>
[/codesyntax]

xml引用即可。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>526</wp:post_id>
		<wp:post_date>2015-04-02 15:13:52</wp:post_date>
		<wp:post_date_gmt>2015-04-02 07:13:52</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>viewpager%e5%92%8cphotoview%e4%b8%80%e8%b5%b7%e4%bd%bf%e7%94%a8%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="android%e5%bc%80%e5%8f%91"><![CDATA[Android开发]]></category>
		<category domain="category" nicename="codingnet"><![CDATA[CodingNet]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707587]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:comment>
			<wp:comment_id>13</wp:comment_id>
			<wp:comment_author><![CDATA[遇到的问题以及解决的方式 | 一个开发者]]></wp:comment_author>
			<wp:comment_author_email></wp:comment_author_email>
			<wp:comment_author_url>http://1.duoinfo.sinaapp.com/?p=416</wp:comment_author_url>
			<wp:comment_author_IP>220.181.136.217</wp:comment_author_IP>
			<wp:comment_date>2015-04-02 15:15:42</wp:comment_date>
			<wp:comment_date_gmt>2015-04-02 07:15:42</wp:comment_date_gmt>
			<wp:comment_content><![CDATA[[...] 解决：http://1.duoinfo.sinaapp.com/?p=526    上一篇 / 下一篇   分享到： QQ空间 新浪微博 腾讯微博 人人网 搜狐微博 开心网 百度空间 更多     if (typeof DUOSHUO !== &#039;undefined&#039;) DUOSHUO.EmbedThread(&#039;.ds-thread&#039;); [...]]]></wp:comment_content>
			<wp:comment_approved>0</wp:comment_approved>
			<wp:comment_type>pingback</wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
		</wp:comment>
	</item>
	<item>
		<title>c++成员变量的初始化顺序</title>
		<link>http://1.duoinfo.sinaapp.com/?p=530</link>
		<pubDate>Tue, 07 Apr 2015 01:47:37 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=530</guid>
		<description></description>
		<content:encoded><![CDATA[如下的代码，分析其输出：

[codesyntax lang="c++"]
<pre>#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;

using namespace std;

class A
{
private:
	int n1;
	int n2;
public:
	A() :n2(0), n1(n2 + 1)
	{

	}
	void Print()
	{
		cout &lt;&lt; n1 &lt;&lt; n2 &lt;&lt; endl;
	}
};
void main()
{
	A a;
	a.Print();
	getchar();
}</pre>
[/codesyntax]

其实在C++中，成员变量的初始化顺序只与他们在类中声明的顺序有关，而与在初始化列表中的顺序无关。所以最后输出的结果不确定。]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>530</wp:post_id>
		<wp:post_date>2015-04-07 09:47:37</wp:post_date>
		<wp:post_date_gmt>2015-04-07 01:47:37</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>c%e6%88%90%e5%91%98%e5%8f%98%e9%87%8f%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96%e9%a1%ba%e5%ba%8f</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<category domain="post_tag" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707588]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>字符串转换成整数</title>
		<link>http://1.duoinfo.sinaapp.com/?p=536</link>
		<pubDate>Thu, 09 Apr 2015 07:51:32 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=536</guid>
		<description></description>
		<content:encoded><![CDATA[在这个程序当中，需要考虑的因素还是很多的：

1.空指针NULL

2.空字符串""

3.正负号（"+123"输出123,"-123"输出"-123","+0"输出0,"-0"输出0）

4.溢出（最大0X7FFFFFFF最小0X80000000）

下面是完整的程序：

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;

using namespace std;

long long StrToIntCore(const char *str, bool minus);

enum Status
{
 kValid = 0,kInvalid
};

int g_nStatus = 0;

int StrToInt(const char *str)
{
 g_nStatus = kInvalid;
 long long num = 0;
 if (str != NULL &amp;&amp; *str != '&#92;&#48;')
 {
 bool minus = false;
 if (*str == '+')
 {
 str++;
 }
 else if (*str == '-')
 {
 str++;
 minus = true;
 }
 if (*str != '&#92;&#48;')
 {
 num = StrToIntCore(str, minus);
 }

}
 return (int)num;
}
long long StrToIntCore(const char *digit, bool minus)
{
 long long num = 0;
 while (*digit != '&#92;&#48;')
 {
 if (*digit &gt;= '0' &amp;&amp; *digit &lt;= '9')
 {
 int flag = minus ? -1 : 1;
 num = num * 10 + flag *(*digit - '0');

if ((!minus &amp;&amp; num &gt;= 0x7FFFFFFF) || (minus &amp;&amp; num &lt; (signed int)0x80000000))
 {
 num = 0;
 break;
 }
 digit++;
 }
 else
 {
 num = 0;
 break;
 }
 }
 if (*digit == '&#92;&#48;')
 {
 g_nStatus = kValid;
 }
 return num;
}
void Test(char *string)
{
 int result = StrToInt(string);
 if (result ==0 &amp;&amp; g_nStatus == kInvalid)
 {
 printf(&quot;The input %s is invalid.\n&quot;,string);
 }
 else
 {
 printf(&quot;number for %s is: %d.\n&quot;, string, result);
 }
}
void main()
{
 Test(NULL);
 Test(&quot;&quot;);
 Test(&quot;123&quot;);
 Test(&quot;+123&quot;);
 Test(&quot;-123&quot;);
 Test(&quot;1a33&quot;);
 Test(&quot;+0&quot;);
 Test(&quot;-0&quot;);
 //有效的最大的正整数 0X7FFFFFFF
 Test(&quot;+2147483647&quot;);
 Test(&quot;-2147483647&quot;);
 Test(&quot;+2147483648&quot;);
 //有效的最小的负整数 0X80000000
 Test(&quot;-2147483648&quot;);
 Test(&quot;+2147483649&quot;);
 Test(&quot;-2147483649&quot;);
 Test(&quot;+&quot;);
 Test(&quot;-&quot;);
 system(&quot;pause&quot;);
}[/cpp]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>536</wp:post_id>
		<wp:post_date>2015-04-09 15:51:32</wp:post_date>
		<wp:post_date_gmt>2015-04-09 07:51:32</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%ad%97%e7%ac%a6%e4%b8%b2%e8%bd%ac%e6%8d%a2%e6%88%90%e6%95%b4%e6%95%b0</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707589]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>树中两个结点的最低公共祖先</title>
		<link>http://1.duoinfo.sinaapp.com/?p=539</link>
		<pubDate>Thu, 09 Apr 2015 08:42:21 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=539</guid>
		<description></description>
		<content:encoded><![CDATA[实质上，这是一组问题。

1.如果是二叉搜索树的情况（二叉搜索树是排过序的）；

2.普通树，树的结点有指向父结点的指针(转换成求两个链表的第一个公共结点)；

3.普通的树，但是树中没有指向父结点的指针；

完整的代码如下：
<div>

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;list&gt;
#include &lt;vector&gt;

using namespace std;

struct TreeNode
{
 int m_nValue;
 vector&lt;TreeNode*&gt; m_vChildren;
};
bool GetNodePath(TreeNode *pRoot, TreeNode *pNode, list&lt;TreeNode*&gt; &amp;path)
{
 if (pRoot == pNode)
 {
 return true;
 }
 path.push_back(pRoot);
 bool found = false;
 vector&lt;TreeNode*&gt;::iterator i = pRoot-&gt;m_vChildren.begin();
 while (!found &amp;&amp; i &lt; pRoot-&gt;m_vChildren.end())
 {
 found = GetNodePath(*i, pNode, path);
 ++i;
 }
 if (!found)
 {
 path.pop_back();
 }
 return found;
}
TreeNode *GetLastCommonNode(const list&lt;TreeNode*&gt; &amp;path1, const list&lt;TreeNode*&gt; &amp;path2)
{
 list&lt;TreeNode *&gt;::const_iterator iterator1 = path1.begin();
 list&lt;TreeNode *&gt;::const_iterator iterator2 = path2.begin();
 TreeNode *pLast = NULL;
 while (iterator1 != path1.end() &amp;&amp; iterator2 != path2.end())
 {
 if (*iterator1 == *iterator2)
 {
 pLast = *iterator1;
 }
 iterator1++;
 iterator2++;
 }
 return pLast;
}
TreeNode *GetLastCommonParent(TreeNode *pRoot, TreeNode *pNode1, TreeNode *pNode2)
{
 if (pRoot == NULL || pNode1 == NULL || pNode2 == NULL)
 {
 return NULL;
 }
 list&lt;TreeNode *&gt; path1;
 GetNodePath(pRoot, pNode1, path1);
 list&lt;TreeNode *&gt; path2;
 GetNodePath(pRoot, pNode1, path2);
 return GetLastCommonNode(path1, path2);
}[/cpp]

</div>]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>539</wp:post_id>
		<wp:post_date>2015-04-09 16:42:21</wp:post_date>
		<wp:post_date_gmt>2015-04-09 08:42:21</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e6%a0%91%e4%b8%ad%e4%b8%a4%e4%b8%aa%e7%bb%93%e7%82%b9%e7%9a%84%e6%9c%80%e4%bd%8e%e5%85%ac%e5%85%b1%e7%a5%96%e5%85%88</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707590]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[2]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>c++设计不能被继承的类</title>
		<link>http://1.duoinfo.sinaapp.com/?p=542</link>
		<pubDate>Thu, 09 Apr 2015 08:55:57 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=542</guid>
		<description></description>
		<content:encoded><![CDATA[两种方式，各有不同，代码如下：

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;

using namespace std;

/**
方式1：只能得到位于堆上的实例，而得不到位于栈上的实例
*/
class SealedClass1
{
public:
 static SealedClass1 *GetInstance()
 {
 return new SealedClass1();
 }
 static void DeleteInstance(SealedClass1 *pInstance)
 {
 delete pInstance;
 }
private:
 SealedClass1();
 ~SealedClass1();
};
/**
方式2：利用虚继承（可移植性不太好）
*/
template&lt;typename T&gt; class MakeSealed
{
 friend T;
private:
 MakeSealed();
 ~MakeSealed();
};
class SealedClass2 :virtual public MakeSealed&lt;SealedClass2&gt;
{
public:
 SealedClass2();
 ~SealedClass2();
};[/cpp]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>542</wp:post_id>
		<wp:post_date>2015-04-09 16:55:57</wp:post_date>
		<wp:post_date_gmt>2015-04-09 08:55:57</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>c%e8%ae%be%e8%ae%a1%e4%b8%8d%e8%83%bd%e8%a2%ab%e7%bb%a7%e6%89%bf%e7%9a%84%e7%b1%bb</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707591]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>不用加减乘除做加法</title>
		<link>http://1.duoinfo.sinaapp.com/?p=545</link>
		<pubDate>Thu, 09 Apr 2015 09:06:39 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=545</guid>
		<description></description>
		<content:encoded><![CDATA[第一步：不考虑进位（异或运算）

第二步：考虑进位（与运算然后左移）

直到没有进位运算完毕：

完整的代码：

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;

using namespace std;

int Add(int num1, int num2)
{
 int sum, carry;
 do
 {
 sum = num1 ^ num2;
 carry = (num1 &amp; num2) &lt;&lt; 1;
 num1 = sum;
 num2 = carry;
 } while (num2 != 0);
 return num1;
}[/cpp]

推广：

异或运算也可以交换两个变量，不使用临时变量：

[cpp]a = a^b;

b = a^b;

a= a^b;[/cpp]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>545</wp:post_id>
		<wp:post_date>2015-04-09 17:06:39</wp:post_date>
		<wp:post_date_gmt>2015-04-09 09:06:39</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e4%b8%8d%e7%94%a8%e5%8a%a0%e5%87%8f%e4%b9%98%e9%99%a4%e5%81%9a%e5%8a%a0%e6%b3%95</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707592]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>求1+2+...+n不能使用乘除法、for、while、if、else、switch、case等关键字以及条件判断语句(A?B:C)</title>
		<link>http://1.duoinfo.sinaapp.com/?p=550</link>
		<pubDate>Mon, 13 Apr 2015 08:15:59 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=550</guid>
		<description></description>
		<content:encoded><![CDATA[这个题没多大的意思，这里提供一个思路，使用构造器来完成，代码如下：

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;
#include &lt;ctime&gt;
#include &lt;exception&gt;

using namespace std;

class Temp
{
public:
 Temp(){ ++N; Sum += N; }

static void Reset(){ N = 0; Sum = 0; }

static unsigned int GetSum(){ return Sum; }
private:
 static unsigned int N;

static unsigned int Sum;
};

unsigned int Temp::N = 0;
unsigned int Temp::Sum = 0;

unsigned int Sum_Solution1(unsigned int n)
{
 Temp::Reset();
 Temp *a = new Temp();
 delete[]a;
 a = NULL;
 return Temp::GetSum();
}[/cpp]]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>550</wp:post_id>
		<wp:post_date>2015-04-13 16:15:59</wp:post_date>
		<wp:post_date_gmt>2015-04-13 08:15:59</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e6%b1%8212-n%e4%b8%8d%e8%83%bd%e4%bd%bf%e7%94%a8%e4%b9%98%e9%99%a4%e6%b3%95%e3%80%81for%e3%80%81while%e3%80%81if%e3%80%81else%e3%80%81switch%e3%80%81case%e7%ad%89%e5%85%b3%e9%94%ae%e5%ad%97</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707593]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
	</item>
	<item>
		<title>圆圈中最后剩下的数字</title>
		<link>http://1.duoinfo.sinaapp.com/?p=553</link>
		<pubDate>Mon, 13 Apr 2015 09:08:53 +0000</pubDate>
		<dc:creator>duoinfo</dc:creator>
		<guid isPermaLink="false">http://1.duoinfo.sinaapp.com/?p=553</guid>
		<description></description>
		<content:encoded><![CDATA[典型的约瑟夫环问题，两种解决方式。

1.环形链表

代码如下：

[cpp]#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;cstdio&gt;
#include &lt;list&gt;
#include &lt;iterator&gt;

using namespace std;

int LastRemaining(unsigned int n, unsigned int m)
{
 if (n &lt; 1 || m &lt; 1)
 {
 return -1;
 }
 unsigned int i = 0;
 list&lt;int&gt; numbers;
 for (i = 0; i &lt; n;i++)
 {
 numbers.push_back(i);
 }
 list&lt;int&gt;::iterator current = numbers.begin();
 while (numbers.size() &gt; 1)
 {
 for (int i = 1; i &lt; m;i++)
 {
 current++;
 if (current == numbers.end())
 {
 current = numbers.begin();
 }
 }
 list&lt;int&gt;::iterator next = ++current;
 if (next == numbers.end())
 {
 next = numbers.begin();
 }
 --current;
 numbers.erase(current);
 current = next;
 }
 return *(current);
}
void main()
{
 int result = LastRemaining(5, 3);
 cout &lt;&lt; result &lt;&lt; endl;
 system(&quot;pause&quot;);
}[/cpp]

时间复杂度为:O(mn)

空间复杂度为：O(n)

2.不需要额外的辅助空间

[java]int LastRemaining2(unsigned int n, unsigned int m)
{
 if (n &lt; 1 || m &lt; 1)
 {
 return -1;
 }
 int last = 0;
 for (int i = 2; i &lt;= n;i++)
 {
 last = (last + m) % i;
 }
 return last;
}

void main()
{
 int result = LastRemaining2(5, 3);
 cout &lt;&lt; result &lt;&lt; endl;
 system(&quot;pause&quot;);
}[/java]

&nbsp;]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>553</wp:post_id>
		<wp:post_date>2015-04-13 17:08:53</wp:post_date>
		<wp:post_date_gmt>2015-04-13 09:08:53</wp:post_date_gmt>
		<wp:comment_status>open</wp:comment_status>
		<wp:ping_status>open</wp:ping_status>
		<wp:post_name>%e5%9c%86%e5%9c%88%e4%b8%ad%e6%9c%80%e5%90%8e%e5%89%a9%e4%b8%8b%e7%9a%84%e6%95%b0%e5%ad%97</wp:post_name>
		<wp:status>publish</wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type>post</wp:post_type>
		<wp:post_password></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
		<category domain="category" nicename="%e5%89%91%e6%8c%87offer"><![CDATA[剑指offer]]></category>
		<wp:postmeta>
			<wp:meta_key>_edit_last</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>_syntaxhighlighter_encoded</wp:meta_key>
			<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>post_views_count</wp:meta_key>
			<wp:meta_value><![CDATA[0]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>duoshuo_thread_id</wp:meta_key>
			<wp:meta_value><![CDATA[1376650130626707594]]></wp:meta_value>
		</wp:postmeta>
		<wp:postmeta>
			<wp:meta_key>views</wp:meta_key>
			<wp:meta_value><![CDATA[9]]></wp:meta_value>
		</wp:postmeta>
	</item>
</channel>
</rss>
